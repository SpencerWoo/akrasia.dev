<!doctype html><html lang=pt-br class=no-js><head><meta name=robots content="noindex, nofollow"><link rel=alternate hreflang=en href=https://kubernetes.io/blog/><link rel=alternate hreflang=zh-cn href=https://kubernetes.io/zh-cn/blog/><link rel=alternate hreflang=ko href=https://kubernetes.io/ko/blog/><link rel=alternate hreflang=ja href=https://kubernetes.io/ja/blog/><link rel=alternate hreflang=fr href=https://kubernetes.io/fr/blog/><link rel=alternate hreflang=it href=https://kubernetes.io/it/blog/><link rel=alternate hreflang=de href=https://kubernetes.io/de/blog/><link rel=alternate hreflang=es href=https://kubernetes.io/es/blog/><link rel=alternate hreflang=vi href=https://kubernetes.io/vi/blog/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://kubernetes.io/pt-br/blog/><link rel="shortcut icon" type=image/png href=/images/favicon.png><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon href=/images/kubernetes-192x192.png><title>Kubernetes Blog | Kubernetes</title><meta property="og:title" content="Kubernetes Blog"><meta property="og:description" content="Orquestra√ß√£o de cont√™ineres em n√≠vel de produ√ß√£o"><meta property="og:type" content="website"><meta property="og:url" content="https://kubernetes.io/pt-br/blog/"><meta property="og:site_name" content="Kubernetes"><meta itemprop=name content="Kubernetes Blog"><meta itemprop=description content="Orquestra√ß√£o de cont√™ineres em n√≠vel de produ√ß√£o"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kubernetes Blog"><meta name=twitter:description content="Orquestra√ß√£o de cont√™ineres em n√≠vel de produ√ß√£o"><link href=/scss/main.css rel=stylesheet><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png","potentialAction":{"@type":"SearchAction","target":"https://kubernetes.io/search/?q={search_term_string}","query-input":"required name=search_term_string"}}</script><meta name=theme-color content="#326ce5"><link rel=stylesheet href=/css/feature-states.css><meta name=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:url" content="https://kubernetes.io/pt-br/blog/"><meta property="og:title" content="Kubernetes Blog"><meta name=twitter:title content="Kubernetes Blog"><meta name=twitter:image content="https://kubernetes.io/images/favicon.png"><meta name=twitter:image:alt content="Kubernetes"><meta property="og:type" content="article"><script src=/js/jquery-3.6.0.min.js intregrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class="td-section td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary><a class=navbar-brand href=/pt-br/></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/pt-br/docs/>Documenta√ß√£o</a></li><li class="nav-item mr-2 mb-lg-0"><a class="nav-link active" href=/pt-br/blog/>Kubernetes Blog</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/pt-br/partners/>Parceiros</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/pt-br/community/>Comunidade</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/pt-br/case-studies/>Casos de estudo</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Vers√µes</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/pt-br/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/pt-br/blog/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/pt-br/blog/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/pt-br/blog/>v1.23</a>
<a class=dropdown-item href=https://v1-22.docs.kubernetes.io/pt-br/blog/>v1.22</a>
<a class=dropdown-item href=https://v1-21.docs.kubernetes.io/pt-br/blog/>v1.21</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Portugu√™s (Portuguese)</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/blog/>English</a>
<a class=dropdown-item href=/zh-cn/blog/>‰∏≠Êñá (Chinese)</a>
<a class=dropdown-item href=/ko/blog/>ÌïúÍµ≠Ïñ¥ (Korean)</a>
<a class=dropdown-item href=/ja/blog/>Êó•Êú¨Ë™û (Japanese)</a>
<a class=dropdown-item href=/fr/blog/>Fran√ßais (French)</a>
<a class=dropdown-item href=/it/blog/>Italiano (Italian)</a>
<a class=dropdown-item href=/de/blog/>Deutsch (German)</a>
<a class=dropdown-item href=/es/blog/>Espa√±ol (Spanish)</a>
<a class=dropdown-item href=/vi/blog/>Ti·∫øng Vi·ªát (Vietnamese)</a></div></li></ul></div><button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Essa √© a vers√£o completa de impress√£o dessa se√ß√£o
<a href=# onclick="return print(),!1">Clique aqui para imprimir</a>.</p><p><a href=/pt-br/blog/>Retornar √† visualiza√ß√£o normal</a>.</p></div><h1 class=title>Kubernetes Blog</h1><ul><li><a href=#pg-0fc668557182aa480318ef29b97df9df>Atualizado: Perguntas frequentes (FAQ) sobre a remo√ß√£o do Dockershim</a></li><li><a href=#pg-d0001c21fb6f2f9b21c0faa11a149fae>N√£o entre em p√¢nico: Kubernetes e Docker</a></li><li><a href=#pg-c911fec01c1b20f202397599afbea2d2>Escalando a rede do Kubernetes com EndpointSlices</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-0fc668557182aa480318ef29b97df9df>Atualizado: Perguntas frequentes (FAQ) sobre a remo√ß√£o do Dockershim</h1><div class="td-byline mb-4"><time datetime=2022-02-17 class=text-muted>17.02.2022</time></div><p><strong>Esta √© uma atualiza√ß√£o do artigo original <a href=/blog/2020/12/02/dockershim-faq/>FAQ sobre a deprecia√ß√£o do Dockershim</a>,
publicado no final de 2020.</strong></p><p>Este documento aborda algumas perguntas frequentes sobre a
descontinua√ß√£o e remo√ß√£o do <em>dockershim</em>, que foi
<a href=/blog/2020/12/08/kubernetes-1-20-release-announcement/>anunciado</a>
como parte do lan√ßamento do Kubernetes v1.20. Para obter mais detalhes sobre
o que isso significa, confira a postagem do blog
<a href=/pt-br/blog/2020/12/02/dont-panic-kubernetes-and-docker/>N√£o entre em p√¢nico: Kubernetes e Docker</a>.</p><p>Al√©m disso, voc√™ pode ler <a href=/docs/tasks/administer-cluster/migrating-from-dockershim/check-if-dockershim-removal-affects-you/>verifique se a remo√ß√£o do dockershim afeta voc√™</a>
para determinar qual impacto a remo√ß√£o do <em>dockershim</em> teria para voc√™
ou para sua organiza√ß√£o.</p><p>Como o lan√ßamento do Kubernetes 1.24 se tornou iminente, estamos trabalhando bastante para tentar fazer uma transi√ß√£o suave.</p><ul><li>Escrevemos uma postagem no blog detalhando nosso <a href=/blog/2022/01/07/kubernetes-is-moving-on-from-dockershim/>compromisso e os pr√≥ximos passos</a>.</li><li>Acreditamos que n√£o h√° grandes obst√°culos para a migra√ß√£o para <a href=/docs/setup/production-environment/container-runtimes/#container-runtimes>outros agentes de execu√ß√£o de cont√™iner</a>.</li><li>H√° tamb√©m um guia <a href=/docs/tasks/administer-cluster/migrating-from-dockershim/>Migrando do dockershim</a> dispon√≠vel.</li><li>Tamb√©m criamos uma p√°gina para listar
<a href=/docs/reference/node/topics-on-dockershim-and-cri-compatible-runtimes/>artigos sobre a remo√ß√£o do dockershim e sobre o uso de agentes de execu√ß√£o compat√≠veis com CRI</a>. Essa lista inclui alguns dos documentos j√° mencionados e tamb√©m
abrange fontes externas selecionadas (incluindo guias de fornecedores).</li></ul><h3 id=por-que-o-dockershim-est√°-sendo-removido-do-kubernetes>Por que o <em>dockershim</em> est√° sendo removido do Kubernetes?</h3><p>As primeiras vers√µes do Kubernetes funcionavam apenas com um ambiente de execu√ß√£o de cont√™iner espec√≠fico:
Docker Engine. Mais tarde, o Kubernetes adicionou suporte para trabalhar com outros agentes de execu√ß√£o de cont√™iner.
O padr√£o CRI (<em>Container Runtime Interface</em> ou Interface de Agente de Execu√ß√£o de Containers) foi <a href=/blog/2016/12/container-runtime-interface-cri-in-kubernetes/>criado</a> para
habilitar a interoperabilidade entre orquestradores (como Kubernetes) e diferentes agentes
de execu√ß√£o de cont√™iner.
O Docker Engine n√£o implementa essa interface (CRI), ent√£o o projeto Kubernetes criou um
c√≥digo especial para ajudar na transi√ß√£o, e tornou esse c√≥digo <em>dockershim</em> parte do projeto
Kubernetes.</p><p>O c√≥digo <em>dockershim</em> sempre foi destinado a ser uma solu√ß√£o tempor√°ria (da√≠ o nome: <em>shim</em>).
Voc√™ pode ler mais sobre a discuss√£o e o planejamento da comunidade na
<a href=https://github.com/kubernetes/enhancements/tree/master/keps/sig-node/2221-remove-dockershim>Proposta de remo√ß√£o do Dockershim para aprimoramento do Kubernetes</a>.
Na verdade, manter o <em>dockershim</em> se tornou um fardo pesado para os mantenedores do Kubernetes.</p><p>Al√©m disso, recursos que s√£o amplamente incompat√≠veis com o <em>dockershim</em>, como
<em>cgroups v2</em> e <em>namespaces</em> de usu√°rio est√£o sendo implementados nos agentes de execu√ß√£o de CRI
mais recentes. A remo√ß√£o do suporte para o <em>dockershim</em> permitir√° um maior
desenvolvimento nessas √°reas.</p><h3 id=ainda-posso-usar-o-docker-engine-no-kubernetes-1-23>Ainda posso usar o Docker Engine no Kubernetes 1.23?</h3><p>Sim, a √∫nica coisa que mudou na vers√£o 1.20 √© a presen√ßa de um aviso no log de inicializa√ß√£o
do <a href=/docs/reference/command-line-tools-reference/kubelet/>kubelet</a> se estiver usando o Docker Engine como agente de execu√ß√£o de cont√™iner.
Voc√™ ver√° este aviso em todas as vers√µes at√© 1.23. A remo√ß√£o do <em>dockershim</em> ocorre no Kubernetes 1.24.</p><h3 id=quando-o-dockershim-ser√°-removido>Quando o <em>dockershim</em> ser√° removido?</h3><p>Dado o impacto dessa mudan√ßa, estamos definindo um cronograma de deprecia√ß√£o mais longo.
A remo√ß√£o do <em>dockershim</em> est√° agendada para o Kubernetes v1.24, consulte a
<a href=https://github.com/kubernetes/enhancements/tree/master/keps/sig-node/2221-remove-dockershim>Proposta de remo√ß√£o do Dockershim para aprimoramento do Kubernetes</a>.
O projeto Kubernetes trabalhar√° em estreita colabora√ß√£o com fornecedores e outros ecossistemas para garantir
uma transi√ß√£o suave e avaliar√° os acontecimentos √† medida que a situa√ß√£o for evoluindo.</p><h3 id=ainda-posso-usar-o-docker-engine-como-meu-agente-de-execu√ß√£o-do-cont√™iner>Ainda posso usar o Docker Engine como meu agente de execu√ß√£o do cont√™iner?</h3><p>Primeiro, se voc√™ usa o Docker em seu pr√≥prio PC para desenvolver ou testar cont√™ineres: nada muda.
Voc√™ ainda pode usar o Docker localmente, independentemente dos agentes de execu√ß√£o de cont√™iner que
voc√™ usa em seus Clusters Kubernetes. Os cont√™ineres tornam esse tipo de interoperabilidade poss√≠vel.</p><p>Mirantis e Docker <a href=https://www.mirantis.com/blog/mirantis-to-take-over-support-of-kubernetes-dockershim-2/>comprometeram-se</a> a manter um adaptador substituto para o
Docker Engine, e a manter este adaptador mesmo ap√≥s o <em>dockershim</em> ser removido
do Kubernetes. O adaptador substituto √© chamado <a href=https://github.com/Mirantis/cri-dockerd><code>cri-dockerd</code></a>.</p><h3 id=minhas-imagens-de-cont√™iner-existentes-ainda-funcionar√£o>Minhas imagens de cont√™iner existentes ainda funcionar√£o?</h3><p>Sim, as imagens produzidas a partir do <code>docker build</code> funcionar√£o com todas as implementa√ß√µes do CRI.
Todas as suas imagens existentes ainda funcionar√£o exatamente da mesma forma.</p><h4 id=e-as-imagens-privadas>E as imagens privadas?</h4><p>Sim. Todos os agentes de execu√ß√£o de CRI s√£o compat√≠veis com as mesmas configura√ß√µes de segredos usadas no
Kubernetes, seja por meio do PodSpec ou ServiceAccount.</p><h3 id=docker-e-cont√™ineres-s√£o-a-mesma-coisa>Docker e cont√™ineres s√£o a mesma coisa?</h3><p>Docker popularizou o padr√£o de cont√™ineres Linux e tem sido fundamental no
desenvolvimento desta tecnologia. No entanto, os cont√™ineres j√° existiam
no Linux h√° muito tempo. O ecossistema de cont√™ineres cresceu para ser muito
mais abrangente do que apenas Docker. Padr√µes como o OCI e o CRI ajudaram muitas
ferramentas a crescer e prosperar no nosso ecossistema, alguns substituindo
aspectos do Docker, enquanto outros aprimoram funcionalidades j√° existentes.</p><h3 id=existem-exemplos-de-pessoas-que-usam-outros-agentes-de-execu√ß√£o-de-cont√™ineres-em-produ√ß√£o-hoje>Existem exemplos de pessoas que usam outros agentes de execu√ß√£o de cont√™ineres em produ√ß√£o hoje?</h3><p>Todos os artefatos produzidos pelo projeto Kubernetes (bin√°rios Kubernetes) s√£o validados
a cada lan√ßamento de vers√£o.</p><p>Al√©m disso, o projeto <a href=https://kind.sigs.k8s.io/>kind</a> vem usando containerd h√° algum tempo e tem
visto uma melhoria na estabilidade para seu caso de uso. Kind e containerd s√£o executados
v√°rias vezes todos os dias para validar quaisquer altera√ß√µes na base de c√≥digo do Kubernetes.
Outros projetos relacionados seguem um padr√£o semelhante, demonstrando a estabilidade e
usabilidade de outros agentes de execu√ß√£o de cont√™iner. Como exemplo, o OpenShift 4.x utiliza
o agente de execu√ß√£o <a href=https://cri-o.io/>CRI-O</a> em produ√ß√£o desde junho de 2019.</p><p>Para outros exemplos e refer√™ncias, d√™ uma olhada em projetos adeptos do containerd e
CRI-O, dois agentes de execu√ß√£o de cont√™ineres sob o controle da <em>Cloud Native Computing Foundation</em>
(<a href=https://cncf.io>CNCF</a>).</p><ul><li><a href=https://github.com/containerd/containerd/blob/master/ADOPTERS.md>containerd</a></li><li><a href=https://github.com/cri-o/cri-o/blob/master/ADOPTERS.md>CRI-O</a></li></ul><h3 id=as-pessoas-continuam-referenciando-oci-o-que-√©-isso>As pessoas continuam referenciando OCI, o que √© isso?</h3><p>OCI significa <em><a href=https://opencontainers.org/about/overview/>Open Container Initiative</a></em> (ou Iniciativa Open Source de Cont√™ineres), que padronizou muitas das
interfaces entre ferramentas e tecnologias de cont√™iner. Eles mant√™m uma
especifica√ß√£o padr√£o para imagens de cont√™iner (OCI image-spec) e para
cont√™ineres em execu√ß√£o (OCI runtime-spec). Eles tamb√©m mant√™m uma implementa√ß√£o real
da especifica√ß√£o do agente de execu√ß√£o na forma de <a href=https://github.com/opencontainers/runc>runc</a>, que √© o agente de execu√ß√£o padr√£o
para ambos <a href=https://containerd.io/>containerd</a> e <a href=https://cri-o.io/>CRI-O</a>. O CRI baseia-se nessas especifica√ß√µes de baixo n√≠vel para
fornecer um padr√£o de ponta a ponta para gerenciar cont√™ineres.</p><h3 id=qual-implementa√ß√£o-de-cri-devo-usar>Qual implementa√ß√£o de CRI devo usar?</h3><p>Essa √© uma pergunta complexa e depende de muitos fatores. Se voc√™ estiver
trabalhando com Docker, mudar para containerd deve ser uma troca relativamente f√°cil e
ter√° um desempenho estritamente melhor e menos sobrecarga. No entanto, n√≥s encorajamos voc√™ a
explorar todas as op√ß√µes do <a href="https://landscape.cncf.io/card-mode?category=container-runtime&grouping=category">cen√°rio CNCF</a>, pois outro agente de execu√ß√£o de cont√™iner
pode funcionar ainda melhor para o seu ambiente.</p><h3 id=o-que-devo-ficar-atento-ao-mudar-a-minha-implementa√ß√£o-de-cri-utilizada>O que devo ficar atento ao mudar a minha implementa√ß√£o de CRI utilizada?</h3><p>Embora o c√≥digo de conteineriza√ß√£o base seja o mesmo entre o Docker e a maioria dos
CRIs (incluindo containerd), existem algumas poucas diferen√ßas. Alguns
pontos a se considerar ao migrar s√£o:</p><ul><li>Configura√ß√£o de <em>log</em></li><li>Limita√ß√µes de recursos de agentes de execu√ß√£o</li><li>Scripts de provisionamento que chamam o docker ou usam o docker por meio de seu soquete de controle</li><li>Plugins kubectl que exigem CLI do docker ou o soquete de controle</li><li>Ferramentas do projeto Kubernetes que requerem acesso direto ao Docker Engine
(por exemplo: a ferramenta depreciada <code>kube-imagepuller</code>)</li><li>Configura√ß√£o de funcionalidades como <code>registry-mirrors</code> e <em>registries</em> inseguros</li><li>Outros scripts de suporte ou <em>daemons</em> que esperam que o Docker Engine esteja dispon√≠vel e seja executado
fora do Kubernetes (por exemplo, agentes de monitoramento ou seguran√ßa)</li><li>GPUs ou hardware especial e como eles se integram ao seu agente de execu√ß√£o e ao Kubernetes</li></ul><p>Se voc√™ usa solicita√ß√µes ou limites de recursos do Kubernetes ou usa DaemonSets para coleta de logs
em arquivos, eles continuar√£o a funcionar da mesma forma. Mas se voc√™ personalizou
sua configura√ß√£o <code>dockerd</code>, voc√™ precisar√° adapt√°-la para seu novo agente de execu√ß√£o de
cont√™iner assim que poss√≠vel.</p><p>Outro aspecto a ser observado √© que ferramentas para manuten√ß√£o do sistema ou execu√ß√µes dentro de um
cont√™iner no momento da cria√ß√£o de imagens podem n√£o funcionar mais. Para o primeiro, a ferramenta
<a href=https://github.com/kubernetes-sigs/cri-tools><code>crictl</code></a> pode ser utilizada como um substituto natural (veja
<a href=https://kubernetes.io/docs/tasks/debug/debug-cluster/crictl/#mapping-from-docker-cli-to-crictl>migrando do docker cli para o crictl</a>)
e para o √∫ltimo, voc√™ pode usar novas op√ß√µes de constru√ß√µes de cont√™iner, como <a href=https://github.com/genuinetools/img>img</a>, <a href=https://github.com/containers/buildah>buildah</a>,
<a href=https://github.com/GoogleContainerTools/kaniko>kaniko</a>, ou <a href=https://github.com/vmware-tanzu/buildkit-cli-for-kubectl>buildkit-cli-for-kubectl</a> que n√£o requerem Docker.</p><p>Para containerd, voc√™ pode come√ßar com sua <a href=https://github.com/containerd/cri/blob/master/docs/registry.md>documenta√ß√£o</a> para ver quais op√ß√µes de configura√ß√£o
est√£o dispon√≠veis √† medida que voc√™ v√° realizando a migra√ß√£o.</p><p>Para obter instru√ß√µes sobre como usar containerd e CRI-O com Kubernetes, consulte o
documenta√ß√£o do Kubernetes em <a href=/docs/setup/production-environment/container-runtimes/>Agentes de execu√ß√£o de cont√™ineres</a></p><h3 id=e-se-eu-tiver-mais-perguntas>E se eu tiver mais perguntas?</h3><p>Se voc√™ usa uma distribui√ß√£o do Kubernetes com suporte do fornecedor, pode perguntar a eles sobre
planos de atualiza√ß√£o para seus produtos. Para perguntas de usu√°rio final, poste-as
no nosso f√≥rum da comunidade de usu√°rios: <a href=https://discuss.kubernetes.io/>https://discuss.kubernetes.io/</a>.</p><p>Voc√™ tamb√©m pode conferir a excelente postagem do blog
<a href=https://dev.to/inductor/wait-docker-is-deprecated-in-kubernetes-now-what-do-i-do-e4m>Espere, o Docker est√° depreciado no Kubernetes agora?</a>, uma discuss√£o t√©cnica mais aprofundada
sobre as mudan√ßas.</p><h3 id=posso-ganhar-um-abra√ßo>Posso ganhar um abra√ßo?</h3><p>Sim, ainda estamos dando abra√ßos se solicitado. ü§óü§óü§ó</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d0001c21fb6f2f9b21c0faa11a149fae>N√£o entre em p√¢nico: Kubernetes e Docker</h1><div class="td-byline mb-4"><time datetime=2020-12-02 class=text-muted>02.12.2020</time></div><p><strong>Autores / Autoras</strong>: Jorge Castro, Duffie Cooley, Kat Cosgrove, Justin Garrison, Noah Kantrowitz, Bob Killen, Rey Lejano, Dan ‚ÄúPOP‚Äù Papandrea, Jeffrey Sica, Davanum ‚ÄúDims‚Äù Srinivas</p><p><strong>Tradu√ß√£o:</strong> Jo√£o Brito</p><p>Kubernetes est√° <a href=https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.20.md#deprecation>deixando de usar Docker</a> como seu agente de execu√ß√£o ap√≥s a vers√£o v1.20.</p><p><strong>N√£o entre em p√¢nico. N√£o √© t√£o dram√°tico quanto parece.</strong></p><p>TL;DR Docker como um agente de execu√ß√£o prim√°rio est√° sendo deixado de lado em favor de agentes de execu√ß√£o que utilizam a Interface de Agente de Execu√ß√£o de Containers (Container Runtime Interface "CRI") criada para o Kubernetes. As imagens criadas com o Docker continuar√£o a funcionar em seu cluster com os agentes atuais, como sempre estiveram.</p><p>Se voc√™ √© um usu√°rio final de Kubernetes, quase nada mudar√° para voc√™. Isso n√£o significa a morte do Docker, e isso n√£o significa que voc√™ n√£o pode, ou n√£o deva, usar ferramentas Docker em desenvolvimento mais. Docker ainda √© uma ferramenta √∫til para a constru√ß√£o de containers, e as imagens resultantes de executar <code>docker build</code> ainda rodar√£o em seu cluster Kubernetes.</p><p>Se voc√™ est√° usando um Kubernetes gerenciado como GKE, EKS, ou AKS (que usa como <a href=https://github.com/Azure/AKS/releases/tag/2020-11-16>padr√£o containerd</a>) voc√™ precisar√° ter certeza que seus n√≥s est√£o usando um agente de execu√ß√£o de container suportado antes que o suporte ao Docker seja removido nas vers√µes futuras do Kubernetes. Se voc√™ tem mudan√ßas em seus n√≥s, talvez voc√™ precise atualiz√°-los baseado em seu ambiente e necessidades do agente de execu√ß√£o.</p><p>Se voc√™ est√° rodando seus pr√≥prios clusters, voc√™ tamb√©m precisa fazer mudan√ßas para evitar quebras em seu cluster. Na vers√£o v1.20, voc√™ ter√° o aviso de alerta da perda de suporte ao Docker. Quando o suporte ao agente de execu√ß√£o do Docker for removido em uma vers√£o futura (atualmente planejado para a vers√£o 1.22 no final de 2021) do Kubernetes ele n√£o ser√° mais suportado e voc√™ precisar√° trocar para um dos outros agentes de execu√ß√£o de container compat√≠vel, como o containerd ou CRI-O. Mas tenha certeza que esse agente de execu√ß√£o escolhido tenha suporte √†s configura√ß√µes do daemon do Docker usadas atualmente (Ex.: logs)</p><h2 id=ent√£o-porque-a-confus√£o-e-toda-essa-turma-surtando>Ent√£o porque a confus√£o e toda essa turma surtando?</h2><p>Estamos falando aqui de dois ambientes diferentes, e isso est√° criando essa confus√£o. Dentro do seu cluster Kubernetes, existe uma coisa chamada de agente de execu√ß√£o de container que √© respons√°vel por baixar e executar as imagens de seu container. Docker √© a escolha popular para esse agente de execu√ß√£o (outras escolhas comuns incluem containerd e CRI-O), mas Docker n√£o foi projetado para ser embutido no Kubernetes, e isso causa problemas.</p><p>Se liga, o que chamamos de "Docker" n√£o √© exatamente uma coisa - √© uma stack tecnol√≥gica inteira, e uma parte disso √© chamado de "containerd", que √© o agente de execu√ß√£o de container de alto-n√≠vel por si s√≥. Docker √© legal e √∫til porque ele possui muitas melhorias de experi√™ncia do usu√°rio e isso o torna realmente f√°cil para humanos interagirem com ele enquanto est√£o desenvolvendo, mas essas melhorias para o usu√°rio n√£o s√£o necess√°rias para o Kubernetes, pois ele n√£o √© humano.</p><p>Como resultado dessa camada de abstra√ß√£o amig√°vel aos humanos, seu cluster Kubernetes precisa usar outra ferramenta chamada Dockershim para ter o que ele realmente precisa, que √© o containerd. Isso n√£o √© muito bom, porque adiciona outra coisa a ser mantida e que pode quebrar. O que est√° atualmente acontecendo aqui √© que o Dockershim est√° sendo removido do Kubelet assim que que a vers√£o v1.23 for lan√ßada, que remove o suporte ao Docker como agente de execu√ß√£o de container como resultado. Voc√™ deve estar pensando, mas se o containerd est√° incluso na stack do Docker, porque o Kubernetes precisa do Dockershim?</p><p>Docker n√£o √© compat√≠vel com CRI, a <a href=https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/>Container Runtime Interface</a> (interface do agente de execu√ß√£o de container). Se fosse, n√≥s n√£o precisar√≠amos do shim, e isso n√£o seria nenhum problema. Mas isso n√£o √© o fim do mundo, e voc√™ n√£o precisa entrar em p√¢nico - voc√™ s√≥ precisa mudar seu agente de execu√ß√£o de container do Docker para um outro suportado.</p><p>Uma coisa a ser notada: Se voc√™ est√° contando com o socket do Docker (<code>/var/run/docker.sock</code>) como parte do seu fluxo de trabalho em seu cluster hoje, mover para um agente de execu√ß√£o diferente acaba com sua habilidade de us√°-lo. Esse modelo √© conhecido como Docker em Docker. Existem diversas op√ß√µes por a√≠ para esse caso espec√≠fico como o <a href=https://github.com/GoogleContainerTools/kaniko>kaniko</a>, <a href=https://github.com/genuinetools/img>img</a>, e <a href=https://github.com/containers/buildah>buildah</a>.</p><h2 id=o-que-essa-mudan√ßa-representa-para-os-desenvolvedores-ainda-escrevemos-dockerfiles-ainda-vamos-fazer-build-com-docker>O que essa mudan√ßa representa para os desenvolvedores? Ainda escrevemos Dockerfiles? Ainda vamos fazer build com Docker?</h2><p>Essa mudan√ßa aborda um ambiente diferente do que a maioria das pessoas usa para interagir com Docker. A instala√ß√£o do Docker que voc√™ est√° usando em desenvolvimento n√£o tem rela√ß√£o com o agente de execu√ß√£o de Docker dentro de seu cluster Kubernetes. √â confuso, d√° pra entender.
Como desenvolvedor, Docker ainda √© √∫til para voc√™ em todas as formas que era antes dessa mudan√ßa ser anunciada. A imagem que o Docker cria n√£o √© uma imagem espec√≠fica para Docker e sim uma imagem que segue o padr√£o OCI (<a href=https://opencontainers.org/>Open Container Initiative</a>).</p><p>Qualquer imagem compat√≠vel com OCI, independente da ferramenta usada para constru√≠-la ser√° vista da mesma forma pelo Kubernetes. Ambos <a href=https://containerd.io/>containerd</a> e <a href=https://cri-o.io/>CRI-O</a> sabem como baixar e execut√°-las. Esse √© o porque temos um padr√£o para containers.</p><p>Ent√£o, essa mudan√ßa est√° chegando. Isso ir√° causar problemas para alguns, mas nada catastr√≥fico, no geral √© uma boa coisa. Dependendo de como voc√™ interage com o Kubernetes, isso tornar√° as coisas mais f√°ceis. Se isso ainda √© confuso para voc√™, tudo bem, tem muita coisa rolando aqui; Kubernetes tem um monte de partes m√≥veis, e ningu√©m √© 100% especialista nisso. N√≥s encorajamos toda e qualquer tipo de quest√£o independente do n√≠vel de experi√™ncia ou de complexidade! Nosso objetivo √© ter certeza que todos est√£o entendendo o m√°ximo poss√≠vel as mudan√ßas que est√£o chegando. Esperamos que isso tenha respondido a maioria de suas quest√µes e acalmado algumas ansiedades! ‚ù§Ô∏è</p><p>Procurando mais respostas? D√™ uma olhada em nosso apanhado de <a href=/blog/2020/12/02/dockershim-faq/>quest√µes quanto ao desuso do Dockershim</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c911fec01c1b20f202397599afbea2d2>Escalando a rede do Kubernetes com EndpointSlices</h1><div class="td-byline mb-4"><time datetime=2020-09-02 class=text-muted>02.09.2020</time></div><p><strong>Autor:</strong> Rob Scott (Google)</p><p>EndpointSlices √© um novo tipo de API que prov√™ uma alternativa escal√°vel e extens√≠vel √† API de Endpoints. EndpointSlices mant√©m o rastreio dos endere√ßos IP, portas, informa√ß√µes de topologia e prontid√£o de Pods que comp√µem um servi√ßo.</p><p>No Kubernetes 1.19 essa funcionalidade est√° habilitada por padr√£o, com o kube-proxy lendo os <a href=/docs/concepts/services-networking/endpoint-slices/>EndpointSlices</a> ao inv√©s de Endpoints. Apesar de isso ser uma mudan√ßa praticamente transparente, resulta numa melhoria not√°vel de escalabilidade em grandes clusters. Tamb√©m permite a adi√ß√£o de novas funcionalidades em releases futuras do Kubernetes, como o <a href=/docs/concepts/services-networking/service-topology/>Roteamento baseado em topologia.</a>.</p><h2 id=limita√ß√µes-de-escalabilidade-da-api-de-endpoints>Limita√ß√µes de escalabilidade da API de Endpoints</h2><p>Na API de Endpoints, existia apenas um recurso de Endpoint por servi√ßo (Service). Isso significa que
era necess√°rio ser poss√≠vel armazenar endere√ßos IPs e portas para cada Pod que compunha o servi√ßo correspondente. Isso resultava em recursos imensos de API. Para piorar, o kube-proxy rodava em cada um dos n√≥s e observava qualquer altera√ß√£o nos recursos de Endpoint. Mesmo que fosse uma simples mudan√ßa em um Endpoint, todo o objeto precisava ser enviado para cada uma das inst√¢ncias do kube-proxy.</p><p>Outra limita√ß√£o da API de Endpoints era que ela limitava o n√∫mero de objetos que podiam ser associados a um <em>Service</em>. O tamanho padr√£o de um objeto armazenado no etcd √© 1.5MB. Em alguns casos, isso poderia limitar um Endpoint a 5,000 IPs de Pod. Isso n√£o chega a ser um problema para a maioria dos usu√°rios, mas torna-se um problema significativo para servi√ßos que se aproximem desse tamanho.</p><p>Para demonstrar o qu√£o significante se torna esse problema em grande escala, vamos usar de um simples exemplo: Imagine um <em>Service</em> que possua 5,000 Pods, e que possa causar o Endpoint a ter 1.5Mb . Se apenas um Endpoint nessa lista sofra uma altera√ß√£o, todo o objeto de Endpoint precisar√° ser redistribu√≠do para cada um dos n√≥s do cluster. Em um cluster com 3.000 n√≥s, essa atualiza√ß√£o causar√° o envio de 4.5Gb de dados (1.5Mb de Endpoints * 3,000 n√≥s) para todo o cluster. Isso √© quase que o suficiente para encher um DVD, e acontecer√° para cada mudan√ßa de Endpoint. Agora imagine uma atualiza√ß√£o gradual em um <em>Deployment</em> que resulte nos 5,000 Pods serem substitu√≠dos - isso √© mais que 22Tb (ou 5,000 DVDs) de dados transferidos.</p><h2 id=dividindo-os-endpoints-com-a-api-de-endpointslice>Dividindo os endpoints com a API de EndpointSlice</h2><p>A API de EndpointSlice foi desenhada para resolver esse problema com um modelo similar de <em>sharding</em>. Ao inv√©s de rastrar todos os IPs dos Pods para um <em>Service</em>, com um √∫nico recurso de Endpoint, n√≥s dividimos eles em m√∫ltiplos EndpointSlices menores.</p><p>Usemos por exemplo um servi√ßo com 15 pods. N√≥s ter√≠amos um √∫nico recurso de Endpoints referente a todos eles. Se o EndpointSlices for configurado para armazenar 5 <em>endpoints</em> cada, n√≥s ter√≠amos 3 EndpointSlices diferentes:
<img src=/images/blog/2020-09-02-scaling-kubernetes-networking-endpointslices/endpoint-slices.png alt=EndpointSlices></p><p>Por padr√£o, o EndpointSlices armazena um m√°ximo de 100 <em>endpoints</em> cada, podendo isso ser configurado com a flag <code>--max-endpoints-per-slice</code> no kube-controller-manager.</p><h2 id=endpointslices-prov√™-uma-melhoria-de-escalabilidade-em-10x>EndpointSlices prov√™ uma melhoria de escalabilidade em 10x</h2><p>Essa API melhora dramaticamente a escalabilidade da rede. Agora quando um Pod √© adicionado ou removido, apenas 1 pequeno EndpointSlice necessita ser atualizado. Essa diferen√ßa come√ßa a ser notada quando centenas ou milhares de Pods comp√µem um √∫nico <em>Service</em>.</p><p>Mais significativo, agora que todos os IPs de Pods para um <em>Service</em> n√£o precisam ser armazenados em um √∫nico recurso, n√≥s n√£o precisamos nos preocupar com o limite de tamanho para objetos armazendos no etcd. EndpointSlices j√° foram utilizados para escalar um servi√ßo al√©m de 100,000 endpoints de rede.</p><p>Tudo isso √© poss√≠vel com uma melhoria significativa de performance feita no kube-proxy. Quando o EndpointSlices √© usado em grande escala, muito menos dados ser√£o transferidos para as atualiza√ß√µes de endpoints e o kube-proxy torna-se mais r√°pido para atualizar regras do iptables ou do ipvs. Al√©m disso, os <em>Services</em> podem escalar agora para pelo menos 10x mais al√©m dos limites anteriores.</p><h2 id=endpointslices-permitem-novas-funcionalidades>EndpointSlices permitem novas funcionalidades</h2><p>Introduzido como uma funcionalidade alpha no Kubernetes v1.16, os EndpointSlices foram constru√≠dos para permitir algumas novas funcionalidades arrebatadoras em futuras vers√µes do Kubernetes. Isso inclui servi√ßos dual-stack, roteamento baseado em topologia e subconjuntos de <em>endpoints</em>.</p><p>Servi√ßos Dual-stack s√£o uma nova funcionalidade que foi desenvolvida juntamente com o EndpointSlices. Eles ir√£o utilizar simult√¢neamente endere√ßos IPv4 e IPv6 para servi√ßos, e dependem do campo addressType do Endpointslices para conter esses novos tipos de endere√ßo por fam√≠lia de IP.</p><p>O roteamento baseado por topologia ir√° atualizar o kube-proxy para dar prefer√™ncia no roteamento de requisi√ß√µes para a mesma regi√£o ou zona, utilizando-se de campos de topologia armazenados em cada endpoint dentro de um EndpointSlice. Como uma melhoria futura disso, estamos explorando o potencial de subconjuntos de endpoint. Isso ir√° permitir o kube-proxy apenas observar um subconjunto de EndpointSlices. Por exemplo, isso pode ser combinado com o roteamento baseado em topologia e assim, o kube-proxy precisar√° observar apenas EndpointSlices contendo <em>endpoints</em> na mesma zona. Isso ir√° permitir uma outra melhoria significativa de escalabilidade.</p><h2 id=o-que-isso-significa-para-a-api-de-endpoints>O que isso significa para a API de Endpoints?</h2><p>Apesar da API de EndpointSlice prover uma alternativa nova e escal√°vel √† API de Endpoints, a API de Endpoints continuar√° a ser considerada uma funcionalidade est√°vel. A mudan√ßa mais significativa para a API de Endpoints envolve come√ßar a truncar Endpoints que podem causar problemas de escalabilidade.</p><p>A API de Endpoints n√£o ser√° removida, mas muitas novas funcionalidades ir√£o depender da nova API EndpointSlice. Para obter vant√°gem da funcionalidade e escalabilidade que os EndpointSlices prov√©m, aplica√ß√µes que hoje consomem a API de Endpoints devem considerar suportar EndpointSlices no futuro.</p></div></main></div></div><footer class=d-print-none><div class=footer__links><nav><a class=text-white href=/pt-br/docs/home/>Home</a>
<a class=text-white href=/pt-br/blog/>Blog</a>
<a class=text-white href=/pt-br/partners/>Parceiros</a>
<a class=text-white href=/pt-br/community/>Comunidade</a>
<a class=text-white href=/pt-br/case-studies/>Casos de estudo</a></nav></div><div class=container-fluid><div class=row><div class="col-6 col-sm-2 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank href=https://discuss.kubernetes.io><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank href=https://twitter.com/kubernetesio><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar><a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io"><i class="fas fa-calendar-alt"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank href=https://youtube.com/kubernetescommunity><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-2 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank href=https://slack.k8s.io><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute><a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide><i class="fas fa-edit"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-12 col-sm-8 text-center order-sm-2"><small class=text-white>&copy; 2023 Os autores do Kubernetes | Documenta√ß√£o Distribu√≠da sob <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small><br><small class=text-white>Copyright &copy; 2023 A Funda√ß√£o Linux &reg;. Todos os direitos reservados. A Linux Foundation tem marcas registradas e usa marcas registradas. Para uma lista de marcas registradas da The Linux Foundation, por favor, veja nossa <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>P√°gina de uso de marca registrada</a></small><br><small class=text-white>ICP license: ‰∫¨ICPÂ§á17074266Âè∑-3</small></div></div></div></footer></div><script src=/js/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=/js/popper-1.16.1.min.js intregrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=/js/bootstrap-4.6.1.min.js integrity=sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2 crossorigin=anonymous></script>
<script src=/js/script.js></script>
<script async src=/js/mermaid-8.13.4.min.js integrity=sha384-5hHNvPeMrNH14oM3IcQofDoBhiclNK3g2+hnEinKzQ07C4AliMeVpnvxuiwEGpaO crossorigin=anonymous></script>
<script src=/js/main.min.5c0bf7f21dc4f66485f74efbbeeff28a7e4f8cddaac1bae47043159c922ff3a3.js integrity="sha256-XAv38h3E9mSF9077vu/yin5PjN2qwbrkcEMVnJIv86M=" crossorigin=anonymous></script></body></html>