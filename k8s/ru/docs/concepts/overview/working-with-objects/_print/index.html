<!doctype html><html lang=ru class=no-js><head><meta name=robots content="noindex, nofollow"><link rel=alternate hreflang=en href=https://kubernetes.io/docs/concepts/overview/working-with-objects/><link rel=alternate hreflang=zh-cn href=https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/><link rel=alternate hreflang=ko href=https://kubernetes.io/ko/docs/concepts/overview/working-with-objects/><link rel=alternate hreflang=ja href=https://kubernetes.io/ja/docs/concepts/overview/working-with-objects/><link rel=alternate hreflang=fr href=https://kubernetes.io/fr/docs/concepts/overview/working-with-objects/><link rel=alternate hreflang=es href=https://kubernetes.io/es/docs/concepts/overview/working-with-objects/><link rel=alternate hreflang=pt-br href=https://kubernetes.io/pt-br/docs/concepts/overview/working-with-objects/><link rel=alternate hreflang=id href=https://kubernetes.io/id/docs/concepts/overview/working-with-objects/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://kubernetes.io/ru/docs/concepts/overview/working-with-objects/><link rel="shortcut icon" type=image/png href=/images/favicon.png><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon href=/images/kubernetes-192x192.png><title>Работа с объектами Kubernetes | Kubernetes</title><meta property="og:title" content="Работа с объектами Kubernetes"><meta property="og:description" content="Первоклассная оркестрация контейнеров"><meta property="og:type" content="website"><meta property="og:url" content="https://kubernetes.io/ru/docs/concepts/overview/working-with-objects/"><meta property="og:site_name" content="Kubernetes"><meta itemprop=name content="Работа с объектами Kubernetes"><meta itemprop=description content="Первоклассная оркестрация контейнеров"><meta name=twitter:card content="summary"><meta name=twitter:title content="Работа с объектами Kubernetes"><meta name=twitter:description content="Первоклассная оркестрация контейнеров"><link href=/scss/main.css rel=stylesheet><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png","potentialAction":{"@type":"SearchAction","target":"https://kubernetes.io/search/?q={search_term_string}","query-input":"required name=search_term_string"}}</script><meta name=theme-color content="#326ce5"><link rel=stylesheet href=/css/feature-states.css><meta name=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:url" content="https://kubernetes.io/ru/docs/concepts/overview/working-with-objects/"><meta property="og:title" content="Работа с объектами Kubernetes"><meta name=twitter:title content="Работа с объектами Kubernetes"><meta name=twitter:image content="https://kubernetes.io/images/favicon.png"><meta name=twitter:image:alt content="Kubernetes"><meta property="og:image" content="/images/kubernetes-horizontal-color.png"><meta property="og:type" content="article"><script src=/js/jquery-3.6.0.min.js intregrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary><a class=navbar-brand href=/ru/></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-2 mb-lg-0"><a class="nav-link active" href=/ru/docs/>Документация</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ru/community/>Сообщество</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ru/case-studies/>Примеры использования</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Versions</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/ru/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/ru/docs/concepts/overview/working-with-objects/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/ru/docs/concepts/overview/working-with-objects/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/ru/docs/concepts/overview/working-with-objects/>v1.23</a>
<a class=dropdown-item href=https://v1-22.docs.kubernetes.io/ru/docs/concepts/overview/working-with-objects/>v1.22</a>
<a class=dropdown-item href=https://v1-21.docs.kubernetes.io/ru/docs/concepts/overview/working-with-objects/>v1.21</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Русский (Russian)</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/concepts/overview/working-with-objects/>English</a>
<a class=dropdown-item href=/zh-cn/docs/concepts/overview/working-with-objects/>中文 (Chinese)</a>
<a class=dropdown-item href=/ko/docs/concepts/overview/working-with-objects/>한국어 (Korean)</a>
<a class=dropdown-item href=/ja/docs/concepts/overview/working-with-objects/>日本語 (Japanese)</a>
<a class=dropdown-item href=/fr/docs/concepts/overview/working-with-objects/>Français (French)</a>
<a class=dropdown-item href=/es/docs/concepts/overview/working-with-objects/>Español (Spanish)</a>
<a class=dropdown-item href=/pt-br/docs/concepts/overview/working-with-objects/>Português (Portuguese)</a>
<a class=dropdown-item href=/id/docs/concepts/overview/working-with-objects/>Bahasa Indonesia</a></div></li></ul></div><button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Это многостраничный печатный вид этого раздела.
<a href=# onclick="return print(),!1">Нажмите что бы печатать</a>.</p><p><a href=/ru/docs/concepts/overview/working-with-objects/>Вернуться к обычному просмотру страницы</a>.</p></div><h1 class=title>Работа с объектами Kubernetes</h1><ul><li>1: <a href=#pg-9f5adfa77f48c50d5cc81155a3cecb98>Изучение объектов Kubernetes</a></li><li>2: <a href=#pg-6751db8ff5409476de8225d17d6c42dd>Управление объектами Kubernetes</a></li><li>3: <a href=#pg-f37749a83c2916b63279ea60f3cfe53e>Имена и идентификаторы объектов</a></li><li>4: <a href=#pg-1127165f472b7181b9c1d5a0b187d620>Пространства имён</a></li><li>5: <a href=#pg-f1dec4557fb8ffbac9f11390aaaf9fa4>Метки и селекторы</a></li><li>6: <a href=#pg-93cd7a1d4e1623e2bf01afc49a5af69c>Аннотации</a></li><li>7: <a href=#pg-046c03090d47bc4b89b818dc645c3865>Селекторы полей</a></li><li>8: <a href=#pg-5dd62c6a4a481b4cf1ac50f6799eb581>Рекомендуемые метки</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-9f5adfa77f48c50d5cc81155a3cecb98>1 - Изучение объектов Kubernetes</h1><p>На этой странице объясняется, как объекты Kubernetes представлены в API Kubernetes, и как их можно определить в формате <code>.yaml</code>.</p><h2 id=kubernetes-objects>Изучение объектов Kubernetes</h2><p><em>Объекты Kubernetes</em> — сущности, которые хранятся в Kubernetes. Kubernetes использует их для представления состояния кластера. В частности, они описывают следующую информацию:</p><ul><li>Какие контейнеризированные приложения запущены (и на каких узлах).</li><li>Доступные ресурсы для этих приложений.</li><li>Стратегии управления приложения, которые относятся, например, к перезапуску, обновлению или отказоустойчивости.</li></ul><p>После создания объекта Kubernetes будет следить за существованием объекта. Создавая объект, вы таким образом указываете системе Kubernetes, какой должна быть рабочая нагрузка кластера; это <em>требуемое состояние</em> кластера.</p><p>Для работы с объектами Kubernetes – будь то создание, изменение или удаление — нужно использовать <a href=/docs/concepts/overview/kubernetes-api/>API Kubernetes</a>. Например, при использовании CLI-инструмента <code>kubectl</code>, он обращается к API Kubernetes. С помощью одной из <a href=/docs/reference/using-api/client-libraries/>клиентской библиотеки</a> вы также можете использовать API Kubernetes в собственных программах.</p><h3 id=спецификация-и-статус-объекта>Спецификация и статус объекта</h3><p>Почти в каждом объекте Kubernetes есть два вложенных поля-объекта, которые управляют конфигурацией объекта: <em><code>spec</code></em> и <em><code>status</code></em>.
При создании объекта в поле <code>spec</code> указывается <em>требуемое состояние</em> (описание характеристик, которые должны быть у объекта).</p><p>Поле <code>status</code> описывает <em>текущее состояние</em> объекта, которое создаётся и обновляется самим Kubernetes и его компонентами. <a class=glossary-tooltip title='Уровень оркестрации контейнеров с API и интерфейсами для определения, развёртывания и управления жизненным циклом контейнеров.' data-toggle=tooltip data-placement=top href='/ru/docs/reference/glossary/?all=true#term-control-plane' target=_blank aria-label='Плоскость управления'>Плоскость управления</a> Kubernetes непрерывно управляет фактическим состоянием каждого объекта, чтобы оно соответствовало требуемому состоянию, которое было задано пользователем.</p><p>Например: Deployment — это объект Kubernetes, представляющий работающее приложение в кластере. При создании объекта Deployment вы можете указать в его поле <code>spec</code>, что хотите иметь три реплики приложения. Система Kubernetes получит спецификацию объекта Deployment и запустит три экземпляра приложения, таким образом обновит статус (состояние) объекта, чтобы он соответствовал заданной спецификации. В случае сбоя одного из экземпляров (это влечет за собой изменение состояние), Kubernetes обнаружит несоответствие между спецификацией и статусом и исправит его, т.е. активирует новый экземпляр вместо того, который вышел из строя.</p><p>Для получения дополнительной информации о спецификации объекта, статусе и метаданных смотрите документ с <a href=https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md>соглашениями API Kubernetes</a>.</p><h3 id=описание-объекта-kubernetes>Описание объекта Kubernetes</h3><p>При создании объекта в Kubernetes нужно передать спецификацию объекта, которая содержит требуемое состояние, а также основную информацию об объекте (например, его имя). Когда вы используете API Kubernetes для создания объекта (напрямую либо через <code>kubectl</code>), соответствующий API-запрос должен включать в теле запроса всю указанную информацию в JSON-формате. <strong>В большинстве случаев вы будете передавать <code>kubectl</code> эти данные, записанные в файле .yaml</strong>. Тогда инструмент <code>kubectl</code> преобразует их в формат JSON при выполнении запроса к API.</p><p>Ниже представлен пример <code>.yaml</code>-файла, в котором заданы обязательные поля и спецификация объекта, необходимая для объекта Deployment в Kubernetes:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/ru/examples/application/deployment.yaml download=application/deployment.yaml><code>application/deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-deployment-yaml")' title="Copy application/deployment.yaml to clipboard"></img></div><div class=includecode id=application-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># до версии 1.9.0 нужно использовать apps/v1beta2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># запускает 2 пода, созданных по шаблону</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Один из способов создания объекта Deployment с помощью файла <code>.yaml</code>, показанного выше — использовать команду <a href=/docs/reference/generated/kubectl/kubectl-commands#apply><code>kubectl apply</code></a>, которая принимает в качестве аргумента файл в формате <code>.yaml</code>. Например:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/deployment.yaml --record
</span></span></code></pre></div><p>Вывод будет примерно таким:</p><pre tabindex=0><code>deployment.apps/nginx-deployment created
</code></pre><h3 id=обязательные-поля>Обязательные поля</h3><p>В файле <code>.yaml</code> создаваемого объекта Kubernetes необходимо указать значения для следующих полей:</p><ul><li><code>apiVersion</code> — используемая для создания объекта версия API Kubernetes</li><li><code>kind</code> — тип создаваемого объекта</li><li><code>metadata</code> — данные, позволяющие идентифицировать объект (<code>name</code>, <code>UID</code> и необязательное поле <code>namespace</code>)</li><li><code>spec</code> — требуемое состояние объекта</li></ul><p>Конкретный формат поля-объекта <code>spec</code> зависит от типа объекта Kubernetes и содержит вложенные поля, предназначенные только для используемого объекта. В <a href=/docs/reference/generated/kubernetes-api/v1.25/>справочнике API Kubernetes</a> можно найти формат спецификации любого объекта Kubernetes.
Например, формат <code>spec</code> для объекта Pod находится в <a href=/docs/reference/generated/kubernetes-api/v1.25/#podspec-v1-core>ядре PodSpec v1</a>, а формат <code>spec</code> для Deployment — в <a href=/docs/reference/generated/kubernetes-api/v1.25/#deploymentspec-v1-apps>DeploymentSpec v1 apps</a>.</p><h2 id=что-дальше>Что дальше</h2><ul><li><a href=/docs/reference/using-api/api-overview/>Обзор API Kubernetes</a> более подробно объясняет некоторые из API-концепций</li><li>Познакомиться с наиболее важными и основными объектами в Kubernetes, например, с <a href=/docs/concepts/workloads/pods/pod-overview/>подами</a>.</li><li>Узнать подробнее про <a href=/docs/concepts/architecture/controller/>контролеры</a> в Kubernetes</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6751db8ff5409476de8225d17d6c42dd>2 - Управление объектами Kubernetes</h1><p>В инструменте командной строки <code>kubectl</code> есть несколько разных способов создания и управления объектами Kubernetes. На этой странице рассматриваются различные подходы. Изучите <a href=https://kubectl.docs.kubernetes.io>документацию по Kubectl</a> для получения подробной информации по управлению объектами с помощью Kubectl.</p><h2 id=способы-управления>Способы управления</h2><div class="alert alert-danger warning callout" role=alert><strong>Предупреждение:</strong> Используйте только один способ для управления объектами Kubernetes. Применение нескольких методов управления к одному и тому же объекту может привести к неопределенному поведению.</div><table><thead><tr><th>Способ управления</th><th>Область применения</th><th>Рекомендуемое окружение</th><th>Количество поддерживаемых авторов</th><th>Трудность изучения</th></tr></thead><tbody><tr><td>Императивные команды</td><td>Активные объекты</td><td>Проекты в стадии разработки</td><td>1+</td><td>Низкая</td></tr><tr><td>Императивная конфигурация объекта</td><td>Отдельные файлы</td><td>Продакшен-проекты</td><td>1</td><td>Средняя</td></tr><tr><td>Декларативная конфигурация объекта</td><td>Директории или файлы</td><td>Продакшен-проекты</td><td>1+</td><td>Сложная</td></tr></tbody></table><h2 id=императивные-команды>Императивные команды</h2><p>При использовании императивных команд пользователь работает непосредственно с активными (текущими) объектами в кластере. Пользователь указывает выполняемые операции команде <code>kubectl</code> в качестве аргументов или флагов.</p><p>Это самый простой способ начать или выполнять одноразовые задачи в кластере. Из-за того, что происходит работа с активными объектами напрямую, нет возможности посмотреть историю предыдущих конфигураций.</p><h3 id=примеры>Примеры</h3><p>Запустите экземпляр контейнера nginx, посредством создания объекта Deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl run nginx --image nginx
</span></span></code></pre></div><p>То же самое, но с другим синтаксисом:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create deployment nginx --image nginx
</span></span></code></pre></div><h3 id=плюсы-и-минусы>Плюсы и минусы</h3><p>Преимущества по сравнению с конфигурацией объекта:</p><ul><li>Простые команды, которые легко выучить и запомнить.</li><li>Для применения изменений в кластер нужно только выполнить команды.</li></ul><p>Недостатки по сравнению с конфигурацией объекта:</p><ul><li>Команды не интегрированы с процессом проверки (обзора) изменений.</li><li>У команд нет журнала с изменениями.</li><li>Команды не дают источник записей, за исключением активных объектов.</li><li>Команды не содержат шаблон для создания новых объектов.</li></ul><h2 id=императивная-конфигурация-объекта>Императивная конфигурация объекта</h2><p>В случае использования императивной конфигурации объекта команде kubectl устанавливают действие (создание, замена и т.д.), необязательные флаги и как минимум одно имя файла. Файл должен содержать полное определение объекта в формате YAML или JSON.</p><p>Посмотрите <a href=/docs/reference/generated/kubernetes-api/v1.25/>Справочник API</a> для получения более подробной информации про определения объекта.</p><div class="alert alert-danger warning callout" role=alert><strong>Предупреждение:</strong> Императивная команда <code>replace</code> заменяет существующую спецификацию новой (переданной), удаляя все изменения в объекте, которые не определены в конфигурационном файле. Такой подход не следует использовать для типов ресурсов, спецификации которых обновляются независимо от конфигурационного файла.
Например, поле <code>externalIPs</code> в сервисах типа <code>LoadBalancer</code> обновляется кластером независимо от конфигурации.</div><h3 id=примеры-1>Примеры</h3><p>Создать объекты, определенные в конфигурационном файле:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create -f nginx.yaml
</span></span></code></pre></div><p>Удалить объекты, определенные в двух конфигурационных файлах:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl delete -f nginx.yaml -f redis.yaml
</span></span></code></pre></div><p>Обновить объекты, определенные в конфигурационном файле, перезаписав текущую конфигурацию:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl replace -f nginx.yaml
</span></span></code></pre></div><h3 id=плюсы-и-минусы-1>Плюсы и минусы</h3><p>Преимущества по сравнению с императивными командами:</p><ul><li>Конфигурация объекта может храниться в системе управления версиями, такой как Git.</li><li>Конфигурация объекта может быть интегрирована с процессами проверки изменений и логирования.</li><li>Конфигурация объекта предусматривает шаблон для создания новых объектов.</li></ul><p>Недостатки по сравнению с императивными командами:</p><ul><li>Конфигурация объекта требует наличие общего представления об схеме объекта.</li><li>Конфигурация объекта предусматривает написание файла YAML.</li></ul><p>Преимущества по сравнению с декларативной конфигурацией объекта:</p><ul><li>Императивная конфигурация объекта проще и легче для понимания.</li><li>Начиная с Kubernetes 1.5, конфигурация императивных объектов стала лучше и совершеннее.</li></ul><p>Недостатки по сравнению с декларативной конфигурацией объекта:</p><ul><li>Императивная конфигурация объекта наилучшим образом работает с файлами, а не с директориями.</li><li>Обновления текущих объектов должны быть описаны в файлах конфигурации, в противном случае они будут потеряны при следующей замене.</li></ul><h2 id=декларативная-конфигурация-объекта>Декларативная конфигурация объекта</h2><p>При использовании декларативной конфигурации объекта пользователь работает с локальными конфигурационными файлами объекта, при этом он не определяет операции, которые будут выполняться над этими файлами. Операции создания, обновления и удаления автоматически для каждого объекта определяются <code>kubectl</code>. Этот механизм позволяет работать с директориями, в ситуациях, когда для разных объектов может потребоваться выполнение других операций.</p><div class="alert alert-info note callout" role=alert><strong>Заметка:</strong> Декларативная конфигурация объекта сохраняет изменения, сделанные другими, даже если эти изменения не будут зафиксированы снова в конфигурационный файл объекта.
Это достигается путем использования API-операции <code>patch</code>, чтобы записать только обнаруженные изменения, а не использовать для этого API-операцию <code>replace</code>, которая полностью заменяет конфигурацию объекта.</div><h3 id=примеры-2>Примеры</h3><p>Обработать все конфигурационные файлы объектов в директории <code>configs</code> и создать либо частично обновить активные объекты. Сначала можно выполнить <code>diff</code>, чтобы посмотреть, какие изменения будут внесены, и только после этого применить их:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl diff -f configs/
</span></span><span style=display:flex><span>kubectl apply -f configs/
</span></span></code></pre></div><p>Рекурсивная обработка директорий:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl diff -R -f configs/
</span></span><span style=display:flex><span>kubectl apply -R -f configs/
</span></span></code></pre></div><h3 id=плюсы-и-минусы-2>Плюсы и минусы</h3><p>Преимущества по сравнению с императивной конфигурацией объекта:</p><ul><li>Изменения, внесенные непосредственно в активные объекты, будут сохранены, даже если они не отражены в конфигурационных файлах.</li><li>Декларативная конфигурация объекта лучше работает с директориями и автоматически определяет тип операции (создание, частичное обновление, удаление) каждого объекта.</li></ul><p>Недостатки по сравнению с императивной конфигурацией объекта:</p><ul><li>Декларативную конфигурацию объекта сложнее отладить и понять, когда можно получить неожиданные результаты.</li><li>Частичные обновления с использованием различий приводит к сложным операциям слияния и исправления.</li></ul><h2 id=что-дальше>Что дальше</h2><ul><li><a href=/docs/tasks/manage-kubernetes-objects/imperative-command/>Управление объектами Kubernetes с помощью императивных команд</a></li><li><a href=/docs/tasks/manage-kubernetes-objects/imperative-config/>Управление объектами Kubernetes с помощью императивной конфигурации объекта</a></li><li><a href=/docs/tasks/manage-kubernetes-objects/declarative-config/>Управление объектами Kubernetes с помощью декларативной конфигурации объекта</a></li><li><a href=/docs/tasks/manage-kubernetes-objects/kustomization/>Управление объектами Kubernetes с помощью Kustomize (декларативный способ)</a></li><li><a href=/docs/reference/generated/kubectl/kubectl-commands/>Справочник по командам Kubectl</a></li><li><a href=https://kubectl.docs.kubernetes.io>Документация Kubectl</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/>Справочник API Kubernetes</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f37749a83c2916b63279ea60f3cfe53e>3 - Имена и идентификаторы объектов</h1><p>Каждый объект в кластере имеет уникальное <a href=#%D0%B8%D0%BC%D0%B5%D0%BD%D0%B0><em>имя</em></a> для конкретного типа ресурса.
Кроме этого, у каждого объекта Kubernetes есть собственный <a href=#%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D1%8B><em>уникальный идентификатор (UID)</em></a> в пределах кластера.</p><p>Например, в одном и том же <a href=/ru/docs/concepts/overview/working-with-objects/namespaces/>пространстве имён</a> может быть только один Pod-объект с именем <code>myapp-1234</code>, и при этом существовать объект Deployment с этим же названием <code>myapp-1234</code>.</p><p>Для создания пользовательских неуникальных атрибутов у Kubernetes есть <a href=/ru/docs/concepts/overview/working-with-objects/labels/>метки</a> и <a href=/ru/docs/concepts/overview/working-with-objects/annotations/>аннотации</a>.</p><h2 id=имена>Имена</h2><p>Клиентская строка, предназначенная для ссылки на объект в URL-адресе ресурса, например <code>/api/v1/pods/some-name</code>.</p><p>Указанное имя может иметь только один объект определённого типа. Но если вы удалите этот объект, вы можете создать новый с таким же именем</p><p>Ниже перечислены три типа распространённых требований к именам ресурсов.</p><h3 id=имена-поддоменов-dns>Имена поддоменов DNS</h3><p>Большинству типов ресурсов нужно указать имя, используемое в качестве имени поддомена DNS в соответствии с <a href=https://tools.ietf.org/html/rfc1123>RFC 1123</a>. Соответственно, имя должно:</p><ul><li>содержать не более 253 символов</li><li>иметь только строчные буквенно-цифровые символы, '-' или '.'</li><li>начинаться с буквенно-цифрового символа</li><li>заканчивается буквенно-цифровым символом</li></ul><h3 id=имена-меток-dns>Имена меток DNS</h3><p>Некоторые типы ресурсов должны соответствовать стандарту меток DNS, который описан в <a href=https://tools.ietf.org/html/rfc1123>RFC 1123</a>. Таким образом, имя должно:</p><ul><li>содержать не более 63 символов</li><li>содержать только строчные буквенно-цифровые символы или '-'</li><li>начинаться с буквенно-цифрового символа</li><li>заканчивается буквенно-цифровым символом</li></ul><h3 id=имена-сегментов-пути>Имена сегментов пути</h3><p>Определённые имена типов ресурсов должны быть закодированы для использования в качестве сегмента пути. Проще говоря, имя не может быть "." или "..", а также не может содержать "/" или "%".</p><p>Пример файла манифеста пода <code>nginx-demo</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Заметка:</strong> У отдельных типов ресурсов есть дополнительные ограничения именования.</div><h2 id=уникальные-идентификаторы>Уникальные идентификаторы</h2><p>Уникальная строка, сгенерированная самим Kubernetes, для идентификации объектов.</p><p>У каждого объекта, созданного в течение всего периода работы кластера Kubernetes, есть собственный уникальный идентификатор (UID). Он предназначен для выяснения различий между событиями похожих сущностей.</p><p>Уникальные идентификатор (UID) в Kubernetes — это универсальные уникальные идентификаторы (известные также как Universally Unique IDentifier, сокращенно UUID).
Эти идентификаторы стандартизированы под названием ISO/IEC 9834-8, а также как ITU-T X.667.</p><h2 id=что-дальше>Что дальше</h2><ul><li>Узнать подробнее про <a href=/ru/docs/concepts/overview/working-with-objects/labels/>метки</a> в Kubernetes.</li><li>Посмотреть архитектуру <a href=https://git.k8s.io/community/contributors/design-proposals/architecture/identifiers.md>идентификаторов и имён Kubernetes</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-1127165f472b7181b9c1d5a0b187d620>4 - Пространства имён</h1><p>Kubernetes поддерживает несколько виртуальных кластеров в одном физическом кластере. Такие виртуальные кластеры называются пространствами имён.</p><h2 id=причины-использования-нескольких-пространств-имён>Причины использования нескольких пространств имён</h2><p>Пространства имён применяются в окружениях с многочисленными пользователями, распределенными по нескольким командам или проектам. Пространства имён не нужно создавать, если есть кластеры с небольшим количеством пользователей (например, десяток пользователей). Пространства имён имеет смысл использовать, когда необходима такая функциональность.</p><p>Пространства имён определяют область имён. Имена ресурсов должны быть уникальными в пределах одного и того же пространства имён. Пространства имён не могут быть вложенными, а каждый ресурс Kubernetes может находиться только в одном пространстве имён.</p><p>Пространства имён — это способ разделения ресурсов кластера между несколькими пользователями (с помощью <a href=/docs/concepts/policy/resource-quotas/>квоты ресурсов</a>).</p><p>По умолчанию в будущих версиях Kubernetes объекты в одном и том же пространстве имён будут иметь одинаковую политику контроля доступа.</p><p>Не нужно использовать пространства имён только для разделения слегка отличающихся ресурсов, например, в случае разных версий одного и того же приложения. Используйте <a href=/ru/docs/concepts/overview/working-with-objects/labels/>метки</a>, чтобы различать ресурсы в рамках одного пространства имён.</p><h2 id=использование-пространств-имён>Использование пространств имён</h2><p>Создание и удаление пространств имён описаны в <a href=/docs/admin/namespaces>руководстве администратора по пространствам имён</a>.</p><h3 id=просмотр-пространств-имён>Просмотр пространств имён</h3><p>Используйте следующую команду, чтобы вывести список существующих пространств имён в кластере:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get namespace
</span></span></code></pre></div><pre tabindex=0><code>NAME          STATUS    AGE
default       Active    1d
kube-system   Active    1d
kube-public   Active    1d
</code></pre><p>По умолчанию в Kubernetes определены три пространства имён:</p><ul><li><code>default</code> — пространство имён по умолчанию для объектов без какого-либо другого пространства имён.</li><li><code>kube-system</code> — пространство имён для объектов, созданных Kubernetes</li><li><code>kube-public</code> — создаваемое автоматически пространство имён, которое доступно для чтения всем пользователям (включая также неаутентифицированных пользователей). Как правило, это пространство имён используется кластером, если некоторые ресурсы должны быть общедоступными для всего кластера. Главная особенность этого пространства имён — оно всего лишь соглашение, а не требование.</li></ul><h3 id=определение-пространства-имён-для-отдельных-команд>Определение пространства имён для отдельных команд</h3><p>Используйте флаг <code>--namespace</code>, чтобы определить пространство имён только для текущего запроса.</p><p>Примеры:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl run nginx --image<span style=color:#666>=</span>nginx --namespace<span style=color:#666>=</span>&lt;insert-namespace-name-here&gt;
</span></span><span style=display:flex><span>kubectl get pods --namespace<span style=color:#666>=</span>&lt;insert-namespace-name-here&gt;
</span></span></code></pre></div><h3 id=определение-пространства-имён-для-всех-команд>Определение пространства имён для всех команд</h3><p>Можно определить пространство имён, которое должно использоваться для всех выполняемых команд kubectl в текущем контексте.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config set-context --current --namespace<span style=color:#666>=</span>&lt;insert-namespace-name-here&gt;
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Проверка</span>
</span></span><span style=display:flex><span>kubectl config view --minify | grep namespace:
</span></span></code></pre></div><h2 id=пространства-имён-и-dns>Пространства имён и DNS</h2><p>При создании <a href=/docs/user-guide/services>сервиса</a> создаётся соответствующая ему <a href=/docs/concepts/services-networking/dns-pod-service/>DNS-запись</a>.
Эта запись вида <code>&lt;service-name>.&lt;namespace-name>.svc.cluster.local</code> означает, что если контейнер использует только <code>&lt;service-name></code>, то он будет локальным сервисом в пространстве имён. Это позволит применять одну и ту же конфигурацию в нескольких пространствах имен (например, development, staging и production). Если нужно обращаться к другим пространствам имён, то нужно использовать полностью определенное имя домена (FQDN).</p><h2 id=объекты-без-пространства-имён>Объекты без пространства имён</h2><p>Большинство ресурсов Kubernetes (например, поды, сервисы, контроллеры репликации и другие) расположены в определённых пространствах имён. При этом сами ресурсы пространства имён не находятся ни в других пространствах имён. А такие низкоуровневые ресурсы, как <a href=/docs/admin/node>узлы</a> и persistentVolumes, не принадлежат ни одному пространству имён.</p><p>Чтобы посмотреть, какие ресурсы Kubernetes находятся в пространстве имён, а какие — нет, используйте следующие команды:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Ресурсы в пространстве имён</span>
</span></span><span style=display:flex><span>kubectl api-resources --namespaced<span style=color:#666>=</span><span style=color:#a2f>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Ресурсы, не принадлежавшие ни одному пространству имён</span>
</span></span><span style=display:flex><span>kubectl api-resources --namespaced<span style=color:#666>=</span><span style=color:#a2f>false</span>
</span></span></code></pre></div><h2 id=что-дальше>Что дальше</h2><ul><li>Узнать подробнее про <a href=/docs/tasks/administer-cluster/namespaces/#creating-a-new-namespace>создание нового пространства имён</a>.</li><li>Узнать подробнее про <a href=/docs/tasks/administer-cluster/namespaces/#deleting-a-namespace>удаление пространства имён</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f1dec4557fb8ffbac9f11390aaaf9fa4>5 - Метки и селекторы</h1><p><em>Метки</em> — это пары ключ-значение, которые добавляются к объектам, как поды.
Метки предназначены для идентификации атрибутов объектов, которые имеют значимость и важны для пользователей, но при этом не относятся напрямую к основной системе.
Метки можно использовать для группировки и выбора подмножеств объектов. Метки могут быть добавлены к объектам во время создания и изменены в любое время после этого.
Каждый объект может иметь набор меток в виде пары ключ-значение. Каждый ключ должен быть уникальным в рамках одного и того же объекта.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#b44>&#34;metadata&#34;</span><span>:</span> {
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;labels&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;key1&#34;</span> : <span style=color:#b44>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;key2&#34;</span> : <span style=color:#b44>&#34;value2&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Метки используются при получении и отслеживании объектов и в веб-панелях и CLI-инструментах. Любая неидентифицирующая информация должна быть записана в <a href=/ru/docs/concepts/overview/working-with-objects/annotations/>аннотации</a>.</p><h2 id=причины-использования>Причины использования</h2><p>Метки позволяют пользователям гибко сопоставить их организационные структуры с системными объектами, не требуя от клиентов хранить эти соответствия.</p><p>Развертывания сервисов и процессы пакетной обработки часто являются многомерными сущностями (например, множество разделов или развертываний, несколько групп выпусков, несколько уровней приложения, несколько микросервисов на каждый уровень приложения). Для управления часто требуются сквозные операции, которые нарушают инкапсуляцию строго иерархических представлений, особенно жестких иерархий, определяемых инфраструктурой, а не пользователями.</p><p>Примеры меток:</p><ul><li><code>"release" : "stable"</code>, <code>"release" : "canary"</code></li><li><code>"environment" : "dev"</code>, <code>"environment" : "qa"</code>, <code>"environment" : "production"</code></li><li><code>"tier" : "frontend"</code>, <code>"tier" : "backend"</code>, <code>"tier" : "cache"</code></li><li><code>"partition" : "customerA"</code>, <code>"partition" : "customerB"</code></li><li><code>"track" : "daily"</code>, <code>"track" : "weekly"</code></li></ul><p>Это всего лишь примеры часто используемых меток; конечно, вы можете использовать свои собственные. Помните о том, что ключ метки должна быть уникальной в пределах одного объекта.</p><h2 id=синтаксис-и-набор-символов>Синтаксис и набор символов</h2><p><em>Метки</em> представляют собой пары ключ-значение. Разрешенные ключи метки имеют два сегмента, разделённые слешем (<code>/</code>): префикс (необязательно) и имя. Сегмент имени обязателен и должен содержать не более 63 символов, среди которых могут быть буквенно-цифровые символы (<code>[a-z0-9A-Z]</code>), а также дефисы (<code>-</code>), знаки подчеркивания (<code>_</code>), точки (<code>.</code>). Префикс не обязателен, но он быть поддоменом DNS: набор меток DNS, разделенных точками (<code>.</code>), общей длиной не более 253 символов, за которыми следует слеш (<code>/</code>).</p><p>Если префикс не указан, ключ метки считается закрытым для пользователя. Компоненты автоматизированной системы (например, <code>kube-scheduler</code>, <code>kube-controller-manager</code>, <code>kube-apiserver</code>, <code>kubectl</code> или другие сторонние), которые добавляют метки к объектам пользователя, должны указывать префикс.</p><p>Префиксы <code>kubernetes.io/</code> и <code>k8s.io/</code> зарезервированы для использования основными компонентами Kubernetes.</p><p>Например, ниже представлен конфигурационный файл объекта Pod с двумя метками <code>environment: production</code> и <code>app: nginx</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>label-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>environment</span>:<span style=color:#bbb> </span>production<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=селекторы-меток>Селекторы меток</h2><p>В отличие от <a href=/docs/user-guide/identifiers>имен и идентификаторов</a>, метки не гарантируют уникальность. Поэтому мы предполагаем, что многие объекты будут иметь одинаковые метки.</p><p>С помощью <em>селектора меток</em> клиент/пользователь может идентифицировать набор объектов. Селектор меток — основное средство группировки в Kubernetes.</p><p>В настоящее время API поддерживает два типа селекторов: <em>на равенстве</em> и <em>на наборе</em>.
Селектор меток может состоять из нескольких <em>условий</em>, разделенных запятыми. В таком случае все условия должны быть выполнены, поэтому запятая-разделитель работает как логический оператор <em>И</em> (<code>&&</code>).</p><p>Работа пустых или неопределённых селекторов зависит от контекста. Типы API, которые использует селекторы, должны задокументировать это поведение.</p><div class="alert alert-info note callout" role=alert><strong>Заметка:</strong> Для некоторых API-типов, например, ReplicaSets, селекторы меток двух экземпляров не должны дублироваться в пространстве имен, в противном случае контроллер может рассматривать их как конфликтующие инструкции и не сможет определить количество реплик.</div><div class="alert alert-warning caution callout" role=alert><strong>Внимание:</strong> Как для условий, основанных на равенстве, так и для условий на основе набора, не существует логического оператора <em>ИЛИ</em> (<code>||</code>). Убедитесь, что синтаксис фильтрации правильно составлен.</div><h3 id=условие-равенства>Условие <em>равенства</em></h3><p>Условия <em>равенства</em> или <em>неравенства</em> позволяют отфильтровать объекты по ключам и значениям меток. Сопоставляемые объекты должны удовлетворять всем указанным условиям меток, хотя при этом у объектов также могут быть заданы другие метки.
Доступны три оператора: <code>=</code>,<code>==</code>,<code>!=</code>. Первые два означают <em>равенство</em> (и являются всего лишь синонимами), а последний оператор определяет <em>неравенство</em>. Например:</p><pre tabindex=0><code>environment = production
tier != frontend
</code></pre><p>Первый пример выбирает все ресурсы с ключом <code>environment</code>, у которого значение указано <code>production</code>.
Последний получает все ресурсы с ключом <code>tier</code> без значения <code>frontend</code>, а также все ресурсы, в которых нет метки с ключом <code>tier</code>.
Используя оператор запятой можно совместить показанные два условия в одно, запросив ресурсы, в которых есть значение метки <code>production</code> и исключить <code>frontend</code>: <code>environment=production,tier!=frontend</code>.</p><p>С помощью условия равенства в объектах Pod можно указать, какие нужно выбрать ресурсы. Например, в примере ниже объект Pod выбирает узлы с меткой "<code>accelerator=nvidia-tesla-p100</code>".</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>cuda-test<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>cuda-test<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;k8s.gcr.io/cuda-vector-add:v0.1&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>nvidia.com/gpu</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>nodeSelector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>accelerator</span>:<span style=color:#bbb> </span>nvidia-tesla-p100<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=условие-набора>Условие <em>набора</em></h3><p>Условие меток <em>на основе набора</em> фильтрует ключи в соответствии с набором значений. Поддерживаются три вида операторов: <code>in</code>, <code>notin</code> и <code>exists</code> (только идентификатор ключа). Например:</p><pre tabindex=0><code>environment in (production, qa)
tier notin (frontend, backend)
partition
!partition
</code></pre><p>В первом примере выбираются все ресурсы с ключом <code>environment</code> и значением <code>production</code> или <code>qa</code>.
Во втором примере выбираются все ресурсы с ключом <code>tier</code> и любыми значениями, кроме <code>frontend</code> и <code>backend</code>, а также все ресурсы без меток с ключом <code>tier</code>.
Третий пример выбирает все ресурсы, включая метку с ключом <code>partition</code> (с любым значением).
В четвертом примере выбираются все ресурсы без метки с ключом <code>partition</code> (с любым значением).
Как и логический оператор <em>И</em> работает разделитель в виде запятой. Таким образом, фильтрация ресурсов по ключу <code>partition</code> (вне зависимости от значения) и ключу <code>environment</code> с любым значением, кроме <code>qa</code>, можно получить с помощью следующего выражения: <code>partition,environment notin (qa)</code>.
Селектор меток <em>на основе набора</em> — основная форма равенства, поскольку <code>environment=production</code> то же самое, что и <code>environment in (production)</code>; аналогично, оператор <code>!=</code> соответствует <code>notin</code>.</p><p>Условия <em>набора</em> могут использоваться одновременно с условия <em>равенства</em>. Например, так: <code>partition in (customerA, customerB),environment!=qa</code>.</p><h2 id=api>API</h2><h3 id=фильтрация-list-и-watch>Фильтрация LIST и WATCH</h3><p>Операции LIST и WATCH могут использовать параметр запроса, чтобы указать селекторы меток фильтрации наборов объектов. Есть поддержка обоих условий (строка запроса URL ниже показывается в исходном виде):</p><ul><li>Условия <em>на основе равенства</em>: <code>?labelSelector=environment%3Dproduction,tier%3Dfrontend</code></li><li>Условия <em>на основе набора</em>: <code>?labelSelector=environment+in+%28production%2Cqa%29%2Ctier+in+%28frontend%29</code></li></ul><p>Указанные выше формы селектора меток можно использовать для просмотра или отслеживания ресурсов через REST-клиент. Например, <code>apiserver</code> с <code>kubectl</code>, который использует <em>условие равенства</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods -l <span style=color:#b8860b>environment</span><span style=color:#666>=</span>production,tier<span style=color:#666>=</span>frontend
</span></span></code></pre></div><p>Либо используя условия <em>на основе набора</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods -l <span style=color:#b44>&#39;environment in (production),tier in (frontend)&#39;</span>
</span></span></code></pre></div><p>Как уже показывалось, <em>условия набора</em> дают больше возможностей. Например, в них можно использовать подобие оператора <em>И</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods -l <span style=color:#b44>&#39;environment in (production, qa)&#39;</span>
</span></span></code></pre></div><p>Либо можно воспользоваться исключающим сопоставлением с помощью оператора <em>exists</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods -l <span style=color:#b44>&#39;environment,environment notin (frontend)&#39;</span>
</span></span></code></pre></div><h3 id=установка-ссылок-в-api-объекты>Установка ссылок в API-объекты</h3><p>Некоторые объекты Kubernetes, такие как <a href=/docs/user-guide/services><code>services</code></a> и <a href=/docs/user-guide/replication-controller><code>replicationcontrollers</code></a>, также используют селекторы меток для ссылки на наборы из других ресурсов, например, <a href=/docs/user-guide/pods>подов</a>.</p><h4 id=service-и-replicationcontroller>Service и ReplicationController</h4><p>Набор подов, на которые указывает <code>service</code>, определяется через селектор меток. Аналогичным образом, количество подов, которыми должен управлять <code>replicationcontroller</code>, также формируются с использованием селектора меток.</p><p>Селекторы меток для обоих объектов записываются в словарях файлов формата <code>json</code> и <code>yaml</code>, при этом поддерживаются только селекторы с условием <em>равенства</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#b44>&#34;selector&#34;</span><span>:</span> {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;component&#34;</span> : <span style=color:#b44>&#34;redis&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Или:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>component</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span></code></pre></div><p>Этот селектор (как в формате <code>json</code>, так и в <code>yaml</code>) эквивалентен <code>component=redis</code> или <code>component in (redis)</code>.</p><h4 id=ресурсы-поддерживающие-условия-набора>Ресурсы, поддерживающие условия набора</h4><p>Новые ресурсы, такие как <a href=/docs/concepts/workloads/controllers/jobs-run-to-completion/><code>Job</code></a>, <a href=/docs/concepts/workloads/controllers/deployment/><code>Deployment</code></a>, <a href=/docs/concepts/workloads/controllers/replicaset/><code>ReplicaSet</code></a> и <a href=/docs/concepts/workloads/controllers/daemonset/><code>DaemonSet</code></a>, также поддерживают условия <em>набора</em>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>component</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:green;font-weight:700>key: tier, operator: In, values</span>:<span style=color:#bbb> </span>[cache]}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:green;font-weight:700>key: environment, operator: NotIn, values</span>:<span style=color:#bbb> </span>[dev]}<span style=color:#bbb>
</span></span></span></code></pre></div><p><code>matchLabels</code> — словарь пар <code>{key,value}</code>. Каждая пара <code>{key,value}</code> в словаре <code>matchLabels</code> эквивалентна элементу <code>matchExpressions</code>, где поле <code>key</code> — "key", поле <code>operator</code> — "In", а массив <code>values</code> содержит только "value".
<code>matchExpressions</code> представляет собой список условий селектора пода. В качестве операторов могут быть In, NotIn, Exists и DoesNotExist. В случае использования In и NotIn должны заданы непустые значения. Все условия, как для <code>matchLabels</code>, так и для <code>matchExpressions</code>, объединяются с помощью логического И, поэтому при выборке объектов все они должны быть выполнены.</p><h4 id=выбор-наборов-узлов>Выбор наборов узлов</h4><p>Один из вариантов использования меток — возможность выбора набора узлов, в которых может быть развернут под.
Смотрите документацию про <a href=/docs/concepts/configuration/assign-pod-node/>выбор узлов</a>, чтобы получить дополнительную информацию.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-93cd7a1d4e1623e2bf01afc49a5af69c>6 - Аннотации</h1><p>Аннотации Kubernetes можно использовать для добавления собственных метаданных к объектам. Такие клиенты, как инструменты и библиотеки, могут получить эти метаданные.</p><h2 id=добавление-метаданных-к-объектам>Добавление метаданных к объектам</h2><p>Вы можете использовать метки или аннотации для добавления метаданных к объектам Kubernetes. Метки можно использовать для выбора объектов и для поиска коллекций объектов, которые соответствуют определенным условиям. В отличие от них аннотации не используются для идентификации и выбора объектов. Метаданные в аннотации могут быть маленькими или большими, структурированными или неструктурированными, кроме этого они включать символы, которые не разрешены в метках.</p><p>Аннотации, как и метки, являются коллекциями с наборами пар ключ-значение:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#b44>&#34;metadata&#34;</span><span>:</span> {
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;annotations&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;key1&#34;</span> : <span style=color:#b44>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;key2&#34;</span> : <span style=color:#b44>&#34;value2&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Некоторые примеры информации, которая может быть в аннотациях:</p><ul><li><p>Поля, управляемые декларативным уровнем конфигурации. Добавление этих полей в виде аннотаций позволяет отличать их от значений по умолчанию, установленных клиентами или серверами, а также от автоматически сгенерированных полей и полей, заданных системами автоматического масштабирования.</p></li><li><p>Информация о сборке, выпуске или образе, например, метка времени, идентификаторы выпуска, ветка git, номера PR, хеши образов и адрес реестра.</p></li><li><p>Ссылки на репозитории логирования, мониторинга, аналитики или аудита.</p></li><li><p>Информация о клиентской библиотеке или инструменте, которая может использоваться при отладке (например, имя, версия и информация о сборке).</p></li><li><p>Информация об источнике пользователя или инструмента/системы, например, URL-адреса связанных объектов из других компонентов экосистемы.</p></li><li><p>Небольшие метаданные развертывания (например, конфигурация или контрольные точки).</p></li><li><p>Номера телефонов или пейджеров ответственных лиц или записи в справочнике, в которых можно найти нужную информацию, например, сайт группы.</p></li><li><p>Инструкции от конечных пользователей по исправлению работы или использования нестандартной функциональности.</p></li></ul><p>Вместо использования аннотаций, вы можете сохранить такого рода информацию во внешней базе данных или директории, хотя это усложнило бы создание общих клиентских библиотек и инструментов развертывания, управления, самодиагностики и т.д.</p><h2 id=синтаксис-и-набор-символов>Синтаксис и набор символов</h2><p><em>Аннотации</em> представляют собой пары ключ-значение. Разрешенные ключи аннотации имеют два сегмента, разделённые слешем (<code>/</code>): префикс (необязательно) и имя. Сегмент имени обязателен и должен содержать не более 63 символов, среди которых могут быть буквенно-цифровые символы(<code>[a-z0-9A-Z]</code>), а также дефисы (<code>-</code>), знаки подчеркивания (<code>_</code>), точки (<code>.</code>). Префикс не обязателен, но он быть поддоменом DNS: набор меток DNS, разделенных точками (<code>.</code>), общей длиной не более 253 символов, за которыми следует слеш (<code>/</code>).</p><p>Если префикс не указан, ключ аннотации считается закрытым для пользователя. Компоненты автоматизированной системы (например, <code>kube-scheduler</code>, <code>kube-controller-manager</code>, <code>kube-apiserver</code>, <code>kubectl</code> или другие сторонние), которые добавляют аннотации к объектам пользователя, должны указывать префикс.</p><p>Префиксы <code>kubernetes.io/</code> и <code>k8s.io/</code> зарезервированы для использования основными компонентами Kubernetes.</p><p>Например, ниже представлен конфигурационный файл объекта Pod с аннотацией <code>imageregistry: https://hub.docker.com/</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>annotations-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>imageregistry</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;https://hub.docker.com/&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=что-дальше>Что дальше</h2><p>Узнать подробнее про <a href=/ru/docs/concepts/overview/working-with-objects/labels/>метки и селекторы</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-046c03090d47bc4b89b818dc645c3865>7 - Селекторы полей</h1><p><em>Селекторы полей</em> позволяют <a href=/ru/docs/concepts/overview/working-with-objects/kubernetes-objects>выбирать ресурсы Kubernetes</a>, исходя из значения одного или нескольких полей ресурсов. Ниже приведены несколько примеров запросов селекторов полей:</p><ul><li><code>metadata.name=my-service</code></li><li><code>metadata.namespace!=default</code></li><li><code>status.phase=Pending</code></li></ul><p>Следующая команда <code>kubectl</code> выбирает все Pod-объекты, в которых значение поля <a href=/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase><code>status.phase</code></a> равно <code>Running</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods --field-selector status.phase<span style=color:#666>=</span>Running
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Заметка:</strong><p>По сути, селекторы полей являются <em>фильтрами</em> ресурсов. По умолчанию нет установленных селекторов/фильтров, поэтому выбираются ресурсы всех типов. Это означает, что два запроса <code>kubectl</code> ниже одинаковы:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods
</span></span><span style=display:flex><span>kubectl get pods --field-selector <span style=color:#b44>&#34;&#34;</span>
</span></span></code></pre></div></div><h2 id=поддерживаемые-поля>Поддерживаемые поля</h2><p>Доступные селекторы полей зависят от типа ресурса Kubernetes. У всех типов ресурсов есть поля <code>metadata.name</code> и <code>metadata.namespace</code>. При использовании несуществующего селекторов полей приведёт к возникновению ошибки. Например:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get ingress --field-selector foo.bar<span style=color:#666>=</span>baz
</span></span></code></pre></div><pre tabindex=0><code>Error from server (BadRequest): Unable to find &#34;ingresses&#34; that match label selector &#34;&#34;, field selector &#34;foo.bar=baz&#34;: &#34;foo.bar&#34; is not a known field selector: only &#34;metadata.name&#34;, &#34;metadata.namespace&#34;
</code></pre><h2 id=поддерживаемые-операторы>Поддерживаемые операторы</h2><p>Можно использовать операторы <code>=</code>, <code>==</code> и <code>!=</code> в селекторах полей (<code>=</code> и <code>==</code> — синонимы). Например, следующая команда <code>kubectl</code> выбирает все сервисы Kubernetes, не принадлежавшие пространству имен <code>default</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get services  --all-namespaces --field-selector metadata.namespace!<span style=color:#666>=</span>default
</span></span></code></pre></div><h2 id=составные-селекторы>Составные селекторы</h2><p>Аналогично <a href=/ru/docs/concepts/overview/working-with-objects/labels>метки</a> и другим селекторам, несколько селекторы полей могут быть объединены через запятую. Приведенная ниже команда <code>kubectl</code> выбирает все Pod-объекты, у которых значение поле <code>status.phase</code>, отличное от <code>Running</code>, а поле <code>spec.restartPolicy</code> имеет значение <code>Always</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods --field-selector<span style=color:#666>=</span>status.phase!<span style=color:#666>=</span>Running,spec.restartPolicy<span style=color:#666>=</span>Always
</span></span></code></pre></div><h2 id=множественные-типы-ресурсов>Множественные типы ресурсов</h2><p>Можно использовать селекторы полей с несколькими типами ресурсов одновременно. Команда <code>kubectl</code> выбирает все объекты StatefulSet и Services, не включенные в пространство имен <code>default</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get statefulsets,services --all-namespaces --field-selector metadata.namespace!<span style=color:#666>=</span>default
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5dd62c6a4a481b4cf1ac50f6799eb581>8 - Рекомендуемые метки</h1><p>Вы можете визуализировать и управлять объектами Kubernetes не только с помощью kubectl и панели управления. С помощью единого набора меток можно единообразно описывать объекты, что позволяет инструментам согласованно работать между собой.</p><p>В дополнение к существующим инструментам, рекомендуемый набор меток описывают приложения в том виде, в котором они могут быть получены.</p><p>Метаданные сосредоточены на понятии <em>приложение</em>. Kubernetes — это не платформа как услуга (PaaS), поэтому не закрепляет формальное понятие приложения.
Вместо этого приложения являются неформальными и описываются через метаданные. Определение приложения довольно расплывчатое.</p><div class="alert alert-info note callout" role=alert><strong>Заметка:</strong> Это рекомендуемые для использования метки. Они облегчают процесс управления приложениями, но при этом не являются обязательными для основных инструментов.</div><p>Общие метки и аннотации используют один и тот же префикс: <code>app.kubernetes.io</code>. Метки без префикса являются приватными для пользователей. Совместно используемый префикс гарантирует, что общие метки не будут влиять на пользовательские метки.</p><h2 id=метки>Метки</h2><p>Чтобы извлечь максимум пользы от использования таких меток, они должны добавляться к каждому ресурсному объекту.</p><table><thead><tr><th>Ключ</th><th>Описание</th><th>Пример</th><th>Тип</th></tr></thead><tbody><tr><td><code>app.kubernetes.io/name</code></td><td>Имя приложения</td><td><code>mysql</code></td><td>string</td></tr><tr><td><code>app.kubernetes.io/instance</code></td><td>Уникальное имя экземпляра приложения</td><td><code>wordpress-abcxzy</code></td><td>string</td></tr><tr><td><code>app.kubernetes.io/version</code></td><td>Текущая версия приложения (например, семантическая версия, хеш коммита и т.д.)</td><td><code>5.7.21</code></td><td>string</td></tr><tr><td><code>app.kubernetes.io/component</code></td><td>Имя компонента в архитектуре</td><td><code>database</code></td><td>string</td></tr><tr><td><code>app.kubernetes.io/part-of</code></td><td>Имя основного приложения, частью которого является текущий объект</td><td><code>wordpress</code></td><td>string</td></tr><tr><td><code>app.kubernetes.io/managed-by</code></td><td>Инструмент управления приложением</td><td><code>helm</code></td><td>string</td></tr></tbody></table><p>Для демонстрации этих меток, рассмотрим следующий объект <code>StatefulSet</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>StatefulSet<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/name</span>:<span style=color:#bbb> </span>mysql<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/instance</span>:<span style=color:#bbb> </span>wordpress-abcxzy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/version</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;5.7.21&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/component</span>:<span style=color:#bbb> </span>database<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/part-of</span>:<span style=color:#bbb> </span>wordpress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/managed-by</span>:<span style=color:#bbb> </span>helm<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=приложения-и-экземпляры-приложений>Приложения и экземпляры приложений</h2><p>Одно и то же приложение может быть установлено несколько раз в кластер Kubernetes, в ряде случаев — в одинаковое пространство имен. Например, WordPress может быть установлен более одного раза, тогда каждый из сайтов будет иметь собственный установленный экземпляр WordPress.</p><p>Имя приложения и имя экземпляра хранятся по отдельности. Например, WordPress имеет ключ <code>app.kubernetes.io/name</code> со значением <code>wordpress</code>, при этом у него есть имя экземпляра, представленное ключом <code>app.kubernetes.io/instance</code> со значением <code>wordpress-abcxzy</code>. Такой механизм позволяет идентифицировать как приложение, так и экземпляры приложения. У каждого экземпляра приложения должно быть уникальное имя.</p><h2 id=примеры>Примеры</h2><p>Следующие примеры показывают разные способы использования общих меток, поэтому они различаются по степени сложности.</p><h3 id=простой-сервис-без-состояния>Простой сервис без состояния</h3><p>Допустим, у нас есть простой сервис без состояния, развернутый с помощью объектов <code>Deployment</code> и <code>Service</code>. Следующие два фрагмента конфигурации показывают, как можно использовать метки в самом простом варианте.</p><p>Объект <code>Deployment</code> используется для наблюдения за подами, на которых запущено приложение.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/name</span>:<span style=color:#bbb> </span>myservice<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/instance</span>:<span style=color:#bbb> </span>myservice-abcxzy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Объект <code>Service</code> используется для открытия доступа к приложению.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/name</span>:<span style=color:#bbb> </span>myservice<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/instance</span>:<span style=color:#bbb> </span>myservice-abcxzy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=веб-приложение-с-базой-данных>Веб-приложение с базой данных</h3><p>Рассмотрим случай немного посложнее: веб-приложение (WordPress), которое использует базу данных (MySQL), установленное с помощью Helm. В следующих фрагментов конфигурации объектов отображена отправная точка развертывания такого приложения.</p><p>Следующий объект <code>Deployment</code> используется для WordPress:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/name</span>:<span style=color:#bbb> </span>wordpress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/instance</span>:<span style=color:#bbb> </span>wordpress-abcxzy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/version</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;4.9.4&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/managed-by</span>:<span style=color:#bbb> </span>helm<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/component</span>:<span style=color:#bbb> </span>server<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/part-of</span>:<span style=color:#bbb> </span>wordpress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Объект <code>Service</code> используется для открытия доступа к WordPress:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/name</span>:<span style=color:#bbb> </span>wordpress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/instance</span>:<span style=color:#bbb> </span>wordpress-abcxzy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/version</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;4.9.4&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/managed-by</span>:<span style=color:#bbb> </span>helm<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/component</span>:<span style=color:#bbb> </span>server<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/part-of</span>:<span style=color:#bbb> </span>wordpress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>MySQL открывается в виде <code>StatefulSet</code> с метаданными как для самого приложения, так и основного (родительского) приложения, к которому принадлежит СУБД:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>StatefulSet<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/name</span>:<span style=color:#bbb> </span>mysql<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/instance</span>:<span style=color:#bbb> </span>mysql-abcxzy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/version</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;5.7.21&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/managed-by</span>:<span style=color:#bbb> </span>helm<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/component</span>:<span style=color:#bbb> </span>database<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/part-of</span>:<span style=color:#bbb> </span>wordpress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Объект <code>Service</code> предоставляет MySQL в составе WordPress:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/name</span>:<span style=color:#bbb> </span>mysql<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/instance</span>:<span style=color:#bbb> </span>mysql-abcxzy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/version</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;5.7.21&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/managed-by</span>:<span style=color:#bbb> </span>helm<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/component</span>:<span style=color:#bbb> </span>database<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app.kubernetes.io/part-of</span>:<span style=color:#bbb> </span>wordpress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Вы заметите, что <code>StatefulSet</code> и <code>Service</code> MySQL содержат больше информации о MySQL и WordPress.</p></div></main></div></div><footer class=d-print-none><div class=footer__links><nav><a class=text-white href=/ru/docs/home/>Главная</a>
<a class=text-white href=/ru/community/>Сообщество</a>
<a class=text-white href=/ru/case-studies/>Примеры использования</a></nav></div><div class=container-fluid><div class=row><div class="col-6 col-sm-2 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank href=https://discuss.kubernetes.io><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank href=https://twitter.com/kubernetesio><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar><a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io"><i class="fas fa-calendar-alt"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank href=https://youtube.com/kubernetescommunity><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-2 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank href=https://slack.k8s.io><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute><a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide><i class="fas fa-edit"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-12 col-sm-8 text-center order-sm-2"><small class=text-white>&copy; 2023 Авторы Kubernetes | Документация распространяется под лицензией <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small><br><small class=text-white>Copyright &copy; 2023 The Linux Foundation &reg;. Все права защищены. The Linux Foundation является зарегистрированной торговой маркой. Список торговых марок The Linux Foundation приведен на странице <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>использования торговых марок</a></small><br><small class=text-white>ICP license: 京ICP备17074266号-3</small></div></div></div></footer></div><script src=/js/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=/js/popper-1.16.1.min.js intregrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=/js/bootstrap-4.6.1.min.js integrity=sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2 crossorigin=anonymous></script>
<script src=/js/script.js></script>
<script async src=/js/mermaid-8.13.4.min.js integrity=sha384-5hHNvPeMrNH14oM3IcQofDoBhiclNK3g2+hnEinKzQ07C4AliMeVpnvxuiwEGpaO crossorigin=anonymous></script>
<script src=/js/main.min.5c0bf7f21dc4f66485f74efbbeeff28a7e4f8cddaac1bae47043159c922ff3a3.js integrity="sha256-XAv38h3E9mSF9077vu/yin5PjN2qwbrkcEMVnJIv86M=" crossorigin=anonymous></script></body></html>