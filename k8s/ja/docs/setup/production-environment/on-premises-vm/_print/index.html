<!doctype html><html lang=ja class=no-js><head><meta name=robots content="noindex, nofollow"><link rel=alternate hreflang=fr href=https://kubernetes.io/fr/docs/setup/production-environment/on-premises-vm/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://kubernetes.io/ja/docs/setup/production-environment/on-premises-vm/><link rel="shortcut icon" type=image/png href=/images/favicon.png><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon href=/images/kubernetes-192x192.png><title>オンプレミスVM | Kubernetes</title><meta property="og:title" content="オンプレミスVM"><meta property="og:description" content="プロダクショングレードのコンテナ管理基盤"><meta property="og:type" content="website"><meta property="og:url" content="https://kubernetes.io/ja/docs/setup/production-environment/on-premises-vm/"><meta property="og:site_name" content="Kubernetes"><meta itemprop=name content="オンプレミスVM"><meta itemprop=description content="プロダクショングレードのコンテナ管理基盤"><meta name=twitter:card content="summary"><meta name=twitter:title content="オンプレミスVM"><meta name=twitter:description content="プロダクショングレードのコンテナ管理基盤"><link href=/scss/main.css rel=stylesheet><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png","potentialAction":{"@type":"SearchAction","target":"https://kubernetes.io/search/?q={search_term_string}","query-input":"required name=search_term_string"}}</script><meta name=theme-color content="#326ce5"><link rel=stylesheet href=/css/feature-states.css><meta name=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:url" content="https://kubernetes.io/ja/docs/setup/production-environment/on-premises-vm/"><meta property="og:title" content="オンプレミスVM"><meta name=twitter:title content="オンプレミスVM"><meta name=twitter:image content="https://kubernetes.io/images/favicon.png"><meta name=twitter:image:alt content="Kubernetes"><meta property="og:image" content="/images/kubernetes-horizontal-color.png"><meta property="og:type" content="article"><script src=/js/jquery-3.6.0.min.js intregrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary><a class=navbar-brand href=/ja/></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-2 mb-lg-0"><a class="nav-link active" href=/ja/docs/>ドキュメント</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/blog/>Blogs</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/training/>トレーニング</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/partners/>パートナー</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/community/>コミュニティ</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/case-studies/>ケーススタディ</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>バージョン</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/ja/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/ja/docs/setup/production-environment/on-premises-vm/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/ja/docs/setup/production-environment/on-premises-vm/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/ja/docs/setup/production-environment/on-premises-vm/>v1.23</a>
<a class=dropdown-item href=https://v1-22.docs.kubernetes.io/ja/docs/setup/production-environment/on-premises-vm/>v1.22</a>
<a class=dropdown-item href=https://v1-21.docs.kubernetes.io/ja/docs/setup/production-environment/on-premises-vm/>v1.21</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語 (Japanese)</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/fr/docs/setup/production-environment/on-premises-vm/>Français (French)</a></div></li></ul></div><button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>これは、このセクションの複数ページの印刷可能なビューです。
<a href=# onclick="return print(),!1">印刷するには、ここをクリックしてください</a>.</p><p><a href=/ja/docs/setup/production-environment/on-premises-vm/>このページの通常のビューに戻る</a>.</p></div><h1 class=title>オンプレミスVM</h1><ul><li>1: <a href=#pg-83a1f15a6fa96fcdca228c4a70f392b3>Cloudstack</a></li><li>2: <a href=#pg-89a44f01ba43ac7fda5e20024b9d6cea>DC/OS上のKubernetes</a></li><li>3: <a href=#pg-7f608a89334fa86add74d0d6ba0beedf>oVirt</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-83a1f15a6fa96fcdca228c4a70f392b3>1 - Cloudstack</h1><p><a href=https://cloudstack.apache.org/>CloudStack</a> is a software to build public and private clouds based on hardware virtualization principles (traditional IaaS). To deploy Kubernetes on CloudStack there are several possibilities depending on the Cloud being used and what images are made available. CloudStack also has a vagrant plugin available, hence Vagrant could be used to deploy Kubernetes either using the existing shell provisioner or using new Salt based recipes.</p><p><a href=https://coreos.com>CoreOS</a> templates for CloudStack are built <a href=https://stable.release.core-os.net/amd64-usr/current/>nightly</a>. CloudStack operators need to <a href=https://docs.cloudstack.apache.org/projects/cloudstack-administration/en/latest/templates.html>register</a> this template in their cloud before proceeding with these Kubernetes deployment instructions.</p><p>This guide uses a single <a href=https://github.com/apachecloudstack/k8s>Ansible playbook</a>, which is completely automated and can deploy Kubernetes on a CloudStack based Cloud using CoreOS images. The playbook, creates an ssh key pair, creates a security group and associated rules and finally starts coreOS instances configured via cloud-init.</p><h2 id=前提条件>前提条件</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt-get install -y python-pip libssl-dev
</span></span><span style=display:flex><span>sudo pip install cs
</span></span><span style=display:flex><span>sudo pip install sshpubkeys
</span></span><span style=display:flex><span>sudo apt-get install software-properties-common
</span></span><span style=display:flex><span>sudo apt-add-repository ppa:ansible/ansible
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install ansible
</span></span></code></pre></div><p>On CloudStack server you also have to install libselinux-python :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yum install libselinux-python
</span></span></code></pre></div><p><a href=https://github.com/exoscale/cs><em>cs</em></a> is a python module for the CloudStack API.</p><p>Set your CloudStack endpoint, API keys and HTTP method used.</p><p>You can define them as environment variables: <code>CLOUDSTACK_ENDPOINT</code>, <code>CLOUDSTACK_KEY</code>, <code>CLOUDSTACK_SECRET</code> and <code>CLOUDSTACK_METHOD</code>.</p><p>Or create a <code>~/.cloudstack.ini</code> file:</p><pre tabindex=0><code class=language-none data-lang=none>[cloudstack]
endpoint = &lt;your cloudstack api endpoint&gt;
key = &lt;your api access key&gt;
secret = &lt;your api secret key&gt;
method = post
</code></pre><p>We need to use the http POST method to pass the <em>large</em> userdata to the coreOS instances.</p><h3 id=playbookのクローン>playbookのクローン</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/apachecloudstack/k8s
</span></span><span style=display:flex><span><span style=color:#a2f>cd</span> kubernetes-cloudstack
</span></span></code></pre></div><h3 id=kubernetesクラスターの作成>Kubernetesクラスターの作成</h3><p>You simply need to run the playbook.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ansible-playbook k8s.yml
</span></span></code></pre></div><p>Some variables can be edited in the <code>k8s.yml</code> file.</p><pre tabindex=0><code class=language-none data-lang=none>vars:
  ssh_key: k8s
  k8s_num_nodes: 2
  k8s_security_group_name: k8s
  k8s_node_prefix: k8s2
  k8s_template: &lt;templatename&gt;
  k8s_instance_type: &lt;serviceofferingname&gt;
</code></pre><p>This will start a Kubernetes master node and a number of compute nodes (by default 2).
The <code>instance_type</code> and <code>template</code> are specific, edit them to specify your CloudStack cloud specific template and instance type (i.e. service offering).</p><p>Check the tasks and templates in <code>roles/k8s</code> if you want to modify anything.</p><p>Once the playbook as finished, it will print out the IP of the Kubernetes master:</p><pre tabindex=0><code class=language-none data-lang=none>TASK: [k8s | debug msg=&#39;k8s master IP is {{ k8s_master.default_ip }}&#39;] ********
</code></pre><p>SSH to it using the key that was created and using the <em>core</em> user.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssh -i ~/.ssh/id_rsa_k8s core@&lt;master IP&gt;
</span></span></code></pre></div><p>And you can list the machines in your cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>fleetctl list-machines
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>MACHINE        IP             METADATA
a017c422...    &lt;node #1 IP&gt;   role=node
ad13bf84...    &lt;master IP&gt;    role=master
e9af8293...    &lt;node #2 IP&gt;   role=node
</code></pre><h2 id=サポートレベル>サポートレベル</h2><table><thead><tr><th>IaaS Provider</th><th>Config. Mgmt</th><th>OS</th><th>Networking</th><th>Docs</th><th>Conforms</th><th>Support Level</th></tr></thead><tbody><tr><td>CloudStack</td><td>Ansible</td><td>CoreOS</td><td>flannel</td><td><a href=/docs/setup/production-environment/on-premises-vm/cloudstack/>docs</a></td><td></td><td>Community (<a href=https://github.com/ltupin/>@Guiques</a>)</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-89a44f01ba43ac7fda5e20024b9d6cea>2 - DC/OS上のKubernetes</h1><p>Mesosphereは<a href=https://mesosphere.com/product/>DC/OS</a>上にKubernetesを構築するための簡単な選択肢を提供します。それは</p><ul><li>純粋なアップストリームのKubernetes</li><li>シングルクリッククラスター構築</li><li>デフォルトで高可用であり安全</li><li>Kubernetesが高速なデータプラットフォーム(例えばAkka、Cassandra、Kafka、Spark)と共に稼働</li></ul><p>です。</p><h2 id=公式mesosphereガイド>公式Mesosphereガイド</h2><p>DC/OS入門の正規のソースは<a href=https://github.com/mesosphere/dcos-kubernetes-quickstart>クイックスタートリポジトリ</a>にあります。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7f608a89334fa86add74d0d6ba0beedf>3 - oVirt</h1><p>oVirt is a virtual datacenter manager that delivers powerful management of multiple virtual machines on multiple hosts. Using KVM and libvirt, oVirt can be installed on Fedora, CentOS, or Red Hat Enterprise Linux hosts to set up and manage your virtual data center.</p><h2 id=ovirtクラウドプロバイダーによる構築>oVirtクラウドプロバイダーによる構築</h2><p>The oVirt cloud provider allows to easily discover and automatically add new VM instances as nodes to your Kubernetes cluster.
At the moment there are no community-supported or pre-loaded VM images including Kubernetes but it is possible to <a href=https://ovedou.blogspot.it/2014/03/importing-glance-images-as-ovirt.html>import</a> or <a href=https://www.ovirt.org/documentation/quickstart/quickstart-guide/#create-virtual-machines>install</a> Project Atomic (or Fedora) in a VM to <a href=https://www.ovirt.org/documentation/quickstart/quickstart-guide/#using-templates>generate a template</a>. Any other distribution that includes Kubernetes may work as well.</p><p>It is mandatory to <a href=https://www.ovirt.org/documentation/how-to/guest-agent/install-the-guest-agent-in-fedora/>install the ovirt-guest-agent</a> in the guests for the VM ip address and hostname to be reported to ovirt-engine and ultimately to Kubernetes.</p><p>Once the Kubernetes template is available it is possible to start instantiating VMs that can be discovered by the cloud provider.</p><h2 id=ovirtクラウドプロバイダーの使用>oVirtクラウドプロバイダーの使用</h2><p>The oVirt Cloud Provider requires access to the oVirt REST-API to gather the proper information, the required credential should be specified in the <code>ovirt-cloud.conf</code> file:</p><pre tabindex=0><code class=language-none data-lang=none>[connection]
uri = https://localhost:8443/ovirt-engine/api
username = admin@internal
password = admin
</code></pre><p>In the same file it is possible to specify (using the <code>filters</code> section) what search query to use to identify the VMs to be reported to Kubernetes:</p><pre tabindex=0><code class=language-none data-lang=none>[filters]
# Search query used to find nodes
vms = tag=kubernetes
</code></pre><p>In the above example all the VMs tagged with the <code>kubernetes</code> label will be reported as nodes to Kubernetes.</p><p>The <code>ovirt-cloud.conf</code> file then must be specified in kube-controller-manager:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kube-controller-manager ... --cloud-provider<span style=color:#666>=</span>ovirt --cloud-config<span style=color:#666>=</span>/path/to/ovirt-cloud.conf ...
</span></span></code></pre></div><h2 id=ovirtクラウドプロバイダーのスクリーンキャスト>oVirtクラウドプロバイダーのスクリーンキャスト</h2><p>This short screencast demonstrates how the oVirt Cloud Provider can be used to dynamically add VMs to your Kubernetes cluster.</p><p><a href="https://www.youtube.com/watch?v=JyyST4ZKne8"><img src=https://img.youtube.com/vi/JyyST4ZKne8/0.jpg alt=Screencast></a></p><h2 id=サポートレベル>サポートレベル</h2><table><thead><tr><th>IaaS Provider</th><th>Config. Mgmt</th><th>OS</th><th>Networking</th><th>Docs</th><th>Conforms</th><th>Support Level</th></tr></thead><tbody><tr><td>oVirt</td><td></td><td></td><td></td><td><a href=/docs/setup/production-environment/on-premises-vm/ovirt/>docs</a></td><td></td><td>Community (<a href=https://github.com/simon3z>@simon3z</a>)</td></tr></tbody></table></div></main></div></div><footer class=d-print-none><div class=footer__links><nav><a class=text-white href=/ja/docs/home/>ホーム</a>
<a class=text-white href=/ja/blog/>Blogs</a>
<a class=text-white href=/ja/training/>トレーニング</a>
<a class=text-white href=/ja/partners/>パートナー</a>
<a class=text-white href=/ja/community/>コミュニティ</a>
<a class=text-white href=/ja/case-studies/>ケーススタディ</a></nav></div><div class=container-fluid><div class=row><div class="col-6 col-sm-2 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank href=https://discuss.kubernetes.io><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank href=https://twitter.com/kubernetesio><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar><a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io"><i class="fas fa-calendar-alt"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank href=https://youtube.com/kubernetescommunity><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-2 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank href=https://slack.k8s.io><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute><a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide><i class="fas fa-edit"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-12 col-sm-8 text-center order-sm-2"><small class=text-white>&copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small><br><small class=text-white>Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>Trademark Usage page</a></small><br><small class=text-white>ICP license: 京ICP备17074266号-3</small></div></div></div></footer></div><script src=/js/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=/js/popper-1.16.1.min.js intregrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=/js/bootstrap-4.6.1.min.js integrity=sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2 crossorigin=anonymous></script>
<script src=/js/script.js></script>
<script async src=/js/mermaid-8.13.4.min.js integrity=sha384-5hHNvPeMrNH14oM3IcQofDoBhiclNK3g2+hnEinKzQ07C4AliMeVpnvxuiwEGpaO crossorigin=anonymous></script>
<script src=/js/main.min.5c0bf7f21dc4f66485f74efbbeeff28a7e4f8cddaac1bae47043159c922ff3a3.js integrity="sha256-XAv38h3E9mSF9077vu/yin5PjN2qwbrkcEMVnJIv86M=" crossorigin=anonymous></script></body></html>