<!doctype html><html lang=ja class=no-js><head><meta name=robots content="noindex, nofollow"><link rel=alternate hreflang=en href=https://kubernetes.io/docs/reference/scheduling/><link rel=alternate hreflang=zh-cn href=https://kubernetes.io/zh-cn/docs/reference/scheduling/><link rel=alternate hreflang=ko href=https://kubernetes.io/ko/docs/reference/scheduling/><link rel=alternate hreflang=hi href=https://kubernetes.io/hi/docs/reference/scheduling/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://kubernetes.io/ja/docs/reference/scheduling/><link rel="shortcut icon" type=image/png href=/images/favicon.png><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon href=/images/kubernetes-192x192.png><title>Scheduling | Kubernetes</title><meta property="og:title" content="Scheduling"><meta property="og:description" content="プロダクショングレードのコンテナ管理基盤"><meta property="og:type" content="website"><meta property="og:url" content="https://kubernetes.io/ja/docs/reference/scheduling/"><meta property="og:site_name" content="Kubernetes"><meta itemprop=name content="Scheduling"><meta itemprop=description content="プロダクショングレードのコンテナ管理基盤"><meta name=twitter:card content="summary"><meta name=twitter:title content="Scheduling"><meta name=twitter:description content="プロダクショングレードのコンテナ管理基盤"><link href=/scss/main.css rel=stylesheet><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png","potentialAction":{"@type":"SearchAction","target":"https://kubernetes.io/search/?q={search_term_string}","query-input":"required name=search_term_string"}}</script><meta name=theme-color content="#326ce5"><link rel=stylesheet href=/css/feature-states.css><meta name=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:url" content="https://kubernetes.io/ja/docs/reference/scheduling/"><meta property="og:title" content="Scheduling"><meta name=twitter:title content="Scheduling"><meta name=twitter:image content="https://kubernetes.io/images/favicon.png"><meta name=twitter:image:alt content="Kubernetes"><meta property="og:image" content="/images/kubernetes-horizontal-color.png"><meta property="og:type" content="article"><script src=/js/jquery-3.6.0.min.js intregrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary><a class=navbar-brand href=/ja/></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-2 mb-lg-0"><a class="nav-link active" href=/ja/docs/>ドキュメント</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/blog/>Blogs</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/training/>トレーニング</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/partners/>パートナー</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/community/>コミュニティ</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/ja/case-studies/>ケーススタディ</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>バージョン</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/ja/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/ja/docs/reference/scheduling/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/ja/docs/reference/scheduling/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/ja/docs/reference/scheduling/>v1.23</a>
<a class=dropdown-item href=https://v1-22.docs.kubernetes.io/ja/docs/reference/scheduling/>v1.22</a>
<a class=dropdown-item href=https://v1-21.docs.kubernetes.io/ja/docs/reference/scheduling/>v1.21</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語 (Japanese)</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/reference/scheduling/>English</a>
<a class=dropdown-item href=/zh-cn/docs/reference/scheduling/>中文 (Chinese)</a>
<a class=dropdown-item href=/ko/docs/reference/scheduling/>한국어 (Korean)</a>
<a class=dropdown-item href=/hi/docs/reference/scheduling/>हिन्दी (Hindi)</a></div></li></ul></div><button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>これは、このセクションの複数ページの印刷可能なビューです。
<a href=# onclick="return print(),!1">印刷するには、ここをクリックしてください</a>.</p><p><a href=/ja/docs/reference/scheduling/>このページの通常のビューに戻る</a>.</p></div><h1 class=title>Scheduling</h1><ul><li>1: <a href=#pg-ef4fb938b6b63c95f5f26f9b1cec3054>スケジューラーの設定</a></li><li>2: <a href=#pg-5a0a68fb6a7ffefb6d5f861100fa0ae3>スケジューリングポリシー</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-ef4fb938b6b63c95f5f26f9b1cec3054>1 - スケジューラーの設定</h1><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.19 [beta]</code></div><p>設定ファイルを作成し、そのパスをコマンドライン引数として渡すことで<code>kube-scheduler</code>の振る舞いをカスタマイズすることができます。</p><p>スケジューリングプロファイルは、<a class=glossary-tooltip title=コントロールプレーン上で動作するコンポーネントで、新しく作られたPodにノードが割り当てられているか監視し、割り当てられていなかった場合にそのPodを実行するノードを選択します。 data-toggle=tooltip data-placement=top href=/docs/reference/generated/kube-scheduler/ target=_blank aria-label=kube-scheduler>kube-scheduler</a>でスケジューリングの異なるステージを設定することができます。
各ステージは、拡張点に公開されています。プラグインをそれらの拡張点に1つ以上実装することで、スケジューリングの振る舞いを変更できます。</p><p>KubeSchedulerConfiguration(<a href=/docs/reference/config-api/kube-scheduler-config.v1beta2/><code>v1beta2</code></a>か<a href=/docs/reference/config-api/kube-scheduler-config.v1beta3/><code>v1beta3</code></a>)構造体を使用して、<code>kube-scheduler --config &lt;filename></code>を実行することで、スケジューリングプロファイルを指定することができます。</p><p>最小限の設定は次の通りです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>clientConnection</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>kubeconfig</span>:<span style=color:#bbb> </span>/etc/srv/kubernetes/kube-scheduler/kubeconfig<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=プロファイル>プロファイル</h2><p>スケジューリングプロファイルは、<a class=glossary-tooltip title=コントロールプレーン上で動作するコンポーネントで、新しく作られたPodにノードが割り当てられているか監視し、割り当てられていなかった場合にそのPodを実行するノードを選択します。 data-toggle=tooltip data-placement=top href=/docs/reference/generated/kube-scheduler/ target=_blank aria-label=kube-scheduler>kube-scheduler</a>でスケジューリングの異なるステージを設定することができます。
各ステージは<a href=#extension-points>拡張点</a>に公開されています。
<a href=#scheduling-plugins>プラグイン</a>をそれらの拡張点に1つ以上実装することで、スケジューリングの振る舞いを変更できます。</p><p>単一の<code>kube-scheduler</code>インスタンスで<a href=#multiple-profiles>複数のプロファイル</a>を実行するように設定することも可能です。</p><h3 id=extension-points>拡張点</h3><p>スケジューリングは一連のステージで行われ、以下の拡張点に公開されています。</p><ol><li><code>queueSort</code>: これらのプラグインは、スケジューリングキューにある<code>pending</code>状態のPodをソートするための順序付け関数を提供します。同時に有効化できるプラグインは1つだけです。</li><li><code>preFilter</code>: これらのプラグインは、フィルタリングをする前にPodやクラスターの情報のチェックや前処理のために使用されます。これらのプラグインは、設定された順序で呼び出されます。</li><li><code>filter</code>: これらのプラグインは、スケジューリングポリシーにおけるPredicatesに相当するもので、Podの実行不可能なNodeをフィルターするために使用されます。もし全てのNodeがフィルターされてしまった場合、Podはunschedulableとしてマークされます。</li><li><code>postFilter</code>:これらのプラグインは、Podの実行可能なNodeが見つからなかった場合、設定された順序で呼び出されます。もし<code>postFilter</code>プラグインのいずれかが、Podを <strong>スケジュール可能</strong> とマークした場合、残りの<code>postFilter</code>プラグインは呼び出されません。</li><li><code>preScore</code>: これは、スコアリング前の作業を行う際に使用できる情報提供のための拡張点です。</li><li><code>score</code>: これらのプラグインはフィルタリングフェーズを通過してきたそれぞれのNodeに対してスコア付けを行います。その後スケジューラーは、最も高い重み付きスコアの合計を持つノードを選択します。</li><li><code>reserve</code>: これは、指定されたPodのためにリソースが予約された際に、プラグインに通知する、情報提供のための拡張点です。また、プラグインは<code>Reserve</code>中に失敗した際、または<code>Reserve</code>の後に呼び出される<code>Unreserve</code>も実装しています。</li><li><code>permit</code>: これらのプラグインではPodのバインディングを拒む、または遅延させることができます。</li><li><code>preBind</code>: これらのプラグインは、Podがバインドされる前に必要な処理を実行できます。</li><li><code>bind</code>: これらのプラグインはPodをNodeにバインドします。<code>bind</code>プラグインは順番に呼び出され、1つのプラグインがバインドを完了すると、残りのプラグインはスキップされます。<code>bind</code>プラグインは少なくとも1つは必要です。</li><li><code>postBind</code>: これは、Podがバインドされた後に呼び出される情報提供のための拡張点です。</li><li><code>multiPoint</code>: このフィールドは設定のみ可能で、プラグインが適用されるすべての拡張点に対して同時に有効化または無効化することができます。</li></ol><p>次の例のように、それぞれの拡張点に対して、特定の<a href=#scheduling-plugins>デフォルトプラグイン</a>を無効化、または自作のプラグインを有効化することができます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>score</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>PodTopologySpread<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MyCustomPluginA<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>weight</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MyCustomPluginB<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>weight</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span></code></pre></div><p><code>disabled</code>配列の<code>name</code>フィールドに<code>*</code>を使用することで、その拡張点の全てのデフォルトプラグインを無効化できます。また、必要に応じてプラグインの順序を入れ替える場合にも使用されます。</p><h3 id=scheduling-plugins>Scheduling plugins</h3><p>以下のプラグインはデフォルトで有効化されており、1つ以上の拡張点に実装されています。</p><ul><li><code>ImageLocality</code>:Podが実行するコンテナイメージを既に持っているNodeを優先します。
拡張点:<code>score</code></li><li><code>TaintToleration</code>:<a href=/ja/docs/concepts/scheduling-eviction/taint-and-toleration/>TaintsとTolerations</a>を実行します。
実装する拡張点:<code>filter</code>、<code>preScore</code>、<code>score</code></li><li><code>NodeName</code>: PodのSpecのNode名が、現在のNodeと一致するかをチェックします。
拡張点:<code>filter</code></li><li><code>NodePorts</code>:要求されたPodのポートに対して、Nodeが空きポートを持っているかチェックします。
拡張点:<code>preFilter</code>、<code>filter</code></li><li><code>NodeAffinity</code>:<a href=/ja/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector>nodeselectors</a>と<a href=/ja/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity>Nodeアフィニティ</a>を実行します。
拡張点:<code>filter</code>、<code>score</code></li><li><code>PodTopologySpread</code>:<a href=/docs/concepts/workloads/pods/pod-topology-spread-constraints/>Podトポロジーの分散制約</a>を実行します。
拡張点:<code>preFilter</code>、<code>filter</code>、<code>preScore</code>、<code>score</code></li><li><code>NodeUnschedulable</code>:<code>.spec.unschedulable</code>がtrueに設定されているNodeをフィルタリングします。
拡張点:<code>filter</code>.</li><li><code>NodeResourcesFit</code>:Podが要求しているすべてのリソースがNodeにあるかをチェックします。スコアは3つのストラテジのうちの1つを使用します:<code>LeastAllocated</code>(デフォルト)、<code>MostAllocated</code>、 と<code>RequestedToCapacityRatio</code>
拡張点:<code>preFilter</code>、<code>filter</code>、<code>score</code></li><li><code>NodeResourcesBalancedAllocation</code>:Podがスケジュールされた場合に、よりバランスの取れたリソース使用量となるNodeを優先します。
拡張点:<code>score</code></li><li><code>VolumeBinding</code>:Nodeが、要求された<a class=glossary-tooltip title=データを格納するディレクトリで、Pod内のコンテナからアクセス可能です。 data-toggle=tooltip data-placement=top href=/docs/concepts/storage/volumes/ target=_blank aria-label=ボリューム>ボリューム</a>を持っている、もしくはバインドしているかチェックします。
拡張点:<code>preFilter</code>、<code>filter</code>、<code>reserve</code>、<code>preBind</code>、<code>score</code><div class="alert alert-info note callout" role=alert><strong>備考:</strong> <code>score</code>拡張点は、<code>VolumeCapacityPriority</code>機能が有効になっている時に有効化されます。
要求されたボリュームに適合する最小のPVを優先的に使用します。</div></li><li><code>VolumeRestrictions</code>:Nodeにマウントされたボリュームが、ボリュームプロバイダ固有の制限を満たしているかを確認します。
拡張点:<code>filter</code></li><li><code>VolumeZone</code>:要求されたボリュームがゾーン要件を満たしているかどうかを確認します。
拡張点:<code>filter</code></li><li><code>NodeVolumeLimits</code>:NodeのCSIボリューム制限を満たすかどうかをチェックします。
拡張点:<code>filter</code></li><li><code>EBSLimits</code>:NodeのAWSのEBSボリューム制限を満たすかどうかをチェックします。
拡張点:<code>filter</code></li><li><code>GCEPDLimits</code>:NodeのGCP-PDボリューム制限を満たすかどうかをチェックします。
拡張点:<code>filter</code></li><li><code>AzureDiskLimits</code>:NodeのAzureディスクボリューム制限を満たすかどうかをチェックします。
拡張点:<code>filter</code></li><li><code>InterPodAffinity</code>:<a href=/docs/concepts/scheduling-eviction/assign-pod-node/#inter-pod-affinity-and-anti-affinity>Pod間のaffinityとanti-affinity</a>を実行します。
拡張点:<code>preFilter</code>、<code>filter</code>、<code>preScore</code>、<code>score</code></li><li><code>PrioritySort</code>:デフォルトの優先順位に基づくソートを提供します。
拡張点:<code>queueSort</code>.</li><li><code>DefaultBinder</code>:デフォルトのバインディングメカニズムを提供します。
拡張点:<code>bind</code></li><li><code>DefaultPreemption</code>:デフォルトのプリエンプションメカニズムを提供します。
拡張点:<code>postFilter</code></li></ul><p>また、コンポーネント設定のAPIにより、以下のプラグインを有効にすることができます。
デフォルトでは有効になっていません。</p><ul><li><code>SelectorSpread</code>:<a class=glossary-tooltip title=Podの集合で実行されているアプリケーションをネットワークサービスとして公開する方法。 data-toggle=tooltip data-placement=top href=/ja/docs/concepts/services-networking/service/ target=_blank aria-label=サービス>サービス</a>と<a class=glossary-tooltip title=ReplicaSetは、指定された数のPodレプリカが一度に動作するように保証します。 data-toggle=tooltip data-placement=top href=/ja/docs/concepts/workloads/controllers/replicaset/ target=_blank aria-label=レプリカセット>レプリカセット</a>、<a class=glossary-tooltip title=StatefulSetはDeploymentとPodのセットのスケーリングを管理し、永続化ストレージと各Podの永続的な識別子を備えています。 data-toggle=tooltip data-placement=top href=/ja/docs/concepts/workloads/controllers/statefulset/ target=_blank aria-label=ステートフルセット>ステートフルセット</a>、に属するPodのNode間の拡散を優先します。
拡張点:<code>preScore</code>、<code>score</code></li><li><code>CinderLimits</code>:Nodeが<a href=https://docs.openstack.org/cinder/><code>OpenStack Cinder</code></a>ボリューム制限を満たせるかチェックします。
拡張点:<code>filter</code></li></ul><h3 id=multiple-profiles>複数のプロファイル</h3><p><code>kube-scheduler</code>は複数のプロファイルを実行するように設定することができます。
各プロファイルは関連するスケジューラー名を持ち、その<a href=#extension-points>拡張点</a>に異なるプラグインを設定することが可能です。</p><p>以下のサンプル設定では、スケジューラーは2つのプロファイルで実行されます。1つはデフォルトプラグインで、もう1つはすべてのスコアリングプラグインを無効にしたものです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>schedulerName</span>:<span style=color:#bbb> </span>default-scheduler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>schedulerName</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>no</span>-scoring-scheduler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>preScore</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>score</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>特定のプロファイルに従ってスケジュールさせたいPodは、その<code>.spec.schedulerName</code>に、対応するスケジューラー名を含めることができます。</p><p>デフォルトでは、スケジューラー名<code>default-scheduler</code>としてプロファイルが生成されます。
このプロファイルは、上記のデフォルトプラグインを含みます。複数のプロファイルを宣言する場合は、それぞれユニークなスケジューラー名にする必要があります。</p><p>もしPodがスケジューラー名を指定しない場合、kube-apiserverは<code>default-scheduler</code>を設定します。
従って、これらのPodをスケジュールするために、このスケジューラー名を持つプロファイルが存在する必要があります。</p><div class="alert alert-info note callout" role=alert><strong>備考:</strong> Podのスケジューリングイベントには、ReportingControllerとして<code>.spec.schedulerName</code>が設定されています。
リーダー選出のイベントには、リスト先頭のプロファイルのスケジューラー名が使用されます。</div><div class="alert alert-info note callout" role=alert><strong>備考:</strong> すべてのプロファイルは、<code>queueSort</code>拡張点で同じプラグインを使用し、同じ設定パラメーターを持つ必要があります (該当する場合)。これは、pending状態のPodキューがスケジューラーに1つしかないためです。</div><h3 id=multipoint>複数の拡張点に適用されるプラグイン</h3><p><code>kubescheduler.config.k8s.io/v1beta3</code>からは、プロファイル設定に<code>multiPoint</code>というフィールドが追加され、複数の拡張点でプラグインを簡単に有効・無効化できるようになりました。
<code>multiPoint</code>設定の目的は、カスタムプロファイルを使用する際に、ユーザーや管理者が必要とする設定を簡素化することです。</p><p><code>MyPlugin</code>というプラグインがあり、<code>preScore</code>、<code>score</code>、<code>preFilter</code>、<code>filter</code>拡張点を実装しているとします。
すべての利用可能な拡張点で<code>MyPlugin</code>を有効化するためには、プロファイル設定は次のようにします。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>schedulerName</span>:<span style=color:#bbb> </span>multipoint-scheduler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>multiPoint</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MyPlugin<span style=color:#bbb>
</span></span></span></code></pre></div><p>これは以下のように、<code>MyPlugin</code>を手動ですべての拡張ポイントに対して有効にすることと同じです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>schedulerName</span>:<span style=color:#bbb> </span>non-multipoint-scheduler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>preScore</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MyPlugin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>score</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MyPlugin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>preFilter</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MyPlugin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>filter</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MyPlugin<span style=color:#bbb>
</span></span></span></code></pre></div><p><code>multiPoint</code>を使用する利点の一つは、将来的に<code>MyPlugin</code>が別の拡張点を実装した場合に、<code>multiPoint</code>設定が自動的に新しい拡張点に対しても有効化されることです。</p><p>特定の拡張点は、その拡張点の<code>disabled</code>フィールドを使用して、<code>MultiPoint</code>の展開から除外することができます。
これは、デフォルトのプラグインを無効にしたり、デフォルト以外のプラグインを無効にしたり、ワイルドカード(<code>'*'</code>)を使ってすべてのプラグインを無効にしたりする場合に有効です。
<code>Score</code>と<code>PreScore</code>を無効にするためには、次の例のようにします。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>schedulerName</span>:<span style=color:#bbb> </span>non-multipoint-scheduler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>multiPoint</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;MyPlugin&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>preScore</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>score</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p><code>v1beta3</code>では、<code>MultiPoint</code>を通じて、内部的に全ての<a href=#scheduling-plugins>デフォルトプラグイン</a>が有効化されています。
しかしながら、デフォルト値(並び順やスコアの重みなど)を柔軟に設定し直せるように、個別の拡張点は用意されています。
例えば、2つのスコアプラグイン<code>DefaultScore1</code>と<code>DefaultScore2</code>に、重み1が設定されているとします。
その場合、次のように重さを変更し、並べ替えることができます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>schedulerName</span>:<span style=color:#bbb> </span>multipoint-scheduler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>score</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultScore2&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>weight</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>この例では、<code>MultiPoint</code>はデフォルトプラグインであるため、明示的にプラグイン名を指定する必要はありません。
そして、<code>Score</code>に指定されているプラグインは<code>DefaultScore2</code>のみです。
これは、特定の拡張点を通じて設定されたプラグインは、常に<code>MultiPoint</code>プラグインよりも優先されるためです。つまり、この設定例では、結果的に2つのプラグインを両方指定することなく、並び替えが行えます。</p><p><code>MultiPoint</code>プラグインを設定する際の一般的な優先順位は、以下の通りです。</p><ol><li>特定の拡張点が最初に実行され、その設定は他の場所で設定されたものよりも優先される</li><li><code>MultiPoint</code>を使用して、手動で設定したプラグインとその設定内容</li><li>デフォルトプラグインとそのデフォルト設定</li></ol><p>上記の優先順位を示すために、次の例はこれらのプラグインをベースにします。</p><table><thead><tr><th>プラグイン</th><th>拡張点</th></tr></thead><tbody><tr><td><code>DefaultQueueSort</code></td><td><code>QueueSort</code></td></tr><tr><td><code>CustomQueueSort</code></td><td><code>QueueSort</code></td></tr><tr><td><code>DefaultPlugin1</code></td><td><code>Score</code>, <code>Filter</code></td></tr><tr><td><code>DefaultPlugin2</code></td><td><code>Score</code></td></tr><tr><td><code>CustomPlugin1</code></td><td><code>Score</code>, <code>Filter</code></td></tr><tr><td><code>CustomPlugin2</code></td><td><code>Score</code>, <code>Filter</code></td></tr></tbody></table><p>これらのプラグインの有効な設定例は次の通りです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>schedulerName</span>:<span style=color:#bbb> </span>multipoint-scheduler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>multiPoint</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;CustomQueueSort&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;CustomPlugin1&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>weight</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;CustomPlugin2&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultQueueSort&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>filter</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultPlugin1&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>score</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultPlugin2&#39;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>なお、特定の拡張点に<code>MultiPoint</code>プラグインを再宣言しても、エラーにはなりません。
特定の拡張点が優先されるため、再宣言は無視されます(ログは記録されます)。</p><p>このサンプルは、ほとんどのコンフィグを一箇所にまとめるだけでなく、いくつかの工夫をしています。</p><ul><li>カスタムの<code>queueSort</code>プラグインを有効にし、デフォルトのプラグインを無効にする。</li><li><code>CustomPlugin1</code>と<code>CustomPlugin2</code>を有効にし、この拡張点のプラグイン内で、最初に実行されるようにする。</li><li><code>filter</code>拡張点でのみ、<code>DefaultPlugin1</code>を無効にする。</li><li><code>score</code>拡張点で<code>DefaultPlugin2</code>が最初に実行されるように並べ替える(カスタムプラグインより先に)。</li></ul><p><code>v1beta3</code>以前のバージョンで、<code>multiPoint</code>がない場合、上記の設定例は、次のものと同等になります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>schedulerName</span>:<span style=color:#bbb> </span>multipoint-scheduler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># デフォルトQueueSortプラグインを無効化</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>queueSort</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;CustomQueueSort&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultQueueSort&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># カスタムFilterプラグインを有効化</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>filter</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;CustomPlugin1&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;CustomPlugin2&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultPlugin2&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>disabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultPlugin1&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># カスタムScoreプラグインを有効化し、実行順を並べ替える</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>score</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>enabled</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultPlugin2&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>weight</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;DefaultPlugin1&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>weight</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>これは複雑な例ですが、<code>MultiPoint</code>設定の柔軟性と、拡張点を設定する既存の方法とのシームレスな統合を実証しています。</p><h2 id=スケジューラー設定の移行>スケジューラー設定の移行</h2><ul class="nav nav-tabs" id=tab-with-md role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tab-with-md-0 role=tab aria-controls=tab-with-md-0 aria-selected=true>v1beta1 → v1beta2</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#tab-with-md-1 role=tab aria-controls=tab-with-md-1>v1beta2 → v1beta3</a></li></ul><div class=tab-content id=tab-with-md><div id=tab-with-md-0 class="tab-pane show active" role=tabpanel aria-labelledby=tab-with-md-0><p><ul><li><p>v1beta2<code>のバージョン</code>の設定では、新しい<code>NodeResourcesFit</code>プラグインをスコア拡張点で使用できます。
この新しい拡張機能は、<code>NodeResourcesLeastAllocated</code>、<code>NodeResourcesMostAllocated</code>、 <code>RequestedToCapacityRatio</code>プラグインの機能を組み合わせたものです。
例えば、以前は<code>NodeResourcesMostAllocated</code>プラグインを使っていたなら、代わりに<code>NodeResourcesFitプラグインを使用し(デフォルトで有効)、</code>pluginConfig<code>に次のような</code>scoreStrategy`を追加することになるでしょう。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kubescheduler.config.k8s.io/v1beta2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>KubeSchedulerConfiguration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>profiles</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>pluginConfig</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>scoringStrategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>cpu<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>weight</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>MostAllocated<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>NodeResourcesFit<span style=color:#bbb>
</span></span></span></code></pre></div></li><li><p>スケジューラープラグインの<code>NodeLabel</code>は廃止されました。代わりに<a href=/ja/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity><code>NodeAffinity</code></a>プラグイン(デフォルトで有効)を使用することで同様の振る舞いを実現できます。</p></li><li><p>スケジューラープラグインの<code>ServiceAffinity</code>は廃止されました。代わりに<a href=/ja/docs/concepts/scheduling-eviction/assign-pod-node/#inter-pod-affinity-and-anti-affinity><code>InterPodAffinity</code></a>プラグイン(デフォルトで有効)を使用することで同様の振る舞いを実現できます。</p></li><li><p>スケジューラープラグインの<code>NodePreferAvoidPods</code>は廃止されました。代わりに<a href=/ja/docs/concepts/scheduling-eviction/taint-and-toleration/>Node taints</a>を使用することで同様の振る舞いを実現できます。</p></li><li><p>v1beta2で有効化されたプラグインは、そのプラグインのデフォルトの設定より優先されます。</p></li><li><p>スケジューラーのヘルスとメトリクスのバインドアドレスに設定されている<code>host</code>や<code>port</code>が無効な場合、バリデーションに失敗します。</p></li></ul></div><div id=tab-with-md-1 class=tab-pane role=tabpanel aria-labelledby=tab-with-md-1><p><ul><li>デフォルトで3つのプラグインの重みが増加しました。<ul><li><code>InterPodAffinity</code>:1から2</li><li><code>NodeAffinity</code>:1から2</li><li><code>TaintToleration</code>:1から3</li></ul></li></ul></div></div><h2 id=次の項目>次の項目</h2><ul><li><a href=/docs/reference/command-line-tools-reference/kube-scheduler/>kube-schedulerリファレンス</a>を読む</li><li><a href=/ja/docs/concepts/scheduling-eviction/kube-scheduler/>scheduling</a>について学ぶ</li><li><a href=/docs/reference/config-api/kube-scheduler-config.v1beta2/>kube-scheduler設定(v1beta2)</a>のリファレンスを読む</li><li><a href=/docs/reference/config-api/kube-scheduler-config.v1beta3/>kube-scheduler設定(v1beta3)</a>のリファレンスを読む</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-5a0a68fb6a7ffefb6d5f861100fa0ae3>2 - スケジューリングポリシー</h1><p>バージョンv1.23より前のKubernetesでは、スケジューリングポリシーを使用して、<em>predicates</em>と<em>priorities</em>の処理を指定することができました。例えば、<code>kube-scheduler --policy-config-file &lt;filename></code>または<code>kube-scheduler --policy-configmap &lt;ConfigMap></code>を実行すると、スケジューリングポリシーを設定することが可能です。</p><p>このスケジューリングポリシーは、バージョンv1.23以降のKubernetesではサポートされていません。関連するフラグである、<code>policy-config-file</code>、<code>policy-configmap</code>、<code>policy-configmap-namespace</code>、<code>use-legacy-policy-config</code>も同様にサポートされていません。
代わりに、<a href=/ja/docs/reference/scheduling/config/>スケジューラー設定</a>を使用してください。</p><h2 id=次の項目>次の項目</h2><ul><li><a href=/ja/docs/concepts/scheduling-eviction/kube-scheduler/>スケジューリング</a>について学ぶ</li><li><a href=/ja/docs/reference/scheduling/config/>kube-scheduler設定</a>について学ぶ</li><li><a href=/docs/reference/config-api/kube-scheduler-config.v1beta3/>kube-scheduler設定リファレンス(v1beta3)</a>について読む</li></ul></div></main></div></div><footer class=d-print-none><div class=footer__links><nav><a class=text-white href=/ja/docs/home/>ホーム</a>
<a class=text-white href=/ja/blog/>Blogs</a>
<a class=text-white href=/ja/training/>トレーニング</a>
<a class=text-white href=/ja/partners/>パートナー</a>
<a class=text-white href=/ja/community/>コミュニティ</a>
<a class=text-white href=/ja/case-studies/>ケーススタディ</a></nav></div><div class=container-fluid><div class=row><div class="col-6 col-sm-2 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank href=https://discuss.kubernetes.io><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank href=https://twitter.com/kubernetesio><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar><a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io"><i class="fas fa-calendar-alt"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank href=https://youtube.com/kubernetescommunity><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-2 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank href=https://slack.k8s.io><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute><a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide><i class="fas fa-edit"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-12 col-sm-8 text-center order-sm-2"><small class=text-white>&copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small><br><small class=text-white>Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>Trademark Usage page</a></small><br><small class=text-white>ICP license: 京ICP备17074266号-3</small></div></div></div></footer></div><script src=/js/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=/js/popper-1.16.1.min.js intregrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=/js/bootstrap-4.6.1.min.js integrity=sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2 crossorigin=anonymous></script>
<script src=/js/script.js></script>
<script async src=/js/mermaid-8.13.4.min.js integrity=sha384-5hHNvPeMrNH14oM3IcQofDoBhiclNK3g2+hnEinKzQ07C4AliMeVpnvxuiwEGpaO crossorigin=anonymous></script>
<script src=/js/main.min.5c0bf7f21dc4f66485f74efbbeeff28a7e4f8cddaac1bae47043159c922ff3a3.js integrity="sha256-XAv38h3E9mSF9077vu/yin5PjN2qwbrkcEMVnJIv86M=" crossorigin=anonymous></script></body></html>