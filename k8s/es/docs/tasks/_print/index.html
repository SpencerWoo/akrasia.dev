<!doctype html><html lang=es class=no-js><head><meta name=robots content="noindex, nofollow"><link rel=alternate hreflang=en href=https://kubernetes.io/docs/tasks/><link rel=alternate hreflang=zh-cn href=https://kubernetes.io/zh-cn/docs/tasks/><link rel=alternate hreflang=ko href=https://kubernetes.io/ko/docs/tasks/><link rel=alternate hreflang=ja href=https://kubernetes.io/ja/docs/tasks/><link rel=alternate hreflang=fr href=https://kubernetes.io/fr/docs/tasks/><link rel=alternate hreflang=de href=https://kubernetes.io/de/docs/tasks/><link rel=alternate hreflang=pt-br href=https://kubernetes.io/pt-br/docs/tasks/><link rel=alternate hreflang=id href=https://kubernetes.io/id/docs/tasks/><link rel=alternate hreflang=hi href=https://kubernetes.io/hi/docs/tasks/><link rel=alternate hreflang=pl href=https://kubernetes.io/pl/docs/tasks/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://kubernetes.io/es/docs/tasks/><link rel="shortcut icon" type=image/png href=/images/favicon.png><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon href=/images/kubernetes-192x192.png><title>Tareas | Kubernetes</title><meta property="og:title" content="Tareas"><meta property="og:description" content="Orquestación de contenedores para producción"><meta property="og:type" content="website"><meta property="og:url" content="https://kubernetes.io/es/docs/tasks/"><meta property="og:site_name" content="Kubernetes"><meta itemprop=name content="Tareas"><meta itemprop=description content="Orquestación de contenedores para producción"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tareas"><meta name=twitter:description content="Orquestación de contenedores para producción"><link href=/scss/main.css rel=stylesheet><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png","potentialAction":{"@type":"SearchAction","target":"https://kubernetes.io/search/?q={search_term_string}","query-input":"required name=search_term_string"}}</script><meta name=theme-color content="#326ce5"><link rel=stylesheet href=/css/feature-states.css><meta name=description content="Interfaz Web de Usuario (Tablero de Control) Usar la línea de comandos con kubectl Configurar Pods y Contenedores Ejecutar Aplicaciones Ejecutar Jobs Acceder a las Aplicaciones de un Clúster Monitorización, Trazas, y Depuración Acceder a la API de Kubernetes Usar TLS Administrar un Clúster Administrar la Federación Gestionar Aplicaciones con Estado Daemons del Clúster Gestionar GPUs Gestionar HugePages Siguientes pasos Esta sección de la documentación de Kubernetes contiene páginas que muestran cómo acometer tareas individuales."><meta property="og:description" content="Interfaz Web de Usuario (Tablero de Control) Usar la línea de comandos con kubectl Configurar Pods y Contenedores Ejecutar Aplicaciones Ejecutar Jobs Acceder a las Aplicaciones de un Clúster Monitorización, Trazas, y Depuración Acceder a la API de Kubernetes Usar TLS Administrar un Clúster Administrar la Federación Gestionar Aplicaciones con Estado Daemons del Clúster Gestionar GPUs Gestionar HugePages Siguientes pasos Esta sección de la documentación de Kubernetes contiene páginas que muestran cómo acometer tareas individuales."><meta name=twitter:description content="Interfaz Web de Usuario (Tablero de Control) Usar la línea de comandos con kubectl Configurar Pods y Contenedores Ejecutar Aplicaciones Ejecutar Jobs Acceder a las Aplicaciones de un Clúster Monitorización, Trazas, y Depuración Acceder a la API de Kubernetes Usar TLS Administrar un Clúster Administrar la Federación Gestionar Aplicaciones con Estado Daemons del Clúster Gestionar GPUs Gestionar HugePages Siguientes pasos Esta sección de la documentación de Kubernetes contiene páginas que muestran cómo acometer tareas individuales."><meta property="og:url" content="https://kubernetes.io/es/docs/tasks/"><meta property="og:title" content="Tareas"><meta name=twitter:title content="Tareas"><meta name=twitter:image content="https://kubernetes.io/images/favicon.png"><meta name=twitter:image:alt content="Kubernetes"><meta property="og:image" content="/images/kubernetes-horizontal-color.png"><meta property="og:type" content="article"><script src=/js/jquery-3.6.0.min.js intregrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary><a class=navbar-brand href=/es/></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-2 mb-lg-0"><a class="nav-link active" href=/es/docs/>Documentación</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/es/blog/>Kubernetes Blog</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/es/partners/>Partners</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/es/community/>Comunidad</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/es/case-studies/>Casos de éxito</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Versions</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/es/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/es/docs/tasks/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/es/docs/tasks/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/es/docs/tasks/>v1.23</a>
<a class=dropdown-item href=https://v1-22.docs.kubernetes.io/es/docs/tasks/>v1.22</a>
<a class=dropdown-item href=https://v1-21.docs.kubernetes.io/es/docs/tasks/>v1.21</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Español (Spanish)</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/tasks/>English</a>
<a class=dropdown-item href=/zh-cn/docs/tasks/>中文 (Chinese)</a>
<a class=dropdown-item href=/ko/docs/tasks/>한국어 (Korean)</a>
<a class=dropdown-item href=/ja/docs/tasks/>日本語 (Japanese)</a>
<a class=dropdown-item href=/fr/docs/tasks/>Français (French)</a>
<a class=dropdown-item href=/de/docs/tasks/>Deutsch (German)</a>
<a class=dropdown-item href=/pt-br/docs/tasks/>Português (Portuguese)</a>
<a class=dropdown-item href=/id/docs/tasks/>Bahasa Indonesia</a>
<a class=dropdown-item href=/hi/docs/tasks/>हिन्दी (Hindi)</a>
<a class=dropdown-item href=/pl/docs/tasks/>Polski (Polish)</a></div></li></ul></div><button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Versión imprimible multipagina.
<a href=# onclick="return print(),!1">Haga click aquí para imprimir</a>.</p><p><a href=/es/docs/tasks/>Volver a la vista normal de esta página</a>.</p></div><h1 class=title>Tareas</h1><ul><li>1: <a href=#pg-57bf66f59d9a642b82eebeabbc66470b>Instalar herramientas</a></li><ul><li>1.1: <a href=#pg-91639f08dfa86a6c88cf0099b2e097bc>Herramientas incluidas</a></li><ul><li>1.1.1: <a href=#pg-aac577e320fac99366fff58005af9613>Instalar y configurar kubectl en Linux</a></li><li>1.1.2: <a href=#pg-3e6792854213ad0b88b1c4de931083c4>Instalar y configurar kubectl en macOS</a></li><li>1.1.3: <a href=#pg-cd2c34dd12233e51112c9c67e5a9b1bd>Instalar y configurar kubectl en Windows</a></li><li>1.1.4: <a href=#pg-99d563e9521796074ba3ca7f15a613ce>¿Que sigue?</a></li><li>1.1.5: <a href=#pg-2d600cc8ec4dec69673b5f9577b6da22>Autocompletar bash en Linux</a></li><li>1.1.6: <a href=#pg-68808b3ec5807517ed64fd8ae32a7d1b>Autocompletar bash en macOS</a></li><li>1.1.7: <a href=#pg-9ab27577326839cb4793fd670a916364>Autocompletar zsh</a></li><li>1.1.8: <a href=#pg-d4ebbbe0a2ddce15850a36dfede9ba52>Descripción general de kubectl-convert</a></li><li>1.1.9: <a href=#pg-b2d43b2ae3e8f26eefa83de2db4ba782>verificar la instalación de kubectl</a></li></ul></ul><li>2: <a href=#pg-34a810f1516ad9d99b2697e36e9b0d0f>Administrar un clúster</a></li><ul><li>2.1: <a href=#pg-8e16d69617b175d61e2e7a6e1642c9d6>Administrar un clúster con kubeadm</a></li><ul></ul><li>2.2: <a href=#pg-47be5dd51f686017f1766e6ec7aa6f41>Administrar recursos de memoria, CPU y API</a></li><ul></ul><li>2.3: <a href=#pg-8c31aafd38fad5b0de0bd191758d6f93>Instalar un proveedor de políticas de red</a></li><ul></ul></ul><li>3: <a href=#pg-f5da33b976758a9183018c421eb83f58>Configurar pods y contenedores</a></li><ul><li>3.1: <a href=#pg-484833fb880d1e179cc2965d15f84da5>Configura un Pod para Usar un Volume como Almacenamiento</a></li></ul><li>4: <a href=#pg-aa0731e8aa8e2f6cc9e3c1a5e9895863>Administrar Objetos en Kubernetes</a></li><ul><li>4.1: <a href=#pg-df206392be6f4d19bd8da41cee7170fa>Administración declarativa de Objetos en Kubernetes usando archivos de Configuración</a></li></ul><li>5: <a href=#pg-866924fa095f897ede8dfdcab9e97942>Inyectar datos en las aplicaciones</a></li><ul></ul><li>6: <a href=#pg-a78a5e7e765fd8c49c8f7c0d72499f72>Gestionar y ejecutar aplicaciones</a></li><ul><li>6.1: <a href=#pg-790ea02857492b3a822e981e93e3a98b>Corre una aplicación stateless usando un Deployment</a></li><li>6.2: <a href=#pg-fbe2744f00d1aa4df4cdf4eea6a082d4>Especificando un presupuesto de disrupción para tu aplicación</a></li></ul><li>7: <a href=#pg-ba58efa15c6d46f10e34d799be220965>Gestionar y ejecutar daemons</a></li><ul></ul><li>8: <a href=#pg-ca3bc4e31dfe46d5044a3b93eb804ee9>Gestionar y ejecutar trabajos</a></li><ul></ul><li>9: <a href=#pg-b74b959f5a531003dd0653dfbfc2e88b>Acceder al clúster y las aplicaciones</a></li><ul></ul><li>10: <a href=#pg-f6a755efe831d24956501e4bcd49ff96>Monitorización, Logs y Debugging</a></li><ul><li>10.1: <a href=#pg-cbd33a50cc4779f855318a0dd00d7b06>Auditoría</a></li><li>10.2: <a href=#pg-06bb252f25983de12f635c806d180d30>Depurar Contenedores de Inicialización</a></li><li>10.3: <a href=#pg-c66e72f8378fe1ded545373488749822>Escribiendo Logs con Elasticsearch y Kibana</a></li><li>10.4: <a href=#pg-96b25d30e732385047272b84d3c4188f>Pipeline de métricas de recursos</a></li></ul><li>11: <a href=#pg-fd78dc15c135dedc24438431769d4d5b>Extender la API de Kubernetes</a></li><ul><li>11.1: <a href=#pg-5b9d7df11699e8cb1a5a4414ff770efe>Usar recursos personalizados</a></li><ul></ul></ul><li>12: <a href=#pg-d3c88a8663f58e9ec0bed73faff5b670>Gestionar certificados TLS</a></li><ul></ul><li>13: <a href=#pg-40e9293a348cfa50147082afc09ff77f>Federación</a></li><ul><li>13.1: <a href=#pg-b61e5206fb2a30cabe2857ed4aaf7944>Administrar la federación de clústeres</a></li><ul></ul></ul><li>14: <a href=#pg-5266308e17490aeee8b018316bf47e03>Catálogo de servicios</a></li><ul></ul></ul><div class=content><nav id=TableOfContents><ul><li><a href=#interfaz-web-de-usuario-tablero-de-control>Interfaz Web de Usuario (Tablero de Control)</a></li><li><a href=#usar-la-línea-de-comandos-con-kubectl>Usar la línea de comandos con kubectl</a></li><li><a href=#configurar-pods-y-contenedores>Configurar Pods y Contenedores</a></li><li><a href=#ejecutar-aplicaciones>Ejecutar Aplicaciones</a></li><li><a href=#ejecutar-jobs>Ejecutar Jobs</a></li><li><a href=#acceder-a-las-aplicaciones-de-un-clúster>Acceder a las Aplicaciones de un Clúster</a></li><li><a href=#monitorización-trazas-y-depuración>Monitorización, Trazas, y Depuración</a></li><li><a href=#acceder-a-la-api-de-kubernetes>Acceder a la API de Kubernetes</a></li><li><a href=#usar-tls>Usar TLS</a></li><li><a href=#administrar-un-clúster>Administrar un Clúster</a></li><li><a href=#administrar-la-federación>Administrar la Federación</a></li><li><a href=#gestionar-aplicaciones-con-estado>Gestionar Aplicaciones con Estado</a></li><li><a href=#daemons-del-clúster>Daemons del Clúster</a></li><li><a href=#gestionar-gpus>Gestionar GPUs</a></li><li><a href=#gestionar-hugepages>Gestionar HugePages</a></li><li><a href=#siguientes-pasos>Siguientes pasos</a></li></ul></nav><p>Esta sección de la documentación de Kubernetes contiene páginas que
muestran cómo acometer tareas individuales. Cada página de tarea muestra cómo
realizar una única cosa, típicamente proporcionando una pequeña secuencia de comandos.</p><h2 id=interfaz-web-de-usuario-tablero-de-control>Interfaz Web de Usuario (Tablero de Control)</h2><p>Despliega y accede al interfaz web de usuario del Tablero de Control para ayudarte en la gestión y monitorización de las aplicaciones en contenedores de tu clúster de Kubenertes.</p><h2 id=usar-la-línea-de-comandos-con-kubectl>Usar la línea de comandos con kubectl</h2><p>Instala y configura la herramienta de línea de comandos <code>kubectl</code> para gestionar de forma directa tus clústers de Kubernetes.</p><h2 id=configurar-pods-y-contenedores>Configurar Pods y Contenedores</h2><p>Realiza tareas comunes de configuración para tus Pods y Contenedores.</p><h2 id=ejecutar-aplicaciones>Ejecutar Aplicaciones</h2><p>Realiza tareas comunes de gestión de aplicaciones, como actualizaciones de lanzamiento, inyectar información en los pods, y auto-escalado horizontal de pods.</p><h2 id=ejecutar-jobs>Ejecutar Jobs</h2><p>Ejecuta Jobs usando procesado paralelo.</p><h2 id=acceder-a-las-aplicaciones-de-un-clúster>Acceder a las Aplicaciones de un Clúster</h2><p>Configura el balanceo de carga, re-envío de puertos, o configura el cortafuegos o las configuraciones de DNS para acceder a las aplicaciones en un clúster.</p><h2 id=monitorización-trazas-y-depuración>Monitorización, Trazas, y Depuración</h2><p>Configura la monitorización y las trazas para identificar problemas en un clúster o depurar una aplicación en un contenedor.</p><h2 id=acceder-a-la-api-de-kubernetes>Acceder a la API de Kubernetes</h2><p>Aprende varios métodos para acceder directamente a la API de Kubernetes.</p><h2 id=usar-tls>Usar TLS</h2><p>Configura tu aplicación para que confíe y use el Certificado de Autoridad (CA) raíz de tu clúster.</p><h2 id=administrar-un-clúster>Administrar un Clúster</h2><p>Aprende tareas comunes de administración de un clúster.</p><h2 id=administrar-la-federación>Administrar la Federación</h2><p>Configura componentes en una federación de clústers.</p><h2 id=gestionar-aplicaciones-con-estado>Gestionar Aplicaciones con Estado</h2><p>Realiza tareas comunes de gestión de aplicaciones con estado, incluyendo escalado, borrado y depuración de StatefulSets.</p><h2 id=daemons-del-clúster>Daemons del Clúster</h2><p>Realiza tareas comunes de gestión de un DaemonSet, como llevar a cabo una actualización de lanzamiento.</p><h2 id=gestionar-gpus>Gestionar GPUs</h2><p>Configura y planifica GPUs de NVIDIA para hacerlas disponibles como recursos a los nodos de un clúster.</p><h2 id=gestionar-hugepages>Gestionar HugePages</h2><p>Configura y planifica HugePages como un recurso planificado en un clúster.</p><h2 id=siguientes-pasos>Siguientes pasos</h2><p>Si quisieras escribir una página de Tareas, echa un vistazo a
<a href=/docs/home/contribute/create-pull-request/>Crear una Petición de Subida de Documentación</a>.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-57bf66f59d9a642b82eebeabbc66470b>1 - Instalar herramientas</h1><div class=lead>Configurar las herramientas de Kubernetes en su computadora.</div><h2 id=kubectl>kubectl</h2><p>Usa la herramienta de línea de comandos de Kubernetes, <a href=/docs/user-guide/kubectl/>kubectl</a>, para desplegar y gestionar aplicaciones en Kubernetes. Usando kubectl, puedes inspeccionar recursos del clúster; crear, eliminar, y actualizar componentes; explorar tu nuevo clúster y arrancar aplicaciones.</p><p>Ver <a href=/docs/tasks/tools/install-kubectl/>Instalar y Configurar <code>kubectl</code></a> para más información sobre cómo descargar y instalar <code>kubectl</code> y configurarlo para acceder su clúster.</p><p><a class="btn btn-primary" href=/docs/tasks/tools/install-kubectl/ role=button aria-label="Ver la guía de instalación y configuración de kubectl">Ver la guía de instalación y configuración de kubectl</a></p><p>También se puede leer <a href=/docs/reference/kubectl>la documentación de referencia</a> de <code>kubectl</code>.</p><h2 id=kind>kind</h2><p><a href=https://kind.sigs.k8s.io/docs/><code>kind</code></a> le permite usar Kubernetes en su máquina local. Esta herramienta require que <a href=https://docs.docker.com/get-docker/>Docker</a> instalado y configurado.</p><p>En la página de <a href=https://kind.sigs.k8s.io/docs/user/quick-start/>inicio rápido</a> encontrarás toda la información necesaria para empezar con kind.</p><p><a class="btn btn-primary" href=https://kind.sigs.k8s.io/docs/user/quick-start/ role=button aria-label="Ver la guía de inicio rápido">Ver la guía de inicio rápido</a></p><h2 id=minikube>minikube</h2><p>De forma similar a <code>kind</code>, <a href=https://minikube.sigs.k8s.io/><code>minikube</code></a> es una herramienta que le permite usar Kubernetes en su máquina local. <code>minikube</code> le permite ejecutar un único nodo en su computadora personal (PC de Windows, macOS y Linux) para que se pueda probar Kubernetes, o para su trabajo de desarrollo.</p><p>Se puede seguir la guía oficial de <a href=https://minikube.sigs.k8s.io/docs/start/><code>minikube</code></a> si su enfoque esta instalando la herramienta.</p><p><a class="btn btn-primary" href=https://minikube.sigs.k8s.io/docs/start/ role=button aria-label="Ver la guía de minikube">Ver la guía de minikube</a></p><p>Una vez <code>minikube</code> ha terminado de instalarse, está lista para desplegar un aplicación de ejemplo (/docs/tutorials/hello-minikube/).</p><h2 id=kubeadm>kubeadm</h2><p>Se puede usar la utilidad <a class=glossary-tooltip title='Utilidad para instalar Kubernetes con rapidez y configurar un clúster seguro.' data-toggle=tooltip data-placement=top href=/docs/admin/kubeadm/ target=_blank aria-label=kubeadm>kubeadm</a> para crear y gestionar clústeres de Kubernetes.</p><p>En <a href=/docs/setup/production-environment/tools/kubeadm/install-kubeadm/>instalando kubeadm</a> se muestra como instalar kubeadm. Una vez instalado, se puede utilizar <a href=/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/>para crear un clúster</a>.</p><p><a class="btn btn-primary" href=/docs/setup/production-environment/tools/kubeadm/install-kubeadm/ role=button aria-label="Ver la guía de instalación">Ver la guía de instalación</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-91639f08dfa86a6c88cf0099b2e097bc>1.1 - Herramientas incluidas</h1><div class=lead>Fragmentos que se incluirán en las páginas principales de kubectl-installs-*.</div></div><div class=td-content><h1 id=pg-aac577e320fac99366fff58005af9613>1.1.1 - Instalar y configurar kubectl en Linux</h1><h2 id=antes-de-empezar>Antes de empezar</h2><p>Debes usar una versión de kubectl que esté dentro de una diferencia de versión menor de tu clúster. Por ejemplo, un cliente v1.25 puede comunicarse con v1.24, v1.25, y v1.26 del plano de control.
El uso de la última versión de kubectl ayuda a evitar problemas inesperados.</p><h2 id=instalar-kubectl-en-linux>Instalar kubectl en Linux</h2><p>Existen los siguientes métodos para instalar kubectl en Linux:</p><ul><li><a href=#install-kubectl-binary-with-curl-on-linux>Instalar el binario kubectl con curl en Linux</a></li><li><a href=#install-using-native-package-management>Instalar usando la administración nativa de paquetes</a></li><li><a href=#install-using-other-package-management>Instalar usando otra administración de paquetes</a></li></ul><h3 id=instale-el-binario-kubectl-con-curl-en-linux>Instale el binario kubectl con curl en Linux</h3><ol><li><p>Descargue la última versión con el comando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/linux/amd64/kubectl&#34;</span>
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong><p>Para descargar una versión específica, reemplace la parte de <code>$(curl -L -s https://dl.k8s.io/release/stable.txt)</code> del comando con la versión específica.</p><p>Por ejemplo, para descargar la versión v1.25.0 en Linux, escriba:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://dl.k8s.io/release/v1.25.0/bin/linux/amd64/kubectl
</span></span></code></pre></div></div></li><li><p>Validar el binario (opcional)</p><p>Descargue el archivo de comprobación de kubectl:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/linux/amd64/kubectl.sha256&#34;</span>
</span></span></code></pre></div><p>Valide el binario kubectl con el archivo de comprobación:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;</span><span style=color:#a2f;font-weight:700>$(</span>cat kubectl.sha256<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>  kubectl&#34;</span> | sha256sum --check
</span></span></code></pre></div><p>Si es válido, la salida es:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#888>kubectl: OK
</span></span></span></code></pre></div><p>Si la comprobación falla, <code>sha256</code> arroja un valor distinto de cero e imprime una salida similar a:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl: FAILED
</span></span><span style=display:flex><span>sha256sum: WARNING: <span style=color:#666>1</span> computed checksum did NOT match
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Descargue la misma versión del binario y el archivo de comprobación.</div></li><li><p>Instalar kubectl</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo install -o root -g root -m <span style=color:#666>0755</span> kubectl /usr/local/bin/kubectl
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong><p>Si no tiene acceso de root en el sistema de destino, aún puede instalar kubectl en el <code>~/.local/bin</code> directorio:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x kubectl
</span></span><span style=display:flex><span>mkdir -p ~/.local/bin/kubectl
</span></span><span style=display:flex><span>mv ./kubectl ~/.local/bin/kubectl
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># y luego agregue ~/.local/bin/kubectl en el $PATH</span>
</span></span></code></pre></div></div></li><li><p>Para asegurarse de que la versión que instaló este actualizada ejecute:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></li></ol><h3 id=instalar-usando-la-administración-nativa-de-paquetes>Instalar usando la administración nativa de paquetes</h3><ul class="nav nav-tabs" id=kubectl-install role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#kubectl-install-0 role=tab aria-controls=kubectl-install-0 aria-selected=true>Debian-based distributions</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#kubectl-install-1 role=tab aria-controls=kubectl-install-1>Red Hat-based distributions</a></li></ul><div class=tab-content id=kubectl-install><div id=kubectl-install-0 class="tab-pane show active" role=tabpanel aria-labelledby=kubectl-install-0><p><ol><li><p>Actualice el índice de paquetes de <code>apt</code> e instale los paquetes necesarios para usar Kubernetes con el repositorio <code>apt</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install -y apt-transport-https ca-certificates curl
</span></span></code></pre></div></li><li><p>Descargue la clave de firma pública de Google Cloud:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
</span></span></code></pre></div></li><li><p>Agregue el repositorio de Kubernetes a <code>apt</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&#34;</span> | sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span></code></pre></div></li><li><p>Actualice el índice de paquetes de <code>apt</code> con el nuevo repositorio e instale kubectl:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install -y kubectl
</span></span></code></pre></div></li></ol></div><div id=kubectl-install-1 class=tab-pane role=tabpanel aria-labelledby=kubectl-install-1><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span style=display:flex><span><span style=color:#b44>[kubernetes]
</span></span></span><span style=display:flex><span><span style=color:#b44>name=Kubernetes
</span></span></span><span style=display:flex><span><span style=color:#b44>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
</span></span></span><span style=display:flex><span><span style=color:#b44>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#b44>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#b44>repo_gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#b44>gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>yum install -y kubectl
</span></span></code></pre></div></div></div><h3 id=instalar-usando-otra-administración-de-paquetes>Instalar usando otra administración de paquetes</h3><ul class="nav nav-tabs" id=other-kubectl-install role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#other-kubectl-install-0 role=tab aria-controls=other-kubectl-install-0 aria-selected=true>Snap</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#other-kubectl-install-1 role=tab aria-controls=other-kubectl-install-1>Homebrew</a></li></ul><div class=tab-content id=other-kubectl-install><div id=other-kubectl-install-0 class="tab-pane show active" role=tabpanel aria-labelledby=other-kubectl-install-0><p><p>Si está en Ubuntu u otra distribución de Linux que admita el administrador de paquetes <a href=https://snapcraft.io/docs/core/install>snap</a>, kubectl estará disponible como solicitud de <a href=https://snapcraft.io/>snap</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>snap install kubectl --classic
</span></span><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></div><div id=other-kubectl-install-1 class=tab-pane role=tabpanel aria-labelledby=other-kubectl-install-1><p><p>Si está en Linux y usa <a href=https://docs.brew.sh/Homebrew-on-Linux>Homebrew</a> como administrador de paquetes, kubectl está disponible para <a href=https://docs.brew.sh/Homebrew-on-Linux#install>instalación</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>brew install kubectl
</span></span><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></div></div><h2 id=verificar-la-configuración-de-kubectl>Verificar la configuración de kubectl</h2><p>Para que kubectl encuentre y acceda a un clúster de Kubernetes, necesita un
<a href=/docs/concepts/configuration/organize-cluster-access-kubeconfig/>archivo kubeconfig</a>, que se crea automáticamente cuando creas un clúster usando
<a href=https://github.com/kubernetes/kubernetes/blob/master/cluster/kube-up.sh>kube-up.sh</a>
o implementar con éxito un clúster de Minikube.
De forma predeterminada, la configuración de kubectl se encuentra en <code>~/.kube/config</code>.</p><p>Verifique que kubectl esté configurado correctamente obteniendo el estado del clúster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info
</span></span></code></pre></div><p>Si ve una respuesta de URL, kubectl está configurado correctamente para acceder a su clúster.</p><p>Si ve un mensaje similar al siguiente, kubectl no está configurado correctamente o no puede conectarse a un clúster de Kubernetes.</p><pre tabindex=0><code>The connection to the server &lt;server-name:port&gt; was refused - did you specify the right host or port?
</code></pre><p>Por ejemplo, si tiene la intención de ejecutar un clúster de Kubernetes en su computadora portátil (localmente), primero necesitará instalar una herramienta como Minikube y luego volver a ejecutar los comandos indicados anteriormente.</p><p>Si kubectl cluster-info devuelve la respuesta de la URL pero no puede acceder a su clúster, para verificar si está configurado correctamente, use:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info dump
</span></span></code></pre></div><h2 id=plugins-y-configuraciones-opcionales-de-kubectl>Plugins y configuraciones opcionales de kubectl</h2><h3 id=habilitar-el-autocompletado-de-shell>Habilitar el autocompletado de shell</h3><p>kubectl proporciona soporte de autocompletado para Bash y Zsh, lo que puede ahorrarle mucho tiempo al interactuar con la herramienta.</p><p>A continuación, se muestran los procedimientos para configurar el autocompletado para Bash y Zsh.</p><ul class="nav nav-tabs" id=kubectl-autocompletion role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#kubectl-autocompletion-0 role=tab aria-controls=kubectl-autocompletion-0 aria-selected=true>Bash</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#kubectl-autocompletion-1 role=tab aria-controls=kubectl-autocompletion-1>Zsh</a></li></ul><div class=tab-content id=kubectl-autocompletion><div id=kubectl-autocompletion-0 class="tab-pane show active" role=tabpanel aria-labelledby=kubectl-autocompletion-0><p><h3 id=introducción>Introducción</h3><p>El script de completado de kubectl para Bash se puede generar con el comando <code>kubectl completion bash</code>. Obtener el script de completado en su shell habilita el autocompletado de kubectl.</p><p>Sin embargo, el script de completado depende de <a href=https://github.com/scop/bash-completion><strong>bash-completion</strong></a>, lo que significa que primero debe instalar este software (puedes probar si tienes bash-completion ya instalado ejecutando <code>type _init_completion</code>).</p><h3 id=instalar-bash-complete>Instalar bash-complete</h3><p>El completado de bash es proporcionado por muchos administradores de paquetes (ver <a href=https://github.com/scop/bash-completion#installation>aquí</a>). Puedes instalarlo con <code>apt-get install bash-completion</code> o <code>yum install bash-completion</code>, etc.</p><p>Los comandos anteriores crean <code>/usr/share/bash-completion/bash_completion</code>, que es el script principal de bash-complete. Dependiendo de su administrador de paquetes, debe obtener manualmente este archivo de perfil en su <code>~/.bashrc</code>.</p><p>Para averiguarlo, recargue su shell y ejecute <code>type _init_completion</code>. Si el comando tiene éxito, ya está configurado; de lo contrario, agregue lo siguiente a su archivo <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>source</span> /usr/share/bash-completion/bash_completion
</span></span></code></pre></div><p>Vuelva a cargar su shell y verifique que la finalización de bash esté correctamente instalada escribiendo <code>type _init_completion</code>.</p><h3 id=habilitar-el-autocompletado-de-kubectl>Habilitar el autocompletado de kubectl</h3><p>Ahora debe asegurarse de que el script de completado de kubectl se obtenga en todas sus sesiones de shell. Hay dos formas de hacer esto:</p><ul><li><p>Obtenga el script de completado en su perfil <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;source &lt;(kubectl completion bash)&#39;</span> &gt;&gt;~/.bashrc
</span></span></code></pre></div></li><li><p>Agregue el script de completado al directorio de <code>/etc/bash_completion.d</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl completion bash &gt;/etc/bash_completion.d/kubectl
</span></span></code></pre></div></li></ul><p>Si tiene un alias para kubectl, puede extender el completado del shell para trabajar con ese alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.bashrc
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;complete -o default -F __start_kubectl k&#39;</span> &gt;&gt;~/.bashrc
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> El código fuente de bash-complete todos los scripts se encuentra en <code>/etc/bash_completion.d</code>.</div><p>Ambos enfoques son equivalentes. Después de recargar su shell, el autocompletado de kubectl debería estar funcionando.</p></div><div id=kubectl-autocompletion-1 class=tab-pane role=tabpanel aria-labelledby=kubectl-autocompletion-1><p><p>El script de completado de kubectl para Zsh se puede generar con el comando <code>kubectl completion zsh</code>. Obtener el script de completado en su shell habilita el autocompletado de kubectl.</p><p>Para hacerlo en todas sus sesiones de shell, agregue lo siguiente a su perfil <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#a2f>source</span> &lt;<span style=color:#666>(</span>kubectl completion zsh<span style=color:#666>)</span>
</span></span></code></pre></div><p>Si tiene un alias para kubectl, puede extender el completado del shell para trabajar con ese alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.zshrc
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;compdef __start_kubectl k&#39;</span> &gt;&gt;~/.zshrc
</span></span></code></pre></div><p>Después de recargar su shell, el autocompletado de kubectl debería estar funcionando.</p><p>Si recibe un error como <code>complete:13: command not found: compdef</code>,
luego agregue lo siguiente al comienzo de su perfil <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>autoload -Uz compinit
</span></span><span style=display:flex><span>compinit
</span></span></code></pre></div></div></div><h3 id=instalar-en-pc-kubectl-convert-plugin>Instalar en pc <code>kubectl convert</code> plugin</h3><p>Un plugin para la herramienta de línea de comandos de Kubernetes <code>kubectl</code>, que le permite convertir manifiestos entre diferentes versiones de la API. Esto puede ser particularmente útil para migrar manifiestos a una versión no obsoleta de la API con la versión más reciente de Kubernetes.
Para obtener más información, visite <a href=/docs/reference/using-api/deprecation-guide/#migrate-to-non-deprecated-apis>migrar a APIs no obsoletas</a></p><ol><li><p>Descargue la última versión con el comando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/linux/amd64/kubectl-convert&#34;</span>
</span></span></code></pre></div></li><li><p>Valide el binario (opcional)</p><p>Descargue el archivo de comprobación kubectl-convert:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/linux/amd64/kubectl-convert.sha256&#34;</span>
</span></span></code></pre></div><p>Valide el binario kubectl-convert con el archivo de comprobación:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;</span><span style=color:#a2f;font-weight:700>$(</span>cat kubectl-convert.sha256<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44> kubectl-convert&#34;</span> | sha256sum --check
</span></span></code></pre></div><p>Si es válido, la salida es:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#888>kubectl-convert: OK
</span></span></span></code></pre></div><p>Si la comprobación falla, <code>sha256</code> arroja un valor distinto de cero e imprime una salida similar a:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl-convert: FAILED
</span></span><span style=display:flex><span>sha256sum: WARNING: <span style=color:#666>1</span> computed checksum did NOT match
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Descargue la misma versión del binario y el archivo de comprobación.</div></li><li><p>Instale kubectl-convert en pc</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo install -o root -g root -m <span style=color:#666>0755</span> kubectl-convert /usr/local/bin/kubectl-convert
</span></span></code></pre></div></li><li><p>Verifique que el plugin se haya instalado correctamente</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl convert --help
</span></span></code></pre></div><p>Si no ve un error, significa que el plugin se instaló correctamente.</p></li></ol><h2 id=siguientes-pasos>Siguientes pasos</h2><ul><li><a href=https://minikube.sigs.k8s.io/docs/start/>Instalar Minikube</a></li><li>Consulte las <a href=/docs/setup/>guías de introducción</a> para obtener más información sobre la creación de clústeres.</li><li><a href=/docs/tasks/access-application-cluster/service-access-application-cluster/>Aprenda a iniciar y exponer su aplicación.</a></li><li>Si necesita acceso a un clúster que no creó, consulte la guia de
<a href=/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>Compartir el acceso al clúster</a>.</li><li>Lea los <a href=/docs/reference/kubectl/kubectl/>documentos de referencia de kubectl</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3e6792854213ad0b88b1c4de931083c4>1.1.2 - Instalar y configurar kubectl en macOS</h1><h2 id=antes-de-empezar>Antes de empezar</h2><p>Debes usar una versión de kubectl que esté dentro de una diferencia de versión menor de tu clúster. Por ejemplo, un cliente v1.25 puede comunicarse con v1.24, v1.25, y v1.26 del plano de control.
El uso de la última versión de kubectl ayuda a evitar problemas imprevistos.</p><h2 id=instalar-kubectl-en-macos>Instalar kubectl en macOS</h2><p>Existen los siguientes métodos para instalar kubectl en macOS:</p><ul><li><a href=#install-kubectl-binary-with-curl-on-macos>Instalar el binario de kubectl con curl en macOS</a></li><li><a href=#install-with-homebrew-on-macos>Instalar con Homebrew en macOS</a></li><li><a href=#install-with-macports-on-macos>Instalar con Macports en macOS</a></li></ul><h3 id=instalar-el-binario-de-kubectl-con-curl-en-macos>Instalar el binario de kubectl con curl en macOS</h3><ol><li><p>Descargue la última versión:</p><ul class="nav nav-tabs" id=download-binary-macos role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#download-binary-macos-0 role=tab aria-controls=download-binary-macos-0 aria-selected=true>Intel</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#download-binary-macos-1 role=tab aria-controls=download-binary-macos-1>Apple Silicon</a></li></ul><div class=tab-content id=download-binary-macos><div id=download-binary-macos-0 class="tab-pane show active" role=tabpanel aria-labelledby=download-binary-macos-0><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>   curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/darwin/amd64/kubectl&#34;</span>
</span></span><span style=display:flex><span>   </span></span></code></pre></div></div><div id=download-binary-macos-1 class=tab-pane role=tabpanel aria-labelledby=download-binary-macos-1><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>   curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/darwin/arm64/kubectl&#34;</span>
</span></span><span style=display:flex><span>   </span></span></code></pre></div></div></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong><p>Para descargar una versión específica, reemplace el <code>$(curl -L -s https://dl.k8s.io/release/stable.txt)</code> parte del comando con la versión específica.</p><p>Por ejemplo, para descargar la versión v1.25.0 en Intel macOS, escriba:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/v1.25.0/bin/darwin/amd64/kubectl&#34;</span>
</span></span></code></pre></div><p>Y para macOS en Apple Silicon, escriba:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/v1.25.0/bin/darwin/arm64/kubectl&#34;</span>
</span></span></code></pre></div></div></li><li><p>Validar el binario (opcional)</p><p>Descargue el archivo de comprobación de kubectl:</p><ul class="nav nav-tabs" id=download-checksum-macos role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#download-checksum-macos-0 role=tab aria-controls=download-checksum-macos-0 aria-selected=true>Intel</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#download-checksum-macos-1 role=tab aria-controls=download-checksum-macos-1>Apple Silicon</a></li></ul><div class=tab-content id=download-checksum-macos><div id=download-checksum-macos-0 class="tab-pane show active" role=tabpanel aria-labelledby=download-checksum-macos-0><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>   curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/darwin/amd64/kubectl.sha256&#34;</span>
</span></span><span style=display:flex><span>   </span></span></code></pre></div></div><div id=download-checksum-macos-1 class=tab-pane role=tabpanel aria-labelledby=download-checksum-macos-1><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>   curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/darwin/arm64/kubectl.sha256&#34;</span>
</span></span><span style=display:flex><span>   </span></span></code></pre></div></div></div><p>Valide el binario kubectl con el archivo de comprobación:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;</span><span style=color:#a2f;font-weight:700>$(</span>&lt;kubectl.sha256<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>  kubectl&#34;</span> | shasum -a <span style=color:#666>256</span> --check
</span></span></code></pre></div><p>Si es válido, la salida es:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#888>kubectl: OK
</span></span></span></code></pre></div><p>Si la verificación falla, <code>shasum</code> arroja un valor distinto de cero e imprime una salida similar a:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl: FAILED
</span></span><span style=display:flex><span>shasum: WARNING: <span style=color:#666>1</span> computed checksum did NOT match
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Descargue la misma versión del binario y el archivo de comprobación.</div></li><li><p>Hacer ejecutable el binario de kubectl.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x ./kubectl
</span></span></code></pre></div></li><li><p>Mueva el binario kubectl a una ubicación de archivo en su sistema <code>PATH</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mv ./kubectl /usr/local/bin/kubectl
</span></span><span style=display:flex><span>sudo chown root: /usr/local/bin/kubectl
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Asegúrese de que <code>/usr/local/bin</code> se encuentre definida en su variable de entorno PATH.</div></li><li><p>Para asegurarse de que la versión que instaló se encuentra actualizada, ejecute:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></li></ol><h3 id=instalar-con-homebrew-en-macos>Instalar con Homebrew en macOS</h3><p>Si está en macOS y usa <a href=https://brew.sh/>Homebrew</a> como administrador de paquetes, puede instalar kubectl con Homebrew.</p><ol><li><p>Ejecute el comando de instalación:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install kubectl 
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install kubernetes-cli
</span></span></code></pre></div></li><li><p>Para asegurarse de que la versión que instaló se encuentra actualizada, ejecute:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></li></ol><h3 id=instalar-con-macports-en-macos>Instalar con Macports en macOS</h3><p>Si está en macOS y usa <a href=https://macports.org/>Macports</a> como administrador de paquetes, puede instalar kubectl con Macports.</p><ol><li><p>Ejecute el comando de instalación:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo port selfupdate
</span></span><span style=display:flex><span>sudo port install kubectl
</span></span></code></pre></div></li><li><p>Para asegurarse de que la versión que instaló se encuentra actualizada, ejecute:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></li></ol><h2 id=verificar-la-configuración-de-kubectl>Verificar la configuración de kubectl</h2><p>Para que kubectl encuentre y acceda a un clúster de Kubernetes, necesita un
<a href=/docs/concepts/configuration/organize-cluster-access-kubeconfig/>archivo kubeconfig</a>, que se crea automáticamente cuando creas un clúster usando
<a href=https://github.com/kubernetes/kubernetes/blob/master/cluster/kube-up.sh>kube-up.sh</a>
o implementar con éxito un clúster de Minikube.
De forma predeterminada, la configuración de kubectl se encuentra en <code>~/.kube/config</code>.</p><p>Verifique que kubectl esté configurado correctamente obteniendo el estado del clúster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info
</span></span></code></pre></div><p>Si ve una respuesta de URL, kubectl está configurado correctamente para acceder a su clúster.</p><p>Si ve un mensaje similar al siguiente, kubectl no está configurado correctamente o no puede conectarse a un clúster de Kubernetes.</p><pre tabindex=0><code>The connection to the server &lt;server-name:port&gt; was refused - did you specify the right host or port?
</code></pre><p>Por ejemplo, si tiene la intención de ejecutar un clúster de Kubernetes en su computadora portátil (localmente), primero necesitará instalar una herramienta como Minikube y luego volver a ejecutar los comandos indicados anteriormente.</p><p>Si kubectl cluster-info devuelve la respuesta de la URL pero no puede acceder a su clúster, para verificar si está configurado correctamente, use:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info dump
</span></span></code></pre></div><h2 id=plugins-y-configuraciones-opcionales-de-kubectl>Plugins y configuraciones opcionales de kubectl</h2><h3 id=habilitar-el-autocompletado-de-shell>Habilitar el autocompletado de shell</h3><p>kubectl proporciona soporte de autocompletado para Bash y Zsh, lo que puede ahorrarle mucho tiempo al escribir.</p><p>A continuación, se muestran los procedimientos para configurar el autocompletado para Bash y Zsh.</p><ul class="nav nav-tabs" id=kubectl-autocompletion role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#kubectl-autocompletion-0 role=tab aria-controls=kubectl-autocompletion-0 aria-selected=true>Bash</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#kubectl-autocompletion-1 role=tab aria-controls=kubectl-autocompletion-1>Zsh</a></li></ul><div class=tab-content id=kubectl-autocompletion><div id=kubectl-autocompletion-0 class="tab-pane show active" role=tabpanel aria-labelledby=kubectl-autocompletion-0><p><h3 id=introducción>Introducción</h3><p>El script de completado de kubectl para Bash se puede generar con <code>kubectl completion bash</code>. Obtener este script en su shell permite el completado de kubectl.</p><p>Sin embargo, el script de finalización de kubectl depende de <a href=https://github.com/scop/bash-completion><strong>bash-completion</strong></a> que, por lo tanto, debe instalar previamente.</p><div class="alert alert-danger warning callout" role=alert><strong>Advertencia:</strong> Hay dos versiones de bash-complete, v1 y v2. V1 es para Bash 3.2 (
que es el predeterminado en macOS), y v2 es para Bash 4.1+. El script de completado de kubectl <strong>no funciona</strong> correctamente con bash-complete v1 y Bash 3.2. Requiere <strong>bash-complete v2</strong> y <strong>Bash 4.1+</strong>. Por lo tanto, para poder usar correctamente la finalización de kubectl en macOS, debe instalar y usar Bash 4.1+ (<a href=https://itnext.io/upgrading-bash-on-macos-7138bd1066ba><em>instrucciones</em></a>). Las siguientes instrucciones asumen que usa Bash 4.1+ (es decir, cualquier versión de Bash de 4.1 o posterior).</div><h3 id=actualizar-bash>Actualizar Bash</h3><p>Las siguientes instrucciones asumen que usa Bash 4.1+. Puede verificar la versión de su Bash ejecutando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b8860b>$BASH_VERSION</span>
</span></span></code></pre></div><p>Si es demasiado antiguo, puede instalarlo o actualizarlo usando Homebrew:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install bash
</span></span></code></pre></div><p>Vuelva a cargar su shell y verifique que se esté utilizando la versión deseada:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b8860b>$BASH_VERSION</span> <span style=color:#b8860b>$SHELL</span>
</span></span></code></pre></div><p>Homebrew generalmente lo instala en <code>/usr/local/bin/bash</code>.</p><h3 id=instalar-bash-complete>Instalar bash-complete</h3><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Como se mencionó antes, estas instrucciones asumen que usa Bash 4.1+, lo que significa que instalará bash-completacion v2 (a diferencia de Bash 3.2 y bash-deployment v1, en cuyo caso el completado de kubectl no funcionará).</div><p>Puede probar si ya tiene instalado bash-complete v2 con <code>type _init_completion</code>. Si no es así, puede instalarlo con Homebrew:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install bash-completion@2
</span></span></code></pre></div><p>Como se indica en el resultado de este comando, agregue lo siguiente a su archivo <code>~/.bash_profile</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>BASH_COMPLETION_COMPAT_DIR</span><span style=color:#666>=</span><span style=color:#b44>&#34;/usr/local/etc/bash_completion.d&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>[[</span> -r <span style=color:#b44>&#34;/usr/local/etc/profile.d/bash_completion.sh&#34;</span> <span style=color:#666>]]</span> <span style=color:#666>&amp;&amp;</span> . <span style=color:#b44>&#34;/usr/local/etc/profile.d/bash_completion.sh&#34;</span>
</span></span></code></pre></div><p>Vuelva a cargar su shell y verifique que bash-complete v2 esté instalado correctamente con <code>type _init_completion</code>.</p><h3 id=habilitar-el-autocompletado-de-kubectl>Habilitar el autocompletado de kubectl</h3><p>Ahora debe asegurarse de que el script de completado de kubectl se obtenga en todas sus sesiones de shell. Hay varias formas de lograrlo:</p><ul><li><p>Obtenga el script de finalización en su perfil <code>~/.bash_profile</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;source &lt;(kubectl completion bash)&#39;</span> &gt;&gt;~/.bash_profile
</span></span></code></pre></div></li><li><p>Agregue el script de completado al directorio <code>/usr/local/etc/bash_completion.d</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl completion bash &gt;/usr/local/etc/bash_completion.d/kubectl
</span></span></code></pre></div></li><li><p>Si tiene un alias para kubectl, puede extender el completado del shell para trabajar con ese alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.bash_profile
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;complete -o default -F __start_kubectl k&#39;</span> &gt;&gt;~/.bash_profile
</span></span></code></pre></div></li><li><p>Si instaló kubectl con Homebrew (como se explica <a href=/docs/tasks/tools/install-kubectl-macos/#install-with-homebrew-on-macos>aquí</a>), entonces el script de completado de kubectl ya debería estar en <code>/usr/local/etc/bash_completion.d/kubectl</code>. En ese caso, no necesita hacer nada.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> La instalación de Homebrew de bash-completion v2 genera todos los archivos en el directorio <code>BASH_COMPLETION_COMPAT_DIR</code>, es por eso que los dos últimos métodos funcionan.</div></li></ul><p>En cualquier caso, después de recargar su shell, el completado de kubectl debería estar funcionando.</p></div><div id=kubectl-autocompletion-1 class=tab-pane role=tabpanel aria-labelledby=kubectl-autocompletion-1><p><p>El script de completado de kubectl para Zsh se puede generar con el comando <code>kubectl completion zsh</code>. Obtener el script de completado en su shell habilita el autocompletado de kubectl.</p><p>Para hacerlo en todas sus sesiones de shell, agregue lo siguiente a su perfil <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#a2f>source</span> &lt;<span style=color:#666>(</span>kubectl completion zsh<span style=color:#666>)</span>
</span></span></code></pre></div><p>Si tiene un alias para kubectl, puede extender el completado del shell para trabajar con ese alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.zshrc
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;compdef __start_kubectl k&#39;</span> &gt;&gt;~/.zshrc
</span></span></code></pre></div><p>Después de recargar su shell, el autocompletado de kubectl debería estar funcionando.</p><p>Si recibe un error como <code>complete:13: command not found: compdef</code>,
luego agregue lo siguiente al comienzo de su perfil <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>autoload -Uz compinit
</span></span><span style=display:flex><span>compinit
</span></span></code></pre></div></div></div><h3 id=instalar-el-plugin-kubectl-convert>Instalar el plugin <code>kubectl-convert</code></h3><p>Un plugin para la herramienta de línea de comandos de Kubernetes <code>kubectl</code>, que le permite convertir manifiestos entre diferentes versiones de la API. Esto puede ser particularmente útil para migrar manifiestos a una versión no obsoleta de la API con la versión más reciente de Kubernetes.
Para obtener más información, visite <a href=/docs/reference/using-api/deprecation-guide/#migrate-to-non-deprecated-apis>migrar a APIs no obsoletas</a></p><ol><li><p>Descargue la última versión con el comando:</p><ul class="nav nav-tabs" id=download-convert-binary-macos role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#download-convert-binary-macos-0 role=tab aria-controls=download-convert-binary-macos-0 aria-selected=true>Intel</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#download-convert-binary-macos-1 role=tab aria-controls=download-convert-binary-macos-1>Apple Silicon</a></li></ul><div class=tab-content id=download-convert-binary-macos><div id=download-convert-binary-macos-0 class="tab-pane show active" role=tabpanel aria-labelledby=download-convert-binary-macos-0><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>   curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/darwin/amd64/kubectl-convert&#34;</span>
</span></span><span style=display:flex><span>   </span></span></code></pre></div></div><div id=download-convert-binary-macos-1 class=tab-pane role=tabpanel aria-labelledby=download-convert-binary-macos-1><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>   curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/darwin/arm64/kubectl-convert&#34;</span>
</span></span><span style=display:flex><span>   </span></span></code></pre></div></div></div></li><li><p>Validar el binario (opcional)</p><p>Descargue el archivo de comprobación de kubectl:</p><ul class="nav nav-tabs" id=download-convert-checksum-macos role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#download-convert-checksum-macos-0 role=tab aria-controls=download-convert-checksum-macos-0 aria-selected=true>Intel</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#download-convert-checksum-macos-1 role=tab aria-controls=download-convert-checksum-macos-1>Apple Silicon</a></li></ul><div class=tab-content id=download-convert-checksum-macos><div id=download-convert-checksum-macos-0 class="tab-pane show active" role=tabpanel aria-labelledby=download-convert-checksum-macos-0><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>   curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/darwin/amd64/kubectl-convert.sha256&#34;</span>
</span></span><span style=display:flex><span>   </span></span></code></pre></div></div><div id=download-convert-checksum-macos-1 class=tab-pane role=tabpanel aria-labelledby=download-convert-checksum-macos-1><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>   curl -LO <span style=color:#b44>&#34;https://dl.k8s.io/release/</span><span style=color:#a2f;font-weight:700>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>/bin/darwin/arm64/kubectl-convert.sha256&#34;</span>
</span></span><span style=display:flex><span>   </span></span></code></pre></div></div></div><p>Valide el binario kubectl-convert con el archivo de comprobación:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;</span><span style=color:#a2f;font-weight:700>$(</span>&lt;kubectl-convert.sha256<span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>  kubectl-convert&#34;</span> | shasum -a <span style=color:#666>256</span> --check
</span></span></code></pre></div><p>Si es válido, la salida es:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#888>kubectl-convert: OK
</span></span></span></code></pre></div><p>Si la verificación falla, <code>shasum</code> arroja un valor distinto de cero e imprime una salida similar a:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl-convert: FAILED
</span></span><span style=display:flex><span>shasum: WARNING: <span style=color:#666>1</span> computed checksum did NOT match
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Descargue la misma versión del binario y el archivo de comprobación.</div></li><li><p>Hacer ejecutable el binario de kubectl-convert</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x ./kubectl-convert
</span></span></code></pre></div></li><li><p>Mueva el binario kubectl-convert a una ubicación de archivo en su sistema <code>PATH</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mv ./kubectl-convert /usr/local/bin/kubectl-convert
</span></span><span style=display:flex><span>sudo chown root: /usr/local/bin/kubectl-convert
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Asegúrese de que <code>/usr/local/bin</code> se encuentre definida en su variable de entorno PATH.</div></li><li><p>Verifique que el complemento se haya instalado correctamente</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl convert --help
</span></span></code></pre></div><p>Si no ve algun error, significa que el complemento se instaló correctamente.</p></li></ol><h2 id=siguientes-pasos>Siguientes pasos</h2><ul><li><a href=https://minikube.sigs.k8s.io/docs/start/>Instalar Minikube</a></li><li>Consulte las <a href=/docs/setup/>guías de introducción</a> para obtener más información sobre la creación de clústeres.</li><li><a href=/docs/tasks/access-application-cluster/service-access-application-cluster/>Aprenda a iniciar y exponer su aplicación.</a></li><li>Si necesita acceso a un clúster que no creó, consulte la guia de
<a href=/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>Compartir el acceso al clúster</a>.</li><li>Lea los <a href=/docs/reference/kubectl/kubectl/>documentos de referencia de kubectl</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-cd2c34dd12233e51112c9c67e5a9b1bd>1.1.3 - Instalar y configurar kubectl en Windows</h1><h2 id=antes-de-empezar>Antes de empezar</h2><p>Debes usar una versión de kubectl que este dentro de una diferencia de versión menor de tu clúster. Por ejemplo, un cliente v1.25 puede comunicarse con versiones v1.24, v1.25, y v1.26 del plano de control.</p><p>El uso de la última versión de kubectl ayuda a evitar problemas imprevistos.</p><h2 id=instalar-kubectl-en-windows>Instalar kubectl en Windows</h2><p>Existen los siguientes métodos para instalar kubectl en Windows:</p><ul><li><a href=#install-kubectl-binary-with-curl-on-windows>Instalar el binario de kubectl con curl en Windows</a></li><li><a href=#install-on-windows-using-chocolatey-or-scoop>Instalar en Windows usando Chocolatey o Scoop</a></li></ul><h3 id=instalar-el-binario-de-kubectl-con-curl-en-windows>Instalar el binario de kubectl con curl en Windows</h3><ol><li><p>Descarga la <a href=https://dl.k8s.io/release/v1.25.0/bin/windows/amd64/kubectl.exe>última versión v1.25.0</a>.</p><p>O si tiene <code>curl</code> instalado, use este comando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#a2f>curl </span>-LO https<span>:</span>//dl.k8s.io/release/<span style=color:#a2f>/bin/windows/amd64/kubectl.exe
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Para conocer la última versión estable (por ejemplo, para secuencias de comandos), eche un vistazo a <a href=https://dl.k8s.io/release/stable.txt>https://dl.k8s.io/release/stable.txt</a>.</div></li><li><p>Validar el binario (opcional)</p><p>Descargue el archivo de comprobación de kubectl:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#a2f>curl </span>-LO https<span>:</span>//dl.k8s.io/<span style=color:#a2f>/bin/windows/amd64/kubectl.exe.sha256
</span></span></code></pre></div><p>Valide el binario kubectl con el archivo de comprobación:</p><ul><li><p>Usando la consola del sistema para comparar manualmente la salida de <code>CertUtil</code> con el archivo de comprobación descargado:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd><span style=display:flex><span>CertUtil -hashfile kubectl.exe SHA256
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>type</span> kubectl.exe.sha256
</span></span></code></pre></div></li><li><p>Usando PowerShell puede automatizar la verificación usando el operador <code>-eq</code> para obtener un resultado de <code>True</code> o <code>False</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$($(CertUtil -hashfile .\kubectl.exe SHA256)[<span style=color:#666>1</span>] <span style=color:#666>-replace</span> <span style=color:#b44>&#34; &#34;</span>, <span style=color:#b44>&#34;&#34;</span>) <span style=color:#666>-eq</span> $(<span style=color:#a2f>type </span>.\kubectl.exe.sha256)
</span></span></code></pre></div></li></ul></li><li><p>Agregue el binario a su <code>PATH</code>.</p></li><li><p>Para asegurar que la versión de<code>kubectl</code> es la misma que descargada, ejecute:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></li></ol><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> <a href=https://docs.docker.com/docker-for-windows/#kubernetes>Docker Desktop para Windows</a> agrega su propia versión de <code>kubectl</code> a el <code>PATH</code>.
Si ha instalado Docker Desktop antes, es posible que deba colocar su entrada en el <code>PATH</code> antes de la agregada por el instalador de Docker Desktop o elimine el <code>kubectl</code>.</div><h3 id=instalar-en-windows-usando-chocolatey-o-scoop>Instalar en Windows usando Chocolatey o Scoop</h3><ol><li><p>Para instalar kubectl en Windows, puede usar <a href=https://chocolatey.org>Chocolatey</a>
como administrador de paquetes o el instalador <a href=https://scoop.sh>Scoop</a> desde línea de comandos.</p><ul class="nav nav-tabs" id=kubectl-win-install role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#kubectl-win-install-0 role=tab aria-controls=kubectl-win-install-0 aria-selected=true>choco</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#kubectl-win-install-1 role=tab aria-controls=kubectl-win-install-1>scoop</a></li></ul><div class=tab-content id=kubectl-win-install><div id=kubectl-win-install-0 class="tab-pane show active" role=tabpanel aria-labelledby=kubectl-win-install-0><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>choco install <span style=color:#a2f>kubernetes-cli</span>
</span></span></code></pre></div></div><div id=kubectl-win-install-1 class=tab-pane role=tabpanel aria-labelledby=kubectl-win-install-1><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>scoop install kubectl
</span></span></code></pre></div></div></div></li><li><p>Para asegurarse de que la versión que instaló esté actualizada, ejecute:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></li><li><p>Navegue a su directorio de inicio:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#080;font-style:italic># Si estas usando cmd.exe, correr: cd %USERPROFILE%</span>
</span></span><span style=display:flex><span><span style=color:#a2f>cd </span>~
</span></span></code></pre></div></li><li><p>Cree el directorio <code>.kube</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>mkdir .kube
</span></span></code></pre></div></li><li><p>Cambie al directorio <code>.kube</code> que acaba de crear:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#a2f>cd </span>.kube
</span></span></code></pre></div></li><li><p>Configure kubectl para usar un clúster de Kubernetes remoto:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#a2f>New-Item</span> config -type file
</span></span></code></pre></div></li></ol><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Edite el archivo de configuración con un editor de texto de su elección, como el Bloc de notas.</div><h2 id=verificar-la-configuración-de-kubectl>Verificar la configuración de kubectl</h2><p>Para que kubectl encuentre y acceda a un clúster de Kubernetes, necesita un
<a href=/docs/concepts/configuration/organize-cluster-access-kubeconfig/>archivo kubeconfig</a>, que se crea automáticamente cuando creas un clúster usando
<a href=https://github.com/kubernetes/kubernetes/blob/master/cluster/kube-up.sh>kube-up.sh</a>
o implementar con éxito un clúster de Minikube.
De forma predeterminada, la configuración de kubectl se encuentra en <code>~/.kube/config</code>.</p><p>Verifique que kubectl esté configurado correctamente obteniendo el estado del clúster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info
</span></span></code></pre></div><p>Si ve una respuesta de URL, kubectl está configurado correctamente para acceder a su clúster.</p><p>Si ve un mensaje similar al siguiente, kubectl no está configurado correctamente o no puede conectarse a un clúster de Kubernetes.</p><pre tabindex=0><code>The connection to the server &lt;server-name:port&gt; was refused - did you specify the right host or port?
</code></pre><p>Por ejemplo, si tiene la intención de ejecutar un clúster de Kubernetes en su computadora portátil (localmente), primero necesitará instalar una herramienta como Minikube y luego volver a ejecutar los comandos indicados anteriormente.</p><p>Si kubectl cluster-info devuelve la respuesta de la URL pero no puede acceder a su clúster, para verificar si está configurado correctamente, use:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info dump
</span></span></code></pre></div><h2 id=plugins-y-configuraciones-opcionales-de-kubectl>Plugins y configuraciones opcionales de kubectl</h2><h3 id=habilitar-el-autocompletado-de-shell>Habilitar el autocompletado de shell</h3><p>kubectl proporciona soporte de autocompletado para Bash y Zsh, lo que puede ahorrarle mucho tiempo al escribir.</p><p>A continuación se muestran los procedimientos para configurar el autocompletado para Zsh, si lo está ejecutando en Windows.</p><p>El script de completado de kubectl para Zsh se puede generar con el comando <code>kubectl completion zsh</code>. Obtener el script de completado en su shell habilita el autocompletado de kubectl.</p><p>Para hacerlo en todas sus sesiones de shell, agregue lo siguiente a su perfil <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#a2f>source</span> &lt;<span style=color:#666>(</span>kubectl completion zsh<span style=color:#666>)</span>
</span></span></code></pre></div><p>Si tiene un alias para kubectl, puede extender el completado del shell para trabajar con ese alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.zshrc
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;compdef __start_kubectl k&#39;</span> &gt;&gt;~/.zshrc
</span></span></code></pre></div><p>Después de recargar su shell, el autocompletado de kubectl debería estar funcionando.</p><p>Si recibe un error como <code>complete:13: command not found: compdef</code>,
luego agregue lo siguiente al comienzo de su perfil <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>autoload -Uz compinit
</span></span><span style=display:flex><span>compinit
</span></span></code></pre></div><h3 id=instalar-el-plugin-kubectl-convert>Instalar el plugin <code>kubectl-convert</code></h3><p>Un plugin para la herramienta de línea de comandos de Kubernetes <code>kubectl</code>, que le permite convertir manifiestos entre diferentes versiones de la API. Esto puede ser particularmente útil para migrar manifiestos a una versión no obsoleta de la API con la versión más reciente de Kubernetes.
Para obtener más información, visite <a href=/docs/reference/using-api/deprecation-guide/#migrate-to-non-deprecated-apis>migrar a APIs no obsoletas</a></p><ol><li><p>Descargue la última versión con el comando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#a2f>curl </span>-LO https<span>:</span>//dl.k8s.io/release/<span style=color:#a2f>/bin/windows/amd64/<span style=color:#a2f>kubectl-convert</span>.exe
</span></span></code></pre></div></li><li><p>Validar el binario (opcional)</p><p>Descargue el archivo de comprobación kubectl-convert:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#a2f>curl </span>-LO https<span>:</span>//dl.k8s.io/<span style=color:#a2f>/bin/windows/amd64/<span style=color:#a2f>kubectl-convert</span>.exe.sha256
</span></span></code></pre></div><p>Valide el binario kubectl-convert con el archivo de comprobación:</p><ul><li><p>Usando la consola del sistema puede comparar manualmente la salida de <code>CertUtil</code> con el archivo de comprobación descargado:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd><span style=display:flex><span>CertUtil -hashfile kubectl-convert.exe SHA256
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>type</span> kubectl-convert.exe.sha256
</span></span></code></pre></div></li><li><p>Usando PowerShell puede automatizar la verificación usando el operador <code>-eq</code>
para obtener un resultado de <code>True</code> o <code>False</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$($(CertUtil -hashfile .\<span style=color:#a2f>kubectl-convert</span>.exe SHA256)[<span style=color:#666>1</span>] <span style=color:#666>-replace</span> <span style=color:#b44>&#34; &#34;</span>, <span style=color:#b44>&#34;&#34;</span>) <span style=color:#666>-eq</span> $(<span style=color:#a2f>type </span>.\<span style=color:#a2f>kubectl-convert</span>.exe.sha256)
</span></span></code></pre></div></li></ul></li><li><p>Agregue el binario a su <code>PATH</code>.</p></li><li><p>Verifique que el plugin se haya instalado correctamente</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl convert --help
</span></span></code></pre></div><p>Si no ve un error, significa que el plugin se instaló correctamente.</p></li></ol><h2 id=siguientes-pasos>Siguientes pasos</h2><ul><li><a href=https://minikube.sigs.k8s.io/docs/start/>Instalar Minikube</a></li><li>Consulte las <a href=/docs/setup/>guías de introducción</a> para obtener más información sobre la creación de clústeres.</li><li><a href=/docs/tasks/access-application-cluster/service-access-application-cluster/>Aprenda a iniciar y exponer su aplicación.</a></li><li>Si necesita acceso a un clúster que no creó, consulte la guia de
<a href=/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>Compartir el acceso al clúster</a>.</li><li>Lea los <a href=/docs/reference/kubectl/kubectl/>documentos de referencia de kubectl</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-99d563e9521796074ba3ca7f15a613ce>1.1.4 - ¿Que sigue?</h1><div class=lead>¿Qué sigue después de instalar kubectl.</div><ul><li><a href=https://minikube.sigs.k8s.io/docs/start/>Instalar Minikube</a></li><li>Consulte las <a href=/docs/setup/>guías de introducción</a> para obtener más información sobre la creación de clústeres.</li><li><a href=/docs/tasks/access-application-cluster/service-access-application-cluster/>Aprenda a iniciar y exponer su aplicación.</a></li><li>Si necesita acceso a un clúster que no creó, consulte la guia de
<a href=/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>Compartir el acceso al clúster</a>.</li><li>Lea los <a href=/docs/reference/kubectl/kubectl/>documentos de referencia de kubectl</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2d600cc8ec4dec69673b5f9577b6da22>1.1.5 - Autocompletar bash en Linux</h1><div class=lead>Alguna configuración opcional para la finalización automática de bash en Linux.</div><h3 id=introducción>Introducción</h3><p>El script de completado de kubectl para Bash se puede generar con el comando <code>kubectl completion bash</code>. Obtener el script de completado en su shell habilita el autocompletado de kubectl.</p><p>Sin embargo, el script de completado depende de <a href=https://github.com/scop/bash-completion><strong>bash-completion</strong></a>, lo que significa que primero debe instalar este software (puedes probar si tienes bash-completion ya instalado ejecutando <code>type _init_completion</code>).</p><h3 id=instalar-bash-complete>Instalar bash-complete</h3><p>El completado de bash es proporcionado por muchos administradores de paquetes (ver <a href=https://github.com/scop/bash-completion#installation>aquí</a>). Puedes instalarlo con <code>apt-get install bash-completion</code> o <code>yum install bash-completion</code>, etc.</p><p>Los comandos anteriores crean <code>/usr/share/bash-completion/bash_completion</code>, que es el script principal de bash-complete. Dependiendo de su administrador de paquetes, debe obtener manualmente este archivo de perfil en su <code>~/.bashrc</code>.</p><p>Para averiguarlo, recargue su shell y ejecute <code>type _init_completion</code>. Si el comando tiene éxito, ya está configurado; de lo contrario, agregue lo siguiente a su archivo <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>source</span> /usr/share/bash-completion/bash_completion
</span></span></code></pre></div><p>Vuelva a cargar su shell y verifique que la finalización de bash esté correctamente instalada escribiendo <code>type _init_completion</code>.</p><h3 id=habilitar-el-autocompletado-de-kubectl>Habilitar el autocompletado de kubectl</h3><p>Ahora debe asegurarse de que el script de completado de kubectl se obtenga en todas sus sesiones de shell. Hay dos formas de hacer esto:</p><ul><li><p>Obtenga el script de completado en su perfil <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;source &lt;(kubectl completion bash)&#39;</span> &gt;&gt;~/.bashrc
</span></span></code></pre></div></li><li><p>Agregue el script de completado al directorio de <code>/etc/bash_completion.d</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl completion bash &gt;/etc/bash_completion.d/kubectl
</span></span></code></pre></div></li></ul><p>Si tiene un alias para kubectl, puede extender el completado del shell para trabajar con ese alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.bashrc
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;complete -o default -F __start_kubectl k&#39;</span> &gt;&gt;~/.bashrc
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> El código fuente de bash-complete todos los scripts se encuentra en <code>/etc/bash_completion.d</code>.</div><p>Ambos enfoques son equivalentes. Después de recargar su shell, el autocompletado de kubectl debería estar funcionando.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-68808b3ec5807517ed64fd8ae32a7d1b>1.1.6 - Autocompletar bash en macOS</h1><div class=lead>Alguna configuración opcional para la finalización automática de bash en macOS.</div><h3 id=introducción>Introducción</h3><p>El script de completado de kubectl para Bash se puede generar con <code>kubectl completion bash</code>. Obtener este script en su shell permite el completado de kubectl.</p><p>Sin embargo, el script de finalización de kubectl depende de <a href=https://github.com/scop/bash-completion><strong>bash-completion</strong></a> que, por lo tanto, debe instalar previamente.</p><div class="alert alert-danger warning callout" role=alert><strong>Advertencia:</strong> Hay dos versiones de bash-complete, v1 y v2. V1 es para Bash 3.2 (
que es el predeterminado en macOS), y v2 es para Bash 4.1+. El script de completado de kubectl <strong>no funciona</strong> correctamente con bash-complete v1 y Bash 3.2. Requiere <strong>bash-complete v2</strong> y <strong>Bash 4.1+</strong>. Por lo tanto, para poder usar correctamente la finalización de kubectl en macOS, debe instalar y usar Bash 4.1+ (<a href=https://itnext.io/upgrading-bash-on-macos-7138bd1066ba><em>instrucciones</em></a>). Las siguientes instrucciones asumen que usa Bash 4.1+ (es decir, cualquier versión de Bash de 4.1 o posterior).</div><h3 id=actualizar-bash>Actualizar Bash</h3><p>Las siguientes instrucciones asumen que usa Bash 4.1+. Puede verificar la versión de su Bash ejecutando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b8860b>$BASH_VERSION</span>
</span></span></code></pre></div><p>Si es demasiado antiguo, puede instalarlo o actualizarlo usando Homebrew:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install bash
</span></span></code></pre></div><p>Vuelva a cargar su shell y verifique que se esté utilizando la versión deseada:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b8860b>$BASH_VERSION</span> <span style=color:#b8860b>$SHELL</span>
</span></span></code></pre></div><p>Homebrew generalmente lo instala en <code>/usr/local/bin/bash</code>.</p><h3 id=instalar-bash-complete>Instalar bash-complete</h3><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Como se mencionó antes, estas instrucciones asumen que usa Bash 4.1+, lo que significa que instalará bash-completacion v2 (a diferencia de Bash 3.2 y bash-deployment v1, en cuyo caso el completado de kubectl no funcionará).</div><p>Puede probar si ya tiene instalado bash-complete v2 con <code>type _init_completion</code>. Si no es así, puede instalarlo con Homebrew:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install bash-completion@2
</span></span></code></pre></div><p>Como se indica en el resultado de este comando, agregue lo siguiente a su archivo <code>~/.bash_profile</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>BASH_COMPLETION_COMPAT_DIR</span><span style=color:#666>=</span><span style=color:#b44>&#34;/usr/local/etc/bash_completion.d&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>[[</span> -r <span style=color:#b44>&#34;/usr/local/etc/profile.d/bash_completion.sh&#34;</span> <span style=color:#666>]]</span> <span style=color:#666>&amp;&amp;</span> . <span style=color:#b44>&#34;/usr/local/etc/profile.d/bash_completion.sh&#34;</span>
</span></span></code></pre></div><p>Vuelva a cargar su shell y verifique que bash-complete v2 esté instalado correctamente con <code>type _init_completion</code>.</p><h3 id=habilitar-el-autocompletado-de-kubectl>Habilitar el autocompletado de kubectl</h3><p>Ahora debe asegurarse de que el script de completado de kubectl se obtenga en todas sus sesiones de shell. Hay varias formas de lograrlo:</p><ul><li><p>Obtenga el script de finalización en su perfil <code>~/.bash_profile</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;source &lt;(kubectl completion bash)&#39;</span> &gt;&gt;~/.bash_profile
</span></span></code></pre></div></li><li><p>Agregue el script de completado al directorio <code>/usr/local/etc/bash_completion.d</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl completion bash &gt;/usr/local/etc/bash_completion.d/kubectl
</span></span></code></pre></div></li><li><p>Si tiene un alias para kubectl, puede extender el completado del shell para trabajar con ese alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.bash_profile
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;complete -o default -F __start_kubectl k&#39;</span> &gt;&gt;~/.bash_profile
</span></span></code></pre></div></li><li><p>Si instaló kubectl con Homebrew (como se explica <a href=/docs/tasks/tools/install-kubectl-macos/#install-with-homebrew-on-macos>aquí</a>), entonces el script de completado de kubectl ya debería estar en <code>/usr/local/etc/bash_completion.d/kubectl</code>. En ese caso, no necesita hacer nada.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> La instalación de Homebrew de bash-completion v2 genera todos los archivos en el directorio <code>BASH_COMPLETION_COMPAT_DIR</code>, es por eso que los dos últimos métodos funcionan.</div></li></ul><p>En cualquier caso, después de recargar su shell, el completado de kubectl debería estar funcionando.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9ab27577326839cb4793fd670a916364>1.1.7 - Autocompletar zsh</h1><div class=lead>Alguna configuración opcional para la finalización automática de zsh.</div><p>El script de completado de kubectl para Zsh se puede generar con el comando <code>kubectl completion zsh</code>. Obtener el script de completado en su shell habilita el autocompletado de kubectl.</p><p>Para hacerlo en todas sus sesiones de shell, agregue lo siguiente a su perfil <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#a2f>source</span> &lt;<span style=color:#666>(</span>kubectl completion zsh<span style=color:#666>)</span>
</span></span></code></pre></div><p>Si tiene un alias para kubectl, puede extender el completado del shell para trabajar con ese alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.zshrc
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;compdef __start_kubectl k&#39;</span> &gt;&gt;~/.zshrc
</span></span></code></pre></div><p>Después de recargar su shell, el autocompletado de kubectl debería estar funcionando.</p><p>Si recibe un error como <code>complete:13: command not found: compdef</code>,
luego agregue lo siguiente al comienzo de su perfil <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>autoload -Uz compinit
</span></span><span style=display:flex><span>compinit
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-d4ebbbe0a2ddce15850a36dfede9ba52>1.1.8 - Descripción general de kubectl-convert</h1><div class=lead>Un plugin de kubectl que le permite convertir manifiestos de una versión</div><p>Un plugin para la herramienta de línea de comandos de Kubernetes <code>kubectl</code>, que le permite convertir manifiestos entre diferentes versiones de la API. Esto puede ser particularmente útil para migrar manifiestos a una versión no obsoleta de la API con la versión más reciente de Kubernetes.
Para obtener más información, visite <a href=/docs/reference/using-api/deprecation-guide/#migrate-to-non-deprecated-apis>migrar a APIs no obsoletas</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-b2d43b2ae3e8f26eefa83de2db4ba782>1.1.9 - verificar la instalación de kubectl</h1><div class=lead>Cómo verificar kubectl.</div><p>Para que kubectl encuentre y acceda a un clúster de Kubernetes, necesita un
<a href=/docs/concepts/configuration/organize-cluster-access-kubeconfig/>archivo kubeconfig</a>, que se crea automáticamente cuando creas un clúster usando
<a href=https://github.com/kubernetes/kubernetes/blob/master/cluster/kube-up.sh>kube-up.sh</a>
o implementar con éxito un clúster de Minikube.
De forma predeterminada, la configuración de kubectl se encuentra en <code>~/.kube/config</code>.</p><p>Verifique que kubectl esté configurado correctamente obteniendo el estado del clúster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info
</span></span></code></pre></div><p>Si ve una respuesta de URL, kubectl está configurado correctamente para acceder a su clúster.</p><p>Si ve un mensaje similar al siguiente, kubectl no está configurado correctamente o no puede conectarse a un clúster de Kubernetes.</p><pre tabindex=0><code>The connection to the server &lt;server-name:port&gt; was refused - did you specify the right host or port?
</code></pre><p>Por ejemplo, si tiene la intención de ejecutar un clúster de Kubernetes en su computadora portátil (localmente), primero necesitará instalar una herramienta como Minikube y luego volver a ejecutar los comandos indicados anteriormente.</p><p>Si kubectl cluster-info devuelve la respuesta de la URL pero no puede acceder a su clúster, para verificar si está configurado correctamente, use:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info dump
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-34a810f1516ad9d99b2697e36e9b0d0f>2 - Administrar un clúster</h1></div><div class=td-content><h1 id=pg-8e16d69617b175d61e2e7a6e1642c9d6>2.1 - Administrar un clúster con kubeadm</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-47be5dd51f686017f1766e6ec7aa6f41>2.2 - Administrar recursos de memoria, CPU y API</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-8c31aafd38fad5b0de0bd191758d6f93>2.3 - Instalar un proveedor de políticas de red</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-f5da33b976758a9183018c421eb83f58>3 - Configurar pods y contenedores</h1></div><div class=td-content><h1 id=pg-484833fb880d1e179cc2965d15f84da5>3.1 - Configura un Pod para Usar un Volume como Almacenamiento</h1><p>En esta página se muestra cómo configurar un Pod para usar un Volume (volumen) como almacenamiento.</p><p>El sistema de ficheros de un Contenedor existe mientras el Contenedor exista. Por tanto, cuando un Contenedor es destruido o reiniciado, los cambios realizados en el sistema de ficheros se pierden. Para un almacenamiento más consistente que sea independiente del ciclo de vida del Contenedor, puedes usar un <a href=/docs/concepts/storage/volumes/>Volume</a>. Esta característica es especialmente importante para aplicaciones que deben mantener un estado, como motores de almacenamiento clave-valor (por ejemplo Redis) y bases de datos.</p><h2 id=antes-de-empezar>Antes de empezar</h2><p><p>Debes tener un cluster Kubernetes a tu dispocición, y la herramienta de línea de comandos <code>kubectl</code> debe estar configurada. Si no tienes un cluster, puedes crear uno utilizando <a href=/docs/setup/minikube>Minikube</a>,
o puedes utilizar una de las siguientes herramientas en línea:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li></ul>Para comprobar la versión, introduzca <code>kubectl version</code>.</p><h2 id=configura-un-volume-para-un-pod>Configura un Volume para un Pod</h2><p>En este ejercicio crearás un Pod que ejecuta un único Contenedor. Este Pod tiene un Volume de tipo <a href=/docs/concepts/storage/volumes/#emptydir>emptyDir</a> (directorio vacío) que existe durante todo el ciclo de vida del Pod, incluso cuando el Contenedor es destruido y reiniciado. Aquí está el fichero de configuración del Pod:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/pods/storage/redis.yaml download=pods/storage/redis.yaml><code>pods/storage/redis.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-storage-redis-yaml")' title="Copy pods/storage/redis.yaml to clipboard"></img></div><div class=includecode id=pods-storage-redis-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>redis-storage<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/data/redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>redis-storage<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>emptyDir</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Crea el Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/storage/redis.yaml
</span></span></code></pre></div></li><li><p>Verifica que el Contenedor del Pod se está ejecutando y después observa los cambios en el Pod</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod redis --watch
</span></span></code></pre></div><p>La salida debería ser similar a:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME      READY     STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>redis     1/1       Running   <span style=color:#666>0</span>          13s
</span></span></code></pre></div></li><li><p>En otro terminal, abre una sesión interactiva dentro del Contenedor que se está ejecutando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it redis -- /bin/bash
</span></span></code></pre></div></li><li><p>En el terminal, ve a <code>/data/redis</code> y crea un fichero:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@redis:/data# <span style=color:#a2f>cd</span> /data/redis/
</span></span><span style=display:flex><span>root@redis:/data/redis# <span style=color:#a2f>echo</span> Hello &gt; test-file
</span></span></code></pre></div></li><li><p>En el terminal, lista los procesos en ejecución:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@redis:/data/redis# apt-get update
</span></span><span style=display:flex><span>root@redis:/data/redis# apt-get install procps
</span></span><span style=display:flex><span>root@redis:/data/redis# ps aux
</span></span></code></pre></div><p>La salida debería ser similar a:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
</span></span><span style=display:flex><span>redis        <span style=color:#666>1</span>  0.1  0.1  <span style=color:#666>33308</span>  <span style=color:#666>3828</span> ?        Ssl  00:46   0:00 redis-server *:6379
</span></span><span style=display:flex><span>root        <span style=color:#666>12</span>  0.0  0.0  <span style=color:#666>20228</span>  <span style=color:#666>3020</span> ?        Ss   00:47   0:00 /bin/bash
</span></span><span style=display:flex><span>root        <span style=color:#666>15</span>  0.0  0.0  <span style=color:#666>17500</span>  <span style=color:#666>2072</span> ?        R+   00:48   0:00 ps aux
</span></span></code></pre></div></li><li><p>En el terminal, mata el proceso de Redis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@redis:/data/redis# <span style=color:#a2f>kill</span> &lt;pid&gt;
</span></span></code></pre></div><p>donde <code>&lt;pid></code> es el ID de proceso (PID) de Redis.</p></li><li><p>En el terminal original, observa los cambios en el Pod de Redis. Eventualmente verás algo como lo siguiente:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME      READY     STATUS     RESTARTS   AGE
</span></span><span style=display:flex><span>redis     1/1       Running    <span style=color:#666>0</span>          13s
</span></span><span style=display:flex><span>redis     0/1       Completed  <span style=color:#666>0</span>         6m
</span></span><span style=display:flex><span>redis     1/1       Running    <span style=color:#666>1</span>         6m
</span></span></code></pre></div></li></ol><p>En este punto, el Contenedor ha sido destruido y reiniciado. Esto es debido a que el Pod de Redis tiene una
<a href=/docs/reference/generated/kubernetes-api/v1.25/#podspec-v1-core>restartPolicy</a> (política de reinicio)
de <code>Always</code> (siempre).</p><ol><li><p>Abre un terminal en el Contenedor reiniciado:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it redis -- /bin/bash
</span></span></code></pre></div></li><li><p>En el terminal, ve a <code>/data/redis</code> y verifica que <code>test-file</code> todavía existe:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@redis:/data/redis# <span style=color:#a2f>cd</span> /data/redis/
</span></span><span style=display:flex><span>root@redis:/data/redis# ls
</span></span><span style=display:flex><span>test-file
</span></span></code></pre></div></li><li><p>Elimina el Pod que has creado para este ejercicio:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod redis
</span></span></code></pre></div></li></ol><h2 id=siguientes-pasos>Siguientes pasos</h2><ul><li><p>Revisa <a href=/docs/reference/generated/kubernetes-api/v1.25/#volume-v1-core>Volume</a>.</p></li><li><p>Revisa <a href=/docs/reference/generated/kubernetes-api/v1.25/#pod-v1-core>Pod</a>.</p></li><li><p>Además del almacenamiento local proporcionado por <code>emptyDir</code>, Kubernetes soporta diferentes tipos de soluciones de almacenamiento por red, incluyendo los discos gestionados de los diferentes proveedores cloud, como por ejemplo los <em>Persistent Disks</em> en Google Cloud Platform o el <em>Elastic Block Storage</em> de Amazon Web Services. Este tipo de soluciones para volúmenes son las preferidas para el almacenamiento de datos críticos. Kubernetes se encarga de todos los detalles, tal como montar y desmontar los dispositivos en los nodos del clúster. Revisa <a href=/docs/concepts/storage/volumes/>Volumes</a> para obtener más información.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-aa0731e8aa8e2f6cc9e3c1a5e9895863>4 - Administrar Objetos en Kubernetes</h1><div class=lead>Interactuando con el API de Kubernetes aplicando paradigmas declarativo e imperativo.</div></div><div class=td-content><h1 id=pg-df206392be6f4d19bd8da41cee7170fa>4.1 - Administración declarativa de Objetos en Kubernetes usando archivos de Configuración</h1><p>Objetos en Kubernetes pueden ser creados, actualizados y eliminados utilizando
archivos de configuración almacenados en un directorio. Usando el comando
<code>kubectl apply</code> podrá crearlos o actualizarlos de manera recursiva según sea necesario.
Este método retiene cualquier escritura realizada contra objetos activos en el
sistema sin unirlos de regreso a los archivos de configuración. <code>kubectl diff</code> le
permite visualizar de manera previa los cambios que <code>apply</code> realizará.</p><h2 id=antes-de-empezar>Antes de empezar</h2><p>Instale <a href=/es/docs/tasks/tools/install-kubectl/><code>kubectl</code></a>.</p><p><p>Debes tener un cluster Kubernetes a tu dispocición, y la herramienta de línea de comandos <code>kubectl</code> debe estar configurada. Si no tienes un cluster, puedes crear uno utilizando <a href=/docs/setup/minikube>Minikube</a>,
o puedes utilizar una de las siguientes herramientas en línea:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li></ul>Para comprobar la versión, introduzca <code>kubectl version</code>.</p><h2 id=modos-de-administración>Modos de administración</h2><p>La herramienta <code>kubectl</code> soporta tres modos distintos para la administración de objetos:</p><ul><li>Comandos imperativos</li><li>Configuración de objetos imperativa</li><li>Configuración de objetos declarativa</li></ul><p>Acceda <a href=/docs/concepts/overview/working-with-objects/object-management/>Administración de objetos de Kubernetes</a>
para una discusión de las ventajas y desventajas de cada modo distinto de administración.</p><h2 id=visión-general>Visión general</h2><p>La configuración de objetos declarativa requiere una comprensión firme de la
definición y configuración de objetos de Kubernetes. Si aún no lo ha hecho, lea
y complete los siguientes documentos:</p><ul><li><a href=/docs/tasks/manage-kubernetes-objects/imperative-command/>Administración de Objetos de Kubernetes usando comandos imperativos</a></li><li><a href=/docs/tasks/manage-kubernetes-objects/imperative-config/>Administración imperativa de los Objetos de Kubernetes usando archivos de Configuración</a></li></ul><p>A continuación la definición de términos usados en este documento:</p><ul><li><em>archivo de configuración de objeto / archivo de configuración</em>: Un archivo en el
que se define la configuración de un objeto de Kubernetes. Este tema muestra como
utilizar archivos de configuración con <code>kubectl apply</code>. Los archivos de configuración
por lo general se almacenan en un sistema de control de versiones, como Git.</li><li><em>configuración activa de objeto / configuración activa</em>: Los valores de configuración
activos de un objeto, según estén siendo observados por el Clúster. Esta configuración
se almacena en el sistema de almacenamiento de Kubernetes, usualmente etcd.</li><li><em>escritor de configuración declarativo / escritor declarativo</em>: Una persona o
componente de software que actualiza a un objeto activo. Los escritores activos a
los que se refiere este tema aplican cambios a los archivos de configuración de objetos
y ejecutan <code>kubectl apply</code> para aplicarlos.</li></ul><h2 id=como-crear-objetos>Como crear objetos</h2><p>Utilice <code>kubectl apply</code> para crear todos los objetos definidos en los archivos
de configuración existentes en un directorio específico, con excepción de aquellos que
ya existen:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f &lt;directorio&gt;/
</span></span></code></pre></div><p>Esto definirá la anotación <code>kubectl.kubernetes.io/last-applied-configuration: '{...}'</code>
en cada objeto. Esta anotación contiene el contenido del archivo de configuración
utilizado para la creación del objeto.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Agregue la opción <code>-R</code> para procesar un directorio de manera recursiva.</div><p>El siguiente es un ejemplo de archivo de configuración para un objeto:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/application/simple_deployment.yaml download=application/simple_deployment.yaml><code>application/simple_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-simple-deployment-yaml")' title="Copy application/simple_deployment.yaml to clipboard"></img></div><div class=includecode id=application-simple-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Ejecute <code>kubectl diff</code> para visualizar el objeto que será creado:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl diff -f https://k8s.io/examples/application/simple_deployment.yaml
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong><p><code>diff</code> utiliza <a href=/docs/reference/using-api/api-concepts/#dry-run>server-side dry-run</a>,
que debe estar habilitado en el <code>kube-apiserver</code>.</p><p>Dado que <code>diff</code> ejecuta una solicitud de <code>apply</code> en el servidor en modo de simulacro (dry-run),
requiere obtener permisos de <code>PATCH</code>, <code>CREATE</code>, y <code>UPDATE</code>.
Vea <a href=/docs/reference/using-api/api-concepts#dry-run-authorization>Autorización Dry-Run</a>
para más detalles.</p></div><p>Cree el objeto usando <code>kubectl apply</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/simple_deployment.yaml
</span></span></code></pre></div><p>Despliegue la configuración activa usando <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f https://k8s.io/examples/application/simple_deployment.yaml -o yaml
</span></span></code></pre></div><p>La salida le mostrará que la anotación <code>kubectl.kubernetes.io/last-applied-configuration</code>
fue escrita a la configuración activa, y es consistente con los contenidos del archivo
de configuración:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Esta es la representación JSON de simple_deployment.yaml</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Fue escrita por kubectl apply cuando el objeto fue creado</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;minReadySeconds&#34;:5,&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.14.2&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=como-actualizar-objetos>Como actualizar objetos</h2><p>También puede usar <code>kubectl apply</code> para actualizar los objetos definidos en un directorio,
aún cuando esos objetos ya existan en la configuración activa. Con este enfoque logrará
lo siguiente:</p><ol><li>Definir los campos que aparecerán en la configuración activa.</li><li>Eliminar aquellos campos eliminados en el archivo de configuración, de la configuración activa.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl diff -f &lt;directorio&gt;/
</span></span><span style=display:flex><span>kubectl apply -f &lt;directorio&gt;/
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Agregue la opción <code>-R</code> para procesar directorios de manera recursiva.</div><p>Este es un ejemplo de archivo de configuración:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/application/simple_deployment.yaml download=application/simple_deployment.yaml><code>application/simple_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-simple-deployment-yaml")' title="Copy application/simple_deployment.yaml to clipboard"></img></div><div class=includecode id=application-simple-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Cree el objeto usando <code>kubectl apply</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/simple_deployment.yaml
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Con el propósito de ilustrar, el comando anterior se refiere a un único archivo
de configuración en vez de un directorio.</div><p>Despliegue la configuración activa usando <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f https://k8s.io/examples/application/simple_deployment.yaml -o yaml
</span></span></code></pre></div><p>La salida le mostrará que la anotación <code>kubectl.kubernetes.io/last-applied-configuration</code>
fue escrita a la configuración activa, y es consistente con los contenidos del archivo
de configuración:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Esta es la representación JSON de simple_deployment.yaml</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Fue escrita por kubectl apply cuando el objeto fue creado</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;minReadySeconds&#34;:5,&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.14.2&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>De manera directa, actualice el campo <code>replicas</code> en la configuración activa usando <code>kubectl scale</code>.
En este caso no se usa <code>kubectl apply</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl scale deployment/nginx-deployment --replicas<span style=color:#666>=</span><span style=color:#666>2</span>
</span></span></code></pre></div><p>Despliegue la configuración activa usando <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get deployment nginx-deployment -o yaml
</span></span></code></pre></div><p>La salida le muestra que el campo <code>replicas</code> ha sido definido en 2, y que la
anotación <code>last-applied-configuration</code> no contiene el campo <code>replicas</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># note que la anotación no contiene replicas</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># debido a que el objeto no fue actualizado usando apply</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;minReadySeconds&#34;:5,&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.14.2&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># definido por scale</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Actualice el archivo de configuración <code>simple_deployment.yaml</code> para cambiar el campo <code>image</code>
de <code>nginx:1.14.2</code> a <code>nginx:1.16.1</code>, y elimine el campo <code>minReadySeconds</code>:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/application/update_deployment.yaml download=application/update_deployment.yaml><code>application/update_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-update-deployment-yaml")' title="Copy application/update_deployment.yaml to clipboard"></img></div><div class=includecode id=application-update-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16.1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># actualice el valor de image</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Aplique los cambios realizados al archivo de configuración:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl diff -f https://k8s.io/examples/application/update_deployment.yaml
</span></span><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/update_deployment.yaml
</span></span></code></pre></div><p>Despliegue la configuración activa usando <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f https://k8s.io/examples/application/update_deployment.yaml -o yaml
</span></span></code></pre></div><p>La salida le mostrará los siguientes cambios hechos a la configuración activa:</p><ul><li>El campo <code>replicas</code> retiene el valor de 2 definido por <code>kubectl scale</code>.
Esto es posible ya que el campo fue omitido en el archivo de configuración.</li><li>El campo <code>image</code> ha sido actualizado de <code>nginx:1.16.1</code> a <code>nginx:1.14.2</code>.</li><li>La anotación <code>last-applied-configuration</code> ha sido actualizada con la nueva imagen.</li><li>El campo <code>minReadySeconds</code> ha sido despejado.</li><li>La anotación <code>last-applied-configuration</code> ya no contiene el campo <code>minReadySeconds</code></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># La anotación contiene la imagen acutalizada a nginx 1.11.9,</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># pero no contiene la actualización de las replicas a 2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.16.1&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Definido por `kubectl scale`.  Ignorado por `kubectl apply`.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># minReadySeconds fue despejado por `kubectl apply`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16.1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Definido `kubectl apply`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><div class="alert alert-danger warning callout" role=alert><strong>Advertencia:</strong> No se puede combinar <code>kubectl apply</code> con comandos de configuración imperativa de objetos
como <code>create</code> y <code>replace</code>. Esto se debe a que <code>create</code>
y <code>replace</code> no retienen la anotación <code>kubectl.kubernetes.io/last-applied-configuration</code>
que <code>kubectl apply</code> utiliza para calcular los cambios por realizar.</div><h2 id=como-eliminar-objetos>Como eliminar objetos</h2><p>Hay dos opciones diferentes para eliminar objetos gestionados por <code>kubectl apply</code>.</p><h3 id=manera-recomendada-kubectl-delete-f-archivo>Manera recomendada: <code>kubectl delete -f &lt;archivo></code></h3><p>La manera recomendada de eliminar objetos de manera manual es utilizando el comando
imperativo, ya que es más explícito en relación a lo que será eliminado, y es
menos probable que resulte en algo siendo eliminado sin la intención del usuario.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete -f &lt;archivo&gt;
</span></span></code></pre></div><h3 id=manera-alternativa-kubectl-apply-f-directorio-prune-l-etiqueta-deseada>Manera alternativa: <code>kubectl apply -f &lt;directorio/> --prune -l etiqueta=deseada</code></h3><p>Únicamente utilice esta opción si está seguro de saber lo que está haciendo.</p><div class="alert alert-danger warning callout" role=alert><strong>Advertencia:</strong> <code>kubectl apply --prune</code> se encuentra aún en alpha, y cambios incompatibles con versiones previas
podrían ser introducidos en lanzamientos futuros.</div><div class="alert alert-danger warning callout" role=alert><strong>Advertencia:</strong> Sea cuidadoso(a) al usar este comando, para evitar eliminar objetos
no intencionalmente.</div><p>Como una alternativa a <code>kubectl delete</code>, puede usar <code>kubectl apply</code> para identificar objetos a ser
eliminados, luego de que sus archivos de configuración han sido eliminados del directorio. El commando <code>apply</code> con <code>--prune</code>
consulta a la API del servidor por todos los objetos que coincidan con un grupo de etiquetas, e intenta relacionar
la configuración obtenida de los objetos activos contra los objetos según sus archivos de configuración.
Si un objeto coincide con la consulta, y no tiene un archivo de configuración en el directorio, pero si
tiene una anotación <code>last-applied-configuration</code>, entonces será eliminado.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f &lt;directorio/&gt; --prune -l &lt;etiquetas&gt;
</span></span></code></pre></div><div class="alert alert-danger warning callout" role=alert><strong>Advertencia:</strong> <code>apply</code> con <code>--prune</code> debería de ser ejecutado únicamente en contra del directorio
raíz que contiene los archivos de configuración. Ejecutarlo en contra de sub-directorios
podría causar que objetos sean eliminados no intencionalmente, si son retornados en la
consulta por selección de etiqueta usando <code>-l &lt;etiquetas></code> y no existen en el subdirectorio.</div><h2 id=como-visualizar-un-objeto>Como visualizar un objeto</h2><p>Puede usar <code>kubectl get</code> con <code>-o yaml</code> para ver la configuración de objetos activos:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f &lt;archivo|url&gt; -o yaml
</span></span></code></pre></div><h2 id=como-son-las-diferencias-calculadas-y-unidas-por-apply>Como son las diferencias calculadas y unidas por apply</h2><div class="alert alert-warning caution callout" role=alert><strong>Precaución:</strong> Un <em>patch</em> (parche) es una operación de actualización con alcance a campos específicos
de un objeto, y no al objeto completo. Esto permite actualizar únicamente grupos de campos
específicos en un objeto sin tener que leer el objeto primero.</div><p>Cuando <code>kubectl apply</code> actualiza la configuración activa para un objeto, lo hace enviando
una solicitud de patch al servidor de API. El patch define actualizaciones para campos
específicos en la configuración del objeto activo. El comando <code>kubectl apply</code> calcula esta solicitud
de patch usando el archivo de configuración, la configuración activa, y la anotación <code>last-applied-configuration</code>
almacenada en la configuración activa.</p><h3 id=calculando-la-unión-de-un-patch>Calculando la unión de un patch</h3><p>El comando <code>kubectl apply</code> escribe los contenidos de la configuración a la anotación
<code>kubectl.kubernetes.io/last-applied-configuration</code>. Esto es usado para identificar aquellos campos
que han sido eliminados de la configuración y deben ser limpiados. Los siguientes pasos
son usados para calcular que campos deben ser eliminados o definidos:</p><ol><li>Calculo de campos por eliminar. Estos son los campos presentes en <code>last-applied-configuration</code> pero ausentes en el archivo de configuración.</li><li>Calculo de campos por agregar o definir. Estos son los campos presentes en el archivo de configuración, con valores inconsistentes con la configuración activa.</li></ol><p>A continuación un ejemplo. Suponga que este es el archivo de configuración para un objeto de tipo Deployment:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/application/update_deployment.yaml download=application/update_deployment.yaml><code>application/update_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-update-deployment-yaml")' title="Copy application/update_deployment.yaml to clipboard"></img></div><div class=includecode id=application-update-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16.1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># actualice el valor de image</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>También, suponga que esta es la configuración activa para ese mismo objeto de tipo Deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># tome nota de que la anotación no contiene un valor para replicas</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># dado que no fue actualizado usando el comando apply</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;minReadySeconds&#34;:5,&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.14.2&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># definidas por scale</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Estos son los cálculos de unión que serían realizados por <code>kubectl apply</code>:</p><ol><li>Calcular los campos por eliminar, leyendo los valores de <code>last-applied-configuration</code>
y comparándolos con los valores en el archivo de configuración.
Limpiar los campos definidos en null de manera explícita en el archivo de configuración
sin tomar en cuenta si se encuentran presentes en la anotación <code>last-applied-configuration</code>.
En este ejemplo, <code>minReadySeconds</code> aparece en la anotación
<code>last-applied-configuration</code> pero no aparece en el archivo de configuración.
<strong>Acción:</strong> Limpiar <code>minReadySeconds</code> de la configuración activa.</li><li>Calcular los campos por ser definidos, al leer los valores del fichero de configuración
y compararlos con los valores en la configuración activa. En este ejemplo, el valor <code>image</code>
en el archivo de configuración, no coincide con el valor en la configuración activa.
<strong>Acción:</strong> Definir el campo <code>image</code> en la configuración activa.</li><li>Definir el valor de la anotación <code>last-applied-configuration</code> para que sea consistente
con el archivo de configuración.</li><li>Unir los resultados de 1, 2 y 3, en una única solicitud de patch para enviar al servidor de API.</li></ol><p>Esta es la configuración activa como resultado de esta unión:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># La anotación contiene la imágen actualizada a nginx 1.11.9,</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># pero no contiene la actualización a 2 replicas</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.16.1&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Definido por `kubectl scale`.  Ignorado por `kubectl apply`.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># minReadySeconds eliminado por `kubectl apply`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16.1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Definido por `kubectl apply`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=como-se-unen-los-diferentes-tipos-de-campos>Como se unen los diferentes tipos de campos</h3><p>La manera en la que los campos en un archivo de configuración son unidos con la
configuración activa depende del tipo de campo. Existen varios tipos de campos:</p><ul><li><p><em>primitivo</em>: Campos de cadena de texto (string), enteros (integer), o lógicos (boolean).
Por ejemplo, <code>image</code> y <code>replicas</code> son campos de tipo primitivo. <strong>Acción:</strong> Reemplazarlos.</p></li><li><p><em>mapa</em>, también llamados <em>objeto</em>: Campo de tipo mapa o un tipo
complejo que contiene sub-campos. Por ejemplo, <code>labels</code>,
<code>annotations</code>,<code>spec</code> y <code>metadata</code> son todos mapas. <strong>Acción:</strong> Unir los elementos o sub-campos.</p></li><li><p><em>lista</em>: Campos que contienen una lista de elementos que pueden ser de tipo primitivo o mapa.
Como ejemplos, <code>containers</code>, <code>ports</code>, y <code>args</code> son listas. <strong>Acción:</strong> Varía.</p></li></ul><p>Cuando <code>kubectl apply</code> actualiza un campo de tipo mapa o lista, típicamente no reemplaza
el campo completo, sino actualiza los sub-elementos individuales.
Por ejemplo, cuando se hace una unión del campo <code>spec</code> en un Deployment, el <code>spec</code>
completo no es reemplazado, por el contrario, únicamente los sub-campos de <code>spec</code> como
<code>replica</code> son comparados y unidos.</p><h3 id=uniendo-cambios-en-campos-primitivos>Uniendo cambios en campos primitivos</h3><p>Campos primitivos son limpiados o reemplazados.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> <code>-</code> determina que "no aplica" debido a que el valor no es utilizado.</div><table><thead><tr><th>Campo en el archivo de configuración</th><th>Campo en la configuración activa</th><th>Campo en last-applied-configuration</th><th>Acción</th></tr></thead><tbody><tr><td>Si</td><td>Si</td><td>-</td><td>Define el valor en el archivo de configuración como activo.</td></tr><tr><td>Si</td><td>No</td><td>-</td><td>Define el valor a la configuración local.</td></tr><tr><td>No</td><td>-</td><td>Si</td><td>Elimina de la configuración activa.</td></tr><tr><td>No</td><td>-</td><td>No</td><td>No hacer nada. Mantiene el valor activo.</td></tr></tbody></table><h3 id=uniendo-cambios-en-campos-de-un-mapa>Uniendo cambios en campos de un mapa</h3><p>Los campos que conjuntamente representan un mapa, son unidos al comparar cada uno de los subcampos o elementos del mapa:</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> <code>-</code> determina que "no aplica" debido a que el valor no es utilizado.</div><table><thead><tr><th>Propiedad en archivo de configuración</th><th>Propiedad en configuración activa</th><th>Campo en last-applied-configuration</th><th>Acción</th></tr></thead><tbody><tr><td>Si</td><td>Si</td><td>-</td><td>Comparar valores de sub-propiedades.</td></tr><tr><td>Si</td><td>No</td><td>-</td><td>Usar configuración local.</td></tr><tr><td>No</td><td>-</td><td>Si</td><td>Eliminar de la configuración activa.</td></tr><tr><td>No</td><td>-</td><td>No</td><td>No hacer nada. Mantener el valor activo.</td></tr></tbody></table><h3 id=uniendo-cambios-en-campos-de-tipo-lista>Uniendo cambios en campos de tipo lista</h3><p>El unir cambios en una lista utiliza una de tres posibles estrategias:</p><ul><li>Reemplazar la lista si todos sus elementos son primitivos.</li><li>Unir elementos individuales en líneas de elementos complejos.</li><li>Unir una lista de elementos primitivos.</li></ul><p>Se define la estrategia elegida con base en cada campo.</p><h4 id=reemplazar-una-lista-si-todos-sus-elementos-son-primitivos>Reemplazar una lista si todos sus elementos son primitivos</h4><p>Trata la lista como si fuese un campo primitivo. Reemplaza o elimina la lista completa.
Esto preserva el orden de los elementos.</p><p><strong>Ejemplo:</strong> Usando <code>kubectl apply</code> para actualizar el campo <code>args</code> de un Contenedor en un Pod.
Esto define el valor de <code>args</code> en la configuración activa, al valor en el archivo de configuración.
Cualquier elemento de <code>args</code> que haya sido previamente agregado a la configuración activa se perderá.
El orden de los elementos definidos en <code>args</code> en el archivo de configuración, serán conservados
en la configuración activa.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#080;font-style:italic># valor en last-applied-configuration</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;a&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;b&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># valores en archivo de configuración</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;a&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;c&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># configuración activa</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;a&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;b&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;d&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># resultado posterior a la unión</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;a&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;c&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>Explicación:</strong> La unión utilizó los valores del archivo de configuración para definir los nuevos valores de la lista.</p><h4 id=unir-elementos-individuales-en-una-lista-de-elementos-complejos>Unir elementos individuales en una lista de elementos complejos</h4><p>Trata la lista como un mapa, y trata cada campo específico de cada elemento como una llave.
Agrega, elimina o actualiza elementos individuales. Esta operación no conserva el orden.</p><p>Esta estrategia de unión utiliza una etiqueta especial en cada campo llamada <code>patchMergeKey</code>. La etiqueta
<code>patchMergeKey</code> es definida para cada campo en el código fuente de Kubernetes:
<a href=https://github.com/kubernetes/api/blob/d04500c8c3dda9c980b668c57abc2ca61efcf5c4/core/v1/types.go#L2747>types.go</a>
Al unir una lista de mapas, el campo especificado en <code>patchMergeKey</code> para el elemento dado
se utiliza como un mapa de llaves para ese elemento.</p><p><strong>Ejemplo:</strong> Utilice <code>kubectl apply</code> para actualizar el campo <code>containers</code> de un PodSpec.
Esto une la lista como si fuese un mapa donde cada elemento utiliza <code>name</code> por llave.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#080;font-style:italic># valor en last-applied-configuration</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name: nginx-helper-a # llave</span>:<span style=color:#bbb> </span>nginx-helper-a; será eliminado en resultado<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name: nginx-helper-b # llave</span>:<span style=color:#bbb> </span>nginx-helper-b; será conservado<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># valor en archivo de configuración</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name: nginx-helper-c # llavel</span>:<span style=color:#bbb> </span>nginx-helper-c; será agregado en el resultado<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># configuración activa</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-a<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;run&#34;</span>]<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Campo será conservado</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name: nginx-helper-d # llave</span>:<span style=color:#bbb> </span>nginx-helper-d; será conservado<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># resultado posterior a la unión</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># Elemento nginx-helper-a fue eliminado</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;run&#34;</span>]<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Campo fue conservado</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-c<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Elemento fue agregado</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-d<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Elemento fue ignorado</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>Explicación:</strong></p><ul><li>El contenedor llamado "nginx-helper-a" fué eliminado al no aparecer ningún
contenedor llamado "nginx-helper-a" en el archivo de configuración.</li><li>El contenedor llamado "nginx-helper-b" mantiene los cambios existentes en <code>args</code>
en la configuración activa. <code>kubectl apply</code> pudo identificar que
el contenedor "nginx-helper-b" en la configuración activa es el mismo
"nginx-helper-b" que aparece en el archivo de configuración, aún teniendo diferentes
valores en los campos (no existe <code>args</code> en el archivo de configuración). Esto sucede
debido a que el valor del campo <code>patchMergeKey</code> (name) es idéntico en ambos.</li><li>El contenedor llamado "nginx-helper-c" fue agregado ya que no existe ningún contenedor
con ese nombre en la configuración activa, pero si existe uno con ese nombre
en el archivo de configuración.</li><li>El contendor llamado "nginx-helper-d" fue conservado debido a que no aparece
ningún elemento con ese nombre en last-applied-configuration.</li></ul><h4 id=unir-una-lista-de-elementos-primitivos>Unir una lista de elementos primitivos</h4><p>A partir de Kubernetes 1.5, el unir listas de elementos primitivos no es soportado.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> La etiqueta <code>patchStrategy</code> en <a href=https://github.com/kubernetes/api/blob/d04500c8c3dda9c980b668c57abc2ca61efcf5c4/core/v1/types.go#L2748>types.go</a> es la que
determina cual de las estrategias aplica para cualquier campo en particular.
Para campos de tipo lista, el campo será reemplazado cuando no exista una especificación de <code>patchStrategy</code>.</div><h2 id=valores-de-campo-por-defecto>Valores de campo por defecto</h2><p>El Servidor de API define algunos campos a sus valores por defecto si no son especificados
al momento de crear un objeto.</p><p>Aquí puede ver un archivo de configuración para un Deployment. Este archivo no especifica
el campo <code>strategy</code>:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/application/simple_deployment.yaml download=application/simple_deployment.yaml><code>application/simple_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-simple-deployment-yaml")' title="Copy application/simple_deployment.yaml to clipboard"></img></div><div class=includecode id=application-simple-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Cree un nuevo objeto <code>kubectl apply</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/simple_deployment.yaml
</span></span></code></pre></div><p>Despliegue la configuración activa usando <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f https://k8s.io/examples/application/simple_deployment.yaml -o yaml
</span></span></code></pre></div><p>La salida muestra que el servidor de API definió varios campos con los valores por defecto
en la configuración activa. Estos campos no fueron especificados en el archivo de
configuración.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>strategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rollingUpdate</span>:<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver - derivado de strategy.type</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxSurge</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxUnavailable</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>RollingUpdate<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>IfNotPresent<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>protocol</span>:<span style=color:#bbb> </span>TCP<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>terminationMessagePath</span>:<span style=color:#bbb> </span>/dev/termination-log<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>dnsPolicy</span>:<span style=color:#bbb> </span>ClústerFirst<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Always<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>terminationGracePeriodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>30</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto definido por apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>En una solicitud de patch, los campos definidos a valores por defecto no son redefinidos a excepción
de cuando hayan sido limpiados de manera explícita como parte de la solicitud de patch. Esto puede
causar comportamientos no esperados para campos cuyo valor por defecto es basado en los valores
de otros campos. Cuando el otro campo ha cambiado, el valor por defecto de ellos no será actualizado
de no ser que sean limpiados de manera explícita.</p><p>Por esta razón, se recomienda que algunos campos que reciben un valor por defecto del
servidor sean definidos de manera explícita en los archivos de configuración, aun cuando
el valor definido sea idéntico al valor por defecto. Esto facilita la identificación
de valores conflictivos que podrían no ser revertidos a valores por defecto por parte
del servidor.</p><p><strong>Ejemplo:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#080;font-style:italic># last-applied-configuration</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># archivo de configuración</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>strategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Recreate<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor actualizado</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># configuración activa</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>strategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>RollingUpdate<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rollingUpdate</span>:<span style=color:#bbb> </span><span style=color:#080;font-style:italic># valor por defecto derivado del campo type</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxSurge </span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxUnavailable</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># resultado posterior a la unión - ERROR!</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>strategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type: Recreate # valor actualizado</span>:<span style=color:#bbb> </span>incompatible con RollingUpdate<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rollingUpdate: # valor por defecto</span>:<span style=color:#bbb> </span>incompatible con &#34;type: Recreate&#34;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxSurge </span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxUnavailable</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>Explicación:</strong></p><ol><li>El usuario crea un Deployment sin definir <code>strategy.type</code>.</li><li>El servidor define <code>strategy.type</code> a su valor por defecto de <code>RollingUpdate</code> y
agrega los valores por defecto a <code>strategy.rollingUpdate</code>.</li><li>El usuario cambia <code>strategy.type</code> a <code>Recreate</code>. Los valores de <code>strategy.rollingUpdate</code>
se mantienen en su configuración por defecto, sin embargo el servidor espera que se limpien.
Si los valores de <code>strategy.rollingUpdate</code> hubiesen sido definidos inicialmente en el archivo
de configuración, hubiese sido más claro que requerían ser eliminados.</li><li>Apply fallará debido a que <code>strategy.rollingUpdate</code> no fue eliminado. El campo <code>strategy.rollingupdate</code>
no puede estar definido, si el valor de <code>strategy.type</code> es <code>Recreate</code>.</li></ol><p>Recomendación: Estos campos deberían de ser definidos de manera explícita en el archivo de configuración:</p><ul><li>Etiquetas de Selectors y PodTemplate en cargas de trabajo como Deployment, StatefulSet, Job, DaemonSet,
ReplicaSet, y ReplicationController</li><li>Estrategia de rollout para un Deployment</li></ul><h3 id=como-limpiar-campos-definidos-a-valores-por-defecto-por-el-servidor-o-definidos-por-otros-escritores>Como limpiar campos definidos a valores por defecto por el servidor, o definidos por otros escritores</h3><p>Campos que no aparecen en el archivo de configuración pueden ser limpiados si se define su valor
a <code>null</code> y luego se aplica el archivo de configuración.
Para los campos definidos a valores por defecto por el servidor, esto provoca que se reestablezca
a sus valores por defecto.</p><h2 id=como-cambiar-al-propietario-de-un-campo-entre-un-archivo-de-configuración-y-un-escritor-imperativo>Como cambiar al propietario de un campo entre un archivo de configuración y un escritor imperativo</h2><p>Estos son los únicos métodos que debe usar para cambiar un campo individual de un objeto:</p><ul><li>Usando <code>kubectl apply</code>.</li><li>Escribiendo de manera directa a la configuración activa sin modificar el archivo de configuración:
por ejemplo, usando <code>kubectl scale</code>.</li></ul><h3 id=cambiando-al-propietario-de-un-campo-de-un-escritor-imperativo-a-un-archivo-de-configuración>Cambiando al propietario de un campo de un escritor imperativo a un archivo de configuración</h3><p>Añada el campo al archivo de configuración, y no realice nuevas actualizaciones a la configuración
activa que no sucedan por medio de <code>kubectl apply</code>.</p><h3 id=cambiando-al-propietario-de-un-archivo-de-configuración-a-un-escritor-imperativo>Cambiando al propietario de un archivo de configuración a un escritor imperativo</h3><p>A partir de Kubernetes 1.5, el cambiar un campo que ha sido definido por medio de un
archivo de configuración para que sea modificado por un escritor imperativo requiere
pasos manuales:</p><ul><li>Eliminar el campo del archivo de configuración.</li><li>Eliminar el campo de la anotación <code>kubectl.kubernetes.io/last-applied-configuration</code> en el objeto activo.</li></ul><h2 id=cambiando-los-métodos-de-gestión>Cambiando los métodos de gestión</h2><p>Los objetos en Kubernetes deberían de ser gestionados utilizando únicamente un método
a la vez. El alternar de un método a otro es posible, pero es un proceso manual.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Esta bien el usar eliminación imperativa junto a gestión declarativa.</div><h3 id=migrando-de-gestión-imperativa-con-comandos-a-configuración-declarativa-de-objetos>Migrando de gestión imperativa con comandos a configuración declarativa de objetos</h3><p>El migrar de gestión imperativa utilizando comandos a la gestión declarativa de objetos
requiere varios pasos manuales:</p><ol><li><p>Exporte el objeto activo a un archivo local de configuración:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get &lt;tipo&gt;/&lt;nombre&gt; -o yaml &gt; &lt;tipo&gt;_&lt;nombre&gt;.yaml
</span></span></code></pre></div></li><li><p>Elimine de manera manual el campo <code>status</code> del archivo de configuración.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Este paso es opcional, ya que <code>kubectl apply</code> no actualiza el campo <code>status</code>
aunque este presente en el archivo de configuración.</div></li><li><p>Defina la anotación <code>kubectl.kubernetes.io/last-applied-configuration</code> en el objeto:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl replace --save-config -f &lt;tipo&gt;_&lt;nombre&gt;.yaml
</span></span></code></pre></div></li><li><p>Modifique el proceso para usar <code>kubectl apply</code> para gestionar el objeto de manera exclusiva.</p></li></ol><h3 id=migrando-de-gestión-imperativa-de-la-configuración-de-objetos-a-gestión-declarativa>Migrando de gestión imperativa de la configuración de objetos a gestión declarativa</h3><ol><li><p>Defina la anotación <code>kubectl.kubernetes.io/last-applied-configuration</code> en el objeto:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl replace --save-config -f &lt;tipo&gt;_&lt;nombre&gt;.yaml
</span></span></code></pre></div></li><li><p>Modifique el proceso para usar <code>kubectl apply</code> para gestionar el objeto de manera exclusiva.</p></li></ol><h2 id=definiendo-los-selectores-para-el-controlador-y-las-etiquetas-de-podtemplate>Definiendo los selectores para el controlador y las etiquetas de PodTemplate</h2><div class="alert alert-danger warning callout" role=alert><strong>Advertencia:</strong> Se desaconseja encarecidamente actualizar los selectores en controladores.</div><p>La forma recomendada es definir una etiqueta única e inmutable para PodTemplate usada
únicamente por el selector del controlador sin tener ningún otro significado semántico.</p><p><strong>Ejemplo:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>controller-selector</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;apps/v1/deployment/nginx&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>controller-selector</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;apps/v1/deployment/nginx&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=siguientes-pasos>Siguientes pasos</h2><ul><li><a href=/docs/tasks/manage-kubernetes-objects/imperative-command/>Administración de Objetos de Kubernetes usando comandos imperativos</a></li><li><a href=/docs/tasks/manage-kubernetes-objects/imperative-config/>Administración imperativa de los Objetos de Kubernetes usando archivos de configuración</a></li><li><a href=/docs/reference/generated/kubectl/kubectl-commands/>Referencia del comando Kubectl</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/>Referencia de la API de Kubernetes</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-866924fa095f897ede8dfdcab9e97942>5 - Inyectar datos en las aplicaciones</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-a78a5e7e765fd8c49c8f7c0d72499f72>6 - Gestionar y ejecutar aplicaciones</h1></div><div class=td-content><h1 id=pg-790ea02857492b3a822e981e93e3a98b>6.1 - Corre una aplicación stateless usando un Deployment</h1><p>Ésta página enseña como correr una aplicación stateless usando un <code>deployment</code> de Kubernetes.</p><h2 id=objetivos>Objetivos</h2><ul><li>Crear un <code>deployment</code> de nginx.</li><li>Usar kubectl para obtener información acerca del <code>deployment</code>.</li><li>Actualizar el <code>deployment</code>.</li></ul><h2 id=antes-de-empezar>Antes de empezar</h2><p><p>Debes tener un cluster Kubernetes a tu dispocición, y la herramienta de línea de comandos <code>kubectl</code> debe estar configurada. Si no tienes un cluster, puedes crear uno utilizando <a href=/docs/setup/minikube>Minikube</a>,
o puedes utilizar una de las siguientes herramientas en línea:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li></ul>Su versión de Kubernetes debe ser como mínimo v1.9.
Para comprobar la versión, introduzca <code>kubectl version</code>.</p><h2 id=creando-y-explorando-un-nginx-deployment>Creando y explorando un nginx deployment</h2><p>Puedes correr una aplicación creando un <code>deployment</code> de Kubernetes, y puedes describir el <code>deployment</code> en un fichero YAML. Por ejemplo, el siguiente fichero YAML describe un <code>deployment</code> que corre la imágen Docker nginx:1.7.9:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/application/deployment.yaml download=application/deployment.yaml><code>application/deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-deployment-yaml")' title="Copy application/deployment.yaml to clipboard"></img></div><div class=includecode id=application-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Usa apps/v1beta2 para versiones anteriores a 1.9.0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># indica al controlador que ejecute 2 pods</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Crea un <code>deployment</code> basado en el fichero YAML:</p><pre><code> kubectl apply -f https://k8s.io/examples/application/deployment.yaml
</code></pre></li><li><p>Obtén información acerca del <code>deployment</code>:</p><pre><code> kubectl describe deployment nginx-deployment
</code></pre><p>El resultado es similar a esto:</p><pre><code> Name:     nginx-deployment
 Namespace:    default
 CreationTimestamp:  Tue, 30 Aug 2016 18:11:37 -0700
 Labels:     app=nginx
 Annotations:    deployment.kubernetes.io/revision=1
 Selector:   app=nginx
 Replicas:   2 desired | 2 updated | 2 total | 2 available | 0 unavailable
 StrategyType:   RollingUpdate
 MinReadySeconds:  0
 RollingUpdateStrategy:  1 max unavailable, 1 max surge
 Pod Template:
   Labels:       app=nginx
   Containers:
    nginx:
     Image:              nginx:1.7.9
     Port:               80/TCP
     Environment:        &lt;none&gt;
     Mounts:             &lt;none&gt;
   Volumes:              &lt;none&gt;
 Conditions:
   Type          Status  Reason
   ----          ------  ------
   Available     True    MinimumReplicasAvailable
   Progressing   True    NewReplicaSetAvailable
 OldReplicaSets:   &lt;none&gt;
 NewReplicaSet:    nginx-deployment-1771418926 (2/2 replicas created)
 No events.
</code></pre></li><li><p>Lista los pods creados por el <code>deployment</code>:</p><pre><code> kubectl get pods -l app=nginx
</code></pre><p>El resultado es similar a esto:</p><pre><code> NAME                                READY     STATUS    RESTARTS   AGE
 nginx-deployment-1771418926-7o5ns   1/1       Running   0          16h
 nginx-deployment-1771418926-r18az   1/1       Running   0          16h
</code></pre></li><li><p>Muestra información acerca del pod:</p><pre><code> kubectl describe pod &lt;pod-name&gt;
</code></pre><p>donde <code>&lt;pod-name></code> es el nombre de uno de los pods.</p></li></ol><h2 id=actualizando-el-deployment>Actualizando el deployment</h2><p>Puedes actualizar el <code>deployment</code> aplicando un nuevo fichero YAML. El siguiente fichero YAML
especifica que el <code>deployment</code> debería ser actualizado para usar nginx 1.8.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/application/deployment-update.yaml download=application/deployment-update.yaml><code>application/deployment-update.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-deployment-update-yaml")' title="Copy application/deployment-update.yaml to clipboard"></img></div><div class=includecode id=application-deployment-update-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Usa apps/v1beta2 para versiones anteriores a 1.9.0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.8<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Actualiza la versión de nginx de 1.7.9 a 1.8</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Aplica el nuevo fichero YAML:</p><pre><code>  kubectl apply -f https://k8s.io/examples/application/deployment-update.yaml
</code></pre></li><li><p>Comprueba como el <code>deployment</code> crea nuevos pods con la nueva imagen mientras va eliminando los pods con la especificación antigua:</p><pre><code>  kubectl get pods -l app=nginx
</code></pre></li></ol><h2 id=escalando-la-aplicación-aumentado-el-número-de-replicas>Escalando la aplicación aumentado el número de replicas</h2><p>Puedes aumentar el número de pods en tu <code>deployment</code> aplicando un nuevo fichero YAML.
El siguiente fichero YAML especifica un total de 4 <code>replicas</code>, lo que significa que el <code>deployment</code> debería tener cuatro pods:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/application/deployment-scale.yaml download=application/deployment-scale.yaml><code>application/deployment-scale.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-deployment-scale-yaml")' title="Copy application/deployment-scale.yaml to clipboard"></img></div><div class=includecode id=application-deployment-scale-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Usa apps/v1beta2 para versiones anteriores a 1.9.0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>4</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Actualiza el número de réplicas de 2 a 4</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.8<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Aplica el nuevo fichero YAML:</p><pre><code> kubectl apply -f https://k8s.io/examples/application/deployment-scale.yaml
</code></pre></li><li><p>Verifica que el <code>deployment</code> tiene cuatro pods:</p><pre><code> kubectl get pods -l app=nginx
</code></pre><p>El resultado es similar a esto:</p><pre><code> NAME                               READY     STATUS    RESTARTS   AGE
 nginx-deployment-148880595-4zdqq   1/1       Running   0          25s
 nginx-deployment-148880595-6zgi1   1/1       Running   0          25s
 nginx-deployment-148880595-fxcez   1/1       Running   0          2m
 nginx-deployment-148880595-rwovn   1/1       Running   0          2m
</code></pre></li></ol><h2 id=eliminando-un-deployment>Eliminando un deployment</h2><p>Elimina el <code>deployment</code> por el nombre:</p><pre><code>kubectl delete deployment nginx-deployment
</code></pre><h2 id=replicationcontrollers>ReplicationControllers</h2><p>La manera preferida de crear una aplicación con múltiples instancias es usando un Deployment, el cual usa un ReplicaSet. Antes de que Deployment y ReplicaSet fueran introducidos en Kubernetes, aplicaciones con múltiples instancias eran configuradas usando un
<a href=/docs/concepts/workloads/controllers/replicationcontroller/>ReplicationController</a>.</p><h2 id=siguientes-pasos>Siguientes pasos</h2><ul><li>Aprende más acerca de <a href=/docs/concepts/workloads/controllers/deployment/>Deployments</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fbe2744f00d1aa4df4cdf4eea6a082d4>6.2 - Especificando un presupuesto de disrupción para tu aplicación</h1><p>Ésta pagina enseña como limitar el numero de disrupciones concurrentes que afectan a tu aplicación definiendo presupuestos de disrupción de pods, Pod Disruption Budgets (PDB) en inglés. Estos presupuestos definen el mínimo número de pods que deben estar ejecutándose en todo momento para asegurar la disponibilidad de la aplicación durante operaciones de mantenimiento efectuadas sobre los nodos por los administradores del cluster.</p><h2 id=antes-de-empezar>Antes de empezar</h2><ul><li>Tener permisos de administrador sobre la aplicación que esta corriendo en Kubernetes y requiere alta disponibilidad</li><li>Deberías saber como desplegar <a href=/docs/tasks/run-application/run-stateless-application-deployment/>Múltiples réplicas de aplicaciones stateless</a>
y/o <a href=/docs/tasks/run-application/run-replicated-stateful-application/>Múltiples réplicas de aplicaciones stateful</a>.</li><li>Deberías haber leido acerca de <a href=/docs/concepts/workloads/pods/disruptions/>Disrupciones de un Pod</a>.</li><li>Deberías confirmar con el propietario del cluster o proveedor de servicio que respetan Presupuestos de Disrupción para Pods.</li></ul><h2 id=protegiendo-una-aplicación-con-un-poddisruptionbudget>Protegiendo una aplicación con un PodDisruptionBudget</h2><ol><li>Identifica la aplicación que quieres proteger con un PodDisruptionBudget (PDB).</li><li>Revisa como afectan las disrupciones a tú aplicación.</li><li>Crea un PDB usando un archivo YAML.</li><li>Crea el objecto PDB desde el archivo YAML.</li></ol><h2 id=identifica-la-applicación-que-quieres-proteger>Identifica la applicación que quieres proteger</h2><p>El caso más común es proteger aplicaciones que usan uno de los controladores incorporados
en Kubernetes:</p><ul><li>Deployment</li><li>Replicationcontrolador</li><li>ReplicaSet</li><li>StatefulSet</li></ul><p>En este caso, toma nota del <code>.spec.selector</code> que utiliza el controlador; el mismo se utilizará en el <code>spec.selector</code> del PDB.</p><p>También puedes utilizar PDBs para proteger pods que no estan gestionados por uno de los controladores listados arriba, o agrupaciones arbitrarias de pods, con algunas restricciones descritas en <a href=#arbitrary-controladores-and-selectors>Controladores Arbitrarios y Selectors</a>.</p><h2 id=revisa-como-afectan-las-disrupciones-a-tú-aplicación>Revisa como afectan las disrupciones a tú aplicación</h2><p>Decide cuántas instancias de tu aplicación pueden estar fuera de servicio al mismo
tiempo debido a disrupciones voluntarias de corto plazo.</p><ul><li>Frontend stateless:<ul><li>Objetivo: evitar reducir capacidad para servir por mas de 10%.<ul><li>Solución: usar un PDB que especifica minAvailable 90%.</li></ul></li></ul></li><li>Aplicación Stateful con una sola instancia:<ul><li>Objetivo: no terminar esta aplicación sin primero confirmar conmigo.<ul><li>Posible Solución 1: No usar un PDB y tolerar inactividad ocasional.</li><li>Posible Solución 2: Crea un PDB con maxUnavailable=0. Entiende que el operador del cluster debe consultar contigo antes de terminar tu aplicación. Cuando el operador te contacte, prepara tu aplicación para downtime y elimina el PDB para indicar que estas preparado para la disrupción. Crea el PDB de nuevo al terminar la disrupción.</li></ul></li></ul></li><li>Aplicación Stateful con múltiples instancias como Consul, ZooKeeper, etcd, Redis o MySQL:<ul><li>Objetivo: no reducir el numero de instancias por debajo del quorum, de lo contrario, las escrituras fallarían.<ul><li>Posible Solución 1: fijar maxUnavailable a 1 (funciona con diferentes escalas de aplicación).</li><li>Posible Solución 2: fijar minAvailable al tamaño del quorum (e.g. 3 cuando hay un total de 5 instancias). (Permite mas disrupciones a la vez.).</li></ul></li></ul></li><li>Trabajos por lote reiniciables:<ul><li>Objetivo: El trabajo debe completarse en caso de una interrupción voluntaria.<ul><li>Posible solución: No cree un PDB. El controlador de Jobs creará un pod de reemplazo.</li></ul></li></ul></li></ul><h2 id=especificando-un-poddisruptionbudget>Especificando un PodDisruptionBudget</h2><p>Un <code>PodDisruptionBudget</code> tiene tres atributos:</p><ul><li>Un label selector <code>.spec.selector</code> para especificar el grupo de
pods donde aplicar el presupuesto. Este campo es requerido.</li><li><code>.spec.minAvailable</code> que es una descripción del número de pods del grupo que deben estar disponibles después del desalojo, incluso en ausencia del pod desalojado. <code>minAvailable</code> puede ser un número absoluto o un porcentaje.</li><li><code>.spec.maxUnavailable</code> (disponible en Kubernetes 1.7 y superior) que es una descripción
del numero de pods del grupo que pueden estar indisponibles despues del desalojo. Puede ser un número absoluto o un porcentaje.</li></ul><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Para las versiones 1.8 y anteriores: al crear un <code>PodDisruptionBudget</code>
utilizando la herramienta de línea de comandos <code>kubectl</code>, el campo <code>minAvailable</code> es 1 por defecto si no se especifica <code>minAvailable</code> ni <code>maxUnavailable</code>.</div><p>Puedes especificar únicamente un valor para <code>maxUnavailable</code> y <code>minAvailable</code> por <code>PodDisruptionBudget</code>.
<code>maxUnavailable</code> solo se puede usar para controlar el desalojo de pods
que tienen un controlador asociado manejándolos. En los ejemplos a continuación, "réplicas deseadas"
hace referencia al valor 'scale' del controlador que gestiona el grupo de pods seleccionados por el
<code>PodDisruptionBudget</code>.</p><p>Ejemplo 1: Con un <code>minAvailable</code> de 5, se permiten los desalojos siempre que dejen
5 o más pods disponibles entre las seleccionadas por el <code>selector</code> del PodDisruptionBudget.</p><p>Ejemplo 2: Con un <code>minAvailable</code> del 30%, se permiten los desalojos mientras que al menos 30% de la cantidad de réplicas se mantengan disponibles.</p><p>Ejemplo 3: Con un <code>maxUnavailable</code> de 5, se permiten desalojos siempre que haya como máximo 5
réplicas indisponibles entre el número total de réplicas deseadas.</p><p>Ejemplo 4: Con un <code>maxUnavailable</code> de 30%, se permiten los desalojos siempre y cuando no más del 30%
de las réplicas esten indisponibles.</p><p>En el uso típico, se usaría un solo presupuesto para una colección de pods administrados por
un controlador, por ejemplo, los pods en un solo ReplicaSet o StatefulSet.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Un presupuesto de disrupción no garantiza que el número/porcentaje de pods especificado
siempre estarán disponibles. Por ejemplo, un nodo que alberga un
pod del grupo puede fallar cuando el grupo está en el tamaño mínimo
especificados en el presupuesto, lo que hace que el número de pods disponibles este por debajo del tamaño especificado. El presupuesto solo puede proteger contra
desalojos voluntarios, pero no todas las causas de indisponibilidad.</div><p>Un <code>maxUnavailable</code> de 0% (o 0) o un <code>minAvailable</code> de 100% (o igual al
número de réplicas) puede prevenir que los nodos sean purgados completamente.
Esto está permitido según la semántica de <code>PodDisruptionBudget</code>.</p><p>Puedes encontrar ejemplos de presupuestos de disrupción de pods definidas a continuación. Los ejemplos aplican al grupo de pods que tienen la etiqueta <code>app: zookeeper</code>.</p><p>Ejemplo de PDB usando minAvailable:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodDisruptionBudget<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>zk-pdb<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minAvailable</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>zookeeper<span style=color:#bbb>
</span></span></span></code></pre></div><p>Ejemplo de PDB usando maxUnavailable (Kubernetes 1.7 o superior):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodDisruptionBudget<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>zk-pdb<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>maxUnavailable</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>zookeeper<span style=color:#bbb>
</span></span></span></code></pre></div><p>Por ejemplo, si el objeto anterior <code>zk-pdb</code> selecciona los pods de un StatefulSet de tamaño 3, ambas
especificaciones tienen el mismo significado exacto. Se recomienda el uso de <code>maxUnavailable</code> ya que
responde automáticamente a los cambios en el número de réplicas del controlador correspondiente.</p><h2 id=crea-el-objeto-pdb>Crea el objeto PDB</h2><p>Puedes crear el objeto PDB con el comando <code>kubectl apply -f mypdb.yaml</code>.</p><p>No puedes actualizar objetos PDB. Deben ser eliminados y recreados.</p><h2 id=comprueba-el-estado-del-pdb>Comprueba el estado del PDB</h2><p>Utiliza kubectl para comprobar que se ha creado tu PDB.</p><p>Suponiendo que en realidad no tengas pods que coincidan con <code>app: zookeeper</code> en su namespace,
entonces verás algo como esto:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get poddisruptionbudgets
</span></span></code></pre></div><pre tabindex=0><code>NAME      MIN-AVAILABLE   ALLOWED-DISRUPTIONS   AGE
zk-pdb    2               0                     7s
</code></pre><p>Si hay pods que coinciden (por ejemplo, 3), entonces debes ver algo similar a esto:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get poddisruptionbudgets
</span></span></code></pre></div><pre tabindex=0><code>NAME      MIN-AVAILABLE   ALLOWED-DISRUPTIONS   AGE
zk-pdb    2               1                     7s
</code></pre><p>El valor distinto a cero de <code>ALLOWED-DISRUPTIONS</code> significa que el controlador de disrupción ha visto los pods, contó los pods coincidentes, y actualizó el estado del PDB.</p><p>Puedes obtener más información sobre el estado de un PDB con este comando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get poddisruptionbudgets zk-pdb -o yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodDisruptionBudget<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2017-08-28T02:38:26Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>generation</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>zk-pdb<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>currentHealthy</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>desiredHealthy</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>disruptedPods</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>disruptionsAllowed</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>expectedPods</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>observedGeneration</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Por último, los PodDisruptionBudgets también se pueden consultar con kubectl utilizando el nombre corto pdb:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pdb
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME      MIN-AVAILABLE   ALLOWED-DISRUPTIONS   AGE
</span></span><span style=display:flex><span>zk-pdb    <span style=color:#666>2</span>               <span style=color:#666>0</span>                     7s
</span></span></code></pre></div><h2 id=controladores-y-selectors-arbitrarios>Controladores y selectors arbitrarios</h2><p>Puedes omitir esta sección si solo utilizas PDBs con los controladores integrados de aplicaciones (Deployment, Replicationcontrolador, ReplicaSet y StatefulSet), con el selector de PDB coincidiendo con el selector del controlador.</p><p>Puedes utilizar un PDB con pods controlados por otro tipo de controlador, por un
"Operator", o pods individuales, pero con las siguientes restricciones:</p><ul><li>solo puedes usar <code>.spec.minAvailable</code>, no <code>.spec.maxUnavailable</code>.</li><li>solo puedes usar un número entero en <code>.spec.minAvailable</code>, no un porcentaje.</li></ul><p>Puedes usar un selector que selecciona un subconjunto o superconjunto de los pods que pertenecen a un controlador incorporado. Sin embargo, cuando hay varios PDB en un namespace, debes tener cuidado de no
crear PDBs cuyos selectores se superponen.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ba58efa15c6d46f10e34d799be220965>7 - Gestionar y ejecutar daemons</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-ca3bc4e31dfe46d5044a3b93eb804ee9>8 - Gestionar y ejecutar trabajos</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-b74b959f5a531003dd0653dfbfc2e88b>9 - Acceder al clúster y las aplicaciones</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-f6a755efe831d24956501e4bcd49ff96>10 - Monitorización, Logs y Debugging</h1></div><div class=td-content><h1 id=pg-cbd33a50cc4779f855318a0dd00d7b06>10.1 - Auditoría</h1><p>La auditoría de Kubernetes proporciona un conjunto de registros cronológicos referentes a la seguridad
que documentan la secuencia de actividades que tanto los usuarios individuales, como
los administradores y otros componentes del sistema ha realizado en el sistema.
Así, permite al administrador del clúster responder a las siguientes cuestiones:</p><ul><li>¿qué ha pasado?</li><li>¿cuándo ha pasado?</li><li>¿quién lo ha iniciado?</li><li>¿sobre qué ha pasado?</li><li>¿dónde se ha observado?</li><li>¿desde dónde se ha iniciado?</li><li>¿hacia dónde iba?</li></ul><p>El componente <a href=/docs/admin/kube-apiserver>Kube-apiserver</a> lleva a cabo la auditoría. Cada petición en cada fase
de su ejecución genera un evento, que se pre-procesa según un cierto reglamento y
se escribe en un backend. Este reglamento determina lo que se audita
y los backends persisten los registros. Las implementaciones actuales de backend
incluyen los archivos de logs y los webhooks.</p><p>Cada petición puede grabarse junto con una "etapa" asociada. Las etapas conocidas son:</p><ul><li><code>RequestReceived</code> - La etapa para aquellos eventos generados tan pronto como
el responsable de la auditoría recibe la petición, pero antes de que sea delegada al
siguiente responsable en la cadena.</li><li><code>ResponseStarted</code> - Una vez que las cabeceras de la respuesta se han enviado,
pero antes de que el cuerpo de la respuesta se envíe. Esta etapa sólo se genera
en peticiones de larga duración (ej. watch).</li><li><code>ResponseComplete</code> - El cuerpo de la respuesta se ha completado y no se enviarán más bytes.</li><li><code>Panic</code> - Eventos que se generan cuando ocurre una situación de pánico.</li></ul><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> La característica de registro de auditoría incrementa el consumo de memoria del servidor API
porque requiere de contexto adicional para lo que se audita en cada petición.
De forma adicional, el consumo de memoria depende de la configuración misma del registro.</div><h2 id=reglamento-de-auditoría>Reglamento de Auditoría</h2><p>El reglamento de auditoría define las reglas acerca de los eventos que deberían registrarse y
los datos que deberían incluir. La estructura del objeto de reglas de auditoría se define
en el <a href=https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apiserver/pkg/apis/audit/v1/types.go><code>audit.k8s.io</code> grupo de API</a>. Cuando se procesa un evento, se compara
con la lista de reglas en orden. La primera regla coincidente establece el "nivel de auditoría"
del evento. Los niveles de auditoría conocidos son:</p><ul><li><code>None</code> - no se registra eventos que disparan esta regla.</li><li><code>Metadata</code> - se registra los metadatos de la petición (usuario que la realiza, marca de fecha y hora, recurso,
verbo, etc.), pero no la petición ni el cuerpo de la respuesta.</li><li><code>Request</code> - se registra los metadatos del evento y el cuerpo de la petición, pero no el cuerpo de la respuesta.
Esto no aplica para las peticiones que no son de recurso.</li><li><code>RequestResponse</code> - se registra los metadatos del evento, y los cuerpos de la petición y la respuesta.
Esto no aplica para las peticiones que no son de recurso.</li></ul><p>Es posible indicar un archivo al definir el reglamento en el <a href=/docs/admin/kube-apiserver>kube-apiserver</a>
usando el parámetro <code>--audit-policy-file</code>. Si dicho parámetros se omite, no se registra ningún evento.
Nótese que el campo <code>rules</code> <strong>debe</strong> proporcionarse en el archivo del reglamento de auditoría.
Un reglamento sin (0) reglas se considera ilegal.</p><p>Abajo se presenta un ejemplo de un archivo de reglamento de auditoría:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/es/examples/audit/audit-policy.yaml download=audit/audit-policy.yaml><code>audit/audit-policy.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("audit-audit-policy-yaml")' title="Copy audit/audit-policy.yaml to clipboard"></img></div><div class=includecode id=audit-audit-policy-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>audit.k8s.io/v1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Esto es obligatorio.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Policy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># No generar eventos de auditoría para las peticiones en la etapa RequestReceived.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>omitStages</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#b44>&#34;RequestReceived&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>rules</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Registrar los cambios del pod al nivel RequestResponse</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>RequestResponse<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>group</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># Los recursos &#34;pods&#34; no hacen coincidir las peticiones a cualquier sub-recurso de pods,</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># lo que es consistente con la regla RBAC.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;pods&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Registrar &#34;pods/log&#34;, &#34;pods/status&#34; al nivel Metadata</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>Metadata<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>group</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;pods/log&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;pods/status&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># No registrar peticiones al configmap denominado &#34;controller-leader&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>None<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>group</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;configmaps&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resourceNames</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;controller-leader&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># No registrar peticiones de observación hechas por &#34;system:kube-proxy&#34; sobre puntos de acceso o servicios</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>None<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>users</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;system:kube-proxy&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>verbs</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;watch&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>group</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;&#34;</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Grupo API base</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;endpoints&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;services&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># No registrar peticiones autenticadas a ciertas rutas URL que no son recursos.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>None<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>userGroups</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;system:authenticated&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>nonResourceURLs</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;/api*&#34;</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Coincidencia por comodín.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;/version&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Registrar el cuerpo de la petición de los cambios de configmap en kube-system.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>Request<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>group</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;&#34;</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Grupo API base</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;configmaps&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Esta regla sólo aplica a los recursos en el Namespace &#34;kube-system&#34;.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># La cadena vacía &#34;&#34; se puede usar para seleccionar los recursos sin Namespace.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>namespaces</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;kube-system&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Registrar los cambios de configmap y secret en todos los otros Namespaces al nivel Metadata.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>Metadata<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>group</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;&#34;</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Grupo API base</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;secrets&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;configmaps&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Registrar todos los recursos en core y extensions al nivel Request.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>Request<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>group</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;&#34;</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Grupo API base</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>group</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;extensions&#34;</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># La versión del grupo NO debería incluirse.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Regla para &#34;cazar&#34; todos las demás peticiones al nivel Metadata.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>Metadata<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Las peticiones de larga duración, como los watches, que caen bajo esta regla no</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># generan un evento de auditoría en RequestReceived.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>omitStages</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#b44>&#34;RequestReceived&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Puedes usar un archivo mínimo de reglamento de auditoría para registrar todas las peticiones al nivel <code>Metadata</code> de la siguiente forma:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#080;font-style:italic># Log all requests at the Metadata level.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>audit.k8s.io/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Policy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>rules</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>Metadata<span style=color:#bbb>
</span></span></span></code></pre></div><p>El <a href=https://github.com/kubernetes/kubernetes/blob/master/cluster/gce/gci/configure-helper.sh#L735>perfil de auditoría utilizado por GCE</a> debería servir como referencia para
que los administradores construyeran sus propios perfiles de auditoría.</p><h2 id=backends-de-auditoría>Backends de auditoría</h2><p>Los backends de auditoría persisten los eventos de auditoría en un almacenamiento externo.
El <a href=/docs/admin/kube-apiserver>Kube-apiserver</a> por defecto proporciona tres backends:</p><ul><li>Backend de logs, que escribe los eventos en disco</li><li>Backend de webhook, que envía los eventos a una API externa</li><li>Backend dinámico, que configura backends de webhook a través de objetos de la API AuditSink.</li></ul><p>En todos los casos, la estructura de los eventos de auditoría se define por la API del grupo
<code>audit.k8s.io</code>. La versión actual de la API es
<a href=https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apiserver/pkg/apis/audit/v1/types.go><code>v1</code></a>.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong><p>En el caso de parches, el cuerpo de la petición es una matriz JSON con operaciones de parcheado, en vez
de un objeto JSON que incluya el objeto de la API de Kubernetes apropiado. Por ejemplo,
el siguiente cuerpo de mensaje es una petición de parcheado válida para
<code>/apis/batch/v1/namespaces/some-namespace/jobs/some-job-name</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;op&#34;</span>: <span style=color:#b44>&#34;replace&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;path&#34;</span>: <span style=color:#b44>&#34;/spec/parallelism&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;value&#34;</span>: <span style=color:#666>0</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;op&#34;</span>: <span style=color:#b44>&#34;remove&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;path&#34;</span>: <span style=color:#b44>&#34;/spec/template/spec/containers/0/terminationMessagePolicy&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div></div><h3 id=backend-de-logs>Backend de Logs</h3><p>El backend de logs escribe los eventos de auditoría a un archivo en formato JSON.
Puedes configurar el backend de logs de auditoría usando el siguiente
parámetro de <a href=/docs/admin/kube-apiserver>kube-apiserver</a> flags:</p><ul><li><code>--audit-log-path</code> especifica la ruta al archivo de log que el backend utiliza para
escribir los eventos de auditoría. Si no se especifica, se deshabilita el backend de logs. <code>-</code> significa salida estándar</li><li><code>--audit-log-maxage</code> define el máximo número de días a retener los archivos de log</li><li><code>--audit-log-maxbackup</code> define el máximo número de archivos de log a retener</li><li><code>--audit-log-maxsize</code> define el tamaño máximo en megabytes del archivo de logs antes de ser rotado</li></ul><h3 id=backend-de-webhook>Backend de Webhook</h3><p>El backend de Webhook envía eventos de auditoría a una API remota, que se supone es la misma API
que expone el <a href=/docs/admin/kube-apiserver>kube-apiserver</a>. Puedes configurar el backend de webhook de auditoría usando
los siguientes parámetros de kube-apiserver:</p><ul><li><code>--audit-webhook-config-file</code> especifica la ruta a un archivo con configuración del webhook.
La configuración del webhook es, de hecho, un archivo <a href=/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>kubeconfig</a>.</li><li><code>--audit-webhook-initial-backoff</code> especifica la cantidad de tiempo a esperar tras una petición fallida
antes de volver a intentarla. Los reintentos posteriores se ejecutan con retraso exponencial.</li></ul><p>El archivo de configuración del webhook usa el formato kubeconfig para especificar la dirección remota
del servicio y las credenciales para conectarse al mismo.</p><p>En la versión 1.13, los backends de webhook pueden configurarse <a href=#dynamic-backend>dinámicamente</a>.</p><h3 id=procesamiento-por-lotes>Procesamiento por lotes</h3><p>Tanto el backend de logs como el de webhook permiten procesamiento por lotes. Si usamos el webhook como ejemplo,
aquí se muestra la lista de parámetros disponibles. Para aplicar el mismo parámetro al backend de logs,
simplemente sustituye <code>webhook</code> por <code>log</code> en el nombre del parámetro. Por defecto,
el procesimiento por lotes está habilitado en <code>webhook</code> y deshabilitado en <code>log</code>. De forma similar,
por defecto la regulación (throttling) está habilitada en <code>webhook</code> y deshabilitada en <code>log</code>.</p><ul><li><code>--audit-webhook-mode</code> define la estrategia de memoria intermedia (búfer), que puede ser una de las siguientes:<ul><li><code>batch</code> - almacenar eventos y procesarlos de forma asíncrona en lotes. Esta es la estrategia por defecto.</li><li><code>blocking</code> - bloquear todas las respuestas del servidor API al procesar cada evento de forma individual.</li><li><code>blocking-strict</code> - igual que blocking, pero si ocurre un error durante el registro de la audtoría en la etapa RequestReceived, la petición completa al apiserver fallará.</li></ul></li></ul><p>Los siguientes parámetros se usan únicamente en el modo <code>batch</code>:</p><ul><li><code>--audit-webhook-batch-buffer-size</code> define el número de eventos a almacenar de forma intermedia antes de procesar por lotes.
Si el ritmo de eventos entrantes desborda la memoria intermedia, dichos eventos se descartan.</li><li><code>--audit-webhook-batch-max-size</code> define el número máximo de eventos en un único proceso por lotes.</li><li><code>--audit-webhook-batch-max-wait</code> define la cantidad máxima de tiempo a esperar de forma incondicional antes de procesar los eventos de la cola.</li><li><code>--audit-webhook-batch-throttle-qps</code> define el promedio máximo de procesos por lote generados por segundo.</li><li><code>--audit-webhook-batch-throttle-burst</code> define el número máximo de procesos por lote generados al mismo tiempo si el QPS permitido no fue usado en su totalidad anteriormente.</li></ul><h4 id=ajuste-de-parámetros>Ajuste de parámetros</h4><p>Los parámetros deberían ajustarse a la carga del apiserver.</p><p>Por ejemplo, si kube-apiserver recibe 100 peticiones por segundo, y para cada petición se audita
las etapas <code>ResponseStarted</code> y <code>ResponseComplete</code>, deberías esperar unos ~200
eventos de auditoría generados por segundo. Asumiendo que hay hasta 100 eventos en un lote,
deberías establecer el nivel de regulación (throttling) por lo menos a 2 QPS. Además, asumiendo
que el backend puede tardar hasta 5 segundos en escribir eventos, deberías configurar el tamaño de la memoria intermedia para almacenar hasta 5 segundos de eventos, esto es,
10 lotes, o sea, 1000 eventos.</p><p>En la mayoría de los casos, sin embargo, los valores por defecto de los parámetros
deberían ser suficientes y no deberías preocuparte de ajustarlos manualmente.
Puedes echar un vistazo a la siguientes métricas de Prometheus que expone kube-apiserver
y también los logs para monitorizar el estado del subsistema de auditoría:</p><ul><li><code>apiserver_audit_event_total</code> métrica que contiene el número total de eventos de auditoría exportados.</li><li><code>apiserver_audit_error_total</code> métrica que contiene el número total de eventos descartados debido a un error durante su exportación.</li></ul><h3 id=truncado>Truncado</h3><p>Tanto el backend de logs como el de webhook permiten truncado. Como ejemplo, aquí se indica la
lista de parámetros disponible para el backend de logs:</p><ul><li><code>audit-log-truncate-enabled</code> indica si el truncado de eventos y por lotes está habilitado.</li><li><code>audit-log-truncate-max-batch-size</code> indica el tamaño máximo en bytes del lote enviado al backend correspondiente.</li><li><code>audit-log-truncate-max-event-size</code> indica el tamaño máximo en bytes del evento de auditoría enviado al backend correspondiente.</li></ul><p>Por defecto, el truncado está deshabilitado tanto en <code>webhook</code> como en <code>log</code>; un administrador del clúster debe configurar bien el parámetro <code>audit-log-truncate-enabled</code> o <code>audit-webhook-truncate-enabled</code> para habilitar esta característica.</p><h3 id=backend-dinámico>Backend dinámico</h3><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.13 [alpha]</code></div><p>En la versión 1.13 de Kubernetes, puedes configurar de forma dinámica los backends de auditoría usando objetos de la API AuditSink.</p><p>Para habilitar la auditoría dinámica, debes configurar los siguientes parámetros de apiserver:</p><ul><li><code>--audit-dynamic-configuration</code>: el interruptor principal. Cuando esta característica sea GA, el único parámetro necesario.</li><li><code>--feature-gates=DynamicAuditing=true</code>: en evaluación en alpha y beta.</li><li><code>--runtime-config=auditregistration.k8s.io/v1alpha1=true</code>: habilitar la API.</li></ul><p>Cuando se habilita, un objeto AuditSink se provisiona de la siguiente forma:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>auditregistration.k8s.io/v1alpha1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>AuditSink<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>mysink<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>policy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span>Metadata<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>stages</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- ResponseComplete<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>webhook</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>throttle</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>qps</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>burst</span>:<span style=color:#bbb> </span><span style=color:#666>15</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>clientConfig</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>url</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;https://audit.app&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Para una definición completa de la API, ver <a href=/docs/reference/generated/kubernetes-api/v1.13/#auditsink-v1alpha1-auditregistration>AuditSink</a>. Múltiples objetos existirán como soluciones independientes.</p><p>Aquellos backends estáticos que se configuran con parámetros en tiempo de ejecución no se ven impactados por esta característica.
Sin embargo, estos backends dinámicos comparten las opciones de truncado del webhook estático, de forma que si dichas opciones se configura con parámetros en tiempo de ejecución, entonces se aplican a todos los backends dinámicos.</p><h4 id=reglamento>Reglamento</h4><p>El reglamento de AuditSink es diferente del de la auditoría en tiempo de ejecución. Esto es debido a que el objeto de la API sirve para casos de uso diferentes. El reglamento continuará
evolucionando para dar cabida a más casos de uso.</p><p>El campo <code>level</code> establece el nivel de auditoría indicado a todas las peticiones. El campo <code>stages</code> es actualmente una lista de las etapas que se permite registrar.</p><h4 id=seguridad>Seguridad</h4><p>Los administradores deberían tener en cuenta que permitir el acceso en modo escritura de esta característica otorga el modo de acceso de lectura
a toda la información del clúster. Así, el acceso debería gestionarse como un privilegio de nivel <code>cluster-admin</code>.</p><h4 id=rendimiento>Rendimiento</h4><p>Actualmente, esta característica tiene implicaciones en el apiserver en forma de incrementos en el uso de la CPU y la memoria.
Aunque debería ser nominal cuando se trata de un número pequeño de destinos, se realizarán pruebas adicionales de rendimiento para entender su impacto real antes de que esta API pase a beta.</p><h2 id=configuración-multi-clúster>Configuración multi-clúster</h2><p>Si estás extendiendo la API de Kubernetes mediante la <a href=/docs/concepts/api-extension/apiserver-aggregation>capa de agregación</a>, puedes también
configurar el registro de auditoría para el apiserver agregado. Para ello, pasa las opciones
de configuración en el mismo formato que se describe arriba al apiserver agregado
y configura el mecanismo de ingestión de logs para que recolecte los logs de auditoría.
Cada uno de los apiservers puede tener configuraciones de auditoría diferentes con
diferentes reglamentos de auditoría.</p><h2 id=ejemplos-de-recolectores-de-logs>Ejemplos de recolectores de Logs</h2><h3 id=uso-de-fluentd-para-recolectar-y-distribuir-eventos-de-auditoría-a-partir-de-un-archivo-de-logs>Uso de fluentd para recolectar y distribuir eventos de auditoría a partir de un archivo de logs</h3><p><a href=http://www.fluentd.org/>Fluentd</a> es un recolector de datos de libre distribución que proporciona una capa unificada de registros.
En este ejemplo, usaremos fluentd para separar los eventos de auditoría por nombres de espacio:</p><ol><li><p>Instala <a href=https://docs.fluentd.org/v1.0/articles/quickstart#step-1:-installing-fluentd>fluentd</a>, fluent-plugin-forest y fluent-plugin-rewrite-tag-filter en el nodo donde corre kube-apiserver<div class="alert alert-info note callout" role=alert><strong>Nota:</strong> Fluent-plugin-forest y fluent-plugin-rewrite-tag-filter son plugins de fluentd. Puedes obtener detalles de la instalación de estos plugins en el documento [fluentd plugin-management][fluentd_plugin_management_doc].</div></p></li><li><p>Crea un archivo de configuración para fluentd:</p><pre tabindex=0><code>cat &lt;&lt;&#39;EOF&#39; &gt; /etc/fluentd/config
# fluentd conf runs in the same host with kube-apiserver
&lt;source&gt;
    @type tail
    # audit log path of kube-apiserver
    path /var/log/kube-audit
    pos_file /var/log/audit.pos
    format json
    time_key time
    time_format %Y-%m-%dT%H:%M:%S.%N%z
    tag audit
&lt;/source&gt;

&lt;filter audit&gt;
    #https://github.com/fluent/fluent-plugin-rewrite-tag-filter/issues/13
    @type record_transformer
    enable_ruby
    &lt;record&gt;
     namespace ${record[&#34;objectRef&#34;].nil? ? &#34;none&#34;:(record[&#34;objectRef&#34;][&#34;namespace&#34;].nil? ? &#34;none&#34;:record[&#34;objectRef&#34;][&#34;namespace&#34;])}
    &lt;/record&gt;
&lt;/filter&gt;

&lt;match audit&gt;
    # route audit according to namespace element in context
    @type rewrite_tag_filter
    &lt;rule&gt;
        key namespace
        pattern /^(.+)/
        tag ${tag}.$1
    &lt;/rule&gt;
&lt;/match&gt;

&lt;filter audit.**&gt;
   @type record_transformer
   remove_keys namespace
&lt;/filter&gt;

&lt;match audit.**&gt;
    @type forest
    subtype file
    remove_prefix audit
    &lt;template&gt;
        time_slice_format %Y%m%d%H
        compress gz
        path /var/log/audit-${tag}.*.log
        format json
        include_time_key true
    &lt;/template&gt;
&lt;/match&gt;
EOF
</code></pre></li><li><p>Arranca fluentd:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>fluentd -c /etc/fluentd/config  -vv
</span></span></code></pre></div></li><li><p>Arranca el componente kube-apiserver con las siguientes opciones:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>--audit-policy-file<span style=color:#666>=</span>/etc/kubernetes/audit-policy.yaml --audit-log-path<span style=color:#666>=</span>/var/log/kube-audit --audit-log-format<span style=color:#666>=</span>json
</span></span></code></pre></div></li><li><p>Comprueba las auditorías de los distintos espacios de nombres en <code>/var/log/audit-*.log</code></p></li></ol><h3 id=uso-de-logstash-para-recolectar-y-distribuir-eventos-de-auditoría-desde-un-backend-de-webhook>Uso de logstash para recolectar y distribuir eventos de auditoría desde un backend de webhook</h3><p><a href=https://www.elastic.co/products/logstash>Logstash</a> es una herramienta de libre distribución de procesamiento de datos en servidor.
En este ejemplo, vamos a usar logstash para recolectar eventos de auditoría a partir de un backend de webhook,
y grabar los eventos de usuarios diferentes en archivos distintos.</p><ol><li><p>Instala <a href=https://www.elastic.co/guide/en/logstash/current/installing-logstash.html>logstash</a></p></li><li><p>Crea un archivo de configuración para logstash:</p><pre tabindex=0><code>cat &lt;&lt;EOF &gt; /etc/logstash/config
input{
    http{
        #TODO, figure out a way to use kubeconfig file to authenticate to logstash
        #https://www.elastic.co/guide/en/logstash/current/plugins-inputs-http.html#plugins-inputs-http-ssl
        port=&gt;8888
    }
}
filter{
    split{
        # Webhook audit backend sends several events together with EventList
        # split each event here.
        field=&gt;[items]
        # We only need event subelement, remove others.
        remove_field=&gt;[headers, metadata, apiVersion, &#34;@timestamp&#34;, kind, &#34;@version&#34;, host]
    }
    mutate{
        rename =&gt; {items=&gt;event}
    }
}
output{
    file{
        # Audit events from different users will be saved into different files.
        path=&gt;&#34;/var/log/kube-audit-%{[event][user][username]}/audit&#34;
    }
}
EOF
</code></pre></li><li><p>Arranca logstash:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bin/logstash -f /etc/logstash/config --path.settings /etc/logstash/
</span></span></code></pre></div></li><li><p>Crea un <a href=/docs/tasks/access-application-cluster/authenticate-across-clusters-kubeconfig/>archivo kubeconfig</a> para el webhook del backend de auditoría de kube-apiserver:</p><pre><code> cat &lt;&lt;EOF &gt; /etc/kubernetes/audit-webhook-kubeconfig
 apiVersion: v1
 clusters:
 - cluster:
     server: http://&lt;ip_of_logstash&gt;:8888
   name: logstash
 contexts:
 - context:
     cluster: logstash
     user: &quot;&quot;
   name: default-context
 current-context: default-context
 kind: Config
 preferences: {}
 users: []
 EOF
</code></pre></li><li><p>Arranca kube-apiserver con las siguientes opciones:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>--audit-policy-file<span style=color:#666>=</span>/etc/kubernetes/audit-policy.yaml --audit-webhook-config-file<span style=color:#666>=</span>/etc/kubernetes/audit-webhook-kubeconfig
</span></span></code></pre></div></li><li><p>Comprueba las auditorías en los directorios <code>/var/log/kube-audit-*/audit</code> de los nodos de logstash</p></li></ol><p>Nótese que además del plugin para salida en archivos, logstash ofrece una variedad de salidas adicionales
que permiten a los usuarios enviar la información donde necesiten. Por ejemplo, se puede enviar los eventos de auditoría
al plugin de elasticsearch que soporta búsquedas avanzadas y analíticas.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-06bb252f25983de12f635c806d180d30>10.2 - Depurar Contenedores de Inicialización</h1><p>Esta página muestra cómo investigar problemas relacionados con la ejecución
de los contenedores de inicialización (init containers). Las líneas de comando del ejemplo de abajo
se refieren al Pod como <code>&lt;pod-name></code> y a los Init Containers como <code>&lt;init-container-1></code> e
<code>&lt;init-container-2></code> respectivamente.</p><h2 id=antes-de-empezar>Antes de empezar</h2><p><p>Debes tener un cluster Kubernetes a tu dispocición, y la herramienta de línea de comandos <code>kubectl</code> debe estar configurada. Si no tienes un cluster, puedes crear uno utilizando <a href=/docs/setup/minikube>Minikube</a>,
o puedes utilizar una de las siguientes herramientas en línea:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li></ul>Para comprobar la versión, introduzca <code>kubectl version</code>.</p><ul><li>Deberías estar familizarizado con el concepto de <a href=/docs/concepts/abstractions/init-containers/>Init Containers</a>.</li><li>Deberías conocer la <a href=/docs/tasks/configure-pod-container/configure-pod-initialization/#creating-a-pod-that-has-an-init-container/>Configuración de un Init Container</a>.</li></ul><h2 id=comprobar-el-estado-de-los-init-containers>Comprobar el estado de los Init Containers</h2><p>Muestra el estado de tu pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod &lt;pod-name&gt;
</span></span></code></pre></div><p>Por ejemplo, un estado de <code>Init:1/2</code> indica que uno de los Init Containers
se ha ejecutado satisfactoriamente:</p><pre tabindex=0><code>NAME         READY     STATUS     RESTARTS   AGE
&lt;pod-name&gt;   0/1       Init:1/2   0          7s
</code></pre><p>Echa un vistazo a <a href=#understanding-pod-status>Comprender el estado de un Pod</a> para más ejemplos
de valores de estado y sus significados.</p><h2 id=obtener-detalles-acerca-de-los-init-containers>Obtener detalles acerca de los Init Containers</h2><p>Para ver información detallada acerca de la ejecución de un Init Container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe pod &lt;pod-name&gt;
</span></span></code></pre></div><p>Por ejemplo, un Pod con dos Init Containers podría mostrar lo siguiente:</p><pre tabindex=0><code>Init Containers:
  &lt;init-container-1&gt;:
    Container ID:    ...
    ...
    State:           Terminated
      Reason:        Completed
      Exit Code:     0
      Started:       ...
      Finished:      ...
    Ready:           True
    Restart Count:   0
    ...
  &lt;init-container-2&gt;:
    Container ID:    ...
    ...
    State:           Waiting
      Reason:        CrashLoopBackOff
    Last State:      Terminated
      Reason:        Error
      Exit Code:     1
      Started:       ...
      Finished:      ...
    Ready:           False
    Restart Count:   3
    ...
</code></pre><p>También puedes acceder al estado del Init Container de forma programática mediante
la lectura del campo <code>status.initContainerStatuses</code> dentro del Pod Spec:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod nginx --template <span style=color:#b44>&#39;{{.status.initContainerStatuses}}&#39;</span>
</span></span></code></pre></div><p>Este comando devolverá la misma información que arriba en formato JSON.</p><h2 id=acceder-a-los-logs-de-los-init-containers>Acceder a los logs de los Init Containers</h2><p>Indica el nombre del Init Container así como el nombre del Pod para
acceder a sus logs.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl logs &lt;pod-name&gt; -c &lt;init-container-2&gt;
</span></span></code></pre></div><p>Los Init Containers que ejecutan secuencias de línea de comandos muestran los comandos
conforme se van ejecutando. Por ejemplo, puedes hacer lo siguiente en Bash
indicando <code>set -x</code> al principio de la secuencia.</p><h2 id=comprender-el-estado-de-un-pod>Comprender el estado de un Pod</h2><p>Un estado de un Pod que comienza con <code>Init:</code> especifica el estado de la ejecución de
un Init Container. La tabla a continuación muestra algunos valores de estado de ejemplo
que puedes encontrar al depurar Init Containers.</p><table><thead><tr><th>Estado</th><th>Significado</th></tr></thead><tbody><tr><td><code>Init:N/M</code></td><td>El Pod tiene <code>M</code> Init Containers, y por el momento se han completado <code>N</code>.</td></tr><tr><td><code>Init:Error</code></td><td>Ha fallado la ejecución de un Init Container.</td></tr><tr><td><code>Init:CrashLoopBackOff</code></td><td>Un Init Container ha fallado de forma repetida.</td></tr><tr><td><code>Pending</code></td><td>El Pod todavía no ha comenzado a ejecutar sus Init Containers.</td></tr><tr><td><code>PodInitializing</code> o <code>Running</code></td><td>El Pod ya ha terminado de ejecutar sus Init Containers.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-c66e72f8378fe1ded545373488749822>10.3 - Escribiendo Logs con Elasticsearch y Kibana</h1><p>En la plataforma Google Compute Engine (GCE), por defecto da soporte a la escritura de logs haciendo uso de
<a href=https://cloud.google.com/logging/>Stackdriver Logging</a>, el cual se describe en detalle en <a href=/docs/user-guide/logging/stackdriver>Logging con Stackdriver Logging</a>.</p><p>Este artículo describe cómo configurar un clúster para la ingesta de logs en
<a href=https://www.elastic.co/products/elasticsearch>Elasticsearch</a> y su posterior visualización
con <a href=https://www.elastic.co/products/kibana>Kibana</a>, a modo de alternativa a
Stackdriver Logging cuando se utiliza la plataforma GCE.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> No se puede desplegar de forma automática Elasticsearch o Kibana en un clúster alojado en Google Kubernetes Engine. Hay que desplegarlos de forma manual.</div><p>Para utilizar Elasticsearch y Kibana para escritura de logs del clúster, deberías configurar
la siguiente variable de entorno que se muestra a continuación como parte de la creación
del clúster con kube-up.sh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>KUBE_LOGGING_DESTINATION</span><span style=color:#666>=</span>elasticsearch
</span></span></code></pre></div><p>También deberías asegurar que <code>KUBE_ENABLE_NODE_LOGGING=true</code> (que es el valor por defecto en la plataforma GCE).</p><p>Así, cuando crees un clúster, un mensaje te indicará que la recolección de logs de los daemons de Fluentd
que corren en cada nodo enviará dichos logs a Elasticsearch:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cluster/kube-up.sh
</span></span></code></pre></div><pre tabindex=0><code>...
Project: kubernetes-satnam
Zone: us-central1-b
... calling kube-up
Project: kubernetes-satnam
Zone: us-central1-b
+++ Staging server tars to Google Storage: gs://kubernetes-staging-e6d0e81793/devel
+++ kubernetes-server-linux-amd64.tar.gz uploaded (sha1 = 6987c098277871b6d69623141276924ab687f89d)
+++ kubernetes-salt.tar.gz uploaded (sha1 = bdfc83ed6b60fa9e3bff9004b542cfc643464cd0)
Looking for already existing resources
Starting master and configuring firewalls
Created [https://www.googleapis.com/compute/v1/projects/kubernetes-satnam/zones/us-central1-b/disks/kubernetes-master-pd].
NAME                 ZONE          SIZE_GB TYPE   STATUS
kubernetes-master-pd us-central1-b 20      pd-ssd READY
Created [https://www.googleapis.com/compute/v1/projects/kubernetes-satnam/regions/us-central1/addresses/kubernetes-master-ip].
+++ Logging using Fluentd to elasticsearch
</code></pre><p>Tanto los pods por nodo de Fluentd, como los pods de Elasticsearch, y los pods de Kibana
deberían ejecutarse en el namespace de kube-system inmediatamente después
de que el clúster esté disponible.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods --namespace<span style=color:#666>=</span>kube-system
</span></span></code></pre></div><pre tabindex=0><code>NAME                                           READY     STATUS    RESTARTS   AGE
elasticsearch-logging-v1-78nog                 1/1       Running   0          2h
elasticsearch-logging-v1-nj2nb                 1/1       Running   0          2h
fluentd-elasticsearch-kubernetes-node-5oq0     1/1       Running   0          2h
fluentd-elasticsearch-kubernetes-node-6896     1/1       Running   0          2h
fluentd-elasticsearch-kubernetes-node-l1ds     1/1       Running   0          2h
fluentd-elasticsearch-kubernetes-node-lz9j     1/1       Running   0          2h
kibana-logging-v1-bhpo8                        1/1       Running   0          2h
kube-dns-v3-7r1l9                              3/3       Running   0          2h
monitoring-heapster-v4-yl332                   1/1       Running   1          2h
monitoring-influx-grafana-v1-o79xf             2/2       Running   0          2h
</code></pre><p>Los pods de <code>fluentd-elasticsearch</code> recogen los logs de cada nodo y los envían a los
pods de <code>elasticsearch-logging</code>, que son parte de un <a href=/docs/concepts/services-networking/service/>servicio</a> llamado <code>elasticsearch-logging</code>.
Estos pods de Elasticsearch almacenan los logs y los exponen via una API REST.
El pod de <code>kibana-logging</code> proporciona una UI via web donde leer los logs almacenados en
Elasticsearch, y es parte de un servicio denominado <code>kibana-logging</code>.</p><p>Los servicios de Elasticsearch y Kibana ambos están en el namespace <code>kube-system</code>
y no se exponen de forma directa mediante una IP accesible públicamente. Para poder acceder a dichos logs,
sigue las instrucciones acerca de cómo <a href=/docs/concepts/cluster-administration/access-clusater/#accessing-services-running-on-the-cluster>Acceder a servicios corriendo en un clúster</a>.</p><p>Si tratas de acceder al servicio de <code>elasticsearch-logging</code> desde tu navegador,
verás una página de estado que se parece a la siguiente:</p><p><img src=/images/docs/es-browser.png alt="Estado de Elasticsearch"></p><p>A partir de ese momento, puedes introducir consultas de Elasticsearch directamente en el navegador, si lo necesitas.
Echa un vistazo a la <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/search-uri-request.html>documentación de Elasticsearch</a>
para más detalles acerca de cómo hacerlo.</p><p>De forma alternativa, puedes ver los logs de tu clúster en Kibana (de nuevo usando las
<a href=/docs/user-guide/accessing-the-cluster/#accessing-services-running-on-the-cluster>instrucciones para acceder a un servicio corriendo en un clúster</a>).
La primera vez que visitas la URL de Kibana se te presentará una página que te pedirá
que configures una vista de los logs. Selecciona la opción de valores de serie temporal
y luego <code>@timestamp</code>. En la página siguiente selecciona la pestaña de <code>Discover</code>
y entonces deberías ver todos los logs. Puedes establecer el intervalo de actualización
en 5 segundos para refrescar los logs de forma regular.</p><p>Aquí se muestra una vista típica de logs desde el visor de Kibana:</p><p><img src=/images/docs/kibana-logs.png alt="Kibana logs"></p><h2 id=siguientes-pasos>Siguientes pasos</h2><p>¡Kibana te permite todo tipo de potentes opciones para explorar tus logs! Puedes encontrar
algunas ideas para profundizar en el tema en la <a href=https://www.elastic.co/guide/en/kibana/current/discover.html>documentación de Kibana</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-96b25d30e732385047272b84d3c4188f>10.4 - Pipeline de métricas de recursos</h1><p>Desde Kubernetes 1.8, las métricas de uso de recursos, tales como el uso de CPU y memoria del contenedor,
están disponibles en Kubernetes a través de la API de métricas. Estas métricas son accedidas directamente
por el usuario, por ejemplo usando el comando <code>kubectl top</code>, o usadas por un controlador en el cluster,
por ejemplo el Horizontal Pod Autoscaler, para la toma de decisiones.</p><h2 id=la-api-de-métricas>La API de Métricas</h2><p>A través de la API de métricas, Metrics API en inglés, puedes obtener la cantidad de recursos usados
actualmente por cada nodo o pod. Esta API no almacena los valores de las métricas,
así que no es posible, por ejemplo, obtener la cantidad de recursos que fueron usados por
un nodo hace 10 minutos.</p><p>La API de métricas está completamente integrada en la API de Kubernetes:</p><ul><li>se expone a través del mismo endpoint que las otras APIs de Kubernetes bajo el path <code>/apis/metrics.k8s.io/</code></li><li>ofrece las mismas garantías de seguridad, escalabilidad y confiabilidad</li></ul><p>La API está definida en el repositorio <a href=https://github.com/kubernetes/metrics/blob/master/pkg/apis/metrics/v1beta1/types.go>k8s.io/metrics</a>. Puedes encontrar
más información sobre la API ahí.</p><div class="alert alert-info note callout" role=alert><strong>Nota:</strong> La API requiere que el servidor de métricas esté desplegado en el clúster. En otro caso no estará
disponible.</div><h2 id=servidor-de-métricas>Servidor de Métricas</h2><p>El <a href=https://github.com/kubernetes-incubator/metrics-server>Servidor de Métricas</a> es un agregador
de datos de uso de recursos de todo el clúster.
A partir de Kubernetes 1.8, el servidor de métricas se despliega por defecto como un objeto de
tipo <a href=https://github.com/docs/concepts/workloads/controllers/deployment/>Deployment</a> en clústeres
creados con el script <code>kube-up.sh</code>. Si usas otro mecanismo de configuración de Kubernetes, puedes desplegarlo
usando los <a href=https://github.com/kubernetes-sigs/metrics-server/releases>yamls de despliegue</a>
proporcionados. Está soportado a partir de Kubernetes 1.7 (más detalles al final).</p><p>El servidor reune métricas de la Summary API, que es expuesta por el <a href=/docs/admin/kubelet/>Kubelet</a> en cada nodo.</p><p>El servidor de métricas se añadió a la API de Kubernetes utilizando el
<a href=/docs/concepts/api-extension/apiserver-aggregation/>Kubernetes aggregator</a> introducido en Kubernetes 1.7.</p><p>Puedes aprender más acerca del servidor de métricas en el <a href=https://github.com/kubernetes/design-proposals-archive/blob/main/instrumentation/metrics-server.md>documento de diseño</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fd78dc15c135dedc24438431769d4d5b>11 - Extender la API de Kubernetes</h1></div><div class=td-content><h1 id=pg-5b9d7df11699e8cb1a5a4414ff770efe>11.1 - Usar recursos personalizados</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-d3c88a8663f58e9ec0bed73faff5b670>12 - Gestionar certificados TLS</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-40e9293a348cfa50147082afc09ff77f>13 - Federación</h1></div><div class=td-content><h1 id=pg-b61e5206fb2a30cabe2857ed4aaf7944>13.1 - Administrar la federación de clústeres</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-5266308e17490aeee8b018316bf47e03>14 - Catálogo de servicios</h1></div></main></div></div><footer class=d-print-none><div class=footer__links><nav><a class=text-white href=/es/docs/home/>Home</a>
<a class=text-white href=/es/blog/>Blog</a>
<a class=text-white href=/es/partners/>Partners</a>
<a class=text-white href=/es/community/>Comunidad</a>
<a class=text-white href=/es/case-studies/>Casos de éxito</a></nav></div><div class=container-fluid><div class=row><div class="col-6 col-sm-2 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank href=https://discuss.kubernetes.io><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank href=https://twitter.com/kubernetesio><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar><a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io"><i class="fas fa-calendar-alt"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank href=https://youtube.com/kubernetescommunity><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-2 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank href=https://slack.k8s.io><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute><a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide><i class="fas fa-edit"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-12 col-sm-8 text-center order-sm-2"><small class=text-white>&copy; 2023 Los autores de Kubernetes | Documentación distribuida bajo <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small><br><small class=text-white>Copyright &copy; 2023 The Linux Foundation &reg;. Todos los derechos reservados. The Linux Foundation tiene marcas registradas y utiliza marcas registradas. Para obtener una lista de marcas registradas por The Linux Foundation, visita <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>Trademark Usage page</a></small><br><small class=text-white>ICP license: 京ICP备17074266号-3</small></div></div></div></footer></div><script src=/js/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=/js/popper-1.16.1.min.js intregrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=/js/bootstrap-4.6.1.min.js integrity=sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2 crossorigin=anonymous></script>
<script src=/js/script.js></script>
<script async src=/js/mermaid-8.13.4.min.js integrity=sha384-5hHNvPeMrNH14oM3IcQofDoBhiclNK3g2+hnEinKzQ07C4AliMeVpnvxuiwEGpaO crossorigin=anonymous></script>
<script src=/js/main.min.5c0bf7f21dc4f66485f74efbbeeff28a7e4f8cddaac1bae47043159c922ff3a3.js integrity="sha256-XAv38h3E9mSF9077vu/yin5PjN2qwbrkcEMVnJIv86M=" crossorigin=anonymous></script></body></html>