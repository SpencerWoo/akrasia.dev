<!doctype html><html lang=id class=no-js><head><meta name=robots content="noindex, nofollow"><link rel=alternate hreflang=en href=https://kubernetes.io/docs/tasks/><link rel=alternate hreflang=zh-cn href=https://kubernetes.io/zh-cn/docs/tasks/><link rel=alternate hreflang=ko href=https://kubernetes.io/ko/docs/tasks/><link rel=alternate hreflang=ja href=https://kubernetes.io/ja/docs/tasks/><link rel=alternate hreflang=fr href=https://kubernetes.io/fr/docs/tasks/><link rel=alternate hreflang=de href=https://kubernetes.io/de/docs/tasks/><link rel=alternate hreflang=es href=https://kubernetes.io/es/docs/tasks/><link rel=alternate hreflang=pt-br href=https://kubernetes.io/pt-br/docs/tasks/><link rel=alternate hreflang=hi href=https://kubernetes.io/hi/docs/tasks/><link rel=alternate hreflang=pl href=https://kubernetes.io/pl/docs/tasks/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://kubernetes.io/id/docs/tasks/><link rel="shortcut icon" type=image/png href=/images/favicon.png><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon href=/images/kubernetes-192x192.png><title>Tugas | Kubernetes</title><meta property="og:title" content="Tugas"><meta property="og:description" content="Orkestrasi Kontainer dengan Skala Produksi"><meta property="og:type" content="website"><meta property="og:url" content="https://kubernetes.io/id/docs/tasks/"><meta property="og:site_name" content="Kubernetes"><meta itemprop=name content="Tugas"><meta itemprop=description content="Orkestrasi Kontainer dengan Skala Produksi"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tugas"><meta name=twitter:description content="Orkestrasi Kontainer dengan Skala Produksi"><link href=/scss/main.css rel=stylesheet><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png","potentialAction":{"@type":"SearchAction","target":"https://kubernetes.io/search/?q={search_term_string}","query-input":"required name=search_term_string"}}</script><meta name=theme-color content="#326ce5"><link rel=stylesheet href=/css/feature-states.css><meta name=description content="Antarmuka Pengguna Berbasis Web (Dashboard) Menggunakan Baris Perintah kubectl Mengkonfigurasi Pod dan Container Menjalankan Aplikasi Menjalankan Job Mengakses Aplikasi dalam Klaster Monitoring, Logging, dan Debugging Mengakses API Kubernetes Menggunakan TLS Mengelola Klaster Mengelola Aplikasi yang Stateful Daemon Klaster Mengelola GPU Mengelola HugePages Selanjutnya Bagian dokumentasi Kubernetes ini berisi halaman-halaman yang perlihatkan bagaimana melakukan setiap tugas (task). Halaman tugas menunjukkan cara melakukan satu hal saja, biasanya dengan memberikan urutan langkah pendek."><meta property="og:description" content="Antarmuka Pengguna Berbasis Web (Dashboard) Menggunakan Baris Perintah kubectl Mengkonfigurasi Pod dan Container Menjalankan Aplikasi Menjalankan Job Mengakses Aplikasi dalam Klaster Monitoring, Logging, dan Debugging Mengakses API Kubernetes Menggunakan TLS Mengelola Klaster Mengelola Aplikasi yang Stateful Daemon Klaster Mengelola GPU Mengelola HugePages Selanjutnya Bagian dokumentasi Kubernetes ini berisi halaman-halaman yang perlihatkan bagaimana melakukan setiap tugas (task). Halaman tugas menunjukkan cara melakukan satu hal saja, biasanya dengan memberikan urutan langkah pendek."><meta name=twitter:description content="Antarmuka Pengguna Berbasis Web (Dashboard) Menggunakan Baris Perintah kubectl Mengkonfigurasi Pod dan Container Menjalankan Aplikasi Menjalankan Job Mengakses Aplikasi dalam Klaster Monitoring, Logging, dan Debugging Mengakses API Kubernetes Menggunakan TLS Mengelola Klaster Mengelola Aplikasi yang Stateful Daemon Klaster Mengelola GPU Mengelola HugePages Selanjutnya Bagian dokumentasi Kubernetes ini berisi halaman-halaman yang perlihatkan bagaimana melakukan setiap tugas (task). Halaman tugas menunjukkan cara melakukan satu hal saja, biasanya dengan memberikan urutan langkah pendek."><meta property="og:url" content="https://kubernetes.io/id/docs/tasks/"><meta property="og:title" content="Tugas"><meta name=twitter:title content="Tugas"><meta name=twitter:image content="https://kubernetes.io/images/favicon.png"><meta name=twitter:image:alt content="Kubernetes"><meta property="og:image" content="/images/kubernetes-horizontal-color.png"><meta property="og:type" content="article"><script src=/js/jquery-3.6.0.min.js intregrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary><a class=navbar-brand href=/id/></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-2 mb-lg-0"><a class="nav-link active" href=/id/docs/>Dokumentasi</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/id/community/>Komunitas</a></li><li class="nav-item mr-2 mb-lg-0"><a class=nav-link href=/id/case-studies/>Studi kasus</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Versi</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/id/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/id/docs/tasks/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/id/docs/tasks/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/id/docs/tasks/>v1.23</a>
<a class=dropdown-item href=https://v1-22.docs.kubernetes.io/id/docs/tasks/>v1.22</a>
<a class=dropdown-item href=https://v1-21.docs.kubernetes.io/id/docs/tasks/>v1.21</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Bahasa Indonesia</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/tasks/>English</a>
<a class=dropdown-item href=/zh-cn/docs/tasks/>中文 (Chinese)</a>
<a class=dropdown-item href=/ko/docs/tasks/>한국어 (Korean)</a>
<a class=dropdown-item href=/ja/docs/tasks/>日本語 (Japanese)</a>
<a class=dropdown-item href=/fr/docs/tasks/>Français (French)</a>
<a class=dropdown-item href=/de/docs/tasks/>Deutsch (German)</a>
<a class=dropdown-item href=/es/docs/tasks/>Español (Spanish)</a>
<a class=dropdown-item href=/pt-br/docs/tasks/>Português (Portuguese)</a>
<a class=dropdown-item href=/hi/docs/tasks/>हिन्दी (Hindi)</a>
<a class=dropdown-item href=/pl/docs/tasks/>Polski (Polish)</a></div></li></ul></div><button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/id/docs/tasks/>Return to the regular view of this page</a>.</p></div><h1 class=title>Tugas</h1><ul><li>1: <a href=#pg-57bf66f59d9a642b82eebeabbc66470b>Menginstal Peralatan</a></li><ul><li>1.1: <a href=#pg-bbdc530b292ab4074d1dfe69feafb3e7>Menginstal dan Menyiapkan kubectl</a></li></ul><li>2: <a href=#pg-964bdff888520740e5e221695245678d>Menjalankan Tugas-Tugas Otomatis dengan CronJob</a></li><li>3: <a href=#pg-f5da33b976758a9183018c421eb83f58>Mengatur Pod dan Kontainer</a></li><ul><li>3.1: <a href=#pg-e6dd9300cf3a955f7cdfe77fb5d15292>Menetapkan Sumber Daya Memori untuk Container dan Pod</a></li><li>3.2: <a href=#pg-904cea8c8efd5c0d33adbfe579ec2dd2>Konfigurasi Quality of Service untuk Pod</a></li><li>3.3: <a href=#pg-484833fb880d1e179cc2965d15f84da5>Mengatur Pod untuk Menggunakan Volume sebagai Tempat Penyimpanan</a></li><li>3.4: <a href=#pg-528d2422215cb9632b7b45e886b023b5>Mengatur Pod untuk Penyimpanan dengan PersistentVolume</a></li><li>3.5: <a href=#pg-abd895c0803315e9717e6ff9ec4e3d30>Mengonfigurasi Konteks Keamanan untuk Pod atau Container</a></li><li>3.6: <a href=#pg-2c0d882359718c4c69c67099bed2156c>Mengatur ServiceAccount untuk Pod</a></li><li>3.7: <a href=#pg-d385b86a7cb496d3b1c3b2a47280ca70>Menarik Image dari Register Pribadi</a></li><li>3.8: <a href=#pg-eb54daf87df373096b5e830680194dfc>Mengatur Probe Liveness, Readiness dan Startup</a></li><li>3.9: <a href=#pg-fc3f4777ae8ea685d2b54e175277ac01>Menempatkan Pod pada Node Menggunakan Afinitas Pod</a></li><li>3.10: <a href=#pg-ed34e761c3dbd00fa79577fa78e30020>Mengatur Pod untuk Menggunakan ConfigMap</a></li><li>3.11: <a href=#pg-3d7b9cb24a647c36ba63f7a02ec49010>Pembagian Namespace Proses antar Container pada sebuah Pod</a></li><li>3.12: <a href=#pg-42a59b878d4c58e5c6f4bb87483dda93>Membuat Pod Statis</a></li></ul><li>4: <a href=#pg-34a810f1516ad9d99b2697e36e9b0d0f>Mengelola Sebuah Klaster</a></li><ul><li>4.1: <a href=#pg-1239a77618c6278373832a142cd85519>Menggunakan Calico untuk NetworkPolicy</a></li><li>4.2: <a href=#pg-47be5dd51f686017f1766e6ec7aa6f41>Mengelola Memori, CPU, dan Sumber Daya API</a></li><ul><li>4.2.1: <a href=#pg-adb489b1ab985c9215657b0d4c6ae92b>Mengatur Batas Minimum dan Maksimum Memori pada sebuah Namespace</a></li></ul><li>4.3: <a href=#pg-8bcf4aeb5bbb6d6969a146e5ab97557b>Debugging Resolusi DNS</a></li><li>4.4: <a href=#pg-3d0cd7d2f13d4759094f281504cf57b8>Kustomisasi Service DNS</a></li><li>4.5: <a href=#pg-b64a1d2bb3f4ed9f7021134e09a75c36>Melakukan Reservasi Sumber Daya Komputasi untuk Daemon Sistem</a></li><li>4.6: <a href=#pg-1e966f5d0540bbee0876f9d0d08d54dc>Membagi sebuah Klaster dengan Namespace</a></li><li>4.7: <a href=#pg-0b17e83b6049e53b8ffa864bdfa07c87>Mengatur Control Plane Kubernetes dengan Ketersediaan Tinggi (High-Availability)</a></li><li>4.8: <a href=#pg-fe5ad73163d38596340536ec03a205f0>Menggunakan sysctl dalam Sebuah Klaster Kubernetes</a></li><li>4.9: <a href=#pg-c4d0832845adc92b7ccd54aed63fc932>Mengoperasikan klaster etcd untuk Kubernetes</a></li></ul><li>5: <a href=#pg-aa0731e8aa8e2f6cc9e3c1a5e9895863>Mengelola Objek Kubernetes</a></li><ul><li>5.1: <a href=#pg-df206392be6f4d19bd8da41cee7170fa>Pengelolaan Objek Kubernetes secara Deklaratif dengan Menggunakan Berkas Konfigurasi</a></li><li>5.2: <a href=#pg-11aa6950fcb203094823c8e2cbdd517f>Mengelola Objek Kubernetes secara Deklaratif menggunakan Kustomize</a></li><li>5.3: <a href=#pg-80c83fe9b80d0fef2681c8d59c0aa197>Pengelolaan Objek Kubernetes dengan Perintah Imperatif</a></li><li>5.4: <a href=#pg-b18886277c410fc6f32ce068e2160537>Pengelolaan Objek Kubernetes Secara Imperatif dengan Menggunakan File Konfigurasi</a></li></ul><li>6: <a href=#pg-866924fa095f897ede8dfdcab9e97942>Memasukkan Data ke dalam Aplikasi</a></li><ul><li>6.1: <a href=#pg-c9af1e81bb6e109f6c41febe44f0931b>Mendefinisikan Perintah dan Argumen untuk sebuah Kontainer</a></li><li>6.2: <a href=#pg-82c93897176489678232542102daea40>Mendefinisikan Variabel Lingkungan untuk sebuah Kontainer</a></li><li>6.3: <a href=#pg-7f9454a1e775548c23ee5b300a9218a3>Mendistribusikan Kredensial dengan Aman Menggunakan Secret</a></li></ul><li>7: <a href=#pg-a78a5e7e765fd8c49c8f7c0d72499f72>Menjalankan</a></li><ul><li>7.1: <a href=#pg-790ea02857492b3a822e981e93e3a98b>Menjalankan Aplikasi Stateless Menggunakan Deployment</a></li><li>7.2: <a href=#pg-f5f2f7a74377a9d45325c5253353fa8f>Menghapus Paksa Pod StatefulSet</a></li><li>7.3: <a href=#pg-0c0bb1bd76d2a9069e50e2cec6d20c2a>HorizontalPodAutoscaler</a></li><li>7.4: <a href=#pg-8138226ce9660ac8e3e82ff86fff8ad2>Panduan HorizontalPodAutoscaler</a></li></ul><li>8: <a href=#pg-b74b959f5a531003dd0653dfbfc2e88b>Mengakes Aplikasi-aplikasi di sebuah Klaster</a></li><ul><li>8.1: <a href=#pg-777447042cd4e81df3fa5beb3357a485>Antarmuka Pengguna Berbasis Web (Dashboard)</a></li><li>8.2: <a href=#pg-6a8d9e9e05f2b6825afbb8889c957370>Mengakses Klaster</a></li><li>8.3: <a href=#pg-5a233e14205d77fe1294917d2da6f876>Mengkonfigurasi Akses ke Banyak Klaster</a></li><li>8.4: <a href=#pg-72d3dddbc0c166c9a364e753d2b31ff0>Menggunakan Port Forwarding untuk Mengakses Aplikasi di sebuah Klaster</a></li><li>8.5: <a href=#pg-21cd8f87563675fb0278d3694ba9ecb0>Membuat Load Balancer Eksternal</a></li><li>8.6: <a href=#pg-48e8f306f919c5b81265e265a2b76ab4>Membuat Daftar Semua Image Container yang Berjalan dalam Klaster</a></li></ul><li>9: <a href=#pg-f6a755efe831d24956501e4bcd49ff96>Pemantauan, Pencatatan, and Debugging</a></li><ul><li>9.1: <a href=#pg-731bb8b338c16aebfb9590ba2bd3fdd1>Introspeksi dan _Debugging_ Aplikasi</a></li><li>9.2: <a href=#pg-9713ac27b6d9e3034033200d968221f2>Mendapatkan Shell Untuk Masuk ke Container yang Sedang Berjalan</a></li><li>9.3: <a href=#pg-9e6e1b706f11386fe2c4b4ffda1409e4>Perangkat untuk Memantau Sumber Daya</a></li></ul><li>10: <a href=#pg-d3c88a8663f58e9ec0bed73faff5b670>TLS</a></li><ul><li>10.1: <a href=#pg-9a87de8ee8332cb487f34a05debb1125>Kelola Sertifikat TLS Pada Klaster</a></li></ul><li>11: <a href=#pg-ba58efa15c6d46f10e34d799be220965>Mengelola Daemon Klaster</a></li><ul><li>11.1: <a href=#pg-f1bf7e426f482a85e1a417d1fd9ea7b7>Melakukan Rollback pada DaemonSet</a></li></ul></ul><div class=content><nav id=TableOfContents><ul><li><a href=#antarmuka-pengguna-berbasis-web-dashboard>Antarmuka Pengguna Berbasis Web (Dashboard)</a></li><li><a href=#menggunakan-baris-perintah-kubectl>Menggunakan Baris Perintah kubectl</a></li><li><a href=#mengkonfigurasi-pod-dan-container>Mengkonfigurasi Pod dan Container</a></li><li><a href=#menjalankan-aplikasi>Menjalankan Aplikasi</a></li><li><a href=#menjalankan-job>Menjalankan Job</a></li><li><a href=#mengakses-aplikasi-dalam-klaster>Mengakses Aplikasi dalam Klaster</a></li><li><a href=#monitoring-logging-dan-debugging><em>Monitoring, Logging</em>, dan <em>Debugging</em></a></li><li><a href=#mengakses-api-kubernetes>Mengakses API Kubernetes</a></li><li><a href=#menggunakan-tls>Menggunakan TLS</a></li><li><a href=#mengelola-klaster>Mengelola Klaster</a></li><li><a href=#mengelola-aplikasi-yang-stateful>Mengelola Aplikasi yang <em>Stateful</em></a></li><li><a href=#daemon-klaster><em>Daemon</em> Klaster</a></li><li><a href=#mengelola-gpu>Mengelola GPU</a></li><li><a href=#mengelola-hugepages>Mengelola <em>HugePages</em></a></li><li><a href=#selanjutnya>Selanjutnya</a></li></ul></nav><p>Bagian dokumentasi Kubernetes ini berisi halaman-halaman yang perlihatkan
bagaimana melakukan setiap tugas (<em>task</em>). Halaman tugas menunjukkan cara melakukan
satu hal saja, biasanya dengan memberikan urutan langkah pendek.</p><h2 id=antarmuka-pengguna-berbasis-web-dashboard>Antarmuka Pengguna Berbasis Web (Dashboard)</h2><p>Melakukan <em>deploy</em> dan mengakses <em>dashboard</em> berbasis web untuk
membantu kamu mengelola dan memantau aplikasi yang dimasukkan ke dalam container
di Kubernetes.</p><h2 id=menggunakan-baris-perintah-kubectl>Menggunakan Baris Perintah kubectl</h2><p>Instalasi dan konfigurasi utilitas baris perintah <code>kubectl</code> yang digunakan untuk
mengelola secara langsung klaster Kubernetes.</p><h2 id=mengkonfigurasi-pod-dan-container>Mengkonfigurasi Pod dan Container</h2><p>Melakukan tugas konfigurasi yang umum untuk Pod dan Container.</p><h2 id=menjalankan-aplikasi>Menjalankan Aplikasi</h2><p>Melakukan tugas manajemen aplikasi secara umum, seperti <em>rolling updates</em>, memasukkan
informasi ke dalam Pod, dan penskalaan Pod secara horisontal.</p><h2 id=menjalankan-job>Menjalankan Job</h2><p>Menjalankan Job dengan menggunakan pemrosesan paralel.</p><h2 id=mengakses-aplikasi-dalam-klaster>Mengakses Aplikasi dalam Klaster</h2><p>Mengkonfigurasi <em>load balancing</em>, <em>port forwarding</em>, atau membangun <em>firewall</em>
atau konfigurasi DNS untuk mengakses aplikasi dalam sebuah klaster.</p><h2 id=monitoring-logging-dan-debugging><em>Monitoring, Logging</em>, dan <em>Debugging</em></h2><p>Mengatur <em>monitoring</em> (pemantauan) dan <em>logging</em> (pencatatan) untuk memecahkan
masalah klaster atau melakukan <em>debug</em> (pelacakan) aplikasi yang dikontainerisasi.</p><h2 id=mengakses-api-kubernetes>Mengakses API Kubernetes</h2><p>Mempelajari berbagai metode untuk mengakses API Kubernetes secara langsung.</p><h2 id=menggunakan-tls>Menggunakan TLS</h2><p>Mengkonfigurasi aplikasi kamu untuk percaya dan menggunakan klaster <em>Certificate
Authority</em> (CA).</p><h2 id=mengelola-klaster>Mengelola Klaster</h2><p>Mempelajari tugas umum untuk mengelola klaster.</p><h2 id=mengelola-aplikasi-yang-stateful>Mengelola Aplikasi yang <em>Stateful</em></h2><p>Melakukan tugas umum untuk mengelola aplikasi yang <em>Stateful</em>, termasuk
penskalaan, penghapusan, dan <em>debugging</em> StatefulSets.</p><h2 id=daemon-klaster><em>Daemon</em> Klaster</h2><p>Melakukan tugas-tugas umum untuk mengelola DaemonSet, seperti melakukan <em>rolling
updates</em>.</p><h2 id=mengelola-gpu>Mengelola GPU</h2><p>Mengkonfigurasi dan menjadwalkan GPU NVIDIA untuk digunakan sebagai sumber daya
oleh Node dalam sebuah klaster.</p><h2 id=mengelola-hugepages>Mengelola <em>HugePages</em></h2><p>Mengkonfigurasi dan menjadwalkan <em>HugePages</em> sebagai sumber daya yang dapat
dijadwalkan dalam sebuah klaster.</p><h2 id=selanjutnya>Selanjutnya</h2><p>Jika kamu ingin menulis halaman tugas (<em>task</em>), silahkan lihat
<a href=/docs/home/contribute/create-pull-request/>Membuat Dokumentasi <em>Pull Request</em></a>.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-57bf66f59d9a642b82eebeabbc66470b>1 - Menginstal Peralatan</h1><div class=lead>Peralatan untuk melakukan instalasi Kubernetes dalam komputer kamu.</div><h2 id=kubectl>kubectl</h2><p>Perangkat baris perintah Kubernetes, <a href=/id/docs/reference/kubectl/kubectl/>kubectl</a>,
memungkinkan kamu untuk menjalankan perintah pada klaster Kubernetes.
Kamu dapat menggunakan kubectl untuk menerapkan aplikasi, memeriksa dan mengelola sumber daya klaster,
dan melihat <em>log</em> (catatan). Untuk informasi lebih lanjut termasuk daftar lengkap operasi kubectl, lihat
<a href=/id/docs/reference/kubectl/>referensi dokumentasi <code>kubectl</code></a>.</p><p>kubectl dapat diinstal pada berbagai platform Linux, macOS dan Windows.
Pilihlah sistem operasi pilihan kamu di bawah ini.</p><ul><li><a href=/en/docs/tasks/tools/install-kubectl-linux>Instalasi kubectl pada Linux</a></li><li><a href=/en/docs/tasks/tools/install-kubectl-macos>Instalasi kubectl pada macOS</a></li><li><a href=/en/docs/tasks/tools/install-kubectl-windows>Instalasi kubectl pada Windows</a></li></ul><h2 id=kind>kind</h2><p><a href=https://kind.sigs.k8s.io/docs/><code>kind</code></a> memberikan kamu kemampuan untuk
menjalankan Kubernetes pada komputer lokal kamu. Perangkat ini membutuhkan
<a href=https://docs.docker.com/get-docker/>Docker</a> yang sudah diinstal dan
terkonfigurasi.</p><p>Halaman <a href=https://kind.sigs.k8s.io/docs/user/quick-start/>Memulai Cepat</a> <code>kind</code>
memperlihatkan kepada kamu tentang apa yang perlu kamu lakukan untuk <code>kind</code>
berjalan dan bekerja.</p><p><a class="btn btn-primary" href=https://kind.sigs.k8s.io/docs/user/quick-start/ role=button aria-label="Melihat Memulai Cepat Kind">Melihat Memulai Cepat Kind</a></p><h2 id=minikube>minikube</h2><p>Seperti halnya dengan <code>kind</code>, <a href=https://minikube.sigs.k8s.io/><code>minikube</code></a>
merupakan perangkat yang memungkinkan kamu untuk menjalankan Kubernetes
secara lokal. <code>minikube</code> menjalankan sebuah klaster Kubernetes dengan
satu node saja dalam komputer pribadi (termasuk Windows, macOS dan Linux)
sehingga kamu dapat mencoba Kubernetes atau untuk pekerjaan pengembangan
sehari-hari.</p><p>Kamu bisa mengikuti petunjuk resmi
<a href=https://minikube.sigs.k8s.io/docs/start/>Memulai!</a>
<code>minikube</code> jika kamu ingin fokus agar perangkat ini terinstal.</p><p><a class="btn btn-primary" href=https://minikube.sigs.k8s.io/docs/start/ role=button aria-label="Lihat Panduan Memulai! Minikube">Lihat Panduan Memulai! Minikube</a></p><p>Setelah kamu memiliki <code>minikube</code> yang bekerja, kamu bisa menggunakannya
untuk <a href=/id/docs/tutorials/hello-minikube/>menjalankan aplikasi contoh</a>.</p><h2 id=kubeadm>kubeadm</h2><p>Kamu dapat menggunakan <a class=glossary-tooltip title='A tool for quickly installing Kubernetes and setting up a secure cluster.' data-toggle=tooltip data-placement=top href=/docs/admin/kubeadm/ target=_blank aria-label=kubeadm>kubeadm</a>
untuk membuat dan mengatur klaster Kubernetes.
<code>kubeadm</code> menjalankan langkah-langkah yang diperlukan untuk mendapatkan klaster
dengan kelaikan dan keamanan minimum, aktif dan berjalan dengan cara yang mudah
bagi pengguna.</p><p><a href=/id/docs/setup/production-environment/tools/kubeadm/install-kubeadm/>Instalasi kubeadm</a> memperlihatkan tentang bagaimana melakukan instalasi kubeadm.
Setelah terinstal, kamu dapat menggunakannya untuk <a href=/id/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/>membuat klaster</a>.</p><p><a class="btn btn-primary" href=/docs/setup/production-environment/tools/kubeadm/install-kubeadm/ role=button aria-label="Lihat panduan instalasi kubeadm">Lihat panduan instalasi kubeadm</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-bbdc530b292ab4074d1dfe69feafb3e7>1.1 - Menginstal dan Menyiapkan kubectl</h1><p><a href=/docs/user-guide/kubectl/>Kubectl</a> adalah alat baris perintah (<em>command line tool</em>) Kubernetes yang digunakan untuk menjalankan berbagai perintah untuk klaster Kubernetes. Kamu dapat menggunakan <code>kubectl</code> untuk men-<em>deploy</em> aplikasi, mengatur sumber daya klaster, dan melihat log. Daftar operasi <code>kubectl</code> dapat dilihat di <a href=/docs/reference/kubectl/overview/>Ikhtisar kubectl</a>.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p>Kamu harus menggunakan kubectl dengan perbedaan maksimal satu versi minor dengan klaster kamu. Misalnya, klien v1.2 masih dapat digunakan dengan master v1.1, v1.2, dan 1.3. Menggunakan versi terbaru <code>kubectl</code> dapat menghindari permasalahan yang tidak terduga.</p><h2 id=menginstal-kubectl-pada-linux>Menginstal kubectl pada Linux</h2><h3 id=menginstal-program-kubectl-menggunakan-curl-pada-linux>Menginstal program kubectl menggunakan curl pada Linux</h3><ol><li><p>Unduh versi terbarunya dengan perintah:</p><pre tabindex=0><code>curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
</code></pre><p>Untuk mengunduh versi spesifik, ganti bagian <code>curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt</code> dengan versi yang diinginkan.</p><p>Misalnya, untuk mengunduh versi v1.25.0 di Linux, ketik:</p><pre tabindex=0><code>curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.25.0/bin/linux/amd64/kubectl
</code></pre></li><li><p>Jadikan program <code>kubectl</code> dapat dieksekusi.</p><pre tabindex=0><code>chmod +x ./kubectl
</code></pre></li><li><p>Pindahkan ke PATH kamu.</p><pre tabindex=0><code>sudo mv ./kubectl /usr/local/bin/kubectl
</code></pre></li><li><p>Pastikan instalasinya sudah berhasil dengan melakukan pengecekan versi:</p><pre tabindex=0><code>kubectl version --client
</code></pre></li></ol><h3 id=menginstal-dengan-manajer-paket-package-manager-bawaan>Menginstal dengan manajer paket (<em>package manager</em>) bawaan</h3><ul class="nav nav-tabs" id=kubectl-install role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#kubectl-install-0 role=tab aria-controls=kubectl-install-0 aria-selected=true>Ubuntu, Debian or HypriotOS</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#kubectl-install-1 role=tab aria-controls=kubectl-install-1>CentOS, RHEL or Fedora</a></li></ul><div class=tab-content id=kubectl-install><div id=kubectl-install-0 class="tab-pane show active" role=tabpanel aria-labelledby=kubectl-install-0><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt-get update <span style=color:#666>&amp;&amp;</span> sudo apt-get install -y apt-transport-https gnupg2
</span></span><span style=display:flex><span>curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;deb https://apt.kubernetes.io/ kubernetes-xenial main&#34;</span> | sudo tee -a /etc/apt/sources.list.d/kubernetes.list
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install -y kubectl
</span></span></code></pre></div></div><div id=kubectl-install-1 class=tab-pane role=tabpanel aria-labelledby=kubectl-install-1><p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span style=display:flex><span><span style=color:#b44>[kubernetes]
</span></span></span><span style=display:flex><span><span style=color:#b44>name=Kubernetes
</span></span></span><span style=display:flex><span><span style=color:#b44>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style=display:flex><span><span style=color:#b44>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#b44>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#b44>repo_gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#b44>gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>yum install -y kubectl
</span></span></code></pre></div></div></div><h3 id=menginstal-dengan-manajer-paket-lain>Menginstal dengan manajer paket lain</h3><ul class="nav nav-tabs" id=other-kubectl-install role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#other-kubectl-install-0 role=tab aria-controls=other-kubectl-install-0 aria-selected=true>Snap</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#other-kubectl-install-1 role=tab aria-controls=other-kubectl-install-1>Homebrew</a></li></ul><div class=tab-content id=other-kubectl-install><div id=other-kubectl-install-0 class="tab-pane show active" role=tabpanel aria-labelledby=other-kubectl-install-0><p><p>Jika kamu menggunakan Ubuntu atau versi Linux lain yang mendukung manajer paket <a href=https://snapcraft.io/docs/core/install>snap</a>, <code>kubectl</code> tersedia dalam bentuk aplikasi di <a href=https://snapcraft.io/>snap</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>snap install kubectl --classic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></div><div id=other-kubectl-install-1 class=tab-pane role=tabpanel aria-labelledby=other-kubectl-install-1><p><p>Jika kamu menggunakan Linux dengan manajer paket <a href=https://docs.brew.sh/Homebrew-on-Linux>Homebrew</a>, <code>kubectl</code> sudah tersedia untuk diinstal di <a href=https://docs.brew.sh/Homebrew-on-Linux#install>Homebrew</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>brew install kubectl
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl version --client
</span></span></code></pre></div></div></div><h2 id=menginstal-kubectl-pada-macos>Menginstal kubectl pada macOS</h2><h3 id=menginstal-program-kubectl-dengan-curl-pada-macos>Menginstal program kubectl dengan curl pada macOS</h3><ol><li><p>Unduh versi terbarunya dengan perintah:</p><pre tabindex=0><code>curl -LO &#34;https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl&#34;
</code></pre><p>Untuk mengunduh versi spesifik, ganti bagian <code>curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt</code> dengan versi yang diinginkan.</p><p>Misalnya, untuk mengunduh versi v1.25.0 pada macOS, ketik:</p><pre tabindex=0><code>curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.25.0/bin/darwin/amd64/kubectl
</code></pre></li><li><p>Buat agar program <code>kubectl</code> dapat dijalankan.</p><pre tabindex=0><code>chmod +x ./kubectl
</code></pre></li><li><p>Pindahkan ke PATH kamu.</p><pre tabindex=0><code>sudo mv ./kubectl /usr/local/bin/kubectl
</code></pre></li><li><p>Pastikan instalasinya sudah berhasil dengan melakukan pengecekan versi:</p><pre tabindex=0><code>kubectl version --client
</code></pre></li></ol><h3 id=menginstal-dengan-homebrew-pada-macos>Menginstal dengan Homebrew pada macOS</h3><p>Jika kamu menggunakan macOS dan manajer paket <a href=https://brew.sh/>Homebrew</a>, kamu dapat menginstal <code>kubectl</code> langsung dengan Homebrew.</p><ol><li><p>Jalankan perintah:</p><pre tabindex=0><code>brew install kubectl 
</code></pre><p>atau</p><pre tabindex=0><code>brew install kubernetes-cli
</code></pre></li><li><p>Pastikan instalasinya sudah berhasil dengan melakukan pengecekan versi:</p><pre tabindex=0><code>kubectl version --client
</code></pre></li></ol><h3 id=menginstal-dengan-macports-pada-macos>Menginstal dengan Macports pada macOS</h3><p>Jika kamu menggunakan macOS dan manajer paket <a href=https://macports.org/>Macports</a>, kamu dapat menginstal <code>kubectl</code> langsung dengan Macports.</p><ol><li><p>Jalankan perintah:</p><pre tabindex=0><code>sudo port selfupdate
sudo port install kubectl
</code></pre></li><li><p>Pastikan instalasinya sudah berhasil dengan melakukan pengecekan versi:</p><pre tabindex=0><code>kubectl version --client
</code></pre></li></ol><h2 id=menginstal-kubectl-pada-windows>Menginstal kubectl pada Windows</h2><h3 id=menginstal-program-kubectl-dengan-curl-pada-windows>Menginstal program kubectl dengan curl pada Windows</h3><ol><li><p>Unduh versi terbarunya v1.25.0 dari <a href=https://storage.googleapis.com/kubernetes-release/release/v1.25.0/bin/windows/amd64/kubectl.exe>tautan ini</a>.</p><p>Atau jika sudah ada <code>curl</code> pada mesin kamu, jalankan perintah ini:</p><pre tabindex=0><code>curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.25.0/bin/windows/amd64/kubectl.exe
</code></pre><p>Untuk mendapatkan versi stabil terakhir (misalnya untuk <em>scripting</em>), lihat di <a href=https://storage.googleapis.com/kubernetes-release/release/stable.txt>https://storage.googleapis.com/kubernetes-release/release/stable.txt</a>.</p></li><li><p>Tambahkan program yang sudah diunduh tersebut ke PATH kamu.</p></li><li><p>Pastikan instalasinya sudah berhasil dengan melakukan pengecekan versi:</p><pre tabindex=0><code>kubectl version --client
</code></pre></li></ol><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> <a href=https://docs.docker.com/docker-for-windows/#kubernetes>Docker Desktop untuk Windows</a> sudah menambahkan versi <code>kubectl</code>-nya sendiri ke PATH. Jika kamu sudah menginstal Docker Desktop, kamu harus menambahkan entrinya ke PATH sebelum yang ditambahkan oleh penginstal (<em>installer</em>) Docker Desktop atau kamu dapat menghapus <code>kubectl</code> bawaan dari Docker Desktop.</div><h3 id=menginstal-dengan-powershell-dari-psgallery>Menginstal dengan Powershell dari PSGallery</h3><p>Jika kamu menggunakan Windows dan manajer paket <a href=https://www.powershellgallery.com/>Powershell Gallery</a>, kamu dapat menginstal dan melakukan pembaruan <code>kubectl</code> dengan Powershell.</p><ol><li><p>Jalankan perintah berikut (jangan lupa untuk memasukkan <code>DownloadLocation</code>):</p><pre tabindex=0><code>Install-Script -Name install-kubectl -Scope CurrentUser -Force
install-kubectl.ps1 [-DownloadLocation &lt;path&gt;]
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Jika kamu tidak menambahkan <code>DownloadLocation</code>, <code>kubectl</code> akan diinstal di dalam direktori <em>temp</em> pengguna.</div><p>Penginstal akan membuat <code>$HOME/.kube</code> dan membuat berkas konfigurasi</p></li><li><p>Pastikan instalasinya sudah berhasil dengan melakukan pengecekan versi:</p><pre tabindex=0><code>kubectl version --client
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Proses pembaruan dapat dilakukan dengan menjalankan ulang dua perintah yang terdapat pada langkah 1.</div></li></ol><h3 id=menginstal-pada-windows-menggunakan-chocolatey-atau-scoop>Menginstal pada Windows menggunakan Chocolatey atau Scoop</h3><p>Untuk menginstal <code>kubectl</code> pada Windows, kamu dapat menggunakan manajer paket <a href=https://chocolatey.org>Chocolatey</a> atau penginstal baris perintah <a href=https://scoop.sh>Scoop</a>.<ul class="nav nav-tabs" id=kubectl-win-install role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#kubectl-win-install-0 role=tab aria-controls=kubectl-win-install-0 aria-selected=true>choco</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#kubectl-win-install-1 role=tab aria-controls=kubectl-win-install-1>scoop</a></li></ul><div class=tab-content id=kubectl-win-install><div id=kubectl-win-install-0 class="tab-pane show active" role=tabpanel aria-labelledby=kubectl-win-install-0><p><pre><code>choco install kubernetes-cli
</code></pre></div><div id=kubectl-win-install-1 class=tab-pane role=tabpanel aria-labelledby=kubectl-win-install-1><p><pre><code>scoop install kubectl
</code></pre></div></div></p><ol><li><p>Pastikan instalasinya sudah berhasil dengan melakukan pengecekan versi:</p><pre tabindex=0><code>kubectl version --client
</code></pre></li><li><p>Pindah ke direktori utama:</p><pre tabindex=0><code>cd %USERPROFILE%
</code></pre></li><li><p>Buat direktori <code>.kube</code>:</p><pre tabindex=0><code>mkdir .kube
</code></pre></li><li><p>Pindah ke direktori <code>.kube</code> yang baru saja dibuat:</p><pre tabindex=0><code>cd .kube
</code></pre></li><li><p>Lakukan konfigurasi <code>kubectl</code> untuk menggunakan klaster Kubernetes <em>remote</em>:</p><pre tabindex=0><code>New-Item config -type file
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Ubah berkas konfigurasi dengan penyunting (<em>editor</em>) teks pilihanmu, misalnya Notepad.</div></li></ol><h2 id=mengunduh-sebagai-bagian-dari-google-cloud-sdk>Mengunduh sebagai bagian dari Google Cloud SDK</h2><p>Kamu dapat menginstal <code>kubectl</code> sebagai bagian dari Google Cloud SDK.</p><ol><li><p>Instal <a href=https://cloud.google.com/sdk/>Google Cloud SDK</a>.</p></li><li><p>Jalankan perintah instalasi <code>kubectl</code>:</p><pre tabindex=0><code>gcloud components install kubectl
</code></pre></li><li><p>Pastikan instalasinya sudah berhasil dengan melakukan pengecekan versi:</p><pre tabindex=0><code>kubectl version --client
</code></pre></li></ol><h2 id=memeriksa-konfigurasi-kubectl>Memeriksa konfigurasi kubectl</h2><p>Agar <code>kubectl</code> dapat mengakses klaster Kubernetes, dibutuhkan sebuah <a href=/id/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>berkas kubeconfig</a>, yang akan otomatis dibuat ketika kamu membuat klaster baru menggunakan <a href=https://github.com/kubernetes/kubernetes/blob/master/cluster/kube-up.sh>kube-up.sh</a> atau setelah berhasil men-<em>deploy</em> klaster Minikube. Secara bawaan, konfigurasi <code>kubectl</code> disimpan di <code>~/.kube/config</code>.</p><p>Kamu dapat memeriksa apakah konfigurasi <code>kubectl</code> sudah benar dengan mengambil keadaan klaster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info
</span></span></code></pre></div><p>Jika kamu melihat respons berupa URL, maka konfigurasi klaster <code>kubectl</code> sudah benar.</p><p>Tetapi, jika kamu melihat pesan seperti di bawah, maka <code>kubectl</code> belum dikonfigurasi dengan benar atau tidak dapat terhubung ke klaster Kubernetes.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>The connection to the server &lt;server-name:port&gt; was refused - did you specify the right host or port?
</span></span></code></pre></div><p>Selanjutnya, jika kamu ingin menjalankan klaster Kubernetes di laptop (lokal) kamu, kamu memerlukan sebuah perangkat seperti Minikube sebelum menjalankan ulang perintah yang ada di atas.</p><p>Jika <code>kubectl cluster-info</code> mengembalikan respons URL tetapi kamu masih belum dapat mengakses klaster, kamu bisa menggunakan perintah di bawah untuk memeriksa apakah klaster sudah dikonfigurasi dengan benar.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info dump
</span></span></code></pre></div><h2 id=konfigurasi-kubectl-opsional>Konfigurasi kubectl opsional</h2><h3 id=menyalakan-penyelesaian-otomatis-untuk-terminal>Menyalakan penyelesaian otomatis untuk terminal</h3><p><code>kubectl</code> menyediakan fitur penyelesaian otomatis (<em>auto complete</em>) untuk Bash dan Zsh yang dapat memudahkanmu ketika mengetik di terminal.</p><p>Ikuti petunjuk di bawah untuk menyalakan penyelesaian otomatis untuk Bash dan Zsh.</p><ul class="nav nav-tabs" id=kubectl-autocompletion role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#kubectl-autocompletion-0 role=tab aria-controls=kubectl-autocompletion-0 aria-selected=true>Bash pada Linux</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#kubectl-autocompletion-1 role=tab aria-controls=kubectl-autocompletion-1>Bash pada macOS</a></li><li class=nav-item><a data-toggle=tab class=nav-link href=#kubectl-autocompletion-2 role=tab aria-controls=kubectl-autocompletion-2>Zsh</a></li></ul><div class=tab-content id=kubectl-autocompletion><div id=kubectl-autocompletion-0 class="tab-pane show active" role=tabpanel aria-labelledby=kubectl-autocompletion-0><p><h3 id=pendahuluan>Pendahuluan</h3><p>Skrip penyelesaian (<em>completion script</em>) <code>kubectl</code> untuk Bash dapat dibuat dengan perintah <code>kubectl completion bash</code>. Masukkan skrip tersebut ke dalam terminal sebagai sumber untuk menyalakan penyelesaian otomatis dari <code>kubectl</code>.</p><p>Namun, skrip penyelesaian tersebut bergantung pada <a href=https://github.com/scop/bash-completion><strong>bash-completion</strong></a>, yang artinya kamu harus menginstal program tersebut terlebih dahulu (kamu dapat memeriksa apakah kamu sudah memiliki bash-completion dengan menjalankan perintah <code>type _init_completion</code>).</p><h3 id=menginstal-bash-completion>Menginstal bash-completion</h3><p>bash-completion disediakan oleh banyak manajer paket (lihat <a href=https://github.com/scop/bash-completion#installation>di sini</a>). Kamu dapat menginstalnya dengan menggunakan perintah <code>apt-get install bash-completion</code> atau <code>yum install bash-completion</code>, dsb.</p><p>Perintah di atas akan membuat skrip utama bash-completion di <code>/usr/share/bash-completion/bash_completion</code>. Terkadang kamu juga harus menambahkan skrip tersebut ke dalam berkas <code>~/.bashrc</code>, tergantung manajer paket yang kamu pakai.</p><p>Untuk memastikannya, muat ulang terminalmu dan jalankan <code>type _init_completion</code>. Jika perintah tersebut berhasil, maka instalasi selesai. Jika tidak, tambahkan teks berikut ke dalam berkas <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>source</span> /usr/share/bash-completion/bash_completion
</span></span></code></pre></div><p>Muat ulang terminalmu dan pastikan bash-completion sudah berhasil diinstal dengan menjalankan <code>type _init_completion</code>.</p><h3 id=menyalakan-penyelesaian-otomatis-kubectl>Menyalakan penyelesaian otomatis kubectl</h3><p>Sekarang kamu harus memastikan bahwa skrip penyelesaian untuk <code>kubectl</code> sudah dimasukkan sebagai sumber penyelesaian otomatis pada semua sesi terminal. Kamu dapat melakukannya dengan dua cara:</p><ul><li><p>Masukkan skrip penyelesaian sebagai sumber di berkas <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;source &lt;(kubectl completion bash)&#39;</span> &gt;&gt;~/.bashrc
</span></span></code></pre></div></li><li><p>Tambahkan skrip penyelesaian ke direktori <code>/etc/bash_completion.d</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl completion bash &gt;/etc/bash_completion.d/kubectl
</span></span></code></pre></div></li></ul><p>Jika kamu menggunakan alias untuk <code>kubectl</code>, kamu masih dapat menggunakan fitur penyelesaian otomatis dengan menjalankan perintah:</p><pre><code>```shell
echo 'alias k=kubectl' &gt;&gt;~/.bashrc
echo 'complete -F __start_kubectl k' &gt;&gt;~/.bashrc
```
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Semua sumber skrip penyelesaian bash-completion terdapat di <code>/etc/bash_completion.d</code>.</div><p>Kedua cara tersebut sama, kamu bisa memilih salah satunya. Setelah memuat ulang terminal, penyelesaian otomatis dari <code>kubectl</code> seharusnya sudah dapat bekerja.</p></div><div id=kubectl-autocompletion-1 class=tab-pane role=tabpanel aria-labelledby=kubectl-autocompletion-1><p><h3 id=pendahuluan>Pendahuluan</h3><p>Skrip penyelesaian (<em>completion script</em>) <code>kubectl</code> untuk Bash dapat dibuat dengan perintah <code>kubectl completion bash</code>. Masukkan skrip tersebut ke dalam terminal sebagai sumber untuk menyalakan penyelesaian otomatis dari <code>kubectl</code>.</p><p>Namun, skrip penyelesaian tersebut bergantung pada <a href=https://github.com/scop/bash-completion><strong>bash-completion</strong></a>, yang artinya kamu harus menginstal program tersebut terlebih dahulu.</p><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Terdapat dua versi bash-completion, v1 dan v2. V1 untuk Bash 3.2 (bawaan dari macOs), dan v2 untuk Bash 4.1+. Skrip penyelesaian <code>kubectl</code> <strong>tidak kompatibel</strong> dengan bash-completion v1 dan Bash 3.2. Dibutuhkan <strong>bash-completion v2</strong> dan <strong>Bash 4.1+</strong> agar skrip penyelesaian <code>kubectl</code> dapat bekerja dengan baik. Maka dari itu, kamu harus menginstal dan menggunakan Bash 4.1+ (<a href=https://itnext.io/upgrading-bash-on-macos-7138bd1066ba><em>panduan</em></a>) untuk dapat menggunakan fitur penyelesaian otomatis dari <code>kubectl</code>. Ikuti panduan di bawah setelah kamu menginstal Bash 4.1+ (yaitu, Bash versi 4.1 atau lebih baru).</div><h3 id=pemutakhiran-bash>Pemutakhiran Bash</h3><p>Panduan di bawah berasumsi kamu menggunakan Bash 4.1+. Kamu dapat memeriksa versi Bash dengan menjalankan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b8860b>$BASH_VERSION</span>
</span></span></code></pre></div><p>Jika versinya sudah terlalu usang, kamu dapat menginstal/memutakhirkannya dengan menggunakan Homebrew:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>brew install bash
</span></span></code></pre></div><p>Muat ulang terminalmu dan pastikan versi yang diharapkan sudah dipakai:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b8860b>$BASH_VERSION</span> <span style=color:#b8860b>$SHELL</span>
</span></span></code></pre></div><p>Homebrew biasanya akan menginstalnya di <code>/usr/local/bin/bash</code>.</p><h3 id=menginstal-bash-completion>Menginstal bash-completion</h3><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Seperti yang sudah disebutkan, panduan di bawah berasumsi kamu menggunakan Bash 4.1+, yang berarti kamu akan menginstal bash-completion v2 (penyelesaian otomatis dari <code>kubectl</code> tidak kompatibel dengan Bash 3.2 dan bash-completion v1).</div><p>Kamu dapat memeriksa apakah kamu sudah memiliki bash-completion v2 dengan perintah <code>type _init_completion</code>. Jika belum, kamu dapat menginstalnya dengan menggunakan Homebrew:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>brew install bash-completion@2
</span></span></code></pre></div><p>Seperti yang disarankan pada keluaran perintah di atas, tambahkan teks berikut ke berkas <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>BASH_COMPLETION_COMPAT_DIR</span><span style=color:#666>=</span><span style=color:#b44>&#34;/usr/local/etc/bash_completion.d&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>[[</span> -r <span style=color:#b44>&#34;/usr/local/etc/profile.d/bash_completion.sh&#34;</span> <span style=color:#666>]]</span> <span style=color:#666>&amp;&amp;</span> . <span style=color:#b44>&#34;/usr/local/etc/profile.d/bash_completion.sh&#34;</span>
</span></span></code></pre></div><p>Muat ulang terminalmu dan pastikan bash-completion v2 sudah terinstal dengan perintah <code>type _init_completion</code>.</p><h3 id=menyalakan-penyelesaian-otomatis-kubectl>Menyalakan penyelesaian otomatis kubectl</h3><p>Sekarang kamu harus memastikan bahwa skrip penyelesaian untuk <code>kubectl</code> sudah dimasukkan sebagai sumber penyelesaian otomatis di semua sesi terminal. Kamu dapat melakukannya dengan beberapa cara:</p><ul><li><p>Masukkan skrip penyelesaian sebagai sumber di berkas <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;source &lt;(kubectl completion bash)&#39;</span> &gt;&gt;~/.bashrc
</span></span></code></pre></div></li><li><p>Menambahkan skrip penyelesaian ke direktori <code>/etc/bash_completion.d</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl completion bash &gt;/etc/bash_completion.d/kubectl
</span></span></code></pre></div></li><li><p>Jika kamu menggunakan alias untuk <code>kubectl</code>, kamu masih dapat menggunakan fitur penyelesaian otomatis dengan menjalankan perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.bashrc
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;complete -F __start_kubectl k&#39;</span> &gt;&gt;~/.bashrc
</span></span></code></pre></div></li><li><p>Jika kamu menginstal <code>kubectl</code> dengan Homebrew (seperti yang sudah dijelaskan <a href=#install-with-homebrew-on-macos>di atas</a>), maka skrip penyelesaian untuk <code>kubectl</code> sudah berada di <code>/usr/local/etc/bash_completion.d/kubectl</code>. Kamu tidak perlu melakukan apa-apa lagi.</p></li></ul><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> bash-completion v2 yang diinstal dengan Homebrew meletakkan semua berkas nya di direktori <code>BASH_COMPLETION_COMPAT_DIR</code>, itulah alasannya dua cara terakhir dapat bekerja.</div><p>Setelah memuat ulang terminal, penyelesaian otomatis dari <code>kubectl</code> seharusnya sudah dapat bekerja.</p></div><div id=kubectl-autocompletion-2 class=tab-pane role=tabpanel aria-labelledby=kubectl-autocompletion-2><p><p>Skrip penyelesaian (<em>completion script</em>) <code>kubectl</code> untuk Zsh dapat dibuat dengan perintah <code>kubectl completion zsh</code>. Masukkan skrip tersebut ke dalam terminal sebagai sumber untuk menyalakan penyelesaian otomatis dari <code>kubectl</code>.</p><p>Tambahkan baris berikut di berkas <code>~/.zshrc</code> untuk menyalakan penyelesaian otomatis dari <code>kubectl</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>source</span> &lt;<span style=color:#666>(</span>kubectl completion zsh<span style=color:#666>)</span>
</span></span></code></pre></div><p>Jika kamu menggunakan alias untuk <code>kubectl</code>, kamu masih dapat menggunakan fitur penyelesaian otomatis dengan menjalankan perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;alias k=kubectl&#39;</span> &gt;&gt;~/.zshrc
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#39;compdef __start_kubectl k&#39;</span> &gt;&gt;~/.zshrc
</span></span></code></pre></div><p>Setelah memuat ulang terminal, penyelesaian otomatis dari <code>kubectl</code> seharusnya sudah dapat bekerja.</p><p>Jika kamu mendapatkan pesan gagal seperti <code>complete:13: command not found: compdef</code>, maka tambahkan teks berikut ke awal berkas <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>autoload -Uz compinit
</span></span><span style=display:flex><span>compinit
</span></span></code></pre></div></div></div><h2 id=selanjutnya>Selanjutnya</h2><ul><li><a href=/id/docs/tasks/tools/install-minikube/>Menginstal Minikube.</a></li><li>Lihat <a href=/docs/setup/>panduan persiapan</a> untuk mencari tahu tentang pembuatan klaster.</li><li><a href=/docs/tasks/access-application-cluster/service-access-application-cluster/>Pelajari cara untuk menjalankan dan mengekspos aplikasimu.</a></li><li>Jika kamu membutuhkan akses ke klaster yang tidak kamu buat, lihat <a href=/id/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>dokumen Berbagi Akses Klaster</a>.</li><li>Baca <a href=/docs/reference/kubectl/kubectl/>dokumen referensi kubectl</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-964bdff888520740e5e221695245678d>2 - Menjalankan Tugas-Tugas Otomatis dengan CronJob</h1><p>Kamu dapat menggunakan <a class=glossary-tooltip title='A repeating task (a Job) that runs on a regular schedule.' data-toggle=tooltip data-placement=top href=/docs/concepts/workloads/controllers/cron-jobs/ target=_blank aria-label=CronJob>CronJob</a> untuk menjalankan <a class=glossary-tooltip title='Tugas terbatas atau bertumpuk (batch) yang berjalan sampai selesai.' data-toggle=tooltip data-placement=top href=/docs/concepts/workloads/controllers/job/ target=_blank aria-label=Job>Job</a> yang dijadwalkan berbasis waktu. Job akan berjalan seperti pekerjaan-pekerjaan <a href=https://en.wikipedia.org/wiki/Cron>Cron</a> di Linux atau sistem UNIX.</p><p>CronJob sangat berguna untuk membuat pekerjaan yang berjalan secara periodik dan berulang, misalnya menjalankan (<em>backup</em>) atau mengirim email.
CronJob juga dapat menjalankan pekerjaan individu pada waktu tertentu, misalnya jika kamu ingin menjadwalkan sebuah pekerjaan dengan periode aktivitas yang rendah.</p><p>CronJob memiliki keterbatasan dan kekhasan.
Misalnya, dalam keadaan tertentu, sebuah CronJob dapat membuat banyak Job.
Karena itu, Job haruslah <em>idempotent.</em></p><p>Untuk informasi lanjut mengenai keterbatasan, lihat <a href=/id/docs/concepts/workloads/controllers/cron-jobs>CronJob</a>.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><ul><li><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul></li></ul><h2 id=membuat-sebuah-cronjob>Membuat Sebuah CronJob</h2><p>CronJob membutuhkan sebuah berkas konfigurasi.
Ini adalah contoh dari berkas konfigurasi CronJob <code>.spec</code> yang akan mencetak waktu sekarang dan pesan "hello" setiap menit:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/job/cronjob.yaml download=application/job/cronjob.yaml><code>application/job/cronjob.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-job-cronjob-yaml")' title="Copy application/job/cronjob.yaml to clipboard"></img></div><div class=includecode id=application-job-cronjob-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>batch/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>CronJob<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>hello<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>schedule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;* * * * *&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>jobTemplate</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>hello<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>busybox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>- /bin/sh<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>- -c<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>- date; echo Hello from the Kubernetes cluster<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>OnFailure<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Jalankan contoh CronJob menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/application/job/cronjob.yaml
</span></span></code></pre></div><p>Keluaran akan mirip dengan ini:</p><pre tabindex=0><code>cronjob.batch/hello created
</code></pre><p>Kamu juga dapat menggunakan <code>kubectl run</code> untuk membuat sebuah CronJob tanpa menulis sebuah konfigurasi yang lengkap:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl run hello --schedule<span style=color:#666>=</span><span style=color:#b44>&#34;*/1 * * * *&#34;</span> --restart<span style=color:#666>=</span>OnFailure --image<span style=color:#666>=</span>busybox -- /bin/sh -c <span style=color:#b44>&#34;date; echo Hello from the Kubernetes cluster&#34;</span>
</span></span></code></pre></div><p>Setelah membuat sebuah CronJob, untuk mengecek statusnya kamu dapat menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get cronjob hello
</span></span></code></pre></div><p>Keluaran akan mirip dengan ini:</p><pre tabindex=0><code>NAME    SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
hello   */1 * * * *   False     0        &lt;none&gt;          10s
</code></pre><p>Seperti yang kamu lihat dari hasil perintah di atas, CronJob belum menjadwalkan atau menjalankan pekerjaan apa pun.
Waktu yang biasanya dibutuhkan untuk mengamati Job hingga Job tersebut dibuat akan membutuhkan sekitar satu menit:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get <span style=color:#a2f>jobs</span> --watch
</span></span></code></pre></div><p>Keluaran akan mirip dengan ini:</p><pre tabindex=0><code>NAME               COMPLETIONS   DURATION   AGE
hello-4111706356   0/1                      0s
hello-4111706356   0/1           0s         0s
hello-4111706356   1/1           5s         5s
</code></pre><p>Sekarang kamu telah melihat satu Job berjalan yang dijadwalkan oleh "hello" CronJob.
Kamu dapat berhenti mengamati Job dan melihat CronJob lagi untuk melihat CronJob menjadwalkan sebuah Job:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get cronjob hello
</span></span></code></pre></div><p>Keluaran akan mirip dengan ini:</p><pre tabindex=0><code>NAME    SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
hello   */1 * * * *   False     0        50s             75s
</code></pre><p>Kamu dapat melihat bahwa CronJob <code>hello</code> berhasil menjadwalkan sebuah Job pada waktu yang ditentukan dalam <code>LAST SCHEDULE</code>. Saat ini ada 0 Job yang aktif, berarti sebuah Job telah selesai atau gagal.</p><p>Sekarang, temukan Pod yang dibuat oleh jadwal Job terakhir dan melihat keluaran bawaan dari salah satu Pod.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Nama Job dan nama Pod itu berbeda.</div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Ganti &#34;hello-4111706356&#34; dengan nama Job di sistem kamu</span>
</span></span><span style=display:flex><span><span style=color:#b8860b>pods</span><span style=color:#666>=</span><span style=color:#a2f;font-weight:700>$(</span>kubectl get pods --selector<span style=color:#666>=</span>job-name<span style=color:#666>=</span>hello-4111706356 --output<span style=color:#666>=</span><span style=color:#b8860b>jsonpath</span><span style=color:#666>={</span>.items<span style=color:#666>[</span>*<span style=color:#666>]</span>.metadata.name<span style=color:#666>}</span><span style=color:#a2f;font-weight:700>)</span>
</span></span></code></pre></div><p>Menampilkan log sebuah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl logs <span style=color:#b8860b>$pods</span>
</span></span></code></pre></div><p>Keluaran akan mirip dengan ini:</p><pre tabindex=0><code>Fri Feb 22 11:02:09 UTC 2019
Hello from the Kubernetes cluster
</code></pre><h2 id=menghapus-sebuah-cronjob>Menghapus sebuah CronJob</h2><p>Ketika kamu tidak membutuhkan sebuah CronJob lagi, kamu dapat megnhapusnya dengan perintah <code>kubectl delete cronjob &lt;cronjob name></code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete cronjob hello
</span></span></code></pre></div><p>Menghapus CronJob akan menghapus semua Job dan Pod yang telah terbuat dan menghentikanya dari pembuatan Job tambahan.
Kamu dapat membaca lebih lanjut tentang menghapus Job di <a href=/id/docs/concepts/workloads/controllers/garbage-collection/><em>garbage collection</em></a>.</p><h2 id=menulis-speifikasi-sebuah-cron>Menulis Speifikasi Sebuah Cron</h2><p>Seperti semua konfigurasi Kubernetes, sebuah CronJob membutuhkan <em>field</em> <code>apiVersion</code>, <code>kind</code>, dan <code>metadata</code>. Untuk informasi
umum tentang bekerja dengan berkas konfigurasi, lihat dokumentasi <a href=/docs/user-guide/deploying-applications>men-<em>deploy</em> aplikasi</a>,
dan <a href=/docs/user-guide/working-with-resources>mengunakan kubectl untuk manajemen sumber daya</a>.</p><p>Sebuah konfigurasi CronJob juga membutuhkan sebuah <a href=https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status>bagian <code>.spec</code></a>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Semua modifikasi pada sebuah CronJob, terutama <code>.spec</code>, akan diterapkan pada proses berikut.</div><h3 id=penjadwalan>Penjadwalan</h3><p><code>.spec.schedule</code> adalah <em>field</em> yang wajib diisi dari sebuah <code>.spec</code>
Dibutuhkan sebuah format string <a href=https://en.wikipedia.org/wiki/Cron>Cron</a>, misalnya <code>0 * * * *</code> atau <code>@hourly</code>, sebagai jadwal Job untuk dibuat dan dieksekusi.</p><p>Format ini juga mencakup nilai langkah "Vixie cron". Seperti penjelasan di <a href=https://www.freebsd.org/cgi/man.cgi?crontab%285%29>FreeBSD manual</a>:</p><blockquote><p>Nilai langkah dapat digunakan bersama dengan rentang. Sebuah rentang diikuti dengan
<code>/&lt;number></code> menentukan lompatan angka melalui rentang.
Misalnya, <code>0-23/2</code> dapat digunakan dalam jam untuk menentukan
perintah akan dieksekusi setiap jam (alternatif dalam bawaan v7 adalah
<code>0,2,4,6,8,10,12,14,16,18,20,22</code>). Langkah-langkah juga diizinkan setelah
tanda bintang, jadi jika kamu menginginkan "setiap dua jam", gunakan saja <code>*/2</code>.</p></blockquote><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Sebuah tanda tanya (<code>?</code>) dalam penjadwalan memiliki makna yang sama dengan tanda bintang <code>*</code>, yaitu, singkatan dari nilai apa pun yang tersedia untuk <em>field</em> tertentu.</div><h3 id=templat-job>Templat Job</h3><p><code>.spec.JobTemplate</code> adalah templat untuk sebuah Job, dan itu wajib.
Templat Job memiliki skema yang sama dengan <a href=/id/docs/concepts/workloads/controllers/job/>Job</a>, kecuali jika bersarang dan tidak memiliki sebuah <code>apiVersion</code> atau <code>kind</code>.
Untuk informasi lebih lanjut tentang menulis sebuah Job <code>.spec</code> lihat <a href=/id/docs/concepts/workloads/controllers/job/#writing-a-job-spec>Menulis spesifikasi Job</a>.</p><h3 id=starting-deadline><em>Starting Deadline</em></h3><p><em>Field</em> <code>.spec.startingDeadlineSeconds</code> adalah <em>field</em> opsional.
<em>Field</em> tersebut berarti batas waktu dalam satuan detik untuk memulai sebuah Job jika Job melewatkan waktu yang telah dijadwalkan karena alasan apapun.
Setelah mencapai batas waktu, CronJob tidak akan memulai sebuah Job.
Job yang tidak memenuhi batas waktu, dengan cara ini dianggap sebagai Job yang gagal.
Jika <em>field</em> ini tidak ditentukan, maka Job tidak memiliki batas waktu.</p><p><em>Controller</em> CronJob menghitung berapa banyak jadwal yang terlewat untuk sebuah CronJob. jika lebih dari 100 jadwal yang terlewat, maka tidak ada lagi CronJob yang akan dijadwalkan. Ketika <code>.spec.startingDeadlineSeconds</code> tidak disetel, CronJob Controller menghitung jadwal yang terlewat dari <code>status.lastScheduleTime</code> hingga sekarang.</p><p>Misalnya, sebuah CronJob seharusnya berjalan setiap menit, <code>status.lastScheduleTime</code> CronJob adalah pukul 5:00am, tetapi sekarang pukul 07:00am. Itu berarti ada 120 jadwal yang terlewat, maka tidak ada lagi CronJob yang akan dijadwalkan.</p><p>Jika <em>field</em> <code>.spec.startingDeadlineSeconds</code> disetel (tidak kosong), CronJob Controller akah menghitung berapa banyak Job yang terlewat dari nilai <code>.spec.startingDeadlineSeconds</code> hingga sekarang.</p><p>Misalnya, jika disetel ke <code>200</code>, CronJob Controller akan menghitung jadwal yang terlewat dalam 200 detik terakhir. Pada kasus ini, jika terdapat lebih dari 100 jadwal yang terlewat dalam 200 detik terakhir, maka tidak ada lagi CronJob yang akan dijadwalkan.</p><h3 id=kebijakan-concurrency>Kebijakan <em>Concurrency</em></h3><p><em>Field</em> <code>.spec.concurrencyPolicy</code> juga opsional.
<em>Field</em> tersebut menentukan bagaimana memperlakukan eksekusi <em>concurrent</em> dari sebuah Job yang dibuat oleh CronJob.
Kamu dapat menetapkan hanya satu dari kebijakan <em>concurrency</em>:</p><ul><li><code>Allow</code> (bawaan): CronJob mengizinkan Job berjalan secara <em>concurrent</em></li><li><code>Forbid</code> : Job tidak mengizinkan Job berjalan secara <em>concurrent</em>; jika sudah saatnya untuk menjalankan Job baru dan Job sebelumnya belum selesai, maka CronJob akan melewatkan Job baru yang akan berjalan</li><li><code>Replace</code>: Jika sudah saatnya untuk menjalankan Job baru dan Job sebelumnya belum selesai, maka CronJob akan mengganti Job yang sedang berjalan dengan Job baru.</li></ul><p>Perhatikan bahwa kebijakan <em>concurrency</em> hanya berlaku untuk Job yang dibuat dengan CronJob yang sama.
Jika terdapat banyak CronJob, Job akan selalu diizinkan untuk berjalan secara <em>concurrent</em>.</p><h3 id=penangguhan>Penangguhan</h3><p><em>Field</em> <code>.spec.suspend</code> juga opsional.
Jika <em>field</em> tersebut disetel <code>true</code>, semua eksekusi selanjutnya akan ditangguhkan.
Konfigurasi ini tidak dapat berlaku untuk eksekusi yang sudah dimulai.
Secara bawaan <em>false</em>.</p><div class="alert alert-warning caution callout" role=alert><strong>Perhatian:</strong> Eksekusi yang ditangguhkan selama waktu yang dijadwalkan dihitung sebagai Job yang terlewat.
Ketika <code>.spec.suspend</code> diubah dari <code>true</code> ke <code>false</code> pada CronJob yang memiliki konfigurasi tanpa <a href=#starting-deadline>batas waktu</a>, Job yang terlewat akan dijadwalkan segera.</div><h3 id=batas-riwayat-pekerjaan>Batas Riwayat Pekerjaan</h3><p><em>Field</em> <code>.spec.successfulJobHistoryLimit</code> dan <code>.spec.failedJobHistoryLimit</code> juga opsional.
<em>Field</em> tersebut menentukan berapa banyak Job yang sudah selesai dan gagal yang harus disimpan.
Secara bawaan, masing-masing <em>field</em> tersebut disetel 3 dan 1. Mensetel batas ke <code>0</code> untuk menjaga tidak ada Job yang sesuai setelah Job tersebut selesai.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f5da33b976758a9183018c421eb83f58>3 - Mengatur Pod dan Kontainer</h1></div><div class=td-content><h1 id=pg-e6dd9300cf3a955f7cdfe77fb5d15292>3.1 - Menetapkan Sumber Daya Memori untuk Container dan Pod</h1><p>Laman ini menunjukkan bagaimana menetapkan permintaan dan batasan memori untuk Container.
Container dijamin memiliki memori sebanyak yang diminta,
tetapi tidak diperbolehkan untuk menggunakan memori melebihi batas.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><p>Setiap Node pada klaster kamu harus memiliki memori setidaknya 300 MiB.</p><p>Beberapa langkah pada laman ini mengharuskan kamu menjalankan Service
<a href=https://github.com/kubernetes-incubator/metrics-server><em>metrics-server</em></a>
pada klaster kamu. Jika kamu memiliki <em>metrics-server</em>
yang sudah berjalan, kamu dapat melewati langkah-langkah berikut ini.</p><p>Jika kamu menjalankan Minikube, jalankan perintah berikut untuk mengaktifkan
<em>metrics-server</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>minikube addons <span style=color:#a2f>enable</span> metrics-server
</span></span></code></pre></div><p>Untuk melihat apakah <em>metrics-server</em> sudah berjalan, atau penyedia lain dari API metrik sumber daya
(<code>metrics.k8s.io</code>), jalankan perintah berikut ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get apiservices
</span></span></code></pre></div><p>Jika API metrik sumber daya telah tersedia, keluarannya meliputi seperti
acuan pada <code>metrics.k8s.io</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME
</span></span><span style=display:flex><span>v1beta1.metrics.k8s.io
</span></span></code></pre></div><h2 id=membuat-namespace>Membuat Namespace</h2><p>Buat Namespace sehingga sumber daya yang kamu buat dalam latihan ini
terisolasi dari klaster kamu yang lain.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create namespace mem-example
</span></span></code></pre></div><h2 id=menentukan-permintaan-memori-dan-batasan-memori>Menentukan permintaan memori dan batasan memori</h2><p>Untuk menentukan permintaan memori untuk Container, sertakan <em>field</em> <code>resources:requests</code>
pada manifes sumber daya dari Container. Untuk menentukan batasan memori, sertakan <code>resources:limits</code>.</p><p>Dalam latihan ini, kamu akan membuat Pod yang memiliki satu Container. Container memiliki permintaan memori
sebesar 100 MiB dan batasan memori sebesar 200 MiB. Berikut berkas konfigurasi
untuk Pod:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/resource/memory-request-limit.yaml download=pods/resource/memory-request-limit.yaml><code>pods/resource/memory-request-limit.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-resource-memory-request-limit-yaml")' title="Copy pods/resource/memory-request-limit.yaml to clipboard"></img></div><div class=includecode id=pods-resource-memory-request-limit-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>memory-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>mem-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>memory-demo-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>polinux/stress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;200Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;100Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;stress&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;--vm&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;--vm-bytes&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;150M&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;--vm-hang&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Bagian <code>args</code> dalam berkas konfigurasi memberikan argumen untuk Container pada saat dimulai.
Argumen<code>"--vm-bytes", "150M"</code> memberi tahu Container agar mencoba mengalokasikan memori sebesar 150 MiB.</p><p>Buatlah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/resource/memory-request-limit.yaml --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Verifikasi apakah Container dalam Pod sudah berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod memory-demo --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Lihat informasi mendetil tentang Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod memory-demo --output<span style=color:#666>=</span>yaml --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa satu Container dalam Pod memiliki permintaan memori sebesar 100 MiB
dan batasan memori sebesar 200 MiB.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>200Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>100Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Jalankan <code>kubectl top</code> untuk mengambil metrik dari Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl top pod memory-demo --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa Pod menggunakan memori sekitar 162.900.000 byte, dimana
sekitar 150 MiB. Ini lebih besar dari permintaannya sebesar 100 MiB Pod, tetapi masih di dalam
batasan Pod sebesar 200 MiB.</p><pre tabindex=0><code>NAME                        CPU(cores)   MEMORY(bytes)
memory-demo                 &lt;something&gt;  162856960
</code></pre><p>Hapuslah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod memory-demo --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><h2 id=melebihi-batasan-memori-dari-container>Melebihi batasan memori dari Container</h2><p>Container dapat melebihi permintaan memorinya jika Node memiliki memori yang tersedia. Tapi sebuah Container
tidak diperbolehkan untuk menggunakan lebih dari batasan memorinya. Jika Container mengalokasikan lebih banyak memori daripada
batasannya, Container menjadi kandidat untuk dihentikan. Jika Container terus berlanjut
mengkonsumsi memori melebihi batasnya, maka Container akan diakhiri. Jika Container dihentikan dan bisa
di mulai ulang, kubelet akan memulai ulang, sama seperti jenis kegagalan <em>runtime</em> yang lainnya.</p><p>Dalam latihan ini, kamu membuat Pod yang mencoba mengalokasikan lebih banyak memori dari batasannya.
Berikut adalah berkas konfigurasi untuk Pod yang memiliki satu Container dengan berkas
permintaan memori sebesar 50 MiB dan batasan memori sebesar 100 MiB:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/resource/memory-request-limit-2.yaml download=pods/resource/memory-request-limit-2.yaml><code>pods/resource/memory-request-limit-2.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-resource-memory-request-limit-2-yaml")' title="Copy pods/resource/memory-request-limit-2.yaml to clipboard"></img></div><div class=includecode id=pods-resource-memory-request-limit-2-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>memory-demo-2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>mem-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>memory-demo-2-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>polinux/stress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;50Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;100Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;stress&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;--vm&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;--vm-bytes&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;250M&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;--vm-hang&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Dalam bagian <code>args</code> dari berkas konfigurasi, kamu dapat melihat bahwa Container tersebut
akan mencoba mengalokasikan memori sebesar 250 MiB, yang jauh di atas batas yaitu 100 MiB.</p><p>Buatlah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/resource/memory-request-limit-2.yaml --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Lihat informasi mendetail tentang Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod memory-demo-2 --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Sampai sini, Container mungkin sedang berjalan atau dimatikan. Ulangi perintah sebelumnya hingga Container dimatikan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME            READY     STATUS      RESTARTS   AGE
</span></span><span style=display:flex><span>memory-demo-2   0/1       OOMKilled   <span style=color:#666>1</span>          24s
</span></span></code></pre></div><p>Dapatkan tampilan yang lebih mendetail tentang status Container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod memory-demo-2 --output<span style=color:#666>=</span>yaml --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa Container dimatikan karena kehabisan memori (OOM):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>lastState:
</span></span><span style=display:flex><span>   terminated:
</span></span><span style=display:flex><span>     containerID: docker://65183c1877aaec2e8427bc95609cc52677a454b56fcb24340dbd22917c23b10f
</span></span><span style=display:flex><span>     exitCode: <span style=color:#666>137</span>
</span></span><span style=display:flex><span>     finishedAt: 2017-06-20T20:52:19Z
</span></span><span style=display:flex><span>     reason: OOMKilled
</span></span><span style=display:flex><span>     startedAt: null
</span></span></code></pre></div><p>Container dalam latihan ini dapat dimulai ulang, sehingga kubelet akan memulai ulangnya. Ulangi
perintah ini beberapa kali untuk melihat bahwa Container berulang kali dimatikan dan dimulai ulang:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod memory-demo-2 --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa Container dimatikan, dimulai ulang, dimatikan lagi, dimulai ulang lagi, dan seterusnya:</p><pre tabindex=0><code>kubectl get pod memory-demo-2 --namespace=mem-example
NAME            READY     STATUS      RESTARTS   AGE
memory-demo-2   0/1       OOMKilled   1          37s
</code></pre><pre tabindex=0><code>
kubectl get pod memory-demo-2 --namespace=mem-example
NAME            READY     STATUS    RESTARTS   AGE
memory-demo-2   1/1       Running   2          40s
</code></pre><p>Lihat informasi mendetail tentang riwayat Pod:</p><pre tabindex=0><code>kubectl describe pod memory-demo-2 --namespace=mem-example
</code></pre><p>Keluarannya menunjukkan bahwa Container dimulai dan gagal berulang kali:</p><pre tabindex=0><code>... Normal  Created   Created container with id 66a3a20aa7980e61be4922780bf9d24d1a1d8b7395c09861225b0eba1b1f8511
... Warning BackOff   Back-off restarting failed container
</code></pre><p>Lihat informasi mendetail tentang Node klaster Anda:</p><pre tabindex=0><code>kubectl describe nodes
</code></pre><p>Keluarannya mencakup rekaman Container yang dimatikan karena kondisi kehabisan memori:</p><pre tabindex=0><code>Warning OOMKilling Memory cgroup out of memory: Kill process 4481 (stress) score 1994 or sacrifice child
</code></pre><p>Hapus Pod kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod memory-demo-2 --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><h2 id=menentukan-permintaan-memori-yang-terlalu-besar-untuk-node-kamu>Menentukan permintaan memori yang terlalu besar untuk Node kamu</h2><p>Permintaan dan batasan memori yang dikaitkan dengan Container, berguna untuk berpikir
apakah sebuah Pod yang memiliki permintaan dan batasan memori. Permintaan memori untuk Pod tersebut adalah
jumlah permintaan memori untuk semua Container dalam Pod. Begitu juga dengan batasan memori
untuk Pod adalah jumlah batasan memori dari semua Container di dalam Pod.</p><p>Penjadwalan Pod didasarkan pada permintaan. Sebuah Pod dijadwalkan untuk berjalan di sebuah Node hanya jika sebuah Node
memiliki cukup memori yang tersedia untuk memenuhi permintaan memori dari Pod tersebut.</p><p>Dalam latihan ini, kamu membuat Pod yang memiliki permintaan memori yang sangat besar sehingga melebihi
kapasitas dari Node mana pun dalam klaster kamu. Berikut adalah berkas konfigurasi untuk Pod yang memiliki
Container dengan permintaan memori 1000 GiB, yang kemungkinan besar melebihi kapasitas
dari setiap Node dalam klaster kamu.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/resource/memory-request-limit-3.yaml download=pods/resource/memory-request-limit-3.yaml><code>pods/resource/memory-request-limit-3.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-resource-memory-request-limit-3-yaml")' title="Copy pods/resource/memory-request-limit-3.yaml to clipboard"></img></div><div class=includecode id=pods-resource-memory-request-limit-3-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>memory-demo-3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>mem-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>memory-demo-3-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>polinux/stress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1000Gi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1000Gi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;stress&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;--vm&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;--vm-bytes&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;150M&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;--vm-hang&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buatlah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/resource/memory-request-limit-3.yaml --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Lihat status Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod memory-demo-3 --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa status Pod adalah PENDING. Artinya, Pod tidak dijadwalkan untuk berjalan di Node mana pun, dan Pod akan tetap dalam status PENDING tanpa batas waktu:</p><pre tabindex=0><code>kubectl get pod memory-demo-3 --namespace=mem-example
NAME            READY     STATUS    RESTARTS   AGE
memory-demo-3   0/1       Pending   0          25s
</code></pre><p>Lihat informasi mendetail tentang Pod, termasuk <em>event</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe pod memory-demo-3 --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa Container tidak dapat dijadwalkan karena memori yang tidak cukup pada Node:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  ...  Reason            Message
</span></span><span style=display:flex><span>       ------            -------
</span></span><span style=display:flex><span>  ...  FailedScheduling  No nodes are available that match all of the following predicates:: Insufficient memory <span style=color:#666>(</span>3<span style=color:#666>)</span>.
</span></span></code></pre></div><h2 id=satuan-memori>Satuan Memori</h2><p>Sumber daya memori diukur dalam satuan <em>byte</em>. Kamu dapat mengekspresikan memori sebagai bilangan bulat biasa atau
bilangan bulan <em>fixed-point</em> dengan salah satu akhiran ini: E, P, T, G, M, K, Ei, Pi, Ti, Gi, Mi, Ki.
Contoh berikut ini mewakili nilai yang kira-kira sama:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>128974848, 129e6, 129M , 123Mi
</span></span></code></pre></div><p>Hapuslah Pod kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod memory-demo-3 --namespace<span style=color:#666>=</span>mem-example
</span></span></code></pre></div><h2 id=jika-kamu-tidak-menentukan-batasan-memori>Jika kamu tidak menentukan batasan memori</h2><p>Jika kamu tidak menentukan batasan memori untuk sebuah Container, salah satu dari situasi berikut ini berlaku:</p><ul><li><p>Container tidak memiliki batasan maksimum jumlah memori yang digunakannya. Container
dapat menggunakan semua memori yang tersedia dalam Node dimana Container itu berjalan yang pada gilirannya dapat memanggil penyetop OOM (<em>out-of-memory</em>).
Lebih lanjut, dalam kasus menghentikan OOM, Container tanpa batas sumber daya akan memiliki peluang lebih besar untuk dihentikan.</p></li><li><p>Container berjalan pada Namespace yang memiliki batasan bawaan memori, dan
Container secara otomatis menetapkan batasan bawaan. Administrator klaster dapat menggunakan
<a href=/docs/reference/generated/kubernetes-api/v1.25/#limitrange-v1-core>LimitRange</a>
untuk menentukan batasan memori secara bawaan.</p></li></ul><h2 id=motivasi-untuk-permintaan-dan-batasan-memori>Motivasi untuk permintaan dan batasan memori</h2><p>Dengan mengonfigurasi permintaan dan batasan memori untuk Container yang berjalan pada berkas
klaster, kamu dapat menggunakan sumber daya memori yang tersedia pada Node klaster kamu secara efisien.
Dengan menjaga permintaan memori pada Pod tetap rendah, kamu memberikan kesempatan yang baik untuk Pod tersebut
dijadwalkan. Dengan memiliki batas memori yang lebih besar dari permintaan memori, Anda mencapai dua hal:</p><ul><li>Pod dapat memiliki aktivitas yang bersifat <em>burst</em> dengan memanfaatkan memori yang kebetulan tersedia.</li><li>Jumlah memori yang dapat digunakan Pod selama keadaan <em>burst</em> dibatasi pada jumlah yang wajar.</li></ul><h2 id=membersihkan>Membersihkan</h2><p>Hapus Namespace kamu. Ini akan menghapus semua Pod yang kamu buat untuk tugas ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete namespace mem-example
</span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><h3 id=untuk-pengembang-aplikasi>Untuk pengembang aplikasi</h3><ul><li><p><a href=/docs/tasks/configure-pod-container/assign-cpu-resource/>Menetapkan sumber daya CPU ke Container dan Pod</a></p></li><li><p><a href=/docs/tasks/configure-pod-container/quality-service-pod/>Mengonfigurasi <em>Quality of Service</em> untuk Pod</a></p></li></ul><h3 id=untuk-administrator-klaster>Untuk administrator klaster</h3><ul><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/>Mengonfigurasi permintaan dan batasan bawaan memori untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/>Mengonfigurasi permintaan dan batasan bawaan CPU untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/memory-constraint-namespace/>Mengonfigurasi batasan memori minimum dan maksimum untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/>Mengonfigurasi batasan CPU minimum dan maksimum untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/>Mengonfigurasi kuota CPU dan memori untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/quota-pod-namespace/>Mengonfigurasi kuota Pod untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/quota-api-object/>Mengonfigurasi kuota untuk objek API</a></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-904cea8c8efd5c0d33adbfe579ec2dd2>3.2 - Konfigurasi Quality of Service untuk Pod</h1><p>Laman ini menunjukkan bagaimana mengonfigurasi Pod agar ditempatkan pada kelas <em>Quality of Service</em> (QoS) tertentu.
Kubernetes menggunakan kelas QoS untuk membuat keputusan tentang
penjadwalan dan pengeluaran Pod.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=qos-classes>Kelas QoS</h2><p>Saat membuat Pod, Kubernetes menempatkan salah satu kelas QoS berikut untuknya:</p><ul><li>Guaranteed</li><li>Burstable</li><li>BestEffort</li></ul><h2 id=membuat-sebuah-namespace>Membuat sebuah Namespace</h2><p>Buat sebuah Namespace sehingga sumber daya yang kamu buat dalam latihan ini
terisolasi dari klaster kamu yang lain.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create namespace qos-example
</span></span></code></pre></div><h2 id=membuat-sebuah-pod-yang-mendapatkan-penempatan-kelas-qos-guaranteed>Membuat sebuah Pod yang mendapatkan penempatan kelas QoS Guaranteed</h2><p>Agar sebuah Pod memiliki kelas QoS Guaranteed:</p><ul><li>Setiap Container, termasuk Container pemulai, di dalam Pod harus memiliki batasan memori dan permintaan memori dengan nilai yang sama.</li><li>Setiap Container, termasuk Container pemulai, di dalam Pod harus memiliki batasan CPU dan permintaan CPU dengan nilai yang sama.</li></ul><p>Berikut adalah berkas konfigurasi untuk sebuah Pod dengan satu Container. Container tersebut memiliki sebuah batasan memori dan sebuah
permintaan memori, keduanya sama dengan 200MiB. Container itu juga mempunyai batasan CPU dan permintaan CPU yang sama sebesar 700 milliCPU:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/qos/qos-pod.yaml download=pods/qos/qos-pod.yaml><code>pods/qos/qos-pod.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-qos-qos-pod-yaml")' title="Copy pods/qos/qos-pod.yaml to clipboard"></img></div><div class=includecode id=pods-qos-qos-pod-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>qos-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;200Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;700m&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;200Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;700m&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buatlah Pod：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/pods/qos/qos-pod.yaml --namespace<span style=color:#666>=</span>qos-example
</span></span></code></pre></div><p>Tampilkan informasi detail Pod yang telah dibuat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod qos-demo --namespace<span style=color:#666>=</span>qos-example --output<span style=color:#666>=</span>yaml
</span></span></code></pre></div><p>Keluaran dari perintah di atas menunjukkan Kubernetes memberikan kelas QoS Guaranteed pada Pod. Keluaran tersebut juga
membuktikan bahwa Container pada Pod memiliki permintaan memori yang sesuai dengan batasan memori dan permintaan CPU yang juga sesuai dengan batasan CPU yang dispesifikasikan.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span>700m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>200Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span>700m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>200Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>qosClass</span>:<span style=color:#bbb> </span>Guaranteed<span style=color:#bbb>
</span></span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Jika sebuah Container hanya menspesifikasikan batasan memori tanpa menentukan permintaan memori, maka Kubernetes akan
secara otomatis menetapkan permintaan memori yang sesuai dengan batasan memori yang dicantumkan. Sama halnya jika sebuah Container menspesifikasikan batasan
CPU tanpa menentukan permintaan CPU, maka Kubernetes akan secara otomatis menetapkan permintaan CPU yang sesuai
dengan batasan CPU yang dicantumkan.</div><p>Hapuslah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod qos-demo --namespace<span style=color:#666>=</span>qos-example
</span></span></code></pre></div><h2 id=membuat-sebuah-pod-yang-mendapatkan-penempatan-kelas-qos-burstable>Membuat sebuah Pod yang mendapatkan penempatan kelas Qos Burstable</h2><p>Sebuah Pod akan mendapatkan kelas QoS Burstable apabila:</p><ul><li>Pod tidak memenuhi kriteria untuk kelas QoS Guaranteed.</li><li>Setidaknya ada satu Container di dalam Pod dengan permintaan memori atau CPU.</li></ul><p>Berikut adalah berkas konfigurasi untuk Pod dengan satu Container. Container yang dimaksud memiliki batasan memori sebesar 200MiB
dan permintaan memori sebesar 100MiB.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/qos/qos-pod-2.yaml download=pods/qos/qos-pod-2.yaml><code>pods/qos/qos-pod-2.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-qos-qos-pod-2-yaml")' title="Copy pods/qos/qos-pod-2.yaml to clipboard"></img></div><div class=includecode id=pods-qos-qos-pod-2-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>qos-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-2-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;200Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;100Mi&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buatlah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/pods/qos/qos-pod-2.yaml --namespace<span style=color:#666>=</span>qos-example
</span></span></code></pre></div><p>Tampilkan informasi detail Pod yang telah dibuat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod qos-demo-2 --namespace<span style=color:#666>=</span>qos-example --output<span style=color:#666>=</span>yaml
</span></span></code></pre></div><p>Keluaran dari perintah di atas menunjukkan Kubernetes memberikan kelas QoS Burstable pada Pod.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>Always<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-2-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>200Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>100Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>qosClass</span>:<span style=color:#bbb> </span>Burstable<span style=color:#bbb>
</span></span></span></code></pre></div><p>Hapuslah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod qos-demo-2 --namespace<span style=color:#666>=</span>qos-example
</span></span></code></pre></div><h2 id=membuat-sebuah-pod-yang-mendapatkan-penempatan-kelas-qos-besteffort>Membuat sebuah Pod yang mendapatkan penempatan kelas QoS BestEffort</h2><p>Agar Pod mendapatkan kelas QoS BestEffort, Container dalam pod tidak boleh
memiliki batasan atau permintaan memori atau CPU.</p><p>Berikut adalah berkas konfigurasi untuk Pod dengan satu Container. Container yang dimaksud tidak memiliki batasan atau permintaan memori atau CPU apapun.<div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/qos/qos-pod-3.yaml download=pods/qos/qos-pod-3.yaml><code>pods/qos/qos-pod-3.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-qos-qos-pod-3-yaml")' title="Copy pods/qos/qos-pod-3.yaml to clipboard"></img></div><div class=includecode id=pods-qos-qos-pod-3-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>qos-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-3-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span></code></pre></div></div></div></p><p>Buatlah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/pods/qos/qos-pod-3.yaml --namespace<span style=color:#666>=</span>qos-example
</span></span></code></pre></div><p>Tampilkan informasi detail Pod yang telah dibuat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod qos-demo-3 --namespace<span style=color:#666>=</span>qos-example --output<span style=color:#666>=</span>yaml
</span></span></code></pre></div><p>Keluaran dari perintah di atas menunjukkan Kubernetes memberikan kelas QoS BestEffort pada Pod.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>qosClass</span>:<span style=color:#bbb> </span>BestEffort<span style=color:#bbb>
</span></span></span></code></pre></div><p>Hapuslah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod qos-demo-3 --namespace<span style=color:#666>=</span>qos-example
</span></span></code></pre></div><h2 id=membuat-sebuah-pod-yang-memiliki-dua-container>Membuat sebuah Pod yang memiliki dua Container</h2><p>Berikut adalah konfigurasi berkas untuk Pod yang memiliki dua Container. Satu Container menentukan permintaan memori sebesar 200MiB. Container yang lain tidak menentukan permintaan atau batasan apapun.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/qos/qos-pod-4.yaml download=pods/qos/qos-pod-4.yaml><code>pods/qos/qos-pod-4.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-qos-qos-pod-4-yaml")' title="Copy pods/qos/qos-pod-4.yaml to clipboard"></img></div><div class=includecode id=pods-qos-qos-pod-4-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-4<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>qos-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-4-ctr-1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;200Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-4-ctr-2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Perhatikan bahwa Pod ini memenuhi kriteria untuk kelas QoS Burstable. Maksudnya, Container tersebut tidak memenuhi
kriteria untuk kelas QoS Guaranteed, dan satu dari Container tersebut memiliki permintaan memori.</p><p>Buatlah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/pods/qos/qos-pod-4.yaml --namespace<span style=color:#666>=</span>qos-example
</span></span></code></pre></div><p>Tampilkan informasi detail Pod yang telah dibuat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod qos-demo-4 --namespace<span style=color:#666>=</span>qos-example --output<span style=color:#666>=</span>yaml
</span></span></code></pre></div><p>Keluaran dari perintah di atas menunjukkan Kubernetes memberikan kelas QoS Burstable pada Pod.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-4-ctr-1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>200Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>qos-demo-4-ctr-2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>qosClass</span>:<span style=color:#bbb> </span>Burstable<span style=color:#bbb>
</span></span></span></code></pre></div><p>Hapuslah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod qos-demo-4 --namespace<span style=color:#666>=</span>qos-example
</span></span></code></pre></div><h2 id=membersihkan>Membersihkan</h2><p>Hapuslah Namespace:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete namespace qos-example
</span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><h3 id=untuk-pengembang-aplikasi>Untuk pengembang aplikasi</h3><ul><li><p><a href=/id/docs/tasks/configure-pod-container/assign-memory-resource/>Menetapkan sumber daya memori ke Container dan Pod</a></p></li><li><p><a href=/docs/tasks/configure-pod-container/assign-cpu-resource/>Menetapkan permintaan CPU pada Container dan Pod</a></p></li></ul><h3 id=untuk-administrator-klaster>Untuk administrator klaster</h3><ul><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/>Mengonfigurasi permintaan dan batasan bawaan memori untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/>Mengonfigurasi permintaan dan batasan bawaan CPU untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/memory-constraint-namespace/>Mengonfigurasi batasan memori minimum dan maksimum untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/>Mengonfigurasi batasan CPU minimum dan maksimum untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/>Mengonfigurasi kuota CPU dan memori untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/manage-resources/quota-pod-namespace/>Mengonfigurasi kuota Pod untuk Namespace</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/quota-api-object/>Mengonfigurasi kuota untuk objek API</a></p></li><li><p><a href=/id/docs/tasks/administer-cluster/topology-manager/>Kebijakan Pengaturan Manajemen Topologi pada sebuah Node</a></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-484833fb880d1e179cc2965d15f84da5>3.3 - Mengatur Pod untuk Menggunakan Volume sebagai Tempat Penyimpanan</h1><p>Laman ini menjelaskan bagaimana cara mengatur sebuah Pod untuk menggunakan Volume sebagai tempat penyimpanan.</p><p><em>Filesystem</em> dari sebuah Container hanya hidup selama Container itu juga hidup. Saat Container berakhir dan dimulai ulang, perubahan pada <em>filesystem</em> akan hilang. Untuk penyimpanan konsisten yang independen dari Container, kamu dapat menggunakan <a href=/id/docs/concepts/storage/volumes/>Volume</a>. Hal ini penting terutama untuk aplikasi <em>stateful</em>, seperti <em>key-value stores</em> (contohnya Redis) dan database.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mengatur-volume-untuk-pod>Mengatur volume untuk Pod</h2><p>Pada latihan ini, kamu membuat sebuah Pod yang menjalankan sebuah Container. Pod ini memiliki sebuah Volume dengan tipe <a href=/id/docs/concepts/storage/volumes/#emptydir>emptyDir</a>
yang tetap bertahan, meski Container berakhir dan dimulai ulang. Berikut berkas konfigurasi untuk Pod:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/storage/redis.yaml download=pods/storage/redis.yaml><code>pods/storage/redis.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-storage-redis-yaml")' title="Copy pods/storage/redis.yaml to clipboard"></img></div><div class=includecode id=pods-storage-redis-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>redis-storage<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/data/redis<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>redis-storage<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>emptyDir</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/storage/redis.yaml
</span></span></code></pre></div></li><li><p>Verifikasi apakah Container dari Pod berjalan sukses, lalu mengamati perubahan terhadap Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod redis --watch
</span></span></code></pre></div><p>Hasil keluaran seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME      READY     STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>redis     1/1       Running   <span style=color:#666>0</span>          13s
</span></span></code></pre></div></li><li><p>Pada terminal lain, buka <em>shell</em> untuk masuk ke Container yang sedang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it redis -- /bin/bash
</span></span></code></pre></div></li><li><p>Di dalam <em>shell</em>, pergi ke <code>/data/redis</code>, kemudian buat sebuah berkas:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@redis:/data# <span style=color:#a2f>cd</span> /data/redis/
</span></span><span style=display:flex><span>root@redis:/data/redis# <span style=color:#a2f>echo</span> Hello &gt; test-file
</span></span></code></pre></div></li><li><p>Di dalam <em>shell</em>, munculkan daftar proses-proses yang sedang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@redis:/data/redis# apt-get update
</span></span><span style=display:flex><span>root@redis:/data/redis# apt-get install procps
</span></span><span style=display:flex><span>root@redis:/data/redis# ps aux
</span></span></code></pre></div><p>Keluarannya mirip seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
</span></span><span style=display:flex><span>redis        <span style=color:#666>1</span>  0.1  0.1  <span style=color:#666>33308</span>  <span style=color:#666>3828</span> ?        Ssl  00:46   0:00 redis-server *:6379
</span></span><span style=display:flex><span>root        <span style=color:#666>12</span>  0.0  0.0  <span style=color:#666>20228</span>  <span style=color:#666>3020</span> ?        Ss   00:47   0:00 /bin/bash
</span></span><span style=display:flex><span>root        <span style=color:#666>15</span>  0.0  0.0  <span style=color:#666>17500</span>  <span style=color:#666>2072</span> ?        R+   00:48   0:00 ps aux
</span></span></code></pre></div></li><li><p>Di dalam <em>shell</em>, matikan proses Redis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@redis:/data/redis# <span style=color:#a2f>kill</span> &lt;pid&gt;
</span></span></code></pre></div><p>dengan <code>&lt;pid></code> adalah ID proses Redis (PID).</p></li><li><p>Di dalam terminal awal, amati perubahan terhadap Pod Redis. Sampai akhirnya kamu akan melihat hal seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME      READY     STATUS     RESTARTS   AGE
</span></span><span style=display:flex><span>redis     1/1       Running    <span style=color:#666>0</span>          13s
</span></span><span style=display:flex><span>redis     0/1       Completed  <span style=color:#666>0</span>         6m
</span></span><span style=display:flex><span>redis     1/1       Running    <span style=color:#666>1</span>         6m
</span></span></code></pre></div></li></ol><p>Sampai di sini, Container telah berakhir dan dimuat ulang. Hal ini karena Pod Redis memiliki
<a href=/docs/reference/generated/kubernetes-api/v1.25/#podspec-v1-core>restartPolicy</a>
dengan nilai <code>Always</code>.</p><ol><li><p>Gunakan <em>shell</em> untuk masuk ke dalam Container yang telah dimuat ulang:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it redis -- /bin/bash
</span></span></code></pre></div></li><li><p>Di dalam <em>shell</em>, pergi ke <code>/data/redis</code>, dan verifikasi apakah <code>test-file</code> masih ada.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@redis:/data/redis# <span style=color:#a2f>cd</span> /data/redis/
</span></span><span style=display:flex><span>root@redis:/data/redis# ls
</span></span><span style=display:flex><span>test-file
</span></span></code></pre></div></li><li><p>Hapus Pod yang kamu buat untuk latihan ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod redis
</span></span></code></pre></div></li></ol><h2 id=selanjutnya>Selanjutnya</h2><ul><li><p>Lihat <a href=/docs/reference/generated/kubernetes-api/v1.25/#volume-v1-core>Volume</a>.</p></li><li><p>Lihat <a href=/docs/reference/generated/kubernetes-api/v1.25/#pod-v1-core>Pod</a>.</p></li><li><p>Selain penyimpanan pada disk lokal yang di sediakan oleh <code>emptyDir</code>, Kubernetes
juga mendukung solusi penyimpanan <em>network-attached</em>, termasuk PD pada
GCE dan EBS dari EC2, yang cenderung lebih disukai untuk data sangat penting dan akan menangani urusan detil seperti <em>mounting</em> dan <em>unmounting</em> perangkat pada Node. Lihat
<a href=/id/docs/concepts/storage/volumes/>Volume</a> untuk informasi detil.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-528d2422215cb9632b7b45e886b023b5>3.4 - Mengatur Pod untuk Penyimpanan dengan PersistentVolume</h1><p>Laman ini akan menjelaskan bagaimana kamu dapat mengatur sebuah Pod dengan menggunakan
<a class=glossary-tooltip title='Mengklaim sumber daya penyimpanan yang didefinisikan di dalam suatu PersistentVolume, sehingga PersistentVolume tersebut dapat dipasang (mounted) sebagai sebuah volume pada suatu Container.' data-toggle=tooltip data-placement=top href=/id/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims target=_blank aria-label=PersistentVolumeClaim>PersistentVolumeClaim</a>
untuk penyimpanan.
Berikut ringkasan prosesnya:</p><ol><li><p>Kamu, sebagai seorang administrator klaster, membuat sebuah PersistentVolume yang didukung oleh penyimpanan
fisik. Kamu tidak mengaitkan volume dengan Pod apapun.</p></li><li><p>Kamu, sekarang mengambil peran sebagai seorang <em>developer</em> / pengguna klaster, membuat sebuah
PersistentVolumeClaim yang secara otomatis terikat dengan PersistentVolume yang sesuai.</p></li><li><p>Kamu membuat sebuah Pod yang menggunakan PersistentVolumeClaim di atas untuk penyimpanan.</p></li></ol><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><ul><li><p>Kamu membutuhkan sebuah klaster Kubernetes yang hanya memiliki satu Node, dan
<a class=glossary-tooltip title='Sebuah utilitas baris perintah untuk berkomunikasi dengan suatu server API Kubernetes.' data-toggle=tooltip data-placement=top href=/docs/user-guide/kubectl-overview/ target=_blank aria-label=kubectl>kubectl</a>
alat baris perintah yang sudah diatur untuk berkomunikasi dengan klaster kamu. Jika kamu
tidak memiliki sebuah klaster dengan Node tunggal, kamu dapat membuatnya dengan
<a href=/docs/getting-started-guides/minikube>Minikube</a>.</p></li><li><p>Familiar dengan materi di
<a href=/id/docs/concepts/storage/persistent-volumes/>Persistent Volumes</a>.</p></li></ul><h2 id=membuat-sebuah-berkas-index-html-di-dalam-node-kamu>Membuat sebuah berkas index.html di dalam Node kamu</h2><p>Buka sebuah <em>shell</em> ke Node tunggal di klaster kamu. Bagaimana kamu membuka sebuah <em>shell</em> tergantung
dengan bagaimana kamu mengatur klaster kamu. Contoh, jika kamu menggunakan Minikube, kamu
dapat membuka sebuah <em>shell</em> ke Node kamu dengan memasukkan <code>minikube ssh</code>.</p><p>Di dalam <em>shell</em> kamu pada Node itu, buat sebuah direktori dengan nama <code>/mnt/data</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Asumsikan Node kamu menggunakan &#34;sudo&#34; untuk menjalankan perintah</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># sebagai superuser</span>
</span></span><span style=display:flex><span>sudo mkdir /mnt/data
</span></span></code></pre></div><p>Di dalam direktori <code>/mnt/data</code>, buat sebuah berkas dengan nama <code>index.html</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Disini kembali asumsikan bahwa Node kamu menggunakan &#34;sudo&#34; untuk menjalankan perintah</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># sebagai superuser</span>
</span></span><span style=display:flex><span>sudo sh -c <span style=color:#b44>&#34;echo &#39;Hello from Kubernetes storage&#39; &gt; /mnt/data/index.html&#34;</span>
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Jika Node kamu menggunakan alat untuk mengakses <em>superuser</em> selain dengan <code>sudo</code>, kamu dapat
membuat ini bekerja jika mengganti <code>sudo</code> dengan nama dari alat lainnya.</div><p>Menguji bahwa berkas <code>index.html</code> ada:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat /mnt/data/index.html
</span></span></code></pre></div><p>Keluaran akan seperti ini:</p><pre tabindex=0><code>Hello from Kubernetes storage
</code></pre><p>Sekarang kamu dapat menutup <em>shell</em> di Node kamu.</p><h2 id=membuat-sebuah-persistentvolume>Membuat sebuah PersistentVolume</h2><p>Pada latihan ini, kamu akan membuat sebuah <em>hostPath</em> PersistentVolume. Kubernetes mendukung
hostPath untuk pengembangan dan pengujian di dalam klaster Node tunggal. Sebuah hostPath
PersistentVolume menggunakan berkas atau direktori di dalam Node untuk meniru penyimpanan terhubung jaringan (NAS, <em>network-attached storage</em>).</p><p>Di dalam klaster <em>production</em>, kamu tidak dapat menggunakan hostPath. Sebagai gantinya sebuah administrator klaster
akan menyediakan sumberdaya jaringan seperti Google Compute Engine <em>persistent disk</em>,
<em>NFS share</em>, atau sebuah Amazon Elastic Block Store volume. Administrator klaster juga dapat
menggunakan <a href=/docs/reference/generated/kubernetes-api/v1.25/#storageclass-v1-storage-k8s-io>StorageClass</a>
untuk mengatur
<a href=https://kubernetes.io/blog/2016/10/dynamic-provisioning-and-storage-in-kubernetes><em>provisioning</em> secara dinamis</a>.</p><p>Berikut berkas konfigurasi untuk hostPath PersistentVolume:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/storage/pv-volume.yaml download=pods/storage/pv-volume.yaml><code>pods/storage/pv-volume.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-storage-pv-volume-yaml")' title="Copy pods/storage/pv-volume.yaml to clipboard"></img></div><div class=includecode id=pods-storage-pv-volume-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PersistentVolume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>task-pv-volume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>local<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>storageClassName</span>:<span style=color:#bbb> </span>manual<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>capacity</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>storage</span>:<span style=color:#bbb> </span>10Gi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>accessModes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- ReadWriteOnce<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPath</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;/mnt/data&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Berkas konfigurasi tersebut menentukan bahwa volume berada di <code>/mnt/data</code> pada
klaster Node. Konfigurasi tersebut juga menentukan ukuran dari 10 gibibytes dan
mode akses <code>ReadWriteOnce</code>, yang berarti volume dapat di pasang sebagai
<em>read-write</em> oleh Node tunggal. Konfigurasi ini menggunakan <a href=/id/docs/concepts/storage/persistent-volumes/#kelas>nama dari StorageClass</a>
<code>manual</code> untuk PersistentVolume, yang akan digunakan untuk mengikat
permintaan PeristentVolumeClaim ke PersistentVolume ini.</p><p>Membuat sebuah PersistentVolume:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/storage/pv-volume.yaml
</span></span></code></pre></div><p>Melihat informasi tentang PersistentVolume:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pv task-pv-volume
</span></span></code></pre></div><p>Keluaran menunjuk PersistentVolume memliki sebuah <code>STATUS</code> dari <code>Available</code>. Ini
berarti PersistentVolume belum terikat ke PersistentVolumeClaim.</p><pre><code>NAME             CAPACITY   ACCESSMODES   RECLAIMPOLICY   STATUS      CLAIM     STORAGECLASS   REASON    AGE
task-pv-volume   10Gi       RWO           Retain          Available             manual                   4s
</code></pre><h2 id=membuat-sebuah-persistentvolumeclaim>Membuat sebuah PersistentVolumeClaim</h2><p>Langkah selanjutnya adalah membuat sebuah PersistentVolumeClaim. Pod menggunakan PersistentVolumeClaim
untuk meminta penyimpanan fisik. Pada latihan ini, kamu akan membuat sebuah PersistentVolumeClaim
yang meminta sebuah volume minimal tiga gibibytes dengan mode akses <em>read-write</em>
setidaknya untuk satu Node.</p><p>Berikut berkas konfigurasi untuk PersistentVolumeClaim:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/storage/pv-claim.yaml download=pods/storage/pv-claim.yaml><code>pods/storage/pv-claim.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-storage-pv-claim-yaml")' title="Copy pods/storage/pv-claim.yaml to clipboard"></img></div><div class=includecode id=pods-storage-pv-claim-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PersistentVolumeClaim<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>task-pv-claim<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>storageClassName</span>:<span style=color:#bbb> </span>manual<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>accessModes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- ReadWriteOnce<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>storage</span>:<span style=color:#bbb> </span>3Gi<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Membuat sebuah PersistentVolumeClaim:</p><pre><code>kubectl apply -f https://k8s.io/examples/pods/storage/pv-claim.yaml
</code></pre><p>Setelah membuat sebuah PersistentVolumeClaim, Kubernetes <em>control plane</em> terlihat
untuk sebuah PersistentVolumeClaim yang memenuhi persyaratan <em>claim's</em>. Jika
<em>control plane</em> menemukan PersistentVolume yang cocok dengan StorageClass, maka
akan mengikat <em>claim</em> ke dalam volume tersebut.</p><p>Lihat kembali PersistentVolume:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pv task-pv-volume
</span></span></code></pre></div><p>Sekarang keluaran menunjukan sebuah <code>STATUS</code> dari <code>Bound</code>.</p><pre><code>NAME             CAPACITY   ACCESSMODES   RECLAIMPOLICY   STATUS    CLAIM                   STORAGECLASS   REASON    AGE
task-pv-volume   10Gi       RWO           Retain          Bound     default/task-pv-claim   manual                   2m
</code></pre><p>Lihat PersistentVolumeClaim:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pvc task-pv-claim
</span></span></code></pre></div><p>Keluaran menunjukan PersistentVolumeClaim terlah terikat dengan PersistentVolume,
<code>task-pv-volume</code>.</p><pre><code>NAME            STATUS    VOLUME           CAPACITY   ACCESSMODES   STORAGECLASS   AGE
task-pv-claim   Bound     task-pv-volume   10Gi       RWO           manual         30s
</code></pre><h2 id=membuat-sebuah-pod>Membuat sebuah Pod</h2><p>Langkah selanjutnya adalah membuat sebuah Pod yang akan menggunakan PersistentVolumeClaim sebagai volume.</p><p>Berikut berkas konfigurasi untuk Pod:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/storage/pv-pod.yaml download=pods/storage/pv-pod.yaml><code>pods/storage/pv-pod.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-storage-pv-pod-yaml")' title="Copy pods/storage/pv-pod.yaml to clipboard"></img></div><div class=includecode id=pods-storage-pv-pod-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>task-pv-pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>task-pv-storage<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>persistentVolumeClaim</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>claimName</span>:<span style=color:#bbb> </span>task-pv-claim<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>task-pv-container<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;http-server&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;/usr/share/nginx/html&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>task-pv-storage<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Perhatikan bahwa berkas konfigurasi Pod menentukan sebuah PersistentVolumeClaim, tetapi
tidak menentukan PeristentVolume. Dari sudut pandang Pod, <em>claim</em> adalah volume.</p><p>Membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/storage/pv-pod.yaml
</span></span></code></pre></div><p>Pastikan bahwa Container di dalam Pod berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod task-pv-pod
</span></span></code></pre></div><p>Mendapatkan sebuah <em>shell</em> ke Container yang sedang berjalan di Pod kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it task-pv-pod -- /bin/bash
</span></span></code></pre></div><p>Di dalam <em>shell</em>, pastikan bahwa nginx menyajikan berkas <code>index.html</code> dari dalam
hostPath volume:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Pastikan kamu menjalankan 3 perintah ini di dalam shell root yang berasal dari</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># &#34;kubectl exec&#34; dari langkah sebelumnya</span>
</span></span><span style=display:flex><span>apt update
</span></span><span style=display:flex><span>apt install curl
</span></span><span style=display:flex><span>curl http://localhost/
</span></span></code></pre></div><p>Keluaran akan menunjukan sebuah teks yang telah kamu tulis di berkas <code>index.html</code>
di dalam hostPath volume:</p><pre><code>Hello from Kubernetes storage
</code></pre><p>Jika kamu melihat pesan tersebut, kamu telah berhasil mengatur sebuah Pod
untuk menggunakan penyimpanan dari PersistentVolumeClaim.</p><h2 id=membersihkan>Membersihkan</h2><p>Hapus Pod, PersistentVolumeClaim dan PersistentVolume:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod task-pv-pod
</span></span><span style=display:flex><span>kubectl delete pvc task-pv-claim
</span></span><span style=display:flex><span>kubectl delete pv task-pv-volume
</span></span></code></pre></div><p>Jika kamu belum memiliki <em>shell</em> yang telah dibuka ke Node di klaster kamu,
buka <em>shell</em> baru dengan cara yang sama yang telah kamu lakukan sebelumnya.</p><p>Di dalam <em>shell</em> Node kamu, hapus berkas dan direktori yang telah kamu buat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Asumsikan Node kamu menggunakan &#34;sudo&#34; untuk menjalankan perintah</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># sebagai superuser</span>
</span></span><span style=display:flex><span>sudo rm /mnt/data/index.html
</span></span><span style=display:flex><span>sudo rmdir /mnt/data
</span></span></code></pre></div><p>Sekarang kamu dapat menutup <em>shell</em> Node kamu.</p><h2 id=kontrol-akses>Kontrol akses</h2><p>Penyimpanan yang telah terkonfigurasi dengan group ID (GID) memungkinkan akses menulis hanya dari Pod yang menggunakan
GID yang sama. GID yang tidak cocok atau hilang akan menyebabkan kesalahan izin ditolak. Untuk mengurangi
kebutuhan koordinasi dengan pengguna, administrator dapat membuat anotasi sebuah PersistentVolume
dengan GID. Kemudian GID akan otomatis ditambahkan ke Pod yang menggunakan PersistentVolume.</p><p>Gunakan anotasi <code>pv.beta.kubernetes.io/gid</code> sebagai berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PersistentVolume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>pv1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>pv.beta.kubernetes.io/gid</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1234&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Ketika sebuah Pod mengkonsumsi PersistentVolume yang memiliki anotasi GID, anotasi GID tersebut
akan diterapkan ke semua container di dalam Pod dengan cara yang sama yang ditentukan di dalam GID Pod security context.
Settiap GID, baik berasal dari anotasi PersistentVolume atau Pod, diterapkan pada proses pertama yang dijalankan
di setiap container.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Ketika sebuah Pod mengkonsumsi PersistentVolume, GID yang terkait dengan PersistentVolume
tidak ada di dalam sumberdaya Pod itu sendiri.</div><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Belajar lebih lanjut tentang <a href=/id/docs/concepts/storage/persistent-volumes/>PersistentVolume</a>.</li><li>Baca <a href=https://git.k8s.io/community/contributors/design-proposals/storage/persistent-storage.md>dokumen perancangan Penyimpanan <em>Persistent</em></a>.</li></ul><h3 id=referensi>Referensi</h3><ul><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#persistentvolume-v1-core>PersistentVolume</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#persistentvolumespec-v1-core>PersistentVolumeSpec</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#persistentvolumeclaim-v1-core>PersistentVolumeClaim</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#persistentvolumeclaimspec-v1-core>PersistentVolumeClaimSpec</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-abd895c0803315e9717e6ff9ec4e3d30>3.5 - Mengonfigurasi Konteks Keamanan untuk Pod atau Container</h1><p>Konteks keamanan (<em>security context</em>) menentukan wewenang (<em>privilege</em>) dan aturan kontrol akses untuk sebuah Pod
atau Container. Aturan konteks keamanan meliputi hal-hal berikut ini namun tidak terbatas pada hal-hal tersebut:</p><ul><li><p>Kontrol akses bersifat diskresi: Izin untuk mengakses objek, seperti sebuah berkas, yang didasarkan pada
<a href=https://wiki.archlinux.org/index.php/users_and_groups>ID pengguna atau <em>user ID</em> (UID) dan ID grup atau <em>group ID</em> (GID)</a>.</p></li><li><p><a href=https://en.wikipedia.org/wiki/Security-Enhanced_Linux><em>Security Enhanced Linux</em> (SELinux)</a>: Di mana objek diberi label keamanan.</p></li><li><p>Menjalankan dengan wewenang (<em>privileged</em>) atau tanpa wewenang (<em>unprivileged</em>).</p></li><li><p><a href=https://linux-audit.com/linux-capabilities-hardening-linux-binaries-by-removing-setuid/>Kapabilitas Linux (Linux Capabilities)</a>: Memberi sebuah proses beberapa wewenang, namun tidak semua wewenang dari pengguna <em>root</em>.</p></li><li><p><a href=/docs/tutorials/clusters/apparmor/>AppArmor</a>: Menggunakan profil program untuk membatasi kemampuan dari masing-masing program.</p></li><li><p><a href=https://en.wikipedia.org/wiki/Seccomp>Seccomp</a>: Menyaring panggilan sistem (<em>system calls</em>) dari suatu proses.</p></li><li><p>AllowPrivilegeEscalation: Mengontrol apakah suatu proses dapat memperoleh lebih banyak wewenang daripada proses induknya. Pilihan ini mengontrol secara langsung apakah opsi <a href=https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt><code>no_new_privs</code></a> diaktifkan pada proses dalam Container. AllowPrivilegeEscalation selalu aktif (<em>true</em>) ketika Container: 1) berjalan dengan wewenang ATAU 2) memiliki <code>CAP_SYS_ADMIN</code>.</p></li><li><p>readOnlyRootFilesystem: Menambatkan (<em>mount</em>) sistem berkas (<em>file system</em>) <em>root</em> dari sebuah Container hanya sebatas untuk dibaca saja (<em>read-only</em>).</p></li></ul><p>Poin-poin di atas bukanlah sekumpulan lengkap dari aturan konteks keamanan - silakan lihat <a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#securitycontext-v1-core>SecurityContext</a> untuk daftar lengkapnya.</p><p>Untuk informasi lebih lanjut tentang mekanisme keamanan pada Linux, silahkan lihat
<a href=https://www.linux.com/learn/overview-linux-kernel-security-features>ikhtisar fitur keamanan pada Kernel Linux</a></p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mengatur-konteks-keamanan-untuk-pod>Mengatur konteks keamanan untuk Pod</h2><p>Untuk menentukan aturan keamanan pada Pod, masukkan bagian <code>securityContext</code>
dalam spesifikasi Pod. Bagian <code>securityContext</code> adalah sebuah objek
<a href=/docs/reference/generate/kubernetes-api/v1.25/#podsecuritycontext-v1-core>PodSecurityContext</a>.
Aturan keamanan yang kamu tetapkan untuk Pod akan berlaku untuk semua Container dalam Pod tersebut.
Berikut sebuah berkas konfigurasi untuk Pod yang memiliki volume <code>securityContext</code> dan <code>emptyDir</code>:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/security/security-context.yaml download=pods/security/security-context.yaml><code>pods/security/security-context.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-security-security-context-yaml")' title="Copy pods/security/security-context.yaml to clipboard"></img></div><div class=includecode id=pods-security-security-context-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>security-context-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb> </span><span style=color:#666>1000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>runAsGroup</span>:<span style=color:#bbb> </span><span style=color:#666>3000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>fsGroup</span>:<span style=color:#bbb> </span><span style=color:#666>2000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>sec-ctx-vol<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>emptyDir</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>sec-ctx-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>busybox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;sleep 1h&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>sec-ctx-vol<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/data/demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Dalam berkas konfigurasi ini, bagian <code>runAsUser</code> menentukan bahwa dalam setiap Container pada
Pod, semua proses dijalankan oleh ID pengguna 1000. Bagian <code>runAsGroup</code> menentukan grup utama dengan ID 3000 untuk
semua proses dalam setiap Container pada Pod. Jika bagian ini diabaikan, maka ID grup utama dari Container
akan berubah menjadi <em>root</em>(0). Berkas apa pun yang dibuat juga akan dimiliki oleh pengguna dengan ID 1000 dan grup dengan ID 3000 ketika <code>runAsGroup</code> ditentukan.
Karena <code>fsGroup</code> ditentukan, semua proses milik Container juga merupakan bagian dari grup tambahan dengan ID 2000.
Pemilik volume <code>/data/demo</code> dan berkas apa pun yang dibuat dalam volume tersebut adalah grup dengan ID 2000.</p><p>Buatlah Pod tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/security/security-context.yaml
</span></span></code></pre></div><p>Periksa apakah Container dari Pod sedang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod security-context-demo
</span></span></code></pre></div><p>Masuk ke <em>shell</em> dari Container yang sedang berjalan tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it security-context-demo -- sh
</span></span></code></pre></div><p>Pada <em>shell</em> kamu, lihat daftar proses yang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ps
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa proses dijalankan oleh pengguna dengan ID 1000, yang merupakan nilai dari bagian <code>runAsUser</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>PID   USER     TIME  COMMAND
</span></span><span style=display:flex><span>    <span style=color:#666>1</span> <span style=color:#666>1000</span>      0:00 sleep 1h
</span></span><span style=display:flex><span>    <span style=color:#666>6</span> <span style=color:#666>1000</span>      0:00 sh
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Pada <em>shell</em> kamu, pindah ke direktori <code>/data</code>, dan lihat isinya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>cd</span> /data
</span></span><span style=display:flex><span>ls -l
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa direktori <code>/data/demo</code> memiliki grup dengan ID 2000, yang merupakan
nilai dari bagian <code>fsGroup</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>drwxrwsrwx <span style=color:#666>2</span> root <span style=color:#666>2000</span> <span style=color:#666>4096</span> Jun  <span style=color:#666>6</span> 20:08 demo
</span></span></code></pre></div><p>Pada <em>shell</em> kamu, pindah ke direktori <code>/data/demo</code>, dan buatlah sebuah berkas didalamnya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>cd</span> demo
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> hello &gt; testfile
</span></span></code></pre></div><p>Lihatlah daftar berkas dalam direktori <code>/data/demo</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ls -l
</span></span></code></pre></div><p>Keluarannya menunjukkan bahwa <code>testfile</code> memiliki grup dengan ID 2000, dimana merupakan nilai dari bagian <code>fsGroup</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>-rw-r--r-- <span style=color:#666>1</span> <span style=color:#666>1000</span> <span style=color:#666>2000</span> <span style=color:#666>6</span> Jun  <span style=color:#666>6</span> 20:08 testfile
</span></span></code></pre></div><p>Jalankan perintah berikut ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ id
</span></span><span style=display:flex><span><span style=color:#b8860b>uid</span><span style=color:#666>=</span><span style=color:#666>1000</span> <span style=color:#b8860b>gid</span><span style=color:#666>=</span><span style=color:#666>3000</span> <span style=color:#b8860b>groups</span><span style=color:#666>=</span><span style=color:#666>2000</span>
</span></span></code></pre></div><p>Kamu akan melihat bahwa nilai <em>gid</em> adalah 3000, sama dengan bagian <code>runAsGroup</code>. Jika <code>runAsGroup</code> diabaikan maka nilai <em>gid</em> akan
tetap bernilai 0(<em>root</em>) dan proses akan dapat berinteraksi dengan berkas-berkas yang dimiliki oleh grup root(0) dan yang memiliki
izin grup untuk grup root(0).</p><p>Keluarlah dari <em>shell</em> kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>exit</span>
</span></span></code></pre></div><h2 id=melakukan-konfigurasi-izin-volume-dan-kebijakan-perubahan-kepemilikan-untuk-pod>Melakukan konfigurasi izin volume dan kebijakan perubahan kepemilikan untuk Pod</h2><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.18 [alpha]</code></div><p>Secara bawaan, Kubernetes mengubah kepemilikan dan izin secara rekursif untuk konten masing-masing
volume untuk mencocokkan <code>fsGroup</code> yang ditentukan dalam <code>securityContext</code> dari Pod pada saat volume itu
ditambatkan (<em>mounted</em>). Untuk volume yang besar, memeriksa dan mengubah kepemilikan dan izin dapat memerlukan waktu yang sangat lama,
sehingga memperlambat proses menjalankan Pod. Kamu dapat menggunakan bagian <code>fsGroupChangePolicy</code> dalam sebuah <code>securityContext</code>
untuk mengontrol cara Kubernetes memeriksa dan mengelola kepemilikan dan izin
untuk sebuah volume.</p><p><strong>fsGroupChangePolicy</strong> - <code>fsGroupChangePolicy</code> mendefinisikan perilaku untuk mengubah kepemilikan dan izin volume
sebelum diekspos di dalam sebuah Pod. Bagian ini hanya berlaku untuk tipe volume yang mendukung
<code>fsGroup</code> untuk mengontrol kepemilikan dan izin. Bagian ini memiliki dua nilai yang dapat dimasukkan:</p><ul><li><em>OnRootMismatch</em>: Hanya mengubah izin dan kepemilikan jika izin dan kepemilikan dari direktori <em>root</em> tidak sesuai dengan izin volume yang diharapkan. Hal ini dapat membantu mempersingkat waktu yang diperlukan untuk mengubah kepemilikan dan izin sebuah volume.</li><li><em>Always</em>: Selalu mengubah izin dan kepemilikan volume ketika volume sudah ditambatkan.</li></ul><p>Sebagai contoh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb> </span><span style=color:#666>1000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>runAsGroup</span>:<span style=color:#bbb> </span><span style=color:#666>3000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>fsGroup</span>:<span style=color:#bbb> </span><span style=color:#666>2000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>fsGroupChangePolicy</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;OnRootMismatch&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Ini adalah fitur alpha. Untuk menggunakannya, silahkan aktifkan <a href=/docs/reference/command-line-tools-reference/feature-gates/>gerbang fitur</a> <code>ConfigurableFSGroupPolicy</code> untuk kube-api-server, kube-controller-manager, dan kubelet.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Bagian ini tidak berpengaruh pada tipe volume yang bersifat sementara (<em>ephemeral</em>) seperti
<a href=https://kubernetes.io/docs/concepts/storage/volumes/#secret><code>secret</code></a>,
<a href=https://kubernetes.io/docs/concepts/storage/volumes/#configmap><code>configMap</code></a>,
dan <a href=https://kubernetes.io/docs/concepts/storage/volumes/#emptydir><code>emptydir</code></a>.</div><h2 id=mengatur-konteks-keamanan-untuk-container>Mengatur konteks keamanan untuk Container</h2><p>Untuk menentukan aturan keamanan untuk suatu Container, sertakan bagian <code>securityContext</code>
dalam manifes Container. Bagian <code>securityContext</code> adalah sebuah objek
<a href=/docs/reference/generate/kubernetes-api/v1.25/#securitycontext-v1-core>SecurityContext</a>.
Aturan keamanan yang kamu tentukan untuk Container hanya berlaku untuk
Container secara individu, dan aturan tersebut menimpa aturan yang dibuat pada tingkat Pod apabila
ada aturan yang tumpang tindih. Aturan pada Container mempengaruhi volume pada Pod.</p><p>Berikut berkas konfigurasi untuk Pod yang hanya memiliki satu Container. Keduanya, baik Pod
dan Container memiliki bagian <code>securityContext</code> sebagai berikut:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/security/security-context-2.yaml download=pods/security/security-context-2.yaml><code>pods/security/security-context-2.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-security-security-context-2-yaml")' title="Copy pods/security/security-context-2.yaml to clipboard"></img></div><div class=includecode id=pods-security-security-context-2-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>security-context-demo-2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb> </span><span style=color:#666>1000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>sec-ctx-demo-2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>gcr.io/google-samples/node-hello:1.0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb> </span><span style=color:#666>2000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buatlah Pod tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/security/security-context-2.yaml
</span></span></code></pre></div><p>Periksa jika Container dalam Pod sedang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod security-context-demo-2
</span></span></code></pre></div><p>Masuk ke dalam <em>shell</em> Container yang sedang berjalan tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it security-context-demo-2 -- sh
</span></span></code></pre></div><p>Pada <em>shell</em> kamu, lihat daftar proses yang sedang berjalan:</p><pre tabindex=0><code>ps aux
</code></pre><p>Keluarannya menunjukkan bahwa proses dijalankan oleh user dengan ID 2000, yang merupakan
nilai dari <code>runAsUser</code> seperti yang telah ditentukan untuk Container tersebut. Nilai tersebut menimpa nilai ID 1000 yang
ditentukan untuk Pod-nya.</p><pre tabindex=0><code>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
2000         1  0.0  0.0   4336   764 ?        Ss   20:36   0:00 /bin/sh -c node server.js
2000         8  0.1  0.5 772124 22604 ?        Sl   20:36   0:00 node server.js
...
</code></pre><p>Keluar dari <em>shell</em> anda:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>exit</span>
</span></span></code></pre></div><h2 id=mengatur-kapabilitas-untuk-container>Mengatur Kapabilitas untuk Container</h2><p>Dengan menggunakan <a href=http://man7.org/linux/man-pages/man7/capabilities.7.html>Kapabilitas Linux (Linux Capabilities)</a>,
kamu dapat memberikan wewenang tertentu kepada suatu proses tanpa memberikan semua wewenang
dari pengguna <em>root</em>. Untuk menambah atau menghapus Kapabilitas Linux pada suatu Container, masukkan
bagian <code>capabilities</code> pada <code>securityContext</code> di manifes Container-nya.</p><p>Pertama-tama, mari melihat apa yang terjadi ketika kamu tidak menyertakan bagian <code>capabilities</code>.
Berikut ini adalah berkas konfigurasi yang tidak menambah atau mengurangi kemampuan apa pun dari Container:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/security/security-context-3.yaml download=pods/security/security-context-3.yaml><code>pods/security/security-context-3.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-security-security-context-3-yaml")' title="Copy pods/security/security-context-3.yaml to clipboard"></img></div><div class=includecode id=pods-security-security-context-3-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>security-context-demo-3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>sec-ctx-3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>gcr.io/google-samples/node-hello:1.0<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buatlah Pod tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/security/security-context-3.yaml
</span></span></code></pre></div><p>Periksa apakah Container dari Pod tersebut sedang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod security-context-demo-3
</span></span></code></pre></div><p>Masuk ke dalam <em>shell</em> dari Container yang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it security-context-demo-3 -- sh
</span></span></code></pre></div><p>Dalam <em>shell</em> tersebut, lihatlah daftar proses yang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ps aux
</span></span></code></pre></div><p>Keluarannya menunjukkan ID dari proses atau <em>process IDs</em> (PIDs) untuk Container tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>USER  PID %CPU %MEM    VSZ   RSS TTY   STAT START   TIME COMMAND
</span></span><span style=display:flex><span>root    <span style=color:#666>1</span>  0.0  0.0   <span style=color:#666>4336</span>   <span style=color:#666>796</span> ?     Ss   18:17   0:00 /bin/sh -c node server.js
</span></span><span style=display:flex><span>root    <span style=color:#666>5</span>  0.1  0.5 <span style=color:#666>772124</span> <span style=color:#666>22700</span> ?     Sl   18:17   0:00 node server.js
</span></span></code></pre></div><p>Dalam <em>shell</em> kamu, lihat status dari proses dengan ID 1:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>cd</span> /proc/1
</span></span><span style=display:flex><span>cat status
</span></span></code></pre></div><p>Keluarannya menunjukkan <em>bitmap</em> dari kapabilitas untuk proses tersebut:</p><pre tabindex=0><code>...
CapPrm:	00000000a80425fb
CapEff:	00000000a80425fb
...
</code></pre><p>Buatlah catatan untuk <em>bitmap</em> dari kapabilitas tersebut, dan keluarlah dari <em>shell</em> kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>exit</span>
</span></span></code></pre></div><p>Berikutnya, jalankan Container yang sama seperti dengan Container sebelumnya, namun
Container ini memiliki kapabilitas tambahan yang sudah ditentukan.</p><p>Berikut ini adalah berkas konfigurasi untuk Pod yang hanya menjalankan satu Container. Konfigurasi
ini menambahkan kapabilitas <code>CAP_NET_ADMIN</code> dan <code>CAP_SYS_TIME</code>:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/security/security-context-4.yaml download=pods/security/security-context-4.yaml><code>pods/security/security-context-4.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-security-security-context-4-yaml")' title="Copy pods/security/security-context-4.yaml to clipboard"></img></div><div class=includecode id=pods-security-security-context-4-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>security-context-demo-4<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>sec-ctx-4<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>gcr.io/google-samples/node-hello:1.0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>capabilities</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>add</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;NET_ADMIN&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;SYS_TIME&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buatlah Pod tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/security/security-context-4.yaml
</span></span></code></pre></div><p>Masuk ke dalam <em>shell</em> dari Container yang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it security-context-demo-4 -- sh
</span></span></code></pre></div><p>Di dalam <em>shell</em> kamu, lihatlah kapabilitas dari proses dengan ID 1:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>cd</span> /proc/1
</span></span><span style=display:flex><span>cat status
</span></span></code></pre></div><p>Keluarannya menunjukkan <em>bitmap</em> kapabilitas untuk proses tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>...
</span></span><span style=display:flex><span>CapPrm:	00000000aa0435fb
</span></span><span style=display:flex><span>CapEff:	00000000aa0435fb
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Bandingkan kemampuan dari kedua Containers tersebut:</p><pre tabindex=0><code>00000000a80425fb
00000000aa0435fb
</code></pre><p>Dalam <em>bitmap</em> kapabilitas pada Container pertama, bit-12 dan ke-25 tidak diatur. Sedangkan dalam Container kedua,
bit ke-12 dan ke-25 diatur. Bit ke-12 adalah kapabilitas <code>CAP_NET_ADMIN</code>, dan bit-25 adalah kapabilitas <code>CAP_SYS_TIME</code>.
Lihatlah <a href=https://github.com/torvalds/linux/blob/master/include/uapi/linux/capability.h>capability.h</a>
untuk nilai dari konstanta kapabilitas-kapabilitas yang lainnya.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Konstanta kapabilitas Linux memiliki format <code>CAP_XXX</code>. Tetapi ketika kamu memasukkan daftar kemampuan dalam manifes Container kamu, kamu harus menghilangkan bagian <code>CAP_</code> dari konstantanya. Misalnya, untuk menambahkan <code>CAP_SYS_TIME</code>, masukkan <code>SYS_TIME</code> ke dalam daftar kapabilitas Container kamu.</div><h2 id=memberikan-label-selinux-pada-sebuah-container>Memberikan label SELinux pada sebuah Container</h2><p>Untuk memberikan label SELinux pada sebuah Container, masukkan bagian <code>seLinuxOptions</code> pada
bagian <code>securityContext</code> dari manifes Pod atau Container kamu.
Bagian <code>seLinuxOptions</code> adalah sebuah objek <a href=/docs/reference/generated/kubernetes-api/v1.25/#selinuxoptions-v1-core>SELinuxOptions</a>.
Berikut ini adalah contoh yang menerapkan sebuah level dari SELinux:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>seLinuxOptions</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>level</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;s0:c123,c456&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Untuk menetapkan label SELinux, modul keamanan SELinux harus dimuat terlebih dahulu pada sistem operasi dari hosnya.</div><h2 id=diskusi>Diskusi</h2><p>Konteks keamanan untuk sebuah Pod berlaku juga untuk Container yang berada dalam Pod tersebut dan juga untuk
volume dari Pod tersebut jika ada. Terkhusus untuk <code>fsGroup</code> dan <code>seLinuxOptions</code>
akan diterapkan pada volume seperti berikut:</p><ul><li><p><code>fsGroup</code>: Volume yang mendukung manajemen kepemilikan (<em>ownership</em>) akan dimodifikasi agar dapat dimiliki
dan ditulis oleh ID group (GID) yang disebutkan dalam <code>fsGroup</code>. Lihatlah
<a href=https://git.k8s.io/community/contributors/design-proposals/storage/volume-ownership-management.md>Dokumen Desain untuk Manajemen Kepemilikan</a>
untuk lebih lanjut.</p></li><li><p><code>seLinuxOptions</code>: Volume yang mendukung pelabelan SELinux akan dilabel ulang agar dapat diakses
oleh label yang ditentukan pada <code>seLinuxOptions</code>. Biasanya kamu hanya
perlu mengatur bagian <code>level</code>. Dimana ini akan menetapkan label
<a href=https://selinuxproject.org/page/NB_MLS>Keamanan multi-kategori (<em>Multi-Category Security</em>) (MCS)</a>
yang diberikan kepada semua Container dalam Pod serta Volume yang ada didalamnya.</p></li></ul><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Setelah kamu menentukan label MCS untuk Pod, maka semua Pod dengan label yang sama dapat mengakses Volume tersebut. Jika kamu membutuhkan perlindungan antar Pod, kamu harus menetapkan label MCS yang unik untuk setiap Pod.</div><h2 id=bersih-bersih-clean-up>Bersih-bersih (<em>Clean Up</em>)</h2><p>Hapus Pod-Pod tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod security-context-demo
</span></span><span style=display:flex><span>kubectl delete pod security-context-demo-2
</span></span><span style=display:flex><span>kubectl delete pod security-context-demo-3
</span></span><span style=display:flex><span>kubectl delete pod security-context-demo-4
</span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><ul><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#podsecuritycontext-v1-core>PodSecurityContext</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#securitycontext-v1-core>SecurityContext</a></li><li><a href=https://opensource.com/business/15/3/docker-security-tuning>Menyetel Docker dengan peningkatan keamanan terbaru</a></li><li><a href=https://git.k8s.io/community/contributors/design-proposals/auth/security_context.md>Dokumen desain konteks keamanan</a></li><li><a href=https://git.k8s.io/community/contributors/design-proposals/storage/volume-ownership-management.md>Dokumen desain manajemen kepemilikan</a></li><li><a href=/id/docs/concepts/policy/pod-security-policy/>Kebijakan keamanan Pod</a></li><li><a href=https://git.k8s.io/community/contributors/design-proposals/auth/no-new-privs.md>Dokumen desain AllowPrivilegeEscalation</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2c0d882359718c4c69c67099bed2156c>3.6 - Mengatur ServiceAccount untuk Pod</h1><p>ServiceAccount menyediakan identitas untuk proses yang sedang berjalan dalam sebuah Pod.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Dokumen ini digunakan sebagai pengenalan untuk pengguna terhadap ServiceAccount dan menjelaskan bagaimana perilaku ServiceAccount dalam konfigurasi klaster seperti yang direkomendasikan Kubernetes. Pengubahan perilaku yang bisa saja dilakukan administrator klaster terhadap klaster tidak menjadi bagian pembahasan dokumentasi ini.</div><p>Ketika kamu mengakses klaster (contohnya menggunakan <code>kubectl</code>), kamu terautentikasi oleh apiserver sebagai sebuah akun pengguna (untuk sekarang umumnya sebagai <code>admin</code>, kecuali jika administrator klustermu telah melakukan pengubahan). Berbagai proses yang ada di dalam kontainer dalam Pod juga dapat mengontak apiserver. Ketika itu terjadi, mereka akan diautentikasi sebagai sebuah ServiceAccount (contohnya sebagai <code>default</code>).</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=menggunakan-default-serviceaccount-untuk-mengakses-api-server>Menggunakan Default ServiceAccount untuk Mengakses API server.</h2><p>Ketika kamu membuat sebuah Pod, jika kamu tidak menentukan sebuah ServiceAccount, maka ia akan otomatis ditetapkan sebagai ServiceAccount<code>default</code> di Namespace yang sama. Jika kamu mendapatkan json atau yaml mentah untuk sebuah Pod yang telah kamu buat (contohnya menggunakan <code>kubectl get pods/&lt;podname> -o yaml</code>), kamu akan melihat <em>field</em> <code>spec.serviceAccountName</code> yang telah secara <a href=/docs/user-guide/working-with-resources/#resources-are-automatically-modified>otomatis ditentukan</a>.</p><p>Kamu dapat mengakses API dari dalam Pod menggunakan kredensial ServiceAccount yang ditambahkan secara otomatis seperti yang dijelaskan dalam <a href=/docs/user-guide/accessing-the-cluster/#accessing-the-api-from-a-pod>Mengakses Klaster</a>.
Hak akses API dari ServiceAccount menyesuaikan dengan <a href=/docs/reference/access-authn-authz/authorization/#authorization-modules>kebijakan dan plugin otorisasi</a> yang sedang digunakan.</p><p>Di versi 1.6+, kamu dapat tidak memilih <em>automounting</em> kredensial API dari sebuah ServiceAccount dengan mengatur <code>automountServiceAccountToken: false</code> pada ServiceAccount:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ServiceAccount<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>build-robot<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>automountServiceAccountToken</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Di versi 1.6+, kamu juga dapat tidak memilih <em>automounting</em> kredensial API dari suatu Pod tertentu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>my-pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>serviceAccountName</span>:<span style=color:#bbb> </span>build-robot<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>automountServiceAccountToken</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>...<span style=color:#bbb>
</span></span></span></code></pre></div><p>Pengaturan dari spesifikasi Pod didahulukan dibanding ServiceAccount jika keduanya menentukan nilai dari <code>automountServiceAccountToken</code>.</p><h2 id=menggunakan-beberapa-serviceaccount>Menggunakan Beberapa ServiceAccount.</h2><p>Setiap Namespace memiliki sumber daya ServiceAccount standar <code>default</code>.
Kamu dapat melihatnya dan sumber daya serviceAccount lainnya di Namespace tersebut dengan perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get serviceaccounts
</span></span></code></pre></div><p>Keluarannya akan serupa dengan:</p><pre tabindex=0><code>NAME      SECRETS    AGE
default   1          1d
</code></pre><p>Kamu dapat membuat objek ServiceAccount tambahan seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f - <span style=color:#b44>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: build-robot
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Nama dari objek ServiceAccount haruslah sebuah <a href=/id/docs/concepts/overview/working-with-objects/names#dns-subdomain-names>nama subdomain DNS</a> yang valid.</p><p>Jika kamu mendapatkan objek ServiceAccount secara komplit, seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get serviceaccounts/build-robot -o yaml
</span></span></code></pre></div><p>Keluarannya akan serupa dengan:</p><pre tabindex=0><code>apiVersion: v1
kind: ServiceAccount
metadata:
  creationTimestamp: 2015-06-16T00:12:59Z
  name: build-robot
  namespace: default
  resourceVersion: &#34;272500&#34;
  uid: 721ab723-13bc-11e5-aec2-42010af0021e
secrets:
- name: build-robot-token-bvbk5
</code></pre><p>maka kamu dapat melihat bahwa <em>token</em> telah dibuat secara otomatis dan dirujuk oleh ServiceAccount.</p><p>Kamu dapat menggunakan <em>plugin</em> otorisasi untuk <a href=/id/docs/reference/access-authn-authz/rbac/#service-account-permissions>mengatur hak akses dari ServiceAccount</a>.</p><p>Untuk menggunakan ServiceAccount selain nilai standar, atur <em>field</em> <code>spec.serviceAccountName</code> dari Pod menjadi nama dari ServiceAccount yang hendak kamu gunakan.</p><p><em>Service account</em> harus ada ketika Pod dibuat, jika tidak maka akan ditolak.</p><p>Kamu tidak dapat memperbarui ServiceAccount dari Pod yang telah dibuat.</p><p>Kamu dapat menghapus ServiceAccount dari contoh seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete serviceaccount/build-robot
</span></span></code></pre></div><h2 id=membuat-token-api-serviceaccount-secara-manual>Membuat token API ServiceAccount secara manual.</h2><p>Asumsikan kita memiliki ServiceAccount dengan nama "build-robot" seperti yang disebukan di atas, dan kita membuat Secret secara manual.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f - <span style=color:#b44>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Secret
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: build-robot-secret
</span></span></span><span style=display:flex><span><span style=color:#b44>  annotations:
</span></span></span><span style=display:flex><span><span style=color:#b44>    kubernetes.io/service-account.name: build-robot
</span></span></span><span style=display:flex><span><span style=color:#b44>type: kubernetes.io/service-account-token
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Sekarang kamu dapat mengonfirmasi bahwa Secret yang baru saja dibuat diisi dengan <em>token</em> API dari ServiceAccount "build-robot".</p><p>Setiap <em>token</em> dari ServiceAccount yang tidak ada akan dihapus oleh <em>token controller</em>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe secrets/build-robot-secret
</span></span></code></pre></div><p>Keluarannya akan serupa dengan:</p><pre tabindex=0><code>Name:           build-robot-secret
Namespace:      default
Labels:         &lt;none&gt;
Annotations:    kubernetes.io/service-account.name: build-robot
                kubernetes.io/service-account.uid: da68f9c6-9d26-11e7-b84e-002dc52800da

Type:   kubernetes.io/service-account-token

Data
====
ca.crt:         1338 bytes
namespace:      7 bytes
token:          ...
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Isi dari <code>token</code> tidak dirinci di sini.</div><h2 id=menambahkan-imagepullsecret-ke-serviceaccount>Menambahkan ImagePullSecret ke ServiceAccount.</h2><h3 id=membuat-imagepullsecret>Membuat imagePullSecret</h3><ul><li><p>Membuat sebuah imagePullSecret, seperti yang dijelaskan pada <a href=/id/docs/concepts/containers/images/#tentukan-imagepullsecrets-pada-sebuah-pod>Menentukan ImagePullSecret pada Pod</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret docker-registry myregistrykey --docker-server<span style=color:#666>=</span>DUMMY_SERVER <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>        --docker-username<span style=color:#666>=</span>DUMMY_USERNAME --docker-password<span style=color:#666>=</span>DUMMY_DOCKER_PASSWORD <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>        --docker-email<span style=color:#666>=</span>DUMMY_DOCKER_EMAIL
</span></span></code></pre></div></li><li><p>Memastikan bahwa Secret telah terbuat.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get secrets myregistrykey
</span></span></code></pre></div><p>Keluarannya akan serupa dengan:</p><pre tabindex=0><code>NAME             TYPE                              DATA    AGE
myregistrykey    kubernetes.io/.dockerconfigjson   1       1d
</code></pre></li></ul><h3 id=menambahkan-imagepullsecret-ke-serviceaccount-1>Menambahkan imagePullSecret ke ServiceAccount</h3><p>Selanjutnya, modifikasi ServiceAccount standar dari Namespace untuk menggunakan Secret ini sebagai imagePullSecret.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl patch serviceaccount default -p <span style=color:#b44>&#39;{&#34;imagePullSecrets&#34;: [{&#34;name&#34;: &#34;myregistrykey&#34;}]}&#39;</span>
</span></span></code></pre></div><p>Sebagai gantinya kamu dapat menggunakan <code>kubectl edit</code>, atau melakukan pengubahan secara manual manifes YAML seperti di bawah ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get serviceaccounts default -o yaml &gt; ./sa.yaml
</span></span></code></pre></div><p>Keluaran dari berkas <code>sa.yaml</code> akan serupa dengan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ServiceAccount
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: 2015-08-07T22:02:39Z
</span></span><span style=display:flex><span>  name: default
</span></span><span style=display:flex><span>  namespace: default
</span></span><span style=display:flex><span>  resourceVersion: <span style=color:#b44>&#34;243024&#34;</span>
</span></span><span style=display:flex><span>  uid: 052fb0f4-3d50-11e5-b066-42010af0d7b6
</span></span><span style=display:flex><span>secrets:
</span></span><span style=display:flex><span>- name: default-token-uudge
</span></span></code></pre></div><p>Menggunakan <em>editor</em> pilihanmu (misalnya <code>vi</code>), buka berkas <code>sa.yaml</code>, hapus baris dengan key <code>resourceVersion</code>, tambahkan baris dengan <code>imagePullSecrets:</code> dan simpan.</p><p>Keluaran dari berkas <code>sa.yaml</code> akan serupa dengan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ServiceAccount
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  creationTimestamp: 2015-08-07T22:02:39Z
</span></span><span style=display:flex><span>  name: default
</span></span><span style=display:flex><span>  namespace: default
</span></span><span style=display:flex><span>  uid: 052fb0f4-3d50-11e5-b066-42010af0d7b6
</span></span><span style=display:flex><span>secrets:
</span></span><span style=display:flex><span>- name: default-token-uudge
</span></span><span style=display:flex><span>imagePullSecrets:
</span></span><span style=display:flex><span>- name: myregistrykey
</span></span></code></pre></div><p>Terakhir ganti serviceaccount dengan berkas <code>sa.yaml</code> yang telah diperbarui.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl replace serviceaccount default -f ./sa.yaml
</span></span></code></pre></div><h3 id=memverifikasi-imagepullsecrets-sudah-ditambahkan-ke-spesifikasi-pod>Memverifikasi imagePullSecrets sudah ditambahkan ke spesifikasi Pod</h3><p>Ketika Pod baru dibuat dalam Namespace yang sedang aktif dan menggunakan ServiceAccount, Pod baru akan memiliki <em>field</em> <code>spec.imagePullSecrets</code> yang ditentukan secara otomatis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl run nginx --image<span style=color:#666>=</span>nginx --restart<span style=color:#666>=</span>Never
</span></span><span style=display:flex><span>kubectl get pod nginx -o<span style=color:#666>=</span><span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#39;{.spec.imagePullSecrets[0].name}{&#34;\n&#34;}&#39;</span>
</span></span></code></pre></div><p>Keluarannya adalah:</p><pre tabindex=0><code>myregistrykey
</code></pre><!--## Menambahkan Secrets ke sebuah ServiceAccount.

TODO: Tes dan jelaskan bagaimana cara menambahkan Secret tambahan non-K8s dengan ServiceAccount yang sudah ada.
--><h2 id=serviceaccounttokenvolumeprojection>ServiceAccountTokenVolumeProjection</h2><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.12 [beta]</code></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong><p>ServiceAccountTokenVolumeProjection masih dalam tahap <strong>beta</strong> untuk versi 1.12 dan diaktifkan dengan memberikan <em>flag</em> berikut ini ke API server:</p><ul><li><code>--service-account-issuer</code></li><li><code>--service-account-signing-key-file</code></li><li><code>--service-account-api-audiences</code></li></ul></div><p>Kubelet juga dapat memproyeksikan <em>token</em> ServiceAccount ke Pod. Kamu dapat menentukan properti yang diinginkan dari <em>token</em> seperti target pengguna dan durasi validitas. Properti tersebut tidak dapat diubah pada <em>token</em> ServiceAccount standar. <em>Token</em> ServiceAccount juga akan menjadi tidak valid terhadap API ketika Pod atau ServiceAccount dihapus.</p><p>Perilaku ini diatur pada PodSpec menggunakan tipe ProjectedVolume yaitu <a href=/id/docs/concepts/storage/volumes/#projected>ServiceAccountToken</a>. Untuk memungkinkan Pod dengan <em>token</em> dengan pengguna bertipe <em>"vault"</em> dan durasi validitas selama dua jam, kamu harus mengubah bagian ini pada PodSpec:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-projected-svc-token.yaml download=pods/pod-projected-svc-token.yaml><code>pods/pod-projected-svc-token.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-projected-svc-token-yaml")' title="Copy pods/pod-projected-svc-token.yaml to clipboard"></img></div><div class=includecode id=pods-pod-projected-svc-token-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/var/run/secrets/tokens<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>vault-token<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>serviceAccountName</span>:<span style=color:#bbb> </span>build-robot<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>vault-token<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>projected</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>sources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>serviceAccountToken</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span>vault-token<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>expirationSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>7200</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>audience</span>:<span style=color:#bbb> </span>vault<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/pods/pod-projected-svc-token.yaml
</span></span></code></pre></div><p><em>Token</em> yang mewakili Pod akan diminta dan disimpan kubelet, lalu kubelet akan membuat <em>token</em> yang dapat diakses oleh Pod pada <em>file path</em> yang ditentukan, dan melakukan <em>refresh</em> <em>token</em> ketika telah mendekati waktu berakhir. <em>Token</em> akan diganti oleh kubelet jika <em>token</em> telah melewati 80% dari total TTL, atau jika <em>token</em> telah melebihi waktu 24 jam.</p><p>Aplikasi bertanggung jawab untuk memuat ulang <em>token</em> ketika terjadi penggantian. Pemuatan ulang teratur (misalnya sekali setiap 5 menit) cukup untuk mencakup kebanyakan kasus.</p><h2 id=serviceaccountissuerdiscovery>ServiceAccountIssuerDiscovery</h2><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.18 [alpha]</code></div><p>Fitur ServiceAccountIssuerDiscovery diaktifkan dengan mengaktifkan <a href=/docs/reference/command-line-tools-reference/feature-gate>gerbang fitur</a> <code>ServiceAccountIssuerDiscovery</code> dan mengaktifkan fitur <em>Service Account Token Volume Projection</em> seperti yang telah dijelaskan <a href=#service-account-token-volume-projection>di atas</a>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong><p>URL <em>issuer</em> harus sesuai dengan <em><a href=https://openid.net/specs/openid-connect-discovery-1_0.html>OIDC Discovery Spec</a></em>. Pada implementasinya, hal ini berarti URL harus menggunakan skema <code>https</code> dan harus menyediakan konfigurasi penyedia OpenID pada <code>{service-account-issuer}/.well-known/openid-configuration</code>.</p><p>Jika URL tidak sesuai dengan aturan, <em>endpoint</em> <code>ServiceAccountIssuerDiscovery</code> tidak akan didaftarkan meskipun fitur telah diaktifkan.</p></div><p>Fitur <em>Service Account Issuer Discovery</em> memungkinkan federasi dari berbagai <em>token</em> ServiceAccount Kubernetes yang dibuat oleh sebuah klaster (penyedia identitas) dan sistem eksternal.</p><p>Ketika diaktifkan, server API Kubernetes menyediakan dokumen OpenID Provider Configuration pada <code>/.well-known/openid-configuration</code> dan JSON Web Key Set (JWKS) terkait pada <code>/openid/v1/jwks</code>. OpenID Provider Configuration terkadang disebut juga dengan sebutan <em>discovery document</em>.</p><p>Ketika diaktifkan, klaster juga dikonfigurasi dengan RBAC ClusterRole standar yaitu <code>system:service-account-issuer-discovery</code>. <em>Role binding</em> tidak disediakan secara <em>default</em>. Administrator dimungkinkan untuk, sebagai contoh, menentukan apakah peran akan disematkan ke <code>system:authenticated</code> atau <code>system:unauthenticated</code> tergantung terhadap kebutuhan keamanan dan sistem eksternal yang direncakanan untuk diintegrasikan.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Respons yang disediakan pada <code>/.well-known/openid-configuration</code> dan<code>/openid/v1/jwks</code> dirancang untuk kompatibel dengan OIDC, tetapi tidak sepenuhnya sesuai dengan ketentuan OIDC. Dokumen tersebut hanya berisi parameter yang dibutuhkan untuk melakukan validasi terhadap <em>token</em> ServiceAccount Kubernetes.</div><p>Respons JWKS memuat kunci publik yang dapat digunakan oleh sistem eksternal untuk melakukan validasi <em>token</em> ServiceAccount Kubernetes. Awalnya sistem eksternal akan mengkueri OpenID Provider Configuration, dan selanjutnya dapat menggunakan <em>field</em> <code>jwks_uri</code> pada respons kueri untuk mendapatkan JWKS.</p><p>Pada banyak kasus, server API Kubernetes tidak tersedia di internet publik, namun <em>endpoint</em> publik yang menyediakan respons hasil <em>cache</em> dari server API dapat dibuat menjadi tersedia oleh pengguna atau penyedia servis. Pada kasus ini, dimungkinkan untuk mengganti <code>jwks_uri</code> pada OpenID Provider Configuration untuk diarahkan ke <em>endpoint</em> publik sebagai ganti alamat server API dengan memberikan <em>flag</em> <code>--service-account-jwks-uri</code> ke API server. serupa dengan URL <em>issuer</em>, URI JWKS diharuskan untuk menggunakan skema <code>https</code>.</p><h2 id=selanjutnya>Selanjutnya</h2><p>Lihat juga:</p><ul><li><a href=/docs/reference/access-authn-authz/service-accounts-admin/>Panduan Admin Kluster mengenai ServiceAccount</a></li><li><a href=https://github.com/kubernetes/enhancements/blob/master/keps/sig-auth/20190730-oidc-discovery.md>ServiceAccount Signing Key Retrieval KEP</a></li><li><a href=https://openid.net/specs/openid-connect-discovery-1_0.html>OIDC Discovery Spec</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d385b86a7cb496d3b1c3b2a47280ca70>3.7 - Menarik Image dari Register Pribadi</h1><p>Laman ini menunjukkan cara membuat Pod dengan menggunakan Secret untuk menarik <em>image</em> dari sebuah
register atau repositori pribadi untuk Docker.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><ul><li><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p></li><li><p>Untuk melakukan latihan ini, kamu memerlukan sebuah
<a href=https://docs.docker.com/docker-id/>nama pengguna (ID) Docker</a> dan kata sandi (<em>password</em>).</p></li></ul><h2 id=masuk-ke-docker>Masuk (<em>login</em>) ke Docker</h2><p>Pada laptop kamu, kamu harus melakukan autentikasi dengan register untuk menarik <em>image</em> pribadi:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker login
</span></span></code></pre></div><p>Ketika diminta, masukkan nama pengguna dan kata sandi Docker kamu.</p><p>Proses <em>login</em> membuat atau memperbarui berkas <code>config.json</code> yang menyimpan sebuah <em>token</em> otorisasi.</p><p>Lihatlah berkas <code>config.json</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat ~/.docker/config.json
</span></span></code></pre></div><p>Keluaran berisi bagian yang serupa dengan ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>&#34;auths&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>&#34;https://index.docker.io/v1/&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:green;font-weight:700>&#34;auth&#34;</span>: <span style=color:#b44>&#34;c3R...zE2&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Jika kamu menggunakan tempat penyimpanan kredensial (<em>credential</em>) untuk Docker, maka kamu tidak akan melihat entri <code>auth</code> tetapi entri <code>credsStore</code> dengan nama tempat penyimpanan sebagai nilainya.</div><h2 id=register-secret-kredensial-yang-ada>Membuat Secret berdasarkan kredensial Docker yang sudah ada</h2><p>Klaster Kubernetes menggunakan Secret dari tipe <code>docker-registry</code> untuk melakukan autentikasi dengan
register Container untuk menarik <em>image</em> pribadi.</p><p>Jika kamu sudah menjalankan <code>docker login</code>, kamu dapat menyalin kredensial itu ke Kubernetes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret generic regcred <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>    --from-file<span style=color:#666>=</span>.dockerconfigjson<span style=color:#666>=</span>&lt;path/to/.docker/config.json&gt; <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>    --type<span style=color:#666>=</span>kubernetes.io/dockerconfigjson
</span></span></code></pre></div><p>Jika kamu memerlukan lebih banyak kontrol (misalnya, untuk mengatur Namespace atau label baru pada Secret)
maka kamu dapat menyesuaikan Secret tersebut sebelum menyimpannya.
Pastikan untuk:</p><ul><li>Mengatur nama dari pokok (<em>item</em>) data menjadi <code>.dockerconfigjson</code></li><li>Melakukan enkode secara <em>base64</em> dari Dockerfile (berkas Docker) dan memindahkan urutan huruf (<em>string</em>) tersebut, secara tidak terputus sebagai nilai untuk bidang <code>data[".dockerconfigjson"]</code></li><li>Mengatur <code>type</code> menjadi <code>kubernetes.io/dockerconfigjson</code></li></ul><p>Sebagai contoh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Secret<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>myregistrykey<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>awesomeapps<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>.dockerconfigjson</span>:<span style=color:#bbb> </span>UmVhbGx5IHJlYWxseSByZWVlZWVlZWVlZWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGx5eXl5eXl5eXl5eXl5eXl5eXl5eSBsbGxsbGxsbGxsbGxsbG9vb29vb29vb29vb29vb29vb29vb29vb29vb25ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubmdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2cgYXV0aCBrZXlzCg==<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>kubernetes.io/dockerconfigjson<span style=color:#bbb>
</span></span></span></code></pre></div><p>Jika kamu mendapat pesan kesalahan <code>error: no objects passed to create</code>, ini berarti pengkodean <em>base64</em> dari urutan huruf tersebut tidak valid.
Jika kamu mendapat pesan kesalahan seperti <code>Secret "myregistrykey" is invalid: data[.dockerconfigjson]: invalid value ...</code>, ini berarti
enkode <em>base64</em> dari urutan huruf dalam data tersebut sukses didekodekan, tetapi tidak bisa diuraikan menjadi berkas <code>.docker/config.json</code>.</p><h2 id=membuat-secret-dengan-memberikan-kredensial-pada-baris-perintah>Membuat Secret dengan memberikan kredensial pada baris perintah</h2><p>Buatlah Secret ini, dan berilah nama <code>regcred</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret docker-registry regcred --docker-server<span style=color:#666>=</span>&lt;your-registry-server&gt; --docker-username<span style=color:#666>=</span>&lt;your-name&gt; --docker-password<span style=color:#666>=</span>&lt;your-pword&gt; --docker-email<span style=color:#666>=</span>&lt;your-email&gt;
</span></span></code></pre></div><p>dimana:</p><ul><li><code>&lt;your-registry-server></code> merupakan FQDN dari register privat Docker kamu. (<a href=https://index.docker.io/v1/>https://index.docker.io/v1/</a> untuk DockerHub)</li><li><code>&lt;your-name></code> adalah nama pengguna Docker kamu.</li><li><code>&lt;your-pword></code> adalah kata sandi Docker kamu.</li><li><code>&lt;your-email></code> adalah alamat email Docker kamu.</li></ul><p>Kamu telah berhasil mengatur kredensial untuk Docker kamu pada klaster sebagai sebuah Secret yang dipanggil dengan nama <code>regcred</code>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Mengetik Secret pada baris perintah dapat menyimpannya dalam riwayat (<em>history</em>) dari <em>shell</em> kamu tanpa perlindungan, dan
Secret tersebut mungkin juga terlihat oleh pengguna lain dalam PC kamu selama perintah <code>kubectl</code> sedang berjalan.</div><h2 id=menginspeksi-secret-regcred>Menginspeksi Secret <code>regcred</code></h2><p>Untuk memahami isi Secret <code>regcred</code> yang baru saja kamu buat, mulailah dengan melihat Secret dalam format YAML:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get secret regcred --output<span style=color:#666>=</span>yaml
</span></span></code></pre></div><p>Keluarannya akan seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Secret<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>regcred<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>.dockerconfigjson</span>:<span style=color:#bbb> </span>eyJodHRwczovL2luZGV4L ... J0QUl6RTIifX0=<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>kubernetes.io/dockerconfigjson<span style=color:#bbb>
</span></span></span></code></pre></div><p>Nilai dari bidang <code>.dockerconfigjson</code> merupakan representasi dalam <em>base64</em> dari kredensial Docker kamu.</p><p>Untuk memahami apa yang ada dalam bidang <code>.dockerconfigjson</code>, ubahlah data Secret menjadi format yang bisa terbaca:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get secret regcred --output<span style=color:#666>=</span><span style=color:#b44>&#34;jsonpath={.data.\.dockerconfigjson}&#34;</span> | base64 --decode
</span></span></code></pre></div><p>Keluarannya akan seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:green;font-weight:700>&#34;auths&#34;</span>:{<span style=color:green;font-weight:700>&#34;your.private.registry.example.com&#34;</span>:{<span style=color:green;font-weight:700>&#34;username&#34;</span>:<span style=color:#b44>&#34;janedoe&#34;</span>,<span style=color:green;font-weight:700>&#34;password&#34;</span>:<span style=color:#b44>&#34;xxxxxxxxxxx&#34;</span>,<span style=color:green;font-weight:700>&#34;email&#34;</span>:<span style=color:#b44>&#34;jdoe@example.com&#34;</span>,<span style=color:green;font-weight:700>&#34;auth&#34;</span>:<span style=color:#b44>&#34;c3R...zE2&#34;</span>}}}
</span></span></code></pre></div><p>Untuk memahami apa yang ada dalam bidang <code>auth</code>, ubahlah data Secret menjadi format yang bisa terbaca:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;c3R...zE2&#34;</span> | base64 --decode
</span></span></code></pre></div><p>Keluarannya, nama pengguna dan kata sandi yang digabungkan dengan tanda <code>:</code>, seperti dibawah ini:</p><pre tabindex=0><code class=language-none data-lang=none>janedoe:xxxxxxxxxxx
</code></pre><p>Perhatikan bahwa data Secret berisi token otorisasi yang serupa dengan berkas <code>~/.docker/config.json</code> lokal kamu.</p><p>Kamu telah berhasil menetapkan kredensial Docker kamu sebagai sebuah Secret yang dipanggil dengan <code>regcred</code> pada klaster.</p><h2 id=membuat-pod-yang-menggunakan-secret-kamu>Membuat Pod yang menggunakan Secret kamu</h2><p>Berikut ini adalah berkas konfigurasi untuk Pod yang memerlukan akses ke kredensial Docker kamu pada <code>regcred</code>:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/private-reg-pod.yaml download=pods/private-reg-pod.yaml><code>pods/private-reg-pod.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-private-reg-pod-yaml")' title="Copy pods/private-reg-pod.yaml to clipboard"></img></div><div class=includecode id=pods-private-reg-pod-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>private-reg<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>private-reg-container<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>&lt;image-pribadi-kamu&gt;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>imagePullSecrets</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>regcred<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Unduh berkas diatas:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget -O my-private-reg-pod.yaml https://k8s.io/examples/pods/private-reg-pod.yaml
</span></span></code></pre></div><p>Dalam berkas <code>my-private-reg-pod.yaml</code>, ubah <code>&lt;your-private-image></code> dengan tautan ke <em>image</em> dalam register pribadi seperti ini:</p><pre tabindex=0><code class=language-none data-lang=none>your.private.registry.example.com/janedoe/jdoe-private:v1
</code></pre><p>Untuk menarik <em>image</em> dari register pribadi, Kubernetes memerlukan kredensial.
Bidang <code>imagePullSecrets</code> dalam berkas konfigurasi menentukan bahwa Kubernetes harus mendapatkan kredensial dari Secret yang bernama <code>regcred</code>.</p><p>Buatlah Pod yang menggunakan Secret kamu, dan verifikasi bahwa Pod tersebut berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f my-private-reg-pod.yaml
</span></span><span style=display:flex><span>kubectl get pod private-reg
</span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Pelajari lebih lanjut tentang <a href=/id/docs/concepts/configuration/secret/>Secret</a>.</li><li>Pelajari lebih lanjut tentang <a href=/id/docs/concepts/containers/images/#menggunakan-register-privat>menggunakan register pribadi</a>.</li><li>Pelajari lebih lanjut tentang <a href=/id/docs/tasks/configure-pod-container/configure-service-account/#add-imagepullsecrets-to-a-service-account>menambahkan Secret untuk menarik <em>image</em> ke dalam sebuah akun service</a>.</li><li>Lihatlah <a href=/docs/reference/generated/kubectl/kubectl-commands/#-em-secret-docker-registry-em->kubectl create secret docker-registry</a>.</li><li>Lihatlah <a href=/docs/reference/generated/kubernetes-api/v1.25/#secret-v1-core>Secret</a>.</li><li>Lihatlah bidang <code>imagePullSecrets</code> dari <a href=/docs/reference/generated/kubernetes-api/v1.25/#podspec-v1-core>PodSpec</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-eb54daf87df373096b5e830680194dfc>3.8 - Mengatur Probe Liveness, Readiness dan Startup</h1><p>Laman ini memperlihatkan bagaimana cara untuk mengatur <em>probe liveness</em>, <em>readiness</em>, dan
<em>startup</em> untuk Container.</p><p><em>Probe liveness</em> digunakan oleh <a href=/docs/admin/kubelet/>kubelet</a> untuk mengetahui
kapan perlu mengulang kembali (<em>restart</em>) sebuah Container. Sebagai contoh, <em>probe liveness</em>
dapat mendeteksi <em>deadlock</em>, ketika aplikasi sedang berjalan tapi tidak dapat berfungsi dengan baik.
Mengulang Container dengan <em>state</em> tersebut dapat membantu ketersediaan aplikasi yang lebih baik
walaupun ada kekutu (<em>bug</em>).</p><p><em>Probe readiness</em> digunakan oleh kubelet untuk mengetahui kapan sebuah Container telah siap untuk
menerima lalu lintas jaringan (<em>traffic</em>). Suatu Pod dianggap siap saat semua Container di dalamnya telah
siap. Sinyal ini berguna untuk mengontrol Pod-Pod mana yang digunakan sebagai <em>backend</em> dari Service.
Ketika Pod dalam kondisi tidak siap, Pod tersebut dihapus dari Service <em>load balancer</em>.</p><p><em>Probe startup</em> digunakan oleh kubelet untuk mengetahui kapan sebuah aplikasi Container telah mulai berjalan.
Jika <em>probe</em> tersebut dinyalakan, <em>probe</em> akan menonaktifkan pemeriksaan <em>liveness</em> dan <em>readiness</em> sampai
berhasil, kamu harus memastikan <em>probe</em> tersebut tidak mengganggu <em>startup</em> dari aplikasi.
Mekanisme ini dapat digunakan untuk mengadopsi pemeriksaan <em>liveness</em> pada saat memulai Container yang lambat,
untuk menghindari Container dimatikan oleh kubelet sebelum Container mulai dan berjalan.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mendefinisikan-perintah-liveness>Mendefinisikan perintah liveness</h2><p>Kebanyakan aplikasi yang telah berjalan dalam waktu lama pada akhirnya akan
bertransisi ke <em>state</em> yang rusak (<em>broken</em>), dan tidak dapat pulih kecuali diulang kembali.
Kubernetes menyediakan <em>probe liveness</em> untuk mendeteksi dan memperbaiki situasi tersebut.</p><p>Pada latihan ini, kamu akan membuat Pod yang menjalankan Container dari image
<code>k8s.gcr.io/busybox</code>. Berikut ini adalah berkas konfigurasi untuk Pod tersebut:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/probe/exec-liveness.yaml download=pods/probe/exec-liveness.yaml><code>pods/probe/exec-liveness.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-probe-exec-liveness-yaml")' title="Copy pods/probe/exec-liveness.yaml to clipboard"></img></div><div class=includecode id=pods-probe-exec-liveness-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>test</span>:<span style=color:#bbb> </span>liveness<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>liveness-exec<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>liveness<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- /bin/sh<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- -c<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 600<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>livenessProbe</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>exec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- cat<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- /tmp/healthy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>initialDelaySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Pada berkas konfigurasi di atas, kamu dapat melihat bahwa Pod memiliki satu <code>Container</code>.
<em>Field</em> <code>periodSeconds</code> menentukan bahwa kubelet harus melakukan <em>probe liveness</em> setiap 5 detik.
<em>Field</em> <code>initialDelaySeconds</code> memberitahu kubelet untuk menunggu 5 detik sebelum mengerjakan
<em>probe</em> yang pertama. Untuk mengerjakan <em>probe</em>, kubelet menjalankan perintah <code>cat /tmp/healthy</code>
pada Container tujuan. Jika perintah berhasil, kode 0 akan dikembalikan, dan kubelet menganggap
Container sedang dalam kondisi hidup (<em>alive</em>) dan sehat (<em>healthy</em>). Jika perintah mengembalikan
kode selain 0, maka kubelet akan mematikan Container dan mengulangnya kembali.</p><p>Saat dimulai, Container akan menjalankan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>/bin/sh -c <span style=color:#b44>&#34;touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 600&#34;</span>
</span></span></code></pre></div><p>Container memiliki berkas <code>/tmp/healthy</code> pada saat 30 detik pertama setelah dijalankan.
Kemudian, perintah <code>cat /tmp/healthy</code> mengembalikan kode sukses. Namun setelah 30 detik,
<code>cat /tmp/healthy</code> mengembalikan kode gagal.</p><p>Buatlah sebuah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/probe/exec-liveness.yaml
</span></span></code></pre></div><p>Dalam 30 detik pertama, lihatlah <em>event</em> dari Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe pod liveness-exec
</span></span></code></pre></div><p>Keluaran dari perintah tersebut memperlihatkan bahwa belum ada <em>probe liveness</em> yang gagal:</p><pre tabindex=0><code>FirstSeen    LastSeen    Count   From            SubobjectPath           Type        Reason      Message
--------- --------    -----   ----            -------------           --------    ------      -------
24s       24s     1   {default-scheduler }                    Normal      Scheduled   Successfully assigned liveness-exec to worker0
23s       23s     1   {kubelet worker0}   spec.containers{liveness}   Normal      Pulling     pulling image &#34;k8s.gcr.io/busybox&#34;
23s       23s     1   {kubelet worker0}   spec.containers{liveness}   Normal      Pulled      Successfully pulled image &#34;k8s.gcr.io/busybox&#34;
23s       23s     1   {kubelet worker0}   spec.containers{liveness}   Normal      Created     Created container with docker id 86849c15382e; Security:[seccomp=unconfined]
23s       23s     1   {kubelet worker0}   spec.containers{liveness}   Normal      Started     Started container with docker id 86849c15382e
</code></pre><p>Setelah 35 detik, lihatlah lagi <em>event</em> Pod tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe pod liveness-exec
</span></span></code></pre></div><p>Baris terakhir dari keluaran tersebut memperlihatkan pesan bahwa <em>probe liveness</em>
mengalami kegagalan, dan Container telah dimatikan dan dibuat ulang.</p><pre tabindex=0><code>FirstSeen LastSeen    Count   From            SubobjectPath           Type        Reason      Message
--------- --------    -----   ----            -------------           --------    ------      -------
37s       37s     1   {default-scheduler }                    Normal      Scheduled   Successfully assigned liveness-exec to worker0
36s       36s     1   {kubelet worker0}   spec.containers{liveness}   Normal      Pulling     pulling image &#34;k8s.gcr.io/busybox&#34;
36s       36s     1   {kubelet worker0}   spec.containers{liveness}   Normal      Pulled      Successfully pulled image &#34;k8s.gcr.io/busybox&#34;
36s       36s     1   {kubelet worker0}   spec.containers{liveness}   Normal      Created     Created container with docker id 86849c15382e; Security:[seccomp=unconfined]
36s       36s     1   {kubelet worker0}   spec.containers{liveness}   Normal      Started     Started container with docker id 86849c15382e
2s        2s      1   {kubelet worker0}   spec.containers{liveness}   Warning     Unhealthy   Liveness probe failed: cat: can&#39;t open &#39;/tmp/healthy&#39;: No such file or directory
</code></pre><p>Tunggu 30 detik lagi, dan verifikasi bahwa Container telah diulang kembali:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod liveness-exec
</span></span></code></pre></div><p>Keluaran perintah tersebut memperlihatkan bahwa jumlah <code>RESTARTS</code> telah meningkat:</p><pre tabindex=0><code>NAME            READY     STATUS    RESTARTS   AGE
liveness-exec   1/1       Running   1          1m
</code></pre><h2 id=mendefinisikan-probe-liveness-dengan-permintaan-http>Mendefinisikan probe liveness dengan permintaan HTTP</h2><p>Jenis kedua dari <em>probe liveness</em> menggunakan sebuah permintaan GET HTTP. Berikut ini
berkas konfigurasi untuk Pod yang menjalankan Container dari image <code>k8s.gcr.io/liveness</code>.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/probe/http-liveness.yaml download=pods/probe/http-liveness.yaml><code>pods/probe/http-liveness.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-probe-http-liveness-yaml")' title="Copy pods/probe/http-liveness.yaml to clipboard"></img></div><div class=includecode id=pods-probe-http-liveness-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>test</span>:<span style=color:#bbb> </span>liveness<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>liveness-http<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>liveness<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/liveness<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- /server<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>livenessProbe</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>httpGet</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span>/healthz<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>httpHeaders</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>Custom-Header<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span>Awesome<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>initialDelaySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Pada berkas konfigurasi tersebut, kamu dapat melihat Pod memiliki sebuah Container.
<em>Field</em> <code>periodSeconds</code> menentukan bahwa kubelet harus mengerjakan <em>probe liveness</em> setiap 3 detik.
<em>Field</em> <code>initialDelaySeconds</code> memberitahu kubelet untuk menunggu 3 detik sebelum mengerjakan
<em>probe</em> yang pertama. Untuk mengerjakan <em>probe</em> tersebut, kubelet mengirimkan sebuah permintaan
GET HTTP ke server yang sedang berjalan di dalam Container dan mendengarkan (<em>listen</em>) pada porta 8080.
Jika <em>handler path</em> <code>/healthz</code> yang dimiliki server mengembalikan kode sukses, kubelet menganggap
Container sedang dalam kondisi hidup dan sehat. Jika <em>handler</em> mengembalikan kode gagal,
kubelet mematikan Container dan mengulangnya kembali.</p><p>Kode yang lebih besar atau sama dengan 200 dan kurang dari 400 mengindikasikan kesuksesan.
Kode selain ini mengindikasikan kegagalan.</p><p>Kamu dapat melihat kode program untuk server ini pada <a href=https://github.com/kubernetes/kubernetes/blob/main/test/images/agnhost/liveness/server.go>server.go</a>.</p><p>Untuk 10 detik pertama setelah Container hidup (<em>alive</em>), <em>handler</em> <code>/healthz</code> mengembalikan
status 200. Setelah itu, <em>handler</em> mengembalikan status 500.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>http.<span style=color:#00a000>HandleFunc</span>(<span style=color:#b44>&#34;/healthz&#34;</span>, <span style=color:#a2f;font-weight:700>func</span>(w http.ResponseWriter, r <span style=color:#666>*</span>http.Request) {
</span></span><span style=display:flex><span>    duration <span style=color:#666>:=</span> time.<span style=color:#00a000>Now</span>().<span style=color:#00a000>Sub</span>(started)
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>if</span> duration.<span style=color:#00a000>Seconds</span>() &gt; <span style=color:#666>10</span> {
</span></span><span style=display:flex><span>        w.<span style=color:#00a000>WriteHeader</span>(<span style=color:#666>500</span>)
</span></span><span style=display:flex><span>        w.<span style=color:#00a000>Write</span>([]<span style=color:#a2f>byte</span>(fmt.<span style=color:#00a000>Sprintf</span>(<span style=color:#b44>&#34;error: %v&#34;</span>, duration.<span style=color:#00a000>Seconds</span>())))
</span></span><span style=display:flex><span>    } <span style=color:#a2f;font-weight:700>else</span> {
</span></span><span style=display:flex><span>        w.<span style=color:#00a000>WriteHeader</span>(<span style=color:#666>200</span>)
</span></span><span style=display:flex><span>        w.<span style=color:#00a000>Write</span>([]<span style=color:#a2f>byte</span>(<span style=color:#b44>&#34;ok&#34;</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>Pemeriksaan kesehatan (<em>health check</em>) dilakukan kubelet 3 detik setelah Container dimulai,
sehingga beberapa pemeriksaaan pertama akan berhasil. Namun setelah 10 detik,
pemeriksaan akan gagal, dan kubelet akan mematikan dan mengulang Container kembali.</p><p>Untuk mencoba pemeriksaan <em>liveness</em> HTTP, marilah membuat sebuah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/probe/http-liveness.yaml
</span></span></code></pre></div><p>Setelah 10 detik, lihatlah <em>event</em> Pod untuk memverifikasi bahwa <em>probe liveness</em>
telah gagal dan Container telah diulang kembali:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe pod liveness-http
</span></span></code></pre></div><p>Untuk rilis sebelum v1.13 (termasuk v1.13), jika variabel lingkungan
<code>http_proxy</code> (atau <code>HTTP_PROXY</code>) telah diatur pada Node dimana Pod
berjalan, <em>probe liveness</em> HTTP akan menggunakan proksi tersebut.
Untuk rilis setelah v1.13, pengaturan variabel lingkungan pada proksi HTTP lokal
tidak mempengaruhi <em>probe liveness</em> HTTP.</p><h2 id=mendefinisikan-probe-liveness-tcp>Mendefinisikan probe liveness TCP</h2><p>Jenis ketiga dari <em>probe liveness</em> menggunakaan sebuah soket TCP. Dengan konfigurasi ini,
kubelet akan mencoba untuk membuka soket pada Container kamu dengan porta tertentu.
Jika koneksi dapat terbentuk dengan sukses, maka Container dianggap dalam kondisi sehat.
Namun jika tidak berhasil terbentuk, maka Container dianggap gagal.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/probe/tcp-liveness-readiness.yaml download=pods/probe/tcp-liveness-readiness.yaml><code>pods/probe/tcp-liveness-readiness.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-probe-tcp-liveness-readiness-yaml")' title="Copy pods/probe/tcp-liveness-readiness.yaml to clipboard"></img></div><div class=includecode id=pods-probe-tcp-liveness-readiness-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>goproxy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>goproxy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>goproxy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/goproxy:0.1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>readinessProbe</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>tcpSocket</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>initialDelaySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>livenessProbe</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>tcpSocket</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>initialDelaySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>15</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>20</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Seperti yang terlihat, konfigurasi untuk pemeriksaan TCP cukup mirip dengan
pemeriksaan HTTP. Contoh ini menggunakan <em>probe readiness</em> dan <em>liveness</em>.
<em>Probe readiness</em> yang pertama akan dikirimkan oleh kubelet, 5 detik setelah
Container mulai dijalankan. Container akan coba dihubungkan oleh kubelet dengan
<code>goproxy</code> pada porta 8080. Jika <em>probe</em> berhasil, maka Pod akan ditandai menjadi
<em>ready</em>. Pemeriksaan ini akan dilanjutkan oleh kubelet setiap 10 detik.</p><p>Selain <em>probe readiness</em>, <em>probe liveness</em> juga termasuk di dalam konfigurasi.
<em>Probe liveness</em> yang pertama akan dijalankan oleh kubelet, 15 detik setelah Container
mulai dijalankan. Sama seperti <em>probe readiness</em>, kubelet akan mencoba untuk
terhubung dengan Container <code>goproxy</code> pada porta 8080. Jika <em>probe liveness</em> gagal,
maka Container akan diulang kembali.</p><p>Untuk mencoba pemeriksaan <em>liveness</em> TCP, marilah membuat sebuah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/probe/tcp-liveness-readiness.yaml
</span></span></code></pre></div><p>Setelah 15 detik, lihatlah <em>event</em> Pod untuk memverifikasi <em>probe liveness</em> tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe pod goproxy
</span></span></code></pre></div><h2 id=menggunakan-sebuah-porta-dengan-nama>Menggunakan sebuah porta dengan nama</h2><p>Kamu dapat menggunakan
<a href=/docs/reference/generated/kubernetes-api/v1.25/#containerport-v1-core>ContainerPort</a>
dengan nama untuk melakukan pemeriksaan <em>liveness</em> HTTP atau TCP:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>liveness-port<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPort</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>livenessProbe</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>httpGet</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span>/healthz<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span>liveness-port<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=mendefinisikan-probe-startup>Melindungi Container yang lambat untuk dimulai dengan probe startup</h2><p>Terkadang kamu harus berurusan dengan aplikasi peninggalan (<em>legacy</em>) yang
memerlukan waktu tambahan untuk mulai berjalan pada saat pertama kali diinisialisasi.
Pada kasus ini, cukup rumit untuk mengatur parameter <em>probe liveness</em> tanpa
mengkompromikan respons yang cepat terhadap <em>deadlock</em> yang memotivasi digunakannya
probe_ tersebut. Triknya adalah mengatur <em>probe startup</em> dengan perintah yang sama,
baik pemeriksaan HTTP ataupun TCP, dengan <code>failureThreshold * periodSeconds</code> yang
mencukupi untuk kemungkinan waktu memulai yang terburuk.</p><p>Sehingga, contoh sebelumnya menjadi:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>liveness-port<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPort</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>livenessProbe</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>httpGet</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span>/healthz<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span>liveness-port<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>failureThreshold</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>startupProbe</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>httpGet</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span>/healthz<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span>liveness-port<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>failureThreshold</span>:<span style=color:#bbb> </span><span style=color:#666>30</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Berkat <em>probe startup</em>, aplikasi akan memiliki paling lambat 5 menit (30 * 10 = 300 detik)
untuk selesai memulai.
Ketika <em>probe startup</em> telah berhasil satu kali, maka <em>probe liveness</em> akan
mengambil alih untuk menyediakan respons cepat terhadap <em>deadlock</em> Container.
Jika <em>probe startup</em> tidak pernah berhasil, maka Container akan dimatikan setelah
300 detik dan perilakunya akan bergantung pada <code>restartPolicy</code> yang dimiliki Pod.</p><h2 id=mendefinisikan-probe-readiness>Mendefinisikan probe readiness</h2><p>Terkadang aplikasi tidak dapat melayani lalu lintas jaringan sementara.
Contohnya, aplikasi mungkin perlu untuk memuat data besar atau berkas konfigurasi
saat dimulai, atau aplikasi bergantung pada layanan eksternal setelah dimulai.
Pada kasus-kasus ini, kamu tidak ingin mematikan aplikasi, tetapi kamu tidak
ingin juga mengirimkan permintaan ke aplikasi tersebut. Kubernetes menyediakan
<em>probe readiness</em> sebagai solusinya. Sebuah Pod dengan Container yang melaporkan
dirinya tidak siap, tidak akan menerima lalu lintas jaringan dari Kubernetes Service.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> <em>Probe readiness</em> dijalankan di dalam Container selama siklus hidupnya.</div><p><em>Probe readiness</em> memiliki pengaturan yang mirip dengan <em>probe liveness</em>. Perbedaan
satu-satunya adalah kamu menggunakan <em>field</em> <code>readinessProbe</code>, bukan <em>field</em> <code>livenessProbe</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>readinessProbe</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>exec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- cat<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- /tmp/healthy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>initialDelaySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Pengaturan untuk <em>probe readiness</em> untuk HTTP dan TCP juga sama persis dengan
pengaturan untuk <em>probe liveness</em>.</p><p><em>Probe readiness</em> dan <em>liveness</em> dapat digunakan secara bersamaan untuk
Container yang sama. Apabila keduanya digunakan sekaligus, lalu lintas jaringan
tidak akan sampai ke Container yang belum siap, dan Container akan diulang kembali
(<em>restart</em>) saat mengalami kegagalan.</p><h2 id=mengatur-probe>Mengatur Probe</h2><p><a href=/docs/reference/generated/kubernetes-api/v1.25/#probe-v1-core>Probe</a> memiliki
beberapa <em>field</em> yang dapat digunakan untuk mengendalikan pemeriksaan <em>liveness</em> dan <em>readiness</em>
secara presisi.</p><ul><li><code>initialDelaySeconds</code>: Durasi dalam detik setelah Container dimulai,
sebelum <em>probe liveness</em> atau <em>readiness</em> diinisiasi. Nilai bawaannya adalah 0 detik. Nilai minimalnya adalah 0.</li><li><code>periodSeconds</code>: Seberapa sering (dalam detik) <em>probe</em> dijalankan. Nilai bawaannya adalah 10 detik.
Nilai minimalnya adalah 0.</li><li><code>timeoutSeconds</code>: Durasi dalam detik setelah <em>probe</em> mengalami <em>timeout</em>. Nilai bawaannya adalah 1 detik.
Nilai minimalnya adalah 0.</li><li><code>successThreshold</code>: Jumlah minimal sukses yang berurutan untuk <em>probe</em> dianggap berhasil
setelah mengalami kegagalan. Nilai bawaannya adalah 1. Nilanya harus 1 untuk <em>liveness</em>.
Nilai minimalnya adalah 1.</li><li><code>failureThreshold</code>: Ketika sebuah Pod dimulai dan <em>probe</em> mengalami kegagalan, Kubernetes
akan mencoba beberapa kali sesuai nilai <code>failureThreshold</code> sebelum menyerah. Menyerah dalam
kasus <em>probe liveness</em> berarti Container akan diulang kembali. Untuk <em>probe readiness</em>, menyerah
akan menandai Pod menjadi "tidak siap" (<em>Unready</em>). Nilai bawaannya adalah 3. Nilai minimalnya adalah 1.</li></ul><p><a href=/docs/reference/generated/kubernetes-api/v1.25/#httpgetaction-v1-core><em>Probe</em> HTTP</a>
memiliki <em>field-field</em> tambahan yang bisa diatur melalui <code>httpGet</code>:</p><ul><li><code>host</code>: Nama dari host yang akan terhubung, nilai bawaannya adalah IP dari Pod. Kamu mungkin
juga ingin mengatur "Host" pada httpHeaders.</li><li><code>scheme</code>: Skema yang digunakan untuk terhubung pada host (HTTP atau HTTPS). Nilai bawaannya adalah HTTP.</li><li><code>path</code>: <em>Path</em> untuk mengakses server HTTP.</li><li><code>httpHeaders</code>: <em>Header</em> khusus yang diatur dalam permintaan HTTP. HTTP memperbolehkan <em>header</em> yang berulang.</li><li><code>port</code>: Nama atau angka dari porta untuk mengakses Container. Angkanya harus ada di antara 1 sampai 65535.</li></ul><p>Untuk sebuah <em>probe</em> HTTP, kubelet mengirimkan permintaan HTTP untuk <em>path</em> yang ditentukan
dan porta untuk mengerjakan pemeriksaan. <em>Probe</em> dikirimkan oleh kubelet untuk alamat IP Pod,
kecuali saat alamat digantikan oleh <em>field</em> opsional pada <code>httpGet</code>. Jika <em>field</em> <code>scheme</code>
diatur menjadi <code>HTTPS</code>, maka kubelet mengirimkan permintaan HTTPS dan melewati langkah verifikasi
sertifikat. Pada skenario kebanyakan, kamu tidak menginginkan <em>field</em> <code>host</code>.
Berikut satu skenario yang memerlukan <code>host</code>. Misalkan Container mendengarkan permintaan
melalui 127.0.0.1 dan <em>field</em> <code>hostNetwork</code> pada Pod bernilai true. Kemudian <code>host</code>, melalui
<code>httpGet</code>, harus diatur menjadi 127.0.0.1. Jika Pod kamu bergantung pada host virtual, dimana
untuk kasus-kasus umum, kamu tidak perlu menggunakan <code>host</code>, tetapi perlu mengatur <em>header</em>
<code>Host</code> pada <code>httpHeaders</code>.</p><p>Untuk <em>probe</em> TCP, kubelet membuat koneksi <em>probe</em> pada Node, tidak pada Pod, yang berarti bahwa
kamu tidak menggunakan nama Service di dalam parameter <code>host</code> karena kubelet tidak bisa
me-<em>resolve</em>-nya.</p><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Pelajari lebih lanjut tentang
<a href=/id/docs/concepts/workloads/pods/pod-lifecycle/#container-probes>Probe Container</a>.</li></ul><p>Kamu juga dapat membaca rujukan API untuk:</p><ul><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#pod-v1-core>Pod</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#container-v1-core>Container</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#probe-v1-core>Probe</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fc3f4777ae8ea685d2b54e175277ac01>3.9 - Menempatkan Pod pada Node Menggunakan Afinitas Pod</h1><p>Dokumen ini menunjukkan cara menempatkan Pod Kubernetes pada sebuah Node menggunakan
Afinitas Node di dalam klaster Kubernetes.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Kubernetes servermu harus dalam versi yang sama atau lebih baru dari v1.10.
Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=menambahkan-sebuah-label-pada-sebuah-node>Menambahkan sebuah Label pada sebuah Node</h2><ol><li><p>Jabarkan Node-Node yang ada pada klaster kamu, bersamaan dengan label yang ada:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get nodes --show-labels
</span></span></code></pre></div><p>Keluaran dari perintah tersebut akan berupa:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME      STATUS    ROLES    AGE     VERSION        LABELS
</span></span><span style=display:flex><span>worker0   Ready     &lt;none&gt;   1d      v1.13.0        ...,kubernetes.io/hostname<span style=color:#666>=</span>worker0
</span></span><span style=display:flex><span>worker1   Ready     &lt;none&gt;   1d      v1.13.0        ...,kubernetes.io/hostname<span style=color:#666>=</span>worker1
</span></span><span style=display:flex><span>worker2   Ready     &lt;none&gt;   1d      v1.13.0        ...,kubernetes.io/hostname<span style=color:#666>=</span>worker2
</span></span></code></pre></div></li><li><p>Pilihkan salah satu dari Node yang ada dan tambahkan label pada Node tersebut.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl label nodes &lt;nama-node-kamu&gt; <span style=color:#b8860b>disktype</span><span style=color:#666>=</span>ssd
</span></span></code></pre></div><p>dimana <code>&lt;nama-node-kamu></code> merupakan nama dari Node yang kamu pilih.</p></li><li><p>Keluaran dari Node yang kamu pilih dan sudah memiliki label <code>disktype=ssd</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get nodes --show-labels
</span></span></code></pre></div><p>Keluaran dari perintah tersebut akan berupa:</p><pre tabindex=0><code>NAME      STATUS    ROLES    AGE     VERSION        LABELS
worker0   Ready     &lt;none&gt;   1d      v1.13.0        ...,disktype=ssd,kubernetes.io/hostname=worker0
worker1   Ready     &lt;none&gt;   1d      v1.13.0        ...,kubernetes.io/hostname=worker1
worker2   Ready     &lt;none&gt;   1d      v1.13.0        ...,kubernetes.io/hostname=worker2
</code></pre><p>Pada keluaran dari perintah di atas, kamu dapat melihat bahwa Node <code>worker0</code>
memiliki label <code>disktype=ssd</code>.</p></li></ol><h2 id=menjadwalkan-pod-menggunakan-afinitas-node>Menjadwalkan Pod menggunakan Afinitas Node</h2><p>Konfigurasi ini menunjukkan sebuah Pod yang memiliki afinitas node <code>requiredDuringSchedulingIgnoredDuringExecution</code>, <code>disktype: ssd</code>.
Dengan kata lain, Pod hanya akan dijadwalkan hanya pada Node yang memiliki label <code>disktype=ssd</code>.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-nginx-required-affinity.yaml download=pods/pod-nginx-required-affinity.yaml><code>pods/pod-nginx-required-affinity.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-nginx-required-affinity-yaml")' title="Copy pods/pod-nginx-required-affinity.yaml to clipboard"></img></div><div class=includecode id=pods-pod-nginx-required-affinity-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>affinity</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>nodeAffinity</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requiredDuringSchedulingIgnoredDuringExecution</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>nodeSelectorTerms</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>disktype<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>operator</span>:<span style=color:#bbb> </span>In<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>values</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>- ssd            <span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>IfNotPresent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Terapkan konfigurasi berikut untuk membuat sebuah Pod yang akan dijadwalkan pada Node yang kamu pilih:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/pod-nginx-required-affinity.yaml
</span></span></code></pre></div></li><li><p>Verifikasi apakah Pod yang kamu pilih sudah dijalankan pada Node yang kamu pilih:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods --output<span style=color:#666>=</span>wide
</span></span></code></pre></div><p>Keluaran dari perintah tersebut akan berupa:</p><pre tabindex=0><code>NAME     READY     STATUS    RESTARTS   AGE    IP           NODE
nginx    1/1       Running   0          13s    10.200.0.4   worker0
</code></pre></li></ol><h2 id=jadwalkan-pod-menggunakan-afinitas-node-yang-dipilih>Jadwalkan Pod menggunakan Afinitas Node yang Dipilih</h2><p>Konfigurasi ini memberikan deskripsi sebuah Pod yang memiliki afinitas Node <code>preferredDuringSchedulingIgnoredDuringExecution</code>,<code>disktype: ssd</code>.
Artinya Pod akan diutamakan dijalankan pada Node yang memiliki label <code>disktype=ssd</code>.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-nginx-preferred-affinity.yaml download=pods/pod-nginx-preferred-affinity.yaml><code>pods/pod-nginx-preferred-affinity.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-nginx-preferred-affinity-yaml")' title="Copy pods/pod-nginx-preferred-affinity.yaml to clipboard"></img></div><div class=includecode id=pods-pod-nginx-preferred-affinity-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>affinity</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>nodeAffinity</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>preferredDuringSchedulingIgnoredDuringExecution</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>weight</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>preference</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>disktype<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>operator</span>:<span style=color:#bbb> </span>In<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>values</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>- ssd          <span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>IfNotPresent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Terapkan konfigurasi berikut untuk membuat sebuah Pod yang akan dijadwalkan pada Node yang kamu pilih:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/pod-nginx-preferred-affinity.yaml
</span></span></code></pre></div></li><li><p>Verifikasi apakah Pod yang kamu pilih sudah dijalankan pada Node yang kamu pilih:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods --output<span style=color:#666>=</span>wide
</span></span></code></pre></div><p>Keluaran dari perintah tersebut akan berupa:</p><pre tabindex=0><code>NAME     READY     STATUS    RESTARTS   AGE    IP           NODE
nginx    1/1       Running   0          13s    10.200.0.4   worker0
</code></pre></li></ol><h2 id=selanjutnya>Selanjutnya</h2><p>Pelajari lebih lanjut mengenai
<a href=/id/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity>Afinitas Node</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ed34e761c3dbd00fa79577fa78e30020>3.10 - Mengatur Pod untuk Menggunakan ConfigMap</h1><p>ConfigMap mengizinkan kamu untuk memisahkan artifak-artifak konfigurasi dari konten <em>image</em> untuk menjaga aplikasi yang dikontainerisasi tetap portabel. Artikel ini menyediakan sekumpulan contoh penerapan yang mendemonstrasikan bagaimana cara membuat ConfigMap dan mengatur Pod menggunakan data yang disimpan di dalam ConfigMap.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=membuat-configmap>Membuat ConfigMap</h2><p>Kamu dapat menggunakan <code>kubectl create configmap</code> ataupun generator ConfigMap pada <code>kustomization.yaml</code> untuk membuat sebuah ConfigMap. Perlu diingat bahwa <code>kubectl</code> mulai mendukung <code>kustomization.yaml</code> sejak versi 1.14.</p><h3 id=membuat-configmap-menggunakan-kubectl-create-configmap>Membuat ConfigMap Menggunakan kubectl create configmap</h3><p>Gunakan perintah <code>kubectl create configmap</code> untuk membuat ConfigMap dari <a href=#membuat-configmap-dari-direktori>direktori</a>, <a href=#membuat-configmap-dari-berkas>berkas</a>, ataupun <a href=#membuat-configmap-dari-nilai-harfiah>nilai-nilai yang harfiah (<em>literal values</em>)</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;
</span></span></code></pre></div><p>di mana &lt;map-name> merupakan nama yang ingin kamu berikan pada ConfigMap tersebut dan &lt;data-source> adalah direktori, berkas, atau nilai harfiah yang digunakan sebagai sumber data.
Nama dari sebuah objek ConfigMap haruslah berupa
<a href=/id/docs/concepts/overview/working-with-objects/names#dns-subdomain-names>nama subdomain DNS</a> yang sah.</p><p>Ketika kamu membuat ConfigMap dari sebuah berkas, secara bawaan, <em>basename</em> dari berkas tersebut akan menjadi kunci pada &lt;data-source>, dan isi dari berkas tersebut akan menjadi nilai dari kunci tersebut.</p><p>Kamu dapat menggunakan <a href=/docs/reference/generated/kubectl/kubectl-commands/#describe><code>kubectl describe</code></a> atau
<a href=/docs/reference/generated/kubectl/kubectl-commands/#get><code>kubectl get</code></a> untuk mengambil informasi
mengenai sebuah ConfigMap.</p><h4 id=membuat-configmap-dari-direktori>Membuat ConfigMap dari direktori</h4><p>Kamu dapat menggunakan <code>kubectl create configmap</code> untuk membuat sebuah ConfigMap dari banyak berkas dalam sebuah direktori yang sama. Ketika kamu membuat sebuah ConfigMap dari sebuah direktori, kubectl akan mengidentifikasi berkas-berkas yang memiliki <em>basename</em> yang merupakan sebuah kunci yang sah pada direktori dan mengemas tiap berkas tersebut ke dalam sebuah ConfigMap baru. Seluruh entri direktori kecuali berkas reguler akan diabaikan (subdirektori, <em>symlink</em>, <em>device</em>, <em>pipe</em>, dsb).</p><p>Sebagai contoh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat direktori lokal</span>
</span></span><span style=display:flex><span>mkdir -p configure-pod-container/configmap/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Mengunduh berkas-berkas sampel ke dalam direktori `configure-pod-container/configmap/`</span>
</span></span><span style=display:flex><span>wget https://kubernetes.io/examples/configmap/game.properties -O configure-pod-cont1ainer/configmap/game.properties
</span></span><span style=display:flex><span>wget https://kubernetes.io/examples/configmap/ui.properties -O configure-pod-container/configmap/ui.properties
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat configmap</span>
</span></span><span style=display:flex><span>kubectl create configmap game-config --from-file<span style=color:#666>=</span>configure-pod-container/configmap/
</span></span></code></pre></div><p>Perintah di atas mengemas tiap berkas, dalam kasus ini, <code>game.properties</code> dan <code>ui.properties</code> dalam direktori <code>configure-pod-container/configmap/</code> ke dalam ConfigMap dengan nama game-config. Kamu dapat menampilkan detail dari ConfigMap menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe configmaps game-config
</span></span></code></pre></div><p>Keluaran akan tampil seperti berikut:</p><pre tabindex=0><code>Name:         game-config
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
====
game.properties:
----
enemies=aliens
lives=3
enemies.cheat=true
enemies.cheat.level=noGoodRotten
secret.code.passphrase=UUDDLRLRBABAS
secret.code.allowed=true
secret.code.lives=30
ui.properties:
----
color.good=purple
color.bad=yellow
allow.textmode=true
how.nice.to.look=fairlyNice
</code></pre><p>Berkas-berkas <code>game.properties</code> dan <code>ui.properties</code> pada direktori <code>configure-pod-container/configmap/</code> direpresentasikan oleh bagian <code>data</code> pada ConfigMap.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get configmaps game-config -o yaml
</span></span></code></pre></div><p>Keluaran akan tampil seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2016-02-18T18:52:05Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>game-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceVersion</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;516&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>uid</span>:<span style=color:#bbb> </span>b4952dc3-d670-11e5-8cd0-68f728db1985<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>game.properties</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    enemies=aliens
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    lives=3
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    enemies.cheat=true
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    enemies.cheat.level=noGoodRotten
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    secret.code.passphrase=UUDDLRLRBABAS
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    secret.code.allowed=true
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    secret.code.lives=30</span><span style=color:#bbb>    
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>ui.properties</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    color.good=purple
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    color.bad=yellow
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    allow.textmode=true
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    how.nice.to.look=fairlyNice</span><span style=color:#bbb>    
</span></span></span></code></pre></div><h4 id=membuat-configmap-dari-berkas>Membuat ConfigMap dari berkas</h4><p>Kamu dapat menggunakan <code>kubectl create configmap</code> untuk membuat sebuah ConfigMap dari berkas individual, atau dari banyak berkas.</p><p>Sebagai contoh,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create configmap game-config-2 --from-file<span style=color:#666>=</span>configure-pod-container/configmap/game.properties
</span></span></code></pre></div><p>akan menghasilkan ConfigMap berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe configmaps game-config-2
</span></span></code></pre></div><p>dengan keluaran seperti berikut:</p><pre tabindex=0><code>Name:         game-config-2
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
====
game.properties:
----
enemies=aliens
lives=3
enemies.cheat=true
enemies.cheat.level=noGoodRotten
secret.code.passphrase=UUDDLRLRBABAS
secret.code.allowed=true
secret.code.lives=30
</code></pre><p>Kamu dapat memasukkan argumen <code>--from-file</code> beberapa kali untuk membuat sebuah ConfigMap dari banyak sumber data.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create configmap game-config-2 --from-file<span style=color:#666>=</span>configure-pod-container/configmap/game.properties --from-file<span style=color:#666>=</span>configure-pod-container/configmap/ui.properties
</span></span></code></pre></div><p>Kamu dapat menampilkan detail dari ConfigMap <code>game-config-2</code> menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe configmaps game-config-2
</span></span></code></pre></div><p>Keluaran akan tampil seperti berikut:</p><pre tabindex=0><code>Name:         game-config-2
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
====
game.properties:
----
enemies=aliens
lives=3
enemies.cheat=true
enemies.cheat.level=noGoodRotten
secret.code.passphrase=UUDDLRLRBABAS
secret.code.allowed=true
secret.code.lives=30
ui.properties:
----
color.good=purple
color.bad=yellow
allow.textmode=true
how.nice.to.look=fairlyNice
</code></pre><p>Gunakan opsi <code>--from-env-file</code> untuk membuat sebuah ConfigMap dari sebuah <em>env-file</em>, sebagai contoh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Env-file berisi sebuah daftar variabel _environment_.</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Ada aturan-aturan sintaks yang berlaku:</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#   Tiap baris pada sebuah env file harus memiliki format VAR=VAL.</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#   Baris yang diawali # (komentar) akan diabaikan.</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#   Baris-baris kosong akan diabaikan.</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#   Tidak ada penanganan spesial untuk tanda kutip (tanda kutip akan menjadi bagian dari nilai pada ConfigMap).</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Mengunduh berkas-berkas sampel berikut ke dalam direktori `configure-pod-container/configmap/`</span>
</span></span><span style=display:flex><span>wget https://kubernetes.io/examples/configmap/game-env-file.properties -O configure-pod-container/configmap/game-env-file.properties
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Berkas env-file `game-env-file.properties` berisi sebagai berikut:</span>
</span></span><span style=display:flex><span>cat configure-pod-container/configmap/game-env-file.properties
</span></span><span style=display:flex><span><span style=color:#b8860b>enemies</span><span style=color:#666>=</span>aliens
</span></span><span style=display:flex><span><span style=color:#b8860b>lives</span><span style=color:#666>=</span><span style=color:#666>3</span>
</span></span><span style=display:flex><span><span style=color:#b8860b>allowed</span><span style=color:#666>=</span><span style=color:#b44>&#34;true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Komentar ini dan baris kosong di atasnya akan diabaikan.</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create configmap game-config-env-file <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>       --from-env-file<span style=color:#666>=</span>configure-pod-container/configmap/game-env-file.properties
</span></span></code></pre></div><p>akan menghasilkan ConfigMap sebagai berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get configmap game-config-env-file -o yaml
</span></span></code></pre></div><p>dengan keluaran seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2017-12-27T18:36:28Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>game-config-env-file<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceVersion</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;809965&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>uid</span>:<span style=color:#bbb> </span>d9d1ca5b-eb34-11e7-887b-42010a8002b8<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowed</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;&#34;true&#34;&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>enemies</span>:<span style=color:#bbb> </span>aliens<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>lives</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;3&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><div class="alert alert-warning caution callout" role=alert><strong>Perhatian:</strong> Ketika memasukkan <code>--from-env-file</code> beberapa kali untuk membuat sebuah ConfigMap dari beberapa sumber data, hanya env-file terakhir yang akan digunakan.</div><p>Contoh perilaku memasukkan <code>--from-env-file</code> beberapa kali didemonstrasikan dengan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Mengunduh berkas-berkas sampel berikut ke dalam direktori `configure-pod-container/configmap/` </span>
</span></span><span style=display:flex><span>wget https://kubernetes.io/examples/configmap/ui-env-file.properties -O configure-pod-container/configmap/ui-env-file.properties
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat configmap</span>
</span></span><span style=display:flex><span>kubectl create configmap config-multi-env-files <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>        --from-env-file<span style=color:#666>=</span>configure-pod-container/configmap/game-env-file.properties <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>        --from-env-file<span style=color:#666>=</span>configure-pod-container/configmap/ui-env-file.properties
</span></span></code></pre></div><p>akan menghasilkan ConfigMap sebagai berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get configmap config-multi-env-files -o yaml
</span></span></code></pre></div><p>dengan keluaran seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2017-12-27T18:38:34Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>config-multi-env-files<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceVersion</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;810136&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>uid</span>:<span style=color:#bbb> </span>252c4572-eb35-11e7-887b-42010a8002b8<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>color</span>:<span style=color:#bbb> </span>purple<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>how</span>:<span style=color:#bbb> </span>fairlyNice<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>textmode</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;true&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><h4 id=menentukan-kunci-yang-akan-digunakan-ketika-membuat-configmap-dari-sebuah-berkas>Menentukan kunci yang akan digunakan ketika membuat ConfigMap dari sebuah berkas</h4><p>Kamu dapat menentukan kunci selain dari nama berkas untuk digunakan pada bagian <code>data</code> pada ConfigMap yang kamu buat menggunakan argumen <code>--from-file</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create configmap game-config-3 --from-file<span style=color:#666>=</span>&lt;my-key-name&gt;<span style=color:#666>=</span>&lt;path-to-file&gt;
</span></span></code></pre></div><p>di mana <code>&lt;my-key-name></code> merupakan kunci yang ingin kamu gunakan pada ConfigMap dan <code>&lt;path-to-file></code> merupakan lokasi dari berkas sumber data yang akan menjadi nilai dari kunci tersebut.</p><p>Sebagai contoh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create configmap game-config-3 --from-file<span style=color:#666>=</span>game-special-key<span style=color:#666>=</span>configure-pod-container/configmap/game.properties
</span></span></code></pre></div><p>akan menghasilkan ConfigMap sebagai berikut:</p><pre tabindex=0><code>kubectl get configmaps game-config-3 -o yaml
</code></pre><p>dengan keluaran seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2016-02-18T18:54:22Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>game-config-3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceVersion</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;530&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>uid</span>:<span style=color:#bbb> </span>05f8da22-d671-11e5-8cd0-68f728db1985<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>game-special-key</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    enemies=aliens
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    lives=3
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    enemies.cheat=true
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    enemies.cheat.level=noGoodRotten
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    secret.code.passphrase=UUDDLRLRBABAS
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    secret.code.allowed=true
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    secret.code.lives=30</span><span style=color:#bbb>    
</span></span></span></code></pre></div><h4 id=membuat-configmap-dari-nilai-harfiah>Membuat ConfigMap dari nilai harfiah</h4><p>Kamu dapat menggunakan <code>kubectl create configmap</code> dengan argumen <code>--from-literal</code> untuk menentukan nilai harfiah dari baris perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create configmap special-config --from-literal<span style=color:#666>=</span>special.how<span style=color:#666>=</span>very --from-literal<span style=color:#666>=</span>special.type<span style=color:#666>=</span>charm
</span></span></code></pre></div><p>Kamu dapat memasukkan beberapa pasang kunci-nilai. Tiap pasang yang dimasukkan pada <em>command line</em> direpresentasikan sebagai sebuah entri terpisah pada bagian <code>data</code> dari ConfigMap.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get configmaps special-config -o yaml
</span></span></code></pre></div><p>Keluaran akan tampil seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2016-02-18T19:14:38Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceVersion</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;651&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>uid</span>:<span style=color:#bbb> </span>dadce046-d673-11e5-8cd0-68f728db1985<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>special.how</span>:<span style=color:#bbb> </span>very<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>special.type</span>:<span style=color:#bbb> </span>charm<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=membuat-configmap-dari-generator>Membuat ConfigMap dari generator</h3><p><code>kubectl</code> mendukung <code>kustomization.yaml</code> sejak versi 1.14.
Kamu juga dapat membuat ConfigMap dari generator lalu menggunakannya untuk membuat objek tersebut pada
peladen API. Generator
harus dituliskan pada <code>kustomization.yaml</code> dalam sebuah direktori.</p><h4 id=menghasilkan-configmap-dari-berkas>Menghasilkan ConfigMap dari berkas</h4><p>Sebagai contoh, untuk menghasilkan ConfigMap dari berkas <code>configure-pod-container/configmap/game.properties</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas kustomization.yaml dengan ConfigMapGenerator</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>configMapGenerator:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: game-config-4
</span></span></span><span style=display:flex><span><span style=color:#b44>  files:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - configure-pod-container/configmap/game.properties
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Gunakan direktori kustomization untuk membuat objek ConfigMap.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -k .
</span></span><span style=display:flex><span>configmap/game-config-4-m9dm2f92bt created
</span></span></code></pre></div><p>Kamu dapat melihat ConfigMap yang dihasilkan seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get configmap
</span></span><span style=display:flex><span>NAME                       DATA   AGE
</span></span><span style=display:flex><span>game-config-4-m9dm2f92bt   <span style=color:#666>1</span>      37s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl describe configmaps/game-config-4-m9dm2f92bt
</span></span><span style=display:flex><span>Name:         game-config-4-m9dm2f92bt
</span></span><span style=display:flex><span>Namespace:    default
</span></span><span style=display:flex><span>Labels:       &lt;none&gt;
</span></span><span style=display:flex><span>Annotations:  kubectl.kubernetes.io/last-applied-configuration:
</span></span><span style=display:flex><span>                <span style=color:#666>{</span><span style=color:#b44>&#34;apiVersion&#34;</span>:<span style=color:#b44>&#34;v1&#34;</span>,<span style=color:#b44>&#34;data&#34;</span>:<span style=color:#666>{</span><span style=color:#b44>&#34;game.properties&#34;</span>:<span style=color:#b44>&#34;enemies=aliens\nlives=3\nenemies.cheat=true\nenemies.cheat.level=noGoodRotten\nsecret.code.p...
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>Data
</span></span></span><span style=display:flex><span><span style=color:#b44>====
</span></span></span><span style=display:flex><span><span style=color:#b44>game.properties:
</span></span></span><span style=display:flex><span><span style=color:#b44>----
</span></span></span><span style=display:flex><span><span style=color:#b44>enemies=aliens
</span></span></span><span style=display:flex><span><span style=color:#b44>lives=3
</span></span></span><span style=display:flex><span><span style=color:#b44>enemies.cheat=true
</span></span></span><span style=display:flex><span><span style=color:#b44>enemies.cheat.level=noGoodRotten
</span></span></span><span style=display:flex><span><span style=color:#b44>secret.code.passphrase=UUDDLRLRBABAS
</span></span></span><span style=display:flex><span><span style=color:#b44>secret.code.allowed=true
</span></span></span><span style=display:flex><span><span style=color:#b44>secret.code.lives=30
</span></span></span><span style=display:flex><span><span style=color:#b44>Events:  &lt;none&gt;
</span></span></span></code></pre></div><p>Perlu diingat baha nama dari ConfigMap yang dihasilkan memiliki sufiks yang ditambahkan dengan melakukan <em>hashing</em> terhadap konten dari ConfigMap tersebut. Hal ini memastikan bahwa
sebuah ConfigMap baru akan dihasilkan setiap kali konten dimodifikasi.</p><h4 id=menentukan-kunci-yang-akan-digunakan-ketika-generating-configmap-dari-sebuah-berkas>Menentukan kunci yang akan digunakan ketika generating ConfigMap dari sebuah berkas</h4><p>Kamu dapat menentukan kunci selain nama berkas untuk digunakan pada generator ConfigMap.
Sebagai contoh, untuk menghasilkan sebuah ConfigMap dari berkas <code>configure-pod-container/configmap/game.properties</code>
dengan kunci <code>game-special-key</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas kustomization.yaml dengan ConfigMapGenerator</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>configMapGenerator:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: game-config-5
</span></span></span><span style=display:flex><span><span style=color:#b44>  files:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - game-special-key=configure-pod-container/configmap/game.properties
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Gunakan direktori kustomization untuk membuat objek ConfigMap.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -k .
</span></span><span style=display:flex><span>configmap/game-config-5-m67dt67794 created
</span></span></code></pre></div><h4 id=menghasilkan-configmap-dari-nilai-nilai-harfiah>Menghasilkan ConfigMap dari Nilai-nilai Harfiah</h4><p>Untuk menghasilkan ConfigMap dari nilai-nilai harfiah <code>special.type=charm</code> dan <code>special.how=very</code>,
kamu dapat menentukan generator ConfigMap pada <code>kustomization.yaml</code> sebagai berikut</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas kustomization.yaml dengan ConfigMapGenerator</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>configMapGenerator:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: special-config-2
</span></span></span><span style=display:flex><span><span style=color:#b44>  literals:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - special.how=very
</span></span></span><span style=display:flex><span><span style=color:#b44>  - special.type=charm
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Gunakan direktori kustomization untuk membuat objek ConfigMap.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -k .
</span></span><span style=display:flex><span>configmap/special-config-2-c92b5mmcf2 created
</span></span></code></pre></div><h2 id=menentukan-variabel-environment-kontainer-menggunakan-data-configmap>Menentukan variabel <em>environment</em> kontainer menggunakan data ConfigMap</h2><h3 id=menentukan-variabel-environment-kontainer-dengan-data-dari-sebuah-configmap>Menentukan variabel <em>environment</em> kontainer dengan data dari sebuah ConfigMap</h3><ol><li><p>Menentukan sebuah variabel <em>environment</em> sebagai sepasang kunci-nilai pada ConfigMap:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create configmap special-config --from-literal<span style=color:#666>=</span>special.how<span style=color:#666>=</span>very
</span></span></code></pre></div></li><li><p>Memberikan nilai <code>special.how</code> yang sudah terdapat pada ConfigMap pada variabel <em>environment</em> <code>SPECIAL_LEVEL_KEY</code> di spesifikasi Pod.</p></li></ol><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-single-configmap-env-variable.yaml download=pods/pod-single-configmap-env-variable.yaml><code>pods/pod-single-configmap-env-variable.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-single-configmap-env-variable-yaml")' title="Copy pods/pod-single-configmap-env-variable.yaml to clipboard"></img></div><div class=includecode id=pods-pod-single-configmap-env-variable-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dapi-test-pod<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;/bin/sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;env&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># Tentukan variabel environment</span><span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SPECIAL_LEVEL_KEY<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>configMapKeyRef</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:#080;font-style:italic># ConfigMap berisi nilai yang ingin kamu berikan pada SPECIAL_LEVEL_KEY</span><span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:#080;font-style:italic># Tentukan kunci yang diasosiasikan dengan nilainya</span><span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>special.how<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Never<span style=color:#bbb>
   </span></span></span></code></pre></div></div></div><p>Buat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/id/examples/pods/pod-single-configmap-env-variable.yaml
</span></span></code></pre></div><p>Sekarang, keluaran dari Pod meliputi variabel <em>environment</em> <code>SPECIAL_LEVEL_KEY=very</code>.</p><h3 id=menentukan-variabel-environment-kontainer-dengan-data-dari-beberapa-configmap>Menentukan variabel <em>environment</em> kontainer dengan data dari beberapa ConfigMap</h3><ul><li><p>Seperti pada contoh sebelumnya, buat ConfigMap terlebih dahulu.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/configmap/configmaps.yaml download=configmap/configmaps.yaml><code>configmap/configmaps.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("configmap-configmaps-yaml")' title="Copy configmap/configmaps.yaml to clipboard"></img></div><div class=includecode id=configmap-configmaps-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>special.how</span>:<span style=color:#bbb> </span>very<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>---</span><span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>env-config<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>log_level</span>:<span style=color:#bbb> </span>INFO<span style=color:#bbb>
   </span></span></span></code></pre></div></div></div><p>Buat ConfigMap:</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/examples/configmap/configmaps.yaml
</span></span></code></pre></div><ul><li><p>Tentukan variabel <em>environment</em> pada spesifikasi Pod.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-multiple-configmap-env-variable.yaml download=pods/pod-multiple-configmap-env-variable.yaml><code>pods/pod-multiple-configmap-env-variable.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-multiple-configmap-env-variable-yaml")' title="Copy pods/pod-multiple-configmap-env-variable.yaml to clipboard"></img></div><div class=includecode id=pods-pod-multiple-configmap-env-variable-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dapi-test-pod<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;/bin/sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;env&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SPECIAL_LEVEL_KEY<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>configMapKeyRef</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>special.how<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>LOG_LEVEL<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>configMapKeyRef</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>env-config<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>log_level<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Never<span style=color:#bbb>
  </span></span></span></code></pre></div></div></div><p>Buat Pod:</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/id/examples/pods/pod-multiple-configmap-env-variable.yaml
</span></span></code></pre></div><p>Sekarang, keluaran Pod meliputi variabel <em>environment</em> <code>SPECIAL_LEVEL_KEY=very</code> dan <code>LOG_LEVEL=INFO</code>.</p><h2 id=mengatur-semua-pasangan-kunci-nilai-pada-configmap-sebagai-variabel-environment-kontainer>Mengatur semua pasangan kunci-nilai pada ConfigMap sebagai variabel <em>environment</em> kontainer</h2><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Fungsi ini tersedia pada Kubernetes v1.6 dan selanjutnya.</div><ul><li><p>Buat ConfigMap yang berisi beberapa pasangan kunci-nilai.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/configmap/configmap-multikeys.yaml download=configmap/configmap-multikeys.yaml><code>configmap/configmap-multikeys.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("configmap-configmap-multikeys-yaml")' title="Copy configmap/configmap-multikeys.yaml to clipboard"></img></div><div class=includecode id=configmap-configmap-multikeys-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>SPECIAL_LEVEL</span>:<span style=color:#bbb> </span>very<span style=color:#bbb>
  </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>SPECIAL_TYPE</span>:<span style=color:#bbb> </span>charm<span style=color:#bbb>
  </span></span></span></code></pre></div></div></div><p>Buat ConfigMap:</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/examples/configmap/configmap-multikeys.yaml
</span></span></code></pre></div><ul><li>Gunakan <code>envFrom</code> untuk menentukan seluruh data pada ConfigMap sebagai variabel <em>environment</em> kontainer. Kunci dari ConfigMap akan menjadi nama variabel <em>environment</em> di dalam Pod.</li></ul><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-configmap-envFrom.yaml download=pods/pod-configmap-envFrom.yaml><code>pods/pod-configmap-envFrom.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-configmap-envfrom-yaml")' title="Copy pods/pod-configmap-envFrom.yaml to clipboard"></img></div><div class=includecode id=pods-pod-configmap-envfrom-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dapi-test-pod<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;/bin/sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;env&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>envFrom</span>:<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>configMapRef</span>:<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
 </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Never<span style=color:#bbb>
 </span></span></span></code></pre></div></div></div><p>Buat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/examples/pods/pod-configmap-envFrom.yaml
</span></span></code></pre></div><p>Sekarang, Pod keluaran pod meliputi variabel <em>environment</em> <code>SPECIAL_LEVEL=very</code> dan <code>SPECIAL_TYPE=charm</code>.</p><h2 id=menggunakan-variabel-environment-yang-ditentukan-configmap-pada-perintah-pod>Menggunakan variabel <em>environment</em> yang ditentukan ConfigMap pada perintah Pod</h2><p>Kamu dapat menggunakan variabel <em>environment</em> yang ditentukan ConfigMap pada bagian <code>command</code> dari spesifikasi Pod menggunakan sintaks substitusi Kubernetes <code>$(VAR_NAME)</code>.</p><p>Sebagai contoh, spesifikasi Pod berikut</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-configmap-env-var-valueFrom.yaml download=pods/pod-configmap-env-var-valueFrom.yaml><code>pods/pod-configmap-env-var-valueFrom.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-configmap-env-var-valuefrom-yaml")' title="Copy pods/pod-configmap-env-var-valueFrom.yaml to clipboard"></img></div><div class=includecode id=pods-pod-configmap-env-var-valuefrom-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dapi-test-pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;/bin/sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;echo $(SPECIAL_LEVEL_KEY) $(SPECIAL_TYPE_KEY)&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SPECIAL_LEVEL_KEY<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>configMapKeyRef</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>SPECIAL_LEVEL<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SPECIAL_TYPE_KEY<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>configMapKeyRef</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>SPECIAL_TYPE<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Never<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>dibuat dengan menjalankan</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/examples/pods/pod-configmap-env-var-valueFrom.yaml
</span></span></code></pre></div><p>menghasilkan keluaran pada kontainer <code>test-container</code> seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>very charm
</span></span></code></pre></div><h2 id=menambahkan-data-configmap-pada-volume>Menambahkan data ConfigMap pada Volume</h2><p>Seperti yang sudah dijelaskan pada <a href=#membuat-configmap-dari-berkas>Membuat ConfigMap dari berkas</a>, ketika kamu membuat ConfigMap menggunakan <code>--from-file</code>, nama dari berkas tersebut akan menjadi kunci yang disimpan pada bagian <code>data</code> dari ConfigMap. Isi berkas tersebut akan menjadi nilai dari kunci tersebut.</p><p>Contoh pada bagian ini merujuk pada ConfigMap bernama <code>special-config</code>, Seperti berikut.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/configmap/configmap-multikeys.yaml download=configmap/configmap-multikeys.yaml><code>configmap/configmap-multikeys.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("configmap-configmap-multikeys-yaml")' title="Copy configmap/configmap-multikeys.yaml to clipboard"></img></div><div class=includecode id=configmap-configmap-multikeys-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>SPECIAL_LEVEL</span>:<span style=color:#bbb> </span>very<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>SPECIAL_TYPE</span>:<span style=color:#bbb> </span>charm<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buat ConfigMap:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/examples/configmap/configmap-multikeys.yaml
</span></span></code></pre></div><h3 id=mengisi-volume-dengan-data-yang-disimpan-pada-configmap>Mengisi Volume dengan data yang disimpan Pada ConfigMap</h3><p>Tambahkan nama ConfigMap di bawah bagian <code>volumes</code> pada spesifikasi Pod.
Hal ini akan menambahkan data ConfigMap pada direktori yang ditentukan oleh <code>volumeMounts.mountPath</code> (pada kasus ini, <code>/etc/config</code>).
Bagian <code>command</code> berisi daftar berkas pada direktori dengan nama-nama yang sesuai dengan kunci-kunci pada ConfigMap.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-configmap-volume.yaml download=pods/pod-configmap-volume.yaml><code>pods/pod-configmap-volume.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-configmap-volume-yaml")' title="Copy pods/pod-configmap-volume.yaml to clipboard"></img></div><div class=includecode id=pods-pod-configmap-volume-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dapi-test-pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;/bin/sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;ls /etc/config/&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>config-volume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/etc/config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>config-volume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>configMap</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># Berikan nama dari ConfigMap yang berisi berkas-berkas yang ingin kamu</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># tambahkan ke kontainer</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Never<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/i/examples/pods/pod-configmap-volume.yaml
</span></span></code></pre></div><p>Ketika Pod berjalan, perintah <code>ls /etc/config/</code> akan menghasilkan keluaran di bawah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SPECIAL_LEVEL
</span></span><span style=display:flex><span>SPECIAL_TYPE
</span></span></code></pre></div><div class="alert alert-warning caution callout" role=alert><strong>Perhatian:</strong> Jika ada beberapa berkas pada direktori <code>/etc/config/</code>, berkas-berkas tersebut akan dihapus.</div><h3 id=menambahkan-data-configmap-pada-jalur-tertentu-pada-volume>Menambahkan data ConfigMap pada jalur tertentu pada Volume</h3><p>Gunakan kolom <code>path</code> untuk menentukan jalur berkas yang diinginkan untuk butir tertentu pada ConfigMap (butir ConfigMap tertentu).
Pada kasus ini, butir <code>SPECIAL_LEVEL</code> akan akan dipasangkan sebagai <code>config-volume</code> pada <code>/etc/config/keys</code>.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/pod-configmap-volume-specific-key.yaml download=pods/pod-configmap-volume-specific-key.yaml><code>pods/pod-configmap-volume-specific-key.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-pod-configmap-volume-specific-key-yaml")' title="Copy pods/pod-configmap-volume-specific-key.yaml to clipboard"></img></div><div class=includecode id=pods-pod-configmap-volume-specific-key-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dapi-test-pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;/bin/sh&#34;</span>,<span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#b44>&#34;cat /etc/config/keys&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>config-volume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/etc/config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>config-volume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>configMap</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>special-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>items</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>SPECIAL_LEVEL<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span>keys<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Never<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://kubernetes.io/examples/pods/pod-configmap-volume-specific-key.yaml
</span></span></code></pre></div><p>Ketika Pod berjalan, perintah <code>cat /etc/config/keys</code> akan menghasilkan keluaran di bawah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>very
</span></span></code></pre></div><div class="alert alert-warning caution callout" role=alert><strong>Perhatian:</strong> Seperti sebelumnya, semua berkas yang sebelumnya berada pada direktori <code>/etc/config/</code> akan dihapus.</div><h3 id=memproyeksikan-kunci-ke-jalur-dan-perizinan-berkas-tertentu>Memproyeksikan kunci ke jalur dan perizinan berkas tertentu</h3><p>Kamu dapat memproyeksikan kunci ke jalur dan perizinan tertentu pada setiap
berkas. Panduan pengguna <a href=/id/docs/concepts/configuration/secret/#using-secrets-as-files-from-a-pod>Secret</a> menjelaskan mengenai sintaks-sintaksnya.</p><h3 id=configmap-yang-dipasang-akan-diperbarui-secara-otomatis>ConfigMap yang dipasang akan diperbarui secara otomatis</h3><p>Ketika sebuah ConfigMap yang sudah dipasang pada sebuah volume diperbarui, kunci-kunci yang diproyeksikan akan turut diperbarui. Kubelet akan memeriksa apakah ConfigMap yang dipasang merupakan yang terbaru pada sinkronisasi berkala. Namun, ConfigMap menggunakan <em>cache</em> lokal berbasis ttl (<em>time-to-live</em>) miliknya untuk mendapatkan nilai dari ConfigMap saat ini. Hasilnya, keseluruhan penundaan dari saat ketika ConfigMap diperbarui sampai saat ketika kunci-kunci baru diproyeksikan ke pada Pod bisa selama periode sinkronisasi kubelet (secara bawaan selama 1 menit) + ttl dari <em>cache</em> ConfigMap (secara bawaan selama 1 menit) pada kubelet. Kamu dapat memicu pembaruan langsung dengan memperbarui salah satu dari anotasi Pod.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Kontainer yang menggunakan ConfigMap sebagai volume <a href=/id/docs/concepts/storage/volumes/#using-subpath>subPath</a> tidak akan menerima pembaruan ConfigMap.</div><h2 id=memahami-configmap-dan-pod>Memahami ConfigMap dan Pod</h2><p>Sumber daya API ConfigMap menyimpan data konfigurasi sebagai pasangan kunci-nilai. Data tersebut dapat dikonsumsi oleh Pod atau sebagai penyedia konfigurasi untuk komponen-komponen sistem seperti kontroler. ConfigMap mirip dengan <a href=/id/docs/concepts/configuration/secret/>Secret</a>, tetapi ConfigMap dimaksudkan untuk mengolah tulisan yang tidak memiliki informasi yang sensitif. Baik pengguna maupun komponen sistem dapat menyimpan data konfigurasi pada ConfigMap.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> ConfigMap harus mereferensikan berkas-berkas properti, bukan menggantikannya. Anggaplah ConfigMap sebagai sesuatu yang merepresentasikan direktori <code>/etc</code> beserta isinya pada Linux. Sebagai contoh, jika kamu membuat sebuah <a href=/id/docs/concepts/storage/volumes/>Volume Kubernetes</a> dari ConfigMap, tiap butir data pada ConfigMap direpresentasikan sebagai sebuah berkas pada volume.</div><p>Kolom <code>data</code> pada ConfigMap berisi data konfigurasi. Seperti pada contoh di bawah, hal ini bisa berupa sesuatu yang sederhana -- seperti properti individual yang ditentukan menggunakan <code>--from-literal</code> -- atau sesuatu yang kompleks -- seperti berkas konfigurasi atau <em>blob</em> JSON yang ditentukan dengan <code>--from-file</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2016-02-18T19:14:38Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># contoh properti yang sederhana yang ditentukan menggunakan --from-literal</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>example.property.1</span>:<span style=color:#bbb> </span>hello<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>example.property.2</span>:<span style=color:#bbb> </span>world<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># contoh properti yang kompleks yang ditentukan menggunakan --from-file</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>example.property.file</span>:<span style=color:#bbb> </span>|-<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    property.1=value-1
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    property.2=value-2
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    property.3=value-3</span><span style=color:#bbb>    
</span></span></span></code></pre></div><h3 id=batasan>Batasan</h3><ul><li><p>Kamu harus membuat ConfigMap sebelum merujuknya pada spesifikasi Pod (kecuali kamu menandai ConfigMap sebagai "<em>optional</em>"). Jika kamu merujuk sebuah ConfigMap yang tidak ada, Pod tersebut tidak akan berjalan. Sama halnya, mereferensikan kunci yang tidak ada pada ConfigMap akan mencegah Pod untuk berjalan.</p></li><li><p>Jika kamu menggunakan <code>envFrom</code> untuk menentukan variabel <em>environment</em> dari ConfigMap, kunci-kunci yang dianggap tidak sah akan dilewat. Pod akan diizinkan untuk berjalan, tetapi nama-nama yang tidak sah akan direkam pada <em>event log</em> (<code>InvalidVariableNames</code>). Pesan <em>log</em> tersebut mencantumkan tiap kunci yang dilewat. Sebagai contoh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get events
</span></span></code></pre></div><p>Keluaran akan tampil seperti berikut:</p><pre tabindex=0><code>LASTSEEN FIRSTSEEN COUNT NAME          KIND  SUBOBJECT  TYPE      REASON                            SOURCE                MESSAGE
0s       0s        1     dapi-test-pod Pod              Warning   InvalidEnvironmentVariableNames   {kubelet, 127.0.0.1}  Keys [1badkey, 2alsobad] from the EnvFrom configMap default/myconfig were skipped since they are considered invalid environment variable names.
</code></pre></li><li><p>ConfigMap berada pada <a class=glossary-tooltip title='Sebuah abstraksi yang digunakan oleh Kubernetes untuk mendukung multipel klaster virtual pada klaster fisik yang sama.' data-toggle=tooltip data-placement=top href=/id/docs/concepts/overview/working-with-objects/namespaces target=_blank aria-label=Namespace>Namespace</a> tertentu. ConfigMap hanya dapat dirujuk oleh Pod yang berada pada Namespace yang sama.</p></li><li><p>Kamu tidak dapat menggunakan ConfigMap untuk <a class=glossary-tooltip title='A pod managed directly by the kubelet daemon on a specific node.' data-toggle=tooltip data-placement=top href=/docs/tasks/configure-pod-container/static-pod/ target=_blank aria-label='Pod statis'>Pod statis</a>, karena Kubelet tidak mendukung hal ini.</p></li></ul><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Ikuti contoh penerapan pada dunia nyata <a href=/docs/tutorials/configuration/configure-redis-using-configmap/>Mengatur Redis menggunakan ConfigMap</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3d7b9cb24a647c36ba63f7a02ec49010>3.11 - Pembagian Namespace Proses antar Container pada sebuah Pod</h1><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.17 [stable]</code></div><p>Dokumen ini akan menjelaskan menkanisme konfigurasi pembagian namespace
process dalam sebuah Pod. Ketika pembagian <em>namespace</em> proses diaktifkan untuk sebuah Pod,
proses yang ada di dalam Container akan bersifat transparan pada semua Container
yang terdapat di dalam Pod tersebut.</p><p>Kamu dapat mengaktifkan fitur ini untuk melakukan konfigurasi kontainer yang saling terhubung,
misalnya saja kontainer <em>sidecar</em> yang bertugas dalam urusan log, atau untuk melakukan
proses pemecahan masalah (<em>troubleshoot</em>) image kontainer yang tidak memiliki utilitas <em>debugging</em> seperti shell.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Kubernetes servermu harus dalam versi yang sama atau lebih baru dari v1.10.
Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mengatur-sebuah-pod>Mengatur sebuah Pod</h2><p>Pembagian <em>namespace</em> proses (<em>Process Namespace Sharing</em>) diaktifkan menggunakan <em>field</em> <code>shareProcessNamespace</code>
<code>v1.PodSpec</code>. Sebagai contoh:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/share-process-namespace.yaml download=pods/share-process-namespace.yaml><code>pods/share-process-namespace.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-share-process-namespace-yaml")' title="Copy pods/share-process-namespace.yaml to clipboard"></img></div><div class=includecode id=pods-share-process-namespace-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>shareProcessNamespace</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>shell<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>busybox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>capabilities</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>add</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- SYS_PTRACE<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>stdin</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>tty</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Buatlah sebuah Pod <code>nginx</code> di dalam klaster kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/share-process-namespace.yaml
</span></span></code></pre></div></li><li><p>Tempelkan kontainer <code>shell</code> dan jalankan perintah <code>ps</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl attach -it nginx -c shell
</span></span></code></pre></div><p>Jika kamu tidak melihat <em>prompt</em> perintah, kamu dapat menekan tombol enter:</p><pre tabindex=0><code>/ # ps ax
PID   USER     TIME  COMMAND
    1 root      0:00 /pause
    8 root      0:00 nginx: master process nginx -g daemon off;
   14 101       0:00 nginx: worker process
   15 root      0:00 sh
   21 root      0:00 ps ax
</code></pre></li></ol><p>Kamu dapat memberikan sinyal pada kontainer lain. Misalnya saja, mengirim sinyal <code>SIGHUP</code> pada
nginx untuk menjalankan ulang proses worker. Hal ini membutuhkan kapabilitas <code>SYS_PTRACE</code>.</p><pre tabindex=0><code>/ # kill -HUP 8
/ # ps ax
PID   USER     TIME  COMMAND
    1 root      0:00 /pause
    8 root      0:00 nginx: master process nginx -g daemon off;
   15 root      0:00 sh
   22 101       0:00 nginx: worker process
   23 root      0:00 ps ax
</code></pre><p>Hal ini juga merupakan alasan mengapa kita dapat mengakses kontainer lain menggunakan
tautan (<em>link</em>) <code>/proc/$pid/root</code>.</p><pre tabindex=0><code>/ # head /proc/8/root/etc/nginx/nginx.conf

user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;


events {
    worker_connections  1024;
</code></pre><h2 id=memahami-pembagian-namespace-process>Memahami Pembagian Namespace Process</h2><p>Pod berbagi banyak sumber daya yang ada sehingga memungkinkan adanya pembagian <em>namespace</em>
proses. Beberapa <em>image</em> kontainer bisa jadi terisolasi dari kontainer lainnya,
meskipun begitu, memahami beberapa perbedaan berikut juga merupakan hal yang
penting untuk diketahui:</p><ol><li><p><strong>Proses kontainer tidak lagi memiliki PID 1.</strong> Beberapa image kontainer akan menolak
untuk dijalankan (contohnya, kontainer yang menggunakan <code>systemd</code>) atau menjalankan
perintah seperti <code>kill -HUP 1</code> untuk memberikan sinyal pada proses kontainer. Di dalam Pod dengan
sebuah namespace process terbagi, sinyal <code>kill -HUP 1</code> akan diberikan pada <em>sandbox</em> Pod.
(<code>/pause</code> pada contoh di atas.)</p></li><li><p><strong>Proses-proses yang ada akan transparan pada kontainer lain di dalam Pod.</strong> Hal ini termasuk
informasi pada <code>/proc</code>, seperti kata sandi yang diberikan sebagai argumen atau <em>environment variable</em>.
Hal ini hanya dilindungi oleh perizinan reguler Unix.</p></li><li><p><strong>Berkas sistem (<em>filesystem</em>) kontainer bersifat transparan pada kontainer lain di dalam Pod melalui link
<code>/proc/$pid/root</code>.</strong> Hal ini memungkinkan proses <em>debugging</em> menjadi lebih mudah, meskipun begitu hal ini
juga berarti kata kunci (<em>secret</em>) yang ada di dalam <em>filesystem</em> juga hanya dilindungi oleh perizinan <em>filesystem</em> saja.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-42a59b878d4c58e5c6f4bb87483dda93>3.12 - Membuat Pod Statis</h1><p>Pod statis dikelola langsung oleh <em>daemon</em> kubelet pada suatu Node spesifik,
tanpa <a class=glossary-tooltip title='Komponen control plane yang mengekspos API Kubernetes. Merupakan front-end dari control plane Kubernetes.' data-toggle=tooltip data-placement=top href=/docs/reference/generated/kube-apiserver/ target=_blank aria-label='API server'>API server</a>
mengobservasi mereka.
Tidak seperti Pod yang dikelola oleh <em>control plane</em> (contohnya,
<a class=glossary-tooltip title='Mengelola aplikasi yang direplikasi di dalam klastermu.' data-toggle=tooltip data-placement=top href=/id/docs/concepts/workloads/controllers/deployment/ target=_blank aria-label=Deployment>Deployment</a>);
kubelet akan memantau setiap Pod statis (dan menjalankan ulang jika
Pod mengalami kegagalan).</p><p>Pod statis selalu terikat pada satu <a class=glossary-tooltip title='Agen yang dijalankan pada setiap node di klaster yang bertugas untuk memastikan kontainer dijalankan di dalam Pod.' data-toggle=tooltip data-placement=top href=/docs/reference/generated/kubelet target=_blank aria-label=Kubelet>Kubelet</a>
di dalam Node spesifik.</p><p>Kubelet secara otomatis akan mengulang untuk membuat sebuah
<a class=glossary-tooltip title='An object in the API server that tracks a static pod on a kubelet.' data-toggle=tooltip data-placement=top href='/id/docs/reference/glossary/?all=true#term-mirror-pod' target=_blank aria-label='Pod mirror'>Pod mirror</a>
pada server API Kubernetes untuk setiap Pod statis.
Ini berarti Pod yang berjalan pada Node akan terlihat oleh API server,
namun tidak dapat mengontrol dari sana.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Jika kamu menjalankan klaster Kubernetes dan menggunakan Pod statis
untuk menjalankan Pod pada setiap Node, kamu kemungkinan harus menggunakan
sebuah <a class=glossary-tooltip title='Memastikan salinan Pod dijalankan pada sekumpulan Node dalam satu klaster.' data-toggle=tooltip data-placement=top href=/id/docs/concepts/workloads/controllers/daemonset target=_blank aria-label=DaemonSet>DaemonSet</a>.</div><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><p>Laman ini mengasumsikan kamu menggunakan <a class=glossary-tooltip title='A lightweight container runtime specifically for Kubernetes' data-toggle=tooltip data-placement=top href=https://cri-o.io/#what-is-cri-o target=_blank aria-label=CRI-O>CRI-O</a>
untuk menjalankan Pod, dan Node kamu berjalan menggunakan sistem operasi Fedora.
Instruksi untuk distribusi lain atau instalasi Kubernetes mungkin berbeda.</p><h2 id=membuat-sebuah-pod-statis>Membuat sebuah Pod statis</h2><p>Kamu dapat mengatur Pod statis dengan menggunakan sebuah
<a href=#konfigurasi-melalui-berkas-sistem>berkas konfigurasi pada <em>file system</em></a>
atau sebuah <a href=#konfigurasi-melalui-http>berkas konfigurasi ditempatkan pada web</a>.</p><h3 id=konfigurasi-melalui-berkas-sistem>Manifes Pod statis pada berkas sistem (<em>file system</em>)</h3><p>Manifes adalah standar definisi Pod dalam format JSON atau YAML pada suatu direktori.
Gunakan <em>field</em> <code>staticPodPath: &lt;direktori></code> pada
<a href=/docs/tasks/administer-cluster/kubelet-config-file>berkas konfigurasi kubelet</a>,
yang akan membaca direktori
secara berkala dan membuat atau menghapus Pod statis sesuai dengan berkas YAML/JSON
yang bertambah atau berkurang disana.</p><p>Catatan bahwa kubelet akan mengabaikan berkas yang diawali dengan titik (<em>dot</em>)
ketika memindai suatu direktori.</p><p>Sebagai contoh, ini cara untuk memulai server web sederhana sebagai Pod statis:</p><ol><li><p>Pilih Node yang kamu pilih untuk menjalankan Pod statis. Dalam contoh ini adalah <code>my-node1</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssh my-node1
</span></span></code></pre></div></li><li><p>Pilih sebuah direktori, katakan <code>/etc/kubelet.d</code> dan letakkan berkas definisi Pod untuk web server disana, contohnya <code>/etc/kubelet.d/static-web.yaml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Jalankan perintah ini pada Node tempat kubelet sedang berjalan</span>
</span></span><span style=display:flex><span>mkdir /etc/kubelet.d/
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;/etc/kubelet.d/static-web.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Pod
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: static-web
</span></span></span><span style=display:flex><span><span style=color:#b44>  labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>    role: myrole
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>    - name: web
</span></span></span><span style=display:flex><span><span style=color:#b44>      image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>      ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>        - name: web
</span></span></span><span style=display:flex><span><span style=color:#b44>          containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>          protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div></li><li><p>Atur kubelet pada Node untuk menggunakan direktori ini dengan menjalankannya menggunakan argumen <code>--pod-manifest-path=/etc/kubelet.d/</code>. Pada Fedora, ubah berkas <code>/etc/kubernetes/kubelet</code> dengan menambahkan baris berikut:</p><pre tabindex=0><code>KUBELET_ARGS=&#34;--cluster-dns=10.254.0.10 --cluster-domain=kube.local --pod-manifest-path=/etc/kubelet.d/&#34;
</code></pre><p>atau tambahkan <em>field</em> <code>staticPodPath: &lt;direktori></code> pada <a href=/docs/tasks/administer-cluster/kubelet-config-file>berkas konfigurasi kubelet</a>.</p></li><li><p>Jalankan ulang kubelet. Pada Fedora, kamu dapat menjalankan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Jalankan perintah berikut pada Node tempat kubelet berjalan</span>
</span></span><span style=display:flex><span>systemctl restart kubelet
</span></span></code></pre></div></li></ol><h3 id=konfigurasi-melalui-http>Manifes Pod statis pada Web</h3><p>Berkas yang ditentukan pada argumen <code>--manifest-url=&lt;URL></code> akan diunduh oleh kubelet secara berkala
dan kubelet akan menginterpretasinya sebagai sebuah berkas JSON/YAML yang berisikan definisi Pod.
Mirip dengan cara kerja <a href=#konfigurasi-melalui-berkas-sistem>manifes pada <em>filesystem</em></a>,
kubelet akan mengambil manifes berdasarkan jadwal. Jika ada perubahan pada daftar
Pod statis, maka kubelet akan menerapkannya.</p><p>Untuk menggunakan cara ini:</p><ol><li><p>Buat sebuah berkas YAML dan simpan pada suatu web server sehingga kamu pada memberikan URL tersebut pada kubelet.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>static-web<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>role</span>:<span style=color:#bbb> </span>myrole<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>web<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>web<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>protocol</span>:<span style=color:#bbb> </span>TCP<span style=color:#bbb>
</span></span></span></code></pre></div></li><li><p>Atur kubelet pada suatu Node untuk menggunakan manifes pada web ini dengan menjalankan menggunakan argumen <code>--manifest-url=&lt;url-manifes></code>. Pada Fedora, ubah pada <code>/etc/kubernetes/kubelet</code> untuk menambahkan baris ini:</p><pre tabindex=0><code>KUBELET_ARGS=&#34;--cluster-dns=10.254.0.10 --cluster-domain=kube.local --manifest-url=&lt;url-manifes&gt;&#34;
</code></pre></li><li><p>Jalankan ulang kubelet. Pada Fedora, kamu dapat menjalankan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Jalankan perintah ini pada Node tempat kubelet berjalan</span>
</span></span><span style=display:flex><span>systemctl restart kubelet
</span></span></code></pre></div></li></ol><h2 id=mengobservasi-perilaku-pod-statis>Mengobservasi perilaku Pod statis</h2><p>Ketika kubelet berjalan, secara otomatis akan menjalankan semua Pod statis yang terdefinisi.
Ketika kamu mendefinisikan Pod statis dan menjalankan ulang kubelet, Pod statis yang baru
akan dijalankan.</p><p>Kamu dapat melihat Container yang berjalan (termasuk Pod statis) dengan menjalankan (pada Node):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Jalankan perintah ini pada Node tempat kubelet berjalan</span>
</span></span><span style=display:flex><span>crictl ps
</span></span></code></pre></div><p>Keluarannya kira-kira seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#888>CONTAINER ID IMAGE         COMMAND  CREATED        STATUS         PORTS     NAMES
</span></span></span><span style=display:flex><span><span style=color:#888>f6d05272b57e nginx:latest  &#34;nginx&#34;  8 minutes ago  Up 8 minutes             k8s_web.6f802af4_static-web-fk-node1_default_67e24ed9466ba55986d120c867395f3c_378e5f3c
</span></span></span></code></pre></div><p>Kamu dapat melihat Pod <em>mirror</em> tersebut pada API server:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><pre tabindex=0><code>NAME         READY   STATUS    RESTARTS        AGE
static-web   1/1     Running   0               2m
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Pastikan kubelet memiliki izin untuk membuat Pod <em>mirror</em> pada server API. Jika tidak,
pembuatannya akan ditolak oleh API server. Lihat
<a href=/id/docs/concepts/policy/pod-security-policy/>PodSecurityPolicy</a>.</div><p><a class=glossary-tooltip title='Tags objects with identifying attributes that are meaningful and relevant to users.' data-toggle=tooltip data-placement=top href=/docs/concepts/overview/working-with-objects/labels target=_blank aria-label=Label>Label</a> dari Pod statis
akan dibuat juga pada Pod <em>mirror</em>. Kamu dapat menggunakan label tersebut
seperti biasa menggunakan <a class=glossary-tooltip title='Allows users to filter a list of resources based on labels.' data-toggle=tooltip data-placement=top href=/docs/concepts/overview/working-with-objects/labels/ target=_blank aria-label=selector-selector>selector-selector</a>,
atau yang lainnya.</p><p>Kamu dapat mencoba untuk menggunakan kubelet untuk menghapus Pod <em>mirror</em> tersebut pada API server,
namun kubelet tidak akan menghapus Pod statis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod static-web
</span></span></code></pre></div><pre tabindex=0><code>pod &#34;static-web&#34; deleted
</code></pre><p>Kamu akan melihat bahwa Pod tersebut tetap berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><pre tabindex=0><code>NAME         READY   STATUS    RESTARTS   AGE
static-web   1/1     Running   0          4s
</code></pre><p>Kembali ke Node tempat kubelet berjalan, kamu dapat mencoba menghentikan Container
Docker secara manual.
Kamu akan melihat, setelah beberapa saat, kubelet akan mengetahui dan akan menjalankan ulang Pod
secara otomatis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Jalankan perintah ini pada Node tempat kubelet berjalan</span>
</span></span><span style=display:flex><span>crictl stop 129fd7d382018 <span style=color:#080;font-style:italic># ganti dengan ID pada Container-mu</span>
</span></span><span style=display:flex><span>sleep <span style=color:#666>20</span>
</span></span><span style=display:flex><span>crictl ps
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#888>CONTAINER       IMAGE                                 CREATED           STATE      NAME    ATTEMPT    POD ID
</span></span></span><span style=display:flex><span><span style=color:#888>89db4553e1eeb   docker.io/library/nginx@sha256:...    19 seconds ago    Running    web     1          34533c6729106
</span></span></span></code></pre></div><h2 id=penambahan-dan-pengurangan-secara-dinamis-pada-pod-statis>Penambahan dan pengurangan secara dinamis pada Pod statis</h2><p>Direktori konfigurasi (<code>/etc/kubelet.d</code> pada contoh kita) akan dipindai secara berkala oleh kubelet
untuk melakukan perubahan dan penambahan/pengurangan
Pod sesuai dengan penambahan/pengurangan berkas pada direktori tersebut.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Ini mengasumsikan kamu menggunakan konfigurasi Pod statis pada _filesystem_</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Jalankan perintah ini pada Node tempat kubelet berjalan</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#</span>
</span></span><span style=display:flex><span>mv /etc/kubernetes/manifests/static-web.yaml /tmp
</span></span><span style=display:flex><span>sleep <span style=color:#666>20</span>
</span></span><span style=display:flex><span>crictl ps
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Kamu mendapatkan bahwa tidak ada Container nginx yang berjalan</span>
</span></span><span style=display:flex><span>mv /tmp/static-web.yaml  /etc/kubernetes/manifests/
</span></span><span style=display:flex><span>sleep <span style=color:#666>20</span>
</span></span><span style=display:flex><span>crictl ps
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#888>CONTAINER       IMAGE                                 CREATED           STATE      NAME    ATTEMPT    POD ID
</span></span></span><span style=display:flex><span><span style=color:#888>f427638871c35   docker.io/library/nginx@sha256:...    19 seconds ago    Running    web     1          34533c6729106
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-34a810f1516ad9d99b2697e36e9b0d0f>4 - Mengelola Sebuah Klaster</h1><div class=lead>Pelajari tugas-tugas umum dalam pengelolaan sebuah klaster.</div></div><div class=td-content><h1 id=pg-1239a77618c6278373832a142cd85519>4.1 - Menggunakan Calico untuk NetworkPolicy</h1><p>Laman ini menunjukkan beberapa cara cepat untuk membuat klaster Calico pada Kubernetes.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p>Putuskan apakah kamu ingin menggelar (<em>deploy</em>) sebuah klaster di <a href=#membuat-klaster-calico-menggunakan-google-kubernetes-engine-gke><em>cloud</em></a> atau di <a href=#membuat-klaster-calico-dengan-kubeadm>lokal</a>.</p><h2 id=membuat-klaster-calico-menggunakan-google-kubernetes-engine-gke>Membuat klaster Calico dengan menggunakan <em>Google Kubernetes Engine</em> (GKE)</h2><p><strong>Prasyarat</strong>: <a href=https://cloud.google.com/sdk/docs/quickstarts>gcloud</a>.</p><ol><li><p>Untuk meluncurkan klaster GKE dengan Calico, cukup sertakan opsi <code>--enable-network-policy</code>.</p><p><strong>Sintaksis</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud container clusters create <span style=color:#666>[</span>CLUSTER_NAME<span style=color:#666>]</span> --enable-network-policy
</span></span></code></pre></div><p><strong>Contoh</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud container clusters create my-calico-cluster --enable-network-policy
</span></span></code></pre></div></li><li><p>Untuk memverifikasi penggelaran, gunakanlah perintah berikut ini.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods --namespace<span style=color:#666>=</span>kube-system
</span></span></code></pre></div><p>Pod Calico dimulai dengan kata <code>calico</code>. Periksa untuk memastikan bahwa statusnya <code>Running</code>.</p></li></ol><h2 id=membuat-klaster-calico-dengan-kubeadm>Membuat klaster lokal Calico dengan kubeadm</h2><p>Untuk membuat satu klaster Calico dengan hos tunggal dalam waktu lima belas menit dengan menggunakan kubeadm, silakan merujuk pada</p><p><a href=https://docs.projectcalico.org/latest/getting-started/kubernetes/>Memulai cepat Calico</a>.</p><h2 id=selanjutnya>Selanjutnya</h2><p>Setelah klaster kamu berjalan, kamu dapat mengikuti <a href=/id/docs/tasks/administer-cluster/declare-network-policy/>Mendeklarasikan Kebijakan Jaringan</a> untuk mencoba NetworkPolicy Kubernetes.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-47be5dd51f686017f1766e6ec7aa6f41>4.2 - Mengelola Memori, CPU, dan Sumber Daya API</h1></div><div class=td-content><h1 id=pg-adb489b1ab985c9215657b0d4c6ae92b>4.2.1 - Mengatur Batas Minimum dan Maksimum Memori pada sebuah Namespace</h1><p>Laman ini menunjukkan cara untuk mengatur nilai minimum dan maksimum memori yang digunakan oleh Container
yang berjalan pada sebuah Namespace. Kamu dapat menentukan nilai minimum dan maksimum memori pada objek
<a href=/docs/reference/generated/kubernetes-api/v1.25/#limitrange-v1-core>LimitRange</a>. Jika sebuah Pod tidak memenuhi batasan yang ditentukan oleh LimitRange,
maka Pod tersebut tidak dapat dibuat pada Namespace tersebut.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><p>Tiap Node dalam klastermu harus memiliki setidaknya 1 GiB memori.</p><h2 id=membuat-sebuah-namespace>Membuat sebuah Namespace</h2><p>Buat sebuah Namespace sehingga sumber daya yang kamu buat pada latihan ini
terisolasi dari komponen lain pada klastermu.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create namespace constraints-mem-example
</span></span></code></pre></div><h2 id=membuat-limitrange-dan-pod>Membuat LimitRange dan Pod</h2><p>Berikut berkas konfigurasi untuk sebuah LimitRange:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/admin/resource/memory-constraints.yaml download=admin/resource/memory-constraints.yaml><code>admin/resource/memory-constraints.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("admin-resource-memory-constraints-yaml")' title="Copy admin/resource/memory-constraints.yaml to clipboard"></img></div><div class=includecode id=admin-resource-memory-constraints-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>LimitRange<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>mem-min-max-demo-lr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>max</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>1Gi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>min</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>500Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Container<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Membuat LimitRange:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/admin/resource/memory-constraints.yaml --namespace<span style=color:#666>=</span>constraints-mem-example
</span></span></code></pre></div><p>Melihat informasi mendetail mengenai LimitRange:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get limitrange mem-min-max-demo-lr --namespace<span style=color:#666>=</span>constraints-mem-example --output<span style=color:#666>=</span>yaml
</span></span></code></pre></div><p>Keluaran yang dihasilkan menunjukkan batasan minimum dan maksimum dari memori seperti yang diharapkan. Tetapi
perhatikan hal berikut, meskipun kamu tidak menentukan nilai bawaan pada berkas konfigurasi untuk
LimitRange, namun nilai tersebut akan dibuat secara otomatis.</p><pre tabindex=0><code>  limits:
  - default:
      memory: 1Gi
    defaultRequest:
      memory: 1Gi
    max:
      memory: 1Gi
    min:
      memory: 500Mi
    type: Container
</code></pre><p>Mulai sekarang setiap Container yang dibuat pada Namespace constraints-mem-example, Kubernetes
akan menjalankan langkah-langkah berikut:</p><ul><li><p>Jika Container tersebut tidak menentukan permintaan dan limit memori, maka diberikan nilai permintaan
dan limit memori bawaan pada Container.</p></li><li><p>Memastikan Container memiliki permintaan memori yang lebih besar atau sama dengan 500 MiB.</p></li><li><p>Memastikan Container memiliki limit memori yang lebih kecil atau kurang dari 1 GiB.</p></li></ul><p>Berikut berkas konfigurasi Pod yang memiliki satu Container. Manifes Container
menentukan permintaan memori 600 MiB dan limit memori 800 MiB. Nilai tersebut memenuhi
batasan minimum dan maksimum memori yang ditentukan oleh LimitRange.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/admin/resource/memory-constraints-pod.yaml download=admin/resource/memory-constraints-pod.yaml><code>admin/resource/memory-constraints-pod.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("admin-resource-memory-constraints-pod-yaml")' title="Copy admin/resource/memory-constraints-pod.yaml to clipboard"></img></div><div class=includecode id=admin-resource-memory-constraints-pod-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>constraints-mem-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>constraints-mem-demo-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;800Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;600Mi&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/admin/resource/memory-constraints-pod.yaml --namespace<span style=color:#666>=</span>constraints-mem-example
</span></span></code></pre></div><p>Memastikan Container pada Pod sudah berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod constraints-mem-demo --namespace<span style=color:#666>=</span>constraints-mem-example
</span></span></code></pre></div><p>Melihat informasi mendetail tentang Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod constraints-mem-demo --output<span style=color:#666>=</span>yaml --namespace<span style=color:#666>=</span>constraints-mem-example
</span></span></code></pre></div><p>Keluaran yang dihasilkan menunjukkan Container memiliki permintaan memori 600 MiB dan limit memori
800 MiB. Nilai tersebut memenuhi batasan yang ditentukan oleh LimitRange.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>     </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>800Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>600Mi<span style=color:#bbb>
</span></span></span></code></pre></div><p>Menghapus Podmu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pod constraints-mem-demo --namespace<span style=color:#666>=</span>constraints-mem-example
</span></span></code></pre></div><h2 id=mencoba-membuat-pod-yang-melebihi-batasan-maksimum-memori>Mencoba membuat Pod yang melebihi batasan maksimum memori</h2><p>Berikut berkas konfigurasi untuk sebuah Pod yang memiliki satu Container. Container tersebut menentukan
permintaan memori 800 MiB dan batas memori 1.5 GiB.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/admin/resource/memory-constraints-pod-2.yaml download=admin/resource/memory-constraints-pod-2.yaml><code>admin/resource/memory-constraints-pod-2.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("admin-resource-memory-constraints-pod-2-yaml")' title="Copy admin/resource/memory-constraints-pod-2.yaml to clipboard"></img></div><div class=includecode id=admin-resource-memory-constraints-pod-2-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>constraints-mem-demo-2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>constraints-mem-demo-2-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1.5Gi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;800Mi&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Mencoba membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/admin/resource/memory-constraints-pod-2.yaml --namespace<span style=color:#666>=</span>constraints-mem-example
</span></span></code></pre></div><p>Keluaran yang dihasilkan menunjukkan Pod tidak dibuat, karena Container menentukan limit memori yang
terlalu besar:</p><pre tabindex=0><code>Error from server (Forbidden): error when creating &#34;examples/admin/resource/memory-constraints-pod-2.yaml&#34;:
pods &#34;constraints-mem-demo-2&#34; is forbidden: maximum memory usage per Container is 1Gi, but limit is 1536Mi.
</code></pre><h2 id=mencoba-membuat-pod-yang-tidak-memenuhi-permintaan-memori>Mencoba membuat Pod yang tidak memenuhi permintaan memori</h2><p>Berikut berkas konfigurasi untuk sebuah Pod yang memiliki satu Container. Container tersebut menentukan
permintaan memori 100 MiB dan limit memori 800 MiB.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/admin/resource/memory-constraints-pod-3.yaml download=admin/resource/memory-constraints-pod-3.yaml><code>admin/resource/memory-constraints-pod-3.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("admin-resource-memory-constraints-pod-3-yaml")' title="Copy admin/resource/memory-constraints-pod-3.yaml to clipboard"></img></div><div class=includecode id=admin-resource-memory-constraints-pod-3-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>constraints-mem-demo-3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>constraints-mem-demo-3-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;800Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;100Mi&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Mencoba membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/admin/resource/memory-constraints-pod-3.yaml --namespace<span style=color:#666>=</span>constraints-mem-example
</span></span></code></pre></div><p>Keluaran yang dihasilkan menunjukkan Pod tidak dibuat, karena Container menentukan permintaan memori yang
terlalu kecil:</p><pre tabindex=0><code>Error from server (Forbidden): error when creating &#34;examples/admin/resource/memory-constraints-pod-3.yaml&#34;:
pods &#34;constraints-mem-demo-3&#34; is forbidden: minimum memory usage per Container is 500Mi, but request is 100Mi.
</code></pre><h2 id=membuat-pod-yang-tidak-menentukan-permintaan-ataupun-limit-memori>Membuat Pod yang tidak menentukan permintaan ataupun limit memori</h2><p>Berikut berkas konfigurasi untuk sebuah Pod yang memiliki satu Container. Container tersebut tidak menentukan
permintaan memori dan juga limit memori.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/admin/resource/memory-constraints-pod-4.yaml download=admin/resource/memory-constraints-pod-4.yaml><code>admin/resource/memory-constraints-pod-4.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("admin-resource-memory-constraints-pod-4-yaml")' title="Copy admin/resource/memory-constraints-pod-4.yaml to clipboard"></img></div><div class=includecode id=admin-resource-memory-constraints-pod-4-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>constraints-mem-demo-4<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>constraints-mem-demo-4-ctr<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Mencoba membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/admin/resource/memory-constraints-pod-4.yaml --namespace<span style=color:#666>=</span>constraints-mem-example
</span></span></code></pre></div><p>Melihat informasi mendetail tentang Pod:</p><pre tabindex=0><code>kubectl get pod constraints-mem-demo-4 --namespace=constraints-mem-example --output=yaml
</code></pre><p>Keluaran yang dihasilkan menunjukkan Container pada Pod memiliki permintaan memori 1 GiB dan limit memori 1 GiB.
Bagaimana Container mendapatkan nilai tersebut?</p><pre tabindex=0><code>resources:
  limits:
    memory: 1Gi
  requests:
    memory: 1Gi
</code></pre><p>Karena Containermu tidak menentukan permintaan dan limit memori, Container tersebut diberikan
<a href=/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/>permintaan dan limit memori bawaan</a>
dari LimitRange.</p><p>Pada tahap ini, Containermu mungkin saja berjalan ataupun mungkin juga tidak berjalan. Ingat bahwa prasyarat
untuk tugas ini adalah Node harus memiliki setidaknya 1 GiB memori. Jika tiap Node hanya memiliki
1 GiB memori, maka tidak akan ada cukup memori untuk dialokasikan pada setiap Node untuk memenuhi permintaan 1 Gib memori. Jika ternyata kamu menggunakan Node dengan 2 GiB memori, maka kamu mungkin memiliki cukup ruang untuk memenuhi permintaan 1 GiB tersebut.</p><p>Menghapus Pod:</p><pre tabindex=0><code>kubectl delete pod constraints-mem-demo-4 --namespace=constraints-mem-example
</code></pre><h2 id=pelaksanaan-batasan-minimum-dan-maksimum-memori>Pelaksanaan batasan minimum dan maksimum memori</h2><p>Batasan maksimum dan minimum memori yang yang ditetapkan pada sebuah Namespace oleh LimitRange dilaksanakan
hanya ketika Pod dibuat atau diperbarui. Jika kamu mengubah LimitRange, hal tersebut tidak akan memengaruhi
Pods yang telah dibuat sebelumnya.</p><h2 id=motivasi-untuk-batasan-minimum-dan-maksimum-memori>Motivasi untuk batasan minimum dan maksimum memori</h2><p>Sebagai seorang administrator klaster, kamu mungkin ingin menetapkan pembatasan jumlah memori yang dapat digunakan oleh Pod.
Sebagai contoh:</p><ul><li><p>Tiap Node dalam sebuah klaster memiliki 2 GB memori. Kamu tidak ingin menerima Pod yang meminta
lebih dari 2 GB memori, karena tidak ada Node pada klater yang dapat memenuhi permintaan tersebut.</p></li><li><p>Sebuah klaster digunakan bersama pada departemen produksi dan pengembangan.
Kamu ingin mengizinkan beban kerja (<em>workload</em>) pada produksi untuk menggunakan hingga 8 GB memori, tapi
kamu ingin beban kerja pada pengembangan cukup terbatas sampai dengan 512 MB saja. Kamu membuat Namespace terpisah
untuk produksi dan pengembangan, dan kamu menerapkan batasan memori pada tiap Namespace.</p></li></ul><h2 id=bersih-bersih>Bersih-bersih</h2><p>Menghapus Namespace:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete namespace constraints-mem-example
</span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><h3 id=untuk-administrator-klaster>Untuk administrator klaster</h3><ul><li><p><a href=/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/>Mengatur Permintaan dan Limit Memori Bawaan untuk Sebuah Namespace</a></p></li><li><p><a href=/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/>Mengatur Permintaan dan Limit CPU Bawaan untuk Sebuah Namespace</a></p></li><li><p><a href=/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/>Mengatur Batas Minimum dan Maksimum CPU untuk Sebuah Namespace</a></p></li><li><p><a href=/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/>Mengatur Kuota Memori dan CPU untuk Sebuah Namespace</a></p></li><li><p><a href=/docs/tasks/administer-cluster/manage-resources/quota-pod-namespace/>Mengatur Kuota Pod untuk Sebuah Namespace</a></p></li><li><p><a href=/docs/tasks/administer-cluster/quota-api-object/>Mengatur Kuota untuk Objek API</a></p></li></ul><h3 id=untuk-pengembang-aplikasi>Untuk pengembang aplikasi</h3><ul><li><p><a href=/docs/tasks/configure-pod-container/assign-memory-resource/>Memberikan Sumber Daya Memori pada Container dan Pod</a></p></li><li><p><a href=/docs/tasks/configure-pod-container/assign-cpu-resource/>Memberikan Sumber Daya CPU pada Container dan Pod</a></p></li><li><p><a href=/docs/tasks/configure-pod-container/quality-service-pod/>Mengatur Kualitas Layanan Pod</a></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8bcf4aeb5bbb6d6969a146e5ab97557b>4.3 - Debugging Resolusi DNS</h1><p>Laman ini menyediakan beberapa petunjuk untuk mendiagnosis masalah DNS.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul><br>Klaster kamu harus dikonfigurasi untuk menggunakan
<a class=glossary-tooltip title='Resources that extend the functionality of Kubernetes.' data-toggle=tooltip data-placement=top href=/docs/concepts/cluster-administration/addons/ target=_blank aria-label=addon>addon</a> CoreDNS atau pendahulunya,
kube-dns.</p><p>Kubernetes servermu harus dalam versi yang sama atau lebih baru dari v1.6.
Untuk melihat versi, tekan <code>kubectl version</code>.</p><h3 id=membuat-pod-sederhana-yang-digunakan-sebagai-lingkungan-pengujian>Membuat Pod sederhana yang digunakan sebagai lingkungan pengujian</h3><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/admin/dns/dnsutils.yaml download=admin/dns/dnsutils.yaml><code>admin/dns/dnsutils.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("admin-dns-dnsutils-yaml")' title="Copy admin/dns/dnsutils.yaml to clipboard"></img></div><div class=includecode id=admin-dns-dnsutils-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dnsutils<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dnsutils<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/e2e-test-images/jessie-dnsutils:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- sleep<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#b44>&#34;3600&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>IfNotPresent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Always<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Gunakan manifes berikut untuk membuat sebuah Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/admin/dns/dnsutils.yaml
</span></span></code></pre></div><pre tabindex=0><code>pod/dnsutils created
</code></pre><p>…dan verifikasi statusnya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods dnsutils
</span></span></code></pre></div><pre tabindex=0><code>NAME      READY     STATUS    RESTARTS   AGE
dnsutils   1/1       Running   0          &lt;some-time&gt;
</code></pre><p>Setelah Pod tersebut berjalan, kamu dapat menjalankan perintah <code>nslookup</code> di lingkungan tersebut.
Jika kamu melihat hal seperti ini, maka DNS sudah berjalan dengan benar.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -i -t dnsutils -- nslookup kubernetes.default
</span></span></code></pre></div><pre tabindex=0><code>Server:    10.0.0.10
Address 1: 10.0.0.10

Name:      kubernetes.default
Address 1: 10.0.0.1
</code></pre><p>Jika perintah <code>nslookup</code> gagal, periksa hal berikut:</p><h3 id=periksa-konfigurasi-dns-lokal-terlebih-dahulu>Periksa konfigurasi DNS lokal terlebih dahulu</h3><p>Periksa isi dari berkas resolv.conf.
(Lihat <a href=/docs/tasks/administer-cluster/dns-custom-nameservers/#inheriting-dns-from-the-node><em>Inheriting</em> DNS dari node</a> dan
<a href=#known-issues>Isu-isu yang dikenal</a> di bawah ini untuk informasi lebih lanjut)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -ti dnsutils -- cat /etc/resolv.conf
</span></span></code></pre></div><p>Verifikasi <em>path</em> pencarian dan nama server telah dibuat agar tampil seperti di bawah ini (perlu diperhatikan bahwa <em>path</em> pencarian dapat berbeda tergantung dari penyedia layanan cloud):</p><pre tabindex=0><code>search default.svc.cluster.local svc.cluster.local cluster.local google.internal c.gce_project_id.internal
nameserver 10.0.0.10
options ndots:5
</code></pre><p>Kesalahan yang muncul berikut ini mengindikasikan terdapat masalah dengan <em>add-on</em> CoreDNS (atau kube-dns) atau Service terkait:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -i -t dnsutils -- nslookup kubernetes.default
</span></span></code></pre></div><pre tabindex=0><code>Server:    10.0.0.10
Address 1: 10.0.0.10

nslookup: can&#39;t resolve &#39;kubernetes.default&#39;
</code></pre><p>atau</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -i -t dnsutils -- nslookup kubernetes.default
</span></span></code></pre></div><pre tabindex=0><code>Server:    10.0.0.10
Address 1: 10.0.0.10 kube-dns.kube-system.svc.cluster.local

nslookup: can&#39;t resolve &#39;kubernetes.default&#39;
</code></pre><h3 id=periksa-apakah-pod-dns-sedang-berjalan>Periksa apakah Pod DNS sedang berjalan</h3><p>Gunakan perintah <code>kubectl get pods</code> untuk memverifikasi apakah Pod DNS sedang berjalan.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods --namespace<span style=color:#666>=</span>kube-system -l k8s-app<span style=color:#666>=</span>kube-dns
</span></span></code></pre></div><pre tabindex=0><code>NAME                       READY     STATUS    RESTARTS   AGE
...
coredns-7b96bf9f76-5hsxb   1/1       Running   0           1h
coredns-7b96bf9f76-mvmmt   1/1       Running   0           1h
...
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Nilai dari label <code>k8s-app</code> adalah <code>kube-dns</code> baik untuk CoreDNS maupun kube-dns.</div><p>Jika kamu melihat tidak ada Pod CoreDNS yang sedang berjalan atau Pod tersebut gagal/telah selesai, <em>add-on</em> DNS mungkin tidak dijalankan (<em>deployed</em>) secara bawaan di lingkunganmu saat ini dan kamu harus menjalankannya secara manual.</p><h3 id=periksa-kesalahan-pada-pod-dns>Periksa kesalahan pada Pod DNS</h3><p>Gunakan perintah <code>kubectl logs</code> untuk melihat log dari Container DNS.</p><p>Untuk CoreDNS:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl logs --namespace<span style=color:#666>=</span>kube-system -l k8s-app<span style=color:#666>=</span>kube-dns
</span></span></code></pre></div><p>Berikut contoh log dari CoreDNS yang sehat (<em>healthy</em>):</p><pre tabindex=0><code>.:53
2018/08/15 14:37:17 [INFO] CoreDNS-1.2.2
2018/08/15 14:37:17 [INFO] linux/amd64, go1.10.3, 2e322f6
CoreDNS-1.2.2
linux/amd64, go1.10.3, 2e322f6
2018/08/15 14:37:17 [INFO] plugin/reload: Running configuration MD5 = 24e6c59e83ce706f07bcc82c31b1ea1c
</code></pre><p>Periksa jika ada pesan mencurigakan atau tidak terduga dalam log.</p><h3 id=apakah-layanan-dns-berjalan>Apakah layanan DNS berjalan?</h3><p>Verifikasi apakah layanan DNS berjalan dengan menggunakan perintah <code>kubectl get service</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get svc --namespace<span style=color:#666>=</span>kube-system
</span></span></code></pre></div><pre tabindex=0><code>NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)             AGE
...
kube-dns     ClusterIP   10.0.0.10      &lt;none&gt;        53/UDP,53/TCP        1h
...
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Nama layanan adalah <code>kube-dns</code> baik untuk CoreDNS maupun kube-dns.</div><p>Jika kamu telah membuat Service atau seharusnya Service telah dibuat secara bawaan namun ternyata tidak muncul, lihat
<a href=/docs/tasks/debug/debug-application/debug-service/><em>debugging</em> Service</a> untuk informasi lebih lanjut.</p><h3 id=apakah-endpoint-dns-telah-ekspos>Apakah endpoint DNS telah ekspos?</h3><p>Kamu dapat memverifikasikan apakah <em>endpoint</em> DNS telah diekspos dengan menggunakan perintah <code>kubectl get endpoints</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get endpoints kube-dns --namespace<span style=color:#666>=</span>kube-system
</span></span></code></pre></div><pre tabindex=0><code>NAME       ENDPOINTS                       AGE
kube-dns   10.180.3.17:53,10.180.3.17:53    1h
</code></pre><p>Jika kamu tidak melihat <em>endpoint</em>, lihat bagian <em>endpoint</em> pada dokumentasi
<a href=/docs/tasks/debug/debug-application/debug-service/><em>debugging</em> Service</a>.</p><p>Untuk tambahan contoh Kubernetes DNS, lihat
<a href=https://github.com/kubernetes/examples/tree/master/staging/cluster-dns>contoh cluster-dns</a> pada repositori Kubernetes GitHub.</p><h3 id=apakah-kueri-dns-diterima-diproses>Apakah kueri DNS diterima/diproses?</h3><p>Kamu dapat memverifikasi apakah kueri telah diterima oleh CoreDNS dengan menambahkan plugin <code>log</code> pada konfigurasi CoreDNS (alias Corefile).
CoreDNS Corefile disimpan pada <a class=glossary-tooltip title='Sebuah objek API yang digunakan untuk menyimpan data nonkonfidensial sebagai pasangan kunci-nilai (key-value). Pod dapat menggunakan ConfigMap sebagai variabel lingkungan, argumen baris perintah (command-line), atau berkas konfigurasi dalam sebuah volume.' data-toggle=tooltip data-placement=top href=/docs/concepts/configuration/configmap/ target=_blank aria-label=ConfigMap>ConfigMap</a> dengan nama <code>coredns</code>. Untuk mengeditnya, gunakan perintah:</p><pre tabindex=0><code>kubectl -n kube-system edit configmap coredns
</code></pre><p>Lalu tambahkan <code>log</code> pada bagian Corefile seperti contoh berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>coredns<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>kube-system<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>Corefile</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    .:53 {
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        log
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        errors
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        health
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        kubernetes cluster.local in-addr.arpa ip6.arpa {
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>          pods insecure
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>          upstream
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>          fallthrough in-addr.arpa ip6.arpa
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        }
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        prometheus :9153
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        proxy . /etc/resolv.conf
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        cache 30
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        loop
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        reload
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        loadbalance
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    }</span><span style=color:#bbb>    
</span></span></span></code></pre></div><p>Setelah perubahan disimpan, perubahan dapat memakan waktu satu hingga dua menit untuk Kubernetes menyebarkan perubahan ini pada Pod CoreDNS.</p><p>Berikutnya, coba buat beberapa kueri dan lihat log pada bagian atas dari dokumen ini. Jika pod CoreDNS menerima kueri, kamu seharusnya akan melihatnya pada log.</p><p>Berikut ini contoh kueri yang terdapat di dalam log:</p><pre tabindex=0><code>.:53
2018/08/15 14:37:15 [INFO] CoreDNS-1.2.0
2018/08/15 14:37:15 [INFO] linux/amd64, go1.10.3, 2e322f6
CoreDNS-1.2.0
linux/amd64, go1.10.3, 2e322f6
2018/09/07 15:29:04 [INFO] plugin/reload: Running configuration MD5 = 162475cdf272d8aa601e6fe67a6ad42f
2018/09/07 15:29:04 [INFO] Reloading complete
172.17.0.18:41675 - [07/Sep/2018:15:29:11 +0000] 59925 &#34;A IN kubernetes.default.svc.cluster.local. udp 54 false 512&#34; NOERROR qr,aa,rd,ra 106 0.000066649s
</code></pre><h2 id=isu-isu-yang-dikenal>Isu-isu yang Dikenal</h2><p>Beberapa distribusi Linux (contoh Ubuntu) menggunakan <em>resolver</em> DNS lokal secara bawaan (systemd-resolved).
Systemd-resolved memindahkan dan mengganti <code>/etc/resolv.conf</code> dengan berkas <em>stub</em> yang dapat menyebabkan <em>forwarding loop</em> yang fatal saat meresolusi nama pada server <em>upstream</em>. Ini dapat diatasi secara manual dengan menggunakan <em>flag</em> kubelet <code>--resolv-conf</code>
untuk mengarahkan ke <code>resolv.conf</code> yang benar (Pada <code>systemd-resolved</code>, ini berada di <code>/run/systemd/resolve/resolv.conf</code>).
kubeadm akan otomatis mendeteksi <code>systemd-resolved</code>, dan menyesuaikan <em>flag</em> kubelet sebagai mana mestinya.</p><p>Pemasangan Kubernetes tidak menggunakan berkas <code>resolv.conf</code> pada <em>node</em> untuk digunakan sebagai klaster DNS secara <em>default</em>, karena proses ini umumnya spesifik pada distribusi tertentu. Hal ini bisa jadi akan diimplementasi nantinya.</p><p>Libc Linux (alias glibc) secara bawaan memiliki batasan <code>nameserver</code> DNS sebanyak 3 rekaman (<em>records</em>). Selain itu, pada glibc versi yang lebih lama dari glibc-2.17-222 (<a href=https://access.redhat.com/solutions/58028>versi terbaru lihat isu ini</a>), jumlah rekaman DNS <code>search</code> dibatasi sejumlah 6 (<a href="https://bugzilla.redhat.com/show_bug.cgi?id=168253">lihat masalah sejak 2005 ini</a>). Kubernetes membutuhkan 1 rekaman <code>nameserver</code> dan 3 rekaman <code>search</code>. Ini berarti jika instalasi lokal telah menggunakan 3 <code>nameserver</code> atau menggunakan lebih dari 3 <code>search</code>,sementara versi glibc kamu termasuk yang terkena dampak, beberapa dari pengaturan tersebut akan hilang. Untuk menyiasati batasan rekaman DNS <code>nameserver</code>, <em>node</em> dapat menjalankan <code>dnsmasq</code>,yang akan menyediakan <code>nameserver</code> lebih banyak. Kamu juga dapat menggunakan kubelet <code>--resolv-conf</code> <em>flag</em>. Untuk menyiasati batasan rekaman <code>search</code>, pertimbangkan untuk memperbarui distribusi linux kamu atau memperbarui glibc ke versi yang tidak terdampak.</p><p>Jika kamu menggunakan Alpine versi 3.3 atau lebih lama sebagai dasar <em>image</em> kamu, DNS mungkin tidak dapat bekerja dengan benar disebabkan masalah dengan Alpine.
<a href=https://github.com/kubernetes/kubernetes/issues/30215>Masalah 30215</a> Kubernetes menyediakan informasi lebih detil tentang ini.</p><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Lihat <a href=/docs/tasks/administer-cluster/dns-horizontal-autoscaling/>Penyekalaan otomatis Service DNS dalam klaster</a>.</li><li>Baca <a href=/docs/concepts/services-networking/dns-pod-service/>DNS untuk Service dan Pod</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3d0cd7d2f13d4759094f281504cf57b8>4.4 - Kustomisasi Service DNS</h1><p>Laman ini menjelaskan cara mengonfigurasi DNS
<a class=glossary-tooltip title='Unit Kubernetes yang paling sederhana dan kecil. Sebuah Pod merepresentasikan sebuah set kontainer yang dijalankan pada kluster kamu.' data-toggle=tooltip data-placement=top href=/docs/concepts/workloads/pods/pod-overview/ target=_blank aria-label=Pod>Pod</a> kamu dan menyesuaikan
proses resolusi DNS pada klaster kamu.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul><p>Klaster kamu harus menjalankan tambahan (<em>add-on</em>) CoreDNS terlebih dahulu.
<a href=/docs/tasks/administer-cluster/coredns/#migrasi-ke-coredns>Migrasi ke CoreDNS</a>
menjelaskan tentang bagaimana menggunakan <code>kubeadm</code> untuk melakukan migrasi dari <code>kube-dns</code>.</p><p>Kubernetes servermu harus dalam versi yang sama atau lebih baru dari v1.12.
Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=pengenalan>Pengenalan</h2><p>DNS adalah Service bawaan dalam Kubernetes yang diluncurkan secara otomatis
melalui <em>addon manager</em>
<a href=http://releases.k8s.io/main/cluster/addons/README.md>add-on klaster</a>.</p><p>Sejak Kubernetes v1.12, CoreDNS adalah server DNS yang direkomendasikan untuk menggantikan kube-dns. Jika klaster kamu
sebelumnya menggunakan kube-dns, maka kamu mungkin masih menggunakan <code>kube-dns</code> daripada CoreDNS.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Baik Service CoreDNS dan kube-dns diberi nama <code>kube-dns</code> pada <em>field</em> <code>metadata.name</code>.
Hal ini agar ada interoperabilitas yang lebih besar dengan beban kerja yang bergantung pada nama Service <code>kube-dns</code> lama untuk me-<em>resolve</em> alamat internal ke dalam klaster. Dengan menggunakan sebuah Service yang bernama <code>kube-dns</code> mengabstraksi detail implementasi yang dijalankan oleh penyedia DNS di belakang nama umum tersebut.</div><p>Jika kamu menjalankan CoreDNS sebagai sebuah Deployment, maka biasanya akan ditampilkan sebagai sebuah Service Kubernetes dengan alamat IP yang statis.
Kubelet meneruskan informasi DNS <em>resolver</em> ke setiap Container dengan argumen <code>--cluster-dns=&lt;dns-service-ip></code>.</p><p>Nama DNS juga membutuhkan domain. Kamu dapat mengonfigurasi domain lokal di kubelet
dengan argumen <code>--cluster-domain=&lt;default-local-domain></code>.</p><p>Server DNS mendukung <em>forward lookup</em> (<em>record</em> A dan AAAA), <em>port lookup</em> (<em>record</em> SRV), <em>reverse lookup</em> alamat IP (<em>record</em> PTR),
dan lain sebagainya. Untuk informasi lebih lanjut, lihatlah <a href=/id/docs/concepts/services-networking/dns-pod-service/>DNS untuk Service dan Pod</a>.</p><p>Jika <code>dnsPolicy</code> dari Pod diatur menjadi <code>default</code>, itu berarti mewarisi konfigurasi resolusi nama
dari Node yang dijalankan Pod. Resolusi DNS pada Pod
harus berperilaku sama dengan Node tersebut.
Tapi lihat <a href=/docs/tasks/debug-application-cluster/dns-debugging-resolution/#known-issues>Isu-isu yang telah diketahui</a>.</p><p>Jika kamu tidak menginginkan hal ini, atau jika kamu menginginkan konfigurasi DNS untuk Pod berbeda, kamu bisa
menggunakan argumen <code>--resolv-conf</code> pada kubelet. Atur argumen ini menjadi "" untuk mencegah Pod tidak
mewarisi konfigurasi DNS. Atur ke jalur (<em>path</em>) berkas yang tepat untuk berkas yang berbeda dengan
<code>/etc/resolv.conf</code> untuk menghindari mewarisi konfigurasi DNS.</p><h2 id=coredns>CoreDNS</h2><p>CoreDNS adalah server DNS otoritatif untuk kegunaan secara umum yang dapat berfungsi sebagai Service DNS untuk klaster, yang sesuai dengan <a href=https://github.com/kubernetes/dns/blob/master/docs/specification.md>spesifikasi dns</a>.</p><h3 id=opsi-configmap-pada-coredns>Opsi ConfigMap pada CoreDNS</h3><p>CoreDNS adalah server DNS yang modular dan mudah dipasang, dan setiap <em>plugin</em> dapat menambahkan fungsionalitas baru ke CoreDNS.
Fitur ini dapat dikonfigurasikan dengan menjaga berkas <a href=https://coredns.io/2017/07/23/corefile-explained/>Corefile</a>, yang merupakan
berkas konfigurasi dari CoreDNS. Sebagai administrator klaster, kamu dapat memodifikasi
<a class=glossary-tooltip title='Sebuah objek API yang digunakan untuk menyimpan data nonkonfidensial sebagai pasangan kunci-nilai (key-value). Pod dapat menggunakan ConfigMap sebagai variabel lingkungan, argumen baris perintah (command-line), atau berkas konfigurasi dalam sebuah volume.' data-toggle=tooltip data-placement=top href=/docs/concepts/configuration/configmap/ target=_blank aria-label=ConfigMap>ConfigMap</a> untuk Corefile dari CoreDNS dengan mengubah cara perilaku pencarian Service DNS
pada klaster tersebut.</p><p>Di Kubernetes, CoreDNS diinstal dengan menggunakan konfigurasi Corefile bawaan sebagai berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>coredns<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>kube-system<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>Corefile</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    .:53 {
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        errors
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        health {
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>            lameduck 5s
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        }
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        ready
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        kubernetes cluster.local in-addr.arpa ip6.arpa {
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>            pods insecure
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>            fallthrough in-addr.arpa ip6.arpa
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>            ttl 30
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        }
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        prometheus :9153
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        forward . /etc/resolv.conf
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        cache 30
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        loop
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        reload
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        loadbalance
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    }</span><span style=color:#bbb>    
</span></span></span></code></pre></div><p>Konfigurasi Corefile meliputi <a href=https://coredns.io/plugins/><em>plugin</em></a> berikut ini dari CoreDNS:</p><ul><li><a href=https://coredns.io/plugins/errors/>errors</a>: Kesalahan yang ditampilkan ke output standar (<em>stdout</em>)</li><li><a href=https://coredns.io/plugins/health/>health</a>: Kesehatan dari CoreDNS dilaporkan pada <code>http://localhost:8080/health</code>. Dalam sintaks yang diperluas <code>lameduck</code> akan menangani proses tidak sehat agar menunggu selama 5 detik sebelum proses tersebut dimatikan.</li><li><a href=https://coredns.io/plugins/ready/>ready</a>: <em>Endpoint</em> HTTP pada port 8181 akan mengembalikan OK 200, ketika semua <em>plugin</em> yang dapat memberi sinyal kesiapan, telah memberikan sinyalnya.</li><li><a href=https://coredns.io/plugins/kubernetes/>kubernetes</a>: CoreDNS akan menjawab pertanyaan (<em>query</em>) DNS berdasarkan IP Service dan Pod pada Kubernetes. Kamu dapat menemukan <a href=https://coredns.io/plugins/kubernetes/>lebih detail</a> tentang <em>plugin</em> itu dalam situs web CoreDNS. <code>ttl</code> memungkinkan kamu untuk mengatur TTL khusus untuk respon dari pertanyaan DNS. Standarnya adalah 5 detik. TTL minimum yang diizinkan adalah 0 detik, dan maksimum hanya dibatasi sampai 3600 detik. Mengatur TTL ke 0 akan mencegah <em>record</em> untuk di simpan sementara dalam <em>cache</em>.<br>Opsi <code>pods insecure</code> disediakan untuk kompatibilitas dengan Service <em>kube-dns</em> sebelumnya. Kamu dapat menggunakan opsi <code>pods verified</code>, yang mengembalikan <em>record</em> A hanya jika ada Pod pada Namespace yang sama untuk alamat IP yang sesuai. Opsi <code>pods disabled</code> dapat digunakan jika kamu tidak menggunakan <em>record</em> Pod.</li><li><a href=https://coredns.io/plugins/metrics/>prometheus</a>: Metrik dari CoreDNS tersedia pada <code>http://localhost:9153/metrics</code> dalam format yang sesuai dengan <a href=https://prometheus.io/>Prometheus</a> (dikenal juga sebagai OpenMetrics).</li><li><a href=https://coredns.io/plugins/forward/>forward</a>: Setiap pertanyaan yang tidak berada dalam domain klaster Kubernetes akan diteruskan ke <em>resolver</em> yang telah ditentukan dalam berkas (/etc/resolv.conf).</li><li><a href=https://coredns.io/plugins/cache/>cache</a>: Ini untuk mengaktifkan <em>frontend cache</em>.</li><li><a href=https://coredns.io/plugins/loop/>loop</a>: Mendeteksi <em>forwarding loop</em> sederhana dan menghentikan proses CoreDNS jika <em>loop</em> ditemukan.</li><li><a href=https://coredns.io/plugins/reload>reload</a>: Mengizinkan <em>reload</em> otomatis Corefile yang telah diubah. Setelah kamu mengubah konfigurasi ConfigMap, beri waktu sekitar dua menit agar perubahan yang kamu lakukan berlaku.</li><li><a href=https://coredns.io/plugins/loadbalance>loadbalance</a>: Ini adalah <em>load balancer</em> DNS secara <em>round-robin</em> yang mengacak urutan <em>record</em> A, AAAA, dan MX dalam setiap responnya.</li></ul><p>Kamu dapat memodifikasi perilaku CoreDNS bawaan dengan memodifikasi ConfigMap.</p><h3 id=konfigurasi-stub-domain-dan-nameserver-upstream-dengan-menggunakan-coredns>Konfigurasi <em>Stub-domain</em> dan <em>Nameserver Upstream</em> dengan menggunakan CoreDNS</h3><p>CoreDNS memiliki kemampuan untuk mengonfigurasi <em>stubdomain</em> dan <em>nameserver upstream</em> dengan menggunakan <a href=https://coredns.io/plugins/forward/><em>plugin</em> forward</a>.</p><h4 id=contoh>Contoh</h4><p>Jika operator klaster memiliki sebuah server domain <a href=https://www.consul.io/>Consul</a> yang terletak di 10.150.0.1, dan semua nama Consul memiliki akhiran .consul.local. Untuk mengonfigurasinya di CoreDNS, administrator klaster membuat bait (<em>stanza</em>) berikut dalam ConfigMap CoreDNS.</p><pre tabindex=0><code>consul.local:53 {
        errors
        cache 30
        forward . 10.150.0.1
    }
</code></pre><p>Untuk memaksa secara eksplisit semua pencarian DNS <em>non-cluster</em> melalui <em>nameserver</em> khusus pada 172.16.0.1, arahkan <code>forward</code> ke <em>nameserver</em> bukan ke <code>/etc/resolv.conf</code></p><pre tabindex=0><code>forward .  172.16.0.1
</code></pre><p>ConfigMap terakhir bersama dengan konfigurasi <code>Corefile</code> bawaan terlihat seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>coredns<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>kube-system<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>Corefile</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    .:53 {
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        errors
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        health
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        kubernetes cluster.local in-addr.arpa ip6.arpa {
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>           pods insecure
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>           fallthrough in-addr.arpa ip6.arpa
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        }
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        prometheus :9153
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        forward . 172.16.0.1
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        cache 30
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        loop
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        reload
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        loadbalance
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    }
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    consul.local:53 {
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        errors
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        cache 30
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>        forward . 10.150.0.1
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    }</span><span style=color:#bbb>    
</span></span></span></code></pre></div><p>Perangkat <code>kubeadm</code> mendukung terjemahan otomatis dari ConfigMap kube-dns
ke ConfigMap CoreDNS yang setara.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Sementara ini kube-dns dapat menerima FQDN untuk <em>stubdomain</em> dan <em>nameserver</em> (mis: ns.foo.com), namun CoreDNS belum mendukung fitur ini.
Selama penerjemahan, semua <em>nameserver</em> FQDN akan dihilangkan dari konfigurasi CoreDNS.</div><h2 id=konfigurasi-coredns-yang-setara-dengan-kube-dns>Konfigurasi CoreDNS yang setara dengan kube-dns</h2><p>CoreDNS mendukung fitur kube-dns dan banyak lagi lainnya.
ConfigMap dibuat agar kube-dns mendukung <code>StubDomains</code> dan <code>upstreamNameservers</code> untuk diterjemahkan ke <em>plugin</em> <code>forward</code> dalam CoreDNS.
Begitu pula dengan <em>plugin</em> <code>Federations</code> dalam kube-dns melakukan translasi untuk <em>plugin</em> <code>federation</code> dalam CoreDNS.</p><h3 id=contoh-1>Contoh</h3><p>Contoh ConfigMap ini untuk kube-dns menentukan federasi, <em>stub domain</em> dan server <em>upstream nameserver</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>federations</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    </span><span style=color:#bbb>    </span>{<span style=color:#b44>&#34;foo&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;foo.feddomain.com&#34;</span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>stubDomains</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    </span><span style=color:#bbb>    </span>{<span style=color:#b44>&#34;abc.com&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;1.2.3.4&#34;</span>],<span style=color:#bbb> </span><span style=color:#b44>&#34;my.cluster.local&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;2.3.4.5&#34;</span>]}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>upstreamNameservers</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    </span><span style=color:#bbb>    </span>[<span style=color:#b44>&#34;8.8.8.8&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;8.8.4.4&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span></code></pre></div><p>Untuk konfigurasi yang setara dengan CoreDNS buat Corefile berikut:</p><ul><li>Untuk federasi:</li></ul><pre tabindex=0><code>federation cluster.local {
    foo foo.feddomain.com
}
</code></pre><ul><li>Untuk stubDomain:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>abc.com:53 {<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>errors<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>cache 30<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>forward . 1.2.3.4<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>my.cluster.local:53 {<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>errors<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>cache 30<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>forward . 2.3.4.5<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>Corefile lengkap dengan <em>plugin</em> bawaan:</p><pre tabindex=0><code>.:53 {
    errors
    health
    kubernetes cluster.local in-addr.arpa ip6.arpa {
        pods insecure
        fallthrough in-addr.arpa ip6.arpa
    }
    federation cluster.local {
        foo foo.feddomain.com
    }
    prometheus :9153
    forward . 8.8.8.8 8.8.4.4
    cache 30
}
abc.com:53 {
    errors
    cache 30
    forward . 1.2.3.4
}
my.cluster.local:53 {
    errors
    cache 30
    forward . 2.3.4.5
}
</code></pre><h2 id=migrasi-ke-coredns>Migrasi ke CoreDNS</h2><p>Untuk bermigrasi dari kube-dns ke CoreDNS,
<a href=https://coredns.io/2018/05/21/migration-from-kube-dns-to-coredns/>artikel blog</a> yang detail
tersedia untuk membantu pengguna mengadaptasi CoreDNS sebagai pengganti dari kube-dns.</p><p>Kamu juga dapat bermigrasi dengan menggunakan
<a href=https://github.com/coredns/deployment/blob/master/kubernetes/deploy.sh>skrip <em>deploy</em></a> CoreDNS yang resmi.</p><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Baca <a href=/docs/tasks/administer-cluster/dns-debugging-resolution/><em>Debugging</em> Resolusi DNS</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b64a1d2bb3f4ed9f7021134e09a75c36>4.5 - Melakukan Reservasi Sumber Daya Komputasi untuk Daemon Sistem</h1><p>Node Kubernetes dapat dijadwalkan sesuai dengan kapasitas. Secara bawaan, Pod dapat menggunakan
semua kapasitas yang tersedia pada sebuah Node. Ini merupakan masalah karena Node
sebenarnya menjalankan beberapa <em>daemon</em> sistem yang diperlukan oleh OS dan Kubernetes itu sendiri.
Jika sumber daya pada Node tidak direservasi untuk <em>daemon-daemon</em> tersebut, maka
Pod dan <em>daemon</em> akan berlomba-lomba menggunakan sumber daya yang tersedia, sehingga
menyebabkan <em>starvation</em> sumber daya pada Node.</p><p>Fitur bernama <code>Allocatable</code> pada Node diekspos oleh kubelet yang berfungsi untuk melakukan
reservasi sumber daya komputasi untuk <em>daemon</em> sistem. Kubernetes merekomendasikan admin
klaster untuk mengatur <code>Allocatable</code> pada Node berdasarkan tingkat kepadatan (<em>density</em>) beban kerja setiap Node.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Kubernetes servermu harus dalam versi yang sama atau lebih baru dari 1.8.
Untuk melihat versi, tekan <code>kubectl version</code>.
Kamu harus menjalankan Kubernetes server dengan versi 1.17 atau yang lebih baru
untuk menggunakan perintah baris kubelet dengan opsi <code>--reserved-cpus</code> untuk
menyetel <a href=#melakukan-reservasi-daftar-cpu-secara-eksplisit>daftar reservasi CPU secara eksplisit</a>.</p><h2 id=allocatable-pada-node><em>Allocatable</em> pada Node</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>       Kapasitas Node
</span></span><span style=display:flex><span>------------------------------
</span></span><span style=display:flex><span>|       kube-reserved        |
</span></span><span style=display:flex><span>|----------------------------|
</span></span><span style=display:flex><span>|      system-reserved       |
</span></span><span style=display:flex><span>|----------------------------|
</span></span><span style=display:flex><span>|     eviction-threshold     |
</span></span><span style=display:flex><span>|     (batas pengusiran)     |
</span></span><span style=display:flex><span>|----------------------------|
</span></span><span style=display:flex><span>|                            |
</span></span><span style=display:flex><span>|        allocatable         |
</span></span><span style=display:flex><span>| (dapat digunakan oleh Pod) |
</span></span><span style=display:flex><span>|                            |
</span></span><span style=display:flex><span>|                            |
</span></span><span style=display:flex><span>------------------------------
</span></span></code></pre></div><p><code>Allocatable</code> atau sumber daya yang dialokasikan pada sebuah Node Kubernetes merupakan
jumlah sumber daya komputasi yang dapat digunakan oleh Pod. Penjadwal tidak
dapat melakukan penjadwalan melebihi <code>Allocatable</code>. Saat ini dukungan terhadap
<code>CPU</code>, <code>memory</code> dan <code>ephemeral-storage</code> tersedia.</p><p><code>Allocatable</code> pada Node diekspos oleh objek API <code>v1.Node</code> dan merupakan
bagian dari baris perintah <code>kubectl describe node</code>.</p><p>Sumber daya dapat direservasi untuk dua kategori <em>daemon</em> sistem melalui kubelet.</p><h3 id=mengaktifkan-qos-dan-tingkatan-cgroup-dari-pod>Mengaktifkan QoS dan tingkatan cgroup dari Pod</h3><p>Untuk menerapkan batasan <code>Allocatable</code> pada Node, kamu harus mengaktifkan
hierarki cgroup yang baru melalui <em>flag</em> <code>--cgroups-per-qos</code>. Secara bawaan, <em>flag</em> ini
telah aktif. Saat aktif, kubelet akan memasukkan semua Pod pengguna di bawah
sebuah hierarki cgroup yang dikelola oleh kubelet.</p><h3 id=mengonfigurasi-driver-cgroup>Mengonfigurasi <em>driver</em> cgroup</h3><p>Manipulasi terhadap hierarki cgroup pada hos melalui <em>driver</em> cgroup didukung oleh kubelet.
<em>Driver</em> dikonfigurasi melalui <em>flag</em> <code>--cgroup-driver</code>.</p><p>Nilai yang didukung adalah sebagai berikut:</p><ul><li><code>cgroupfs</code> merupakan <em>driver</em> bawaan yang melakukan manipulasi secara langsung
terhadap <em>filesystem</em> cgroup pada hos untuk mengelola <em>sandbox</em> cgroup.</li><li><code>systemd</code> merupakan <em>driver</em> alternatif yang mengelola <em>sandbox</em> cgroup menggunakan
bagian dari sumber daya yang didukung oleh sistem <em>init</em> yang digunakan.</li></ul><p>Tergantung dari konfigurasi <em>runtime</em> Container yang digunakan,
operator dapat memilih <em>driver</em> cgroup tertentu untuk memastikan perilaku sistem yang tepat.
Misalnya, jika operator menggunakan <em>driver</em> cgroup <code>systemd</code> yang disediakan oleh
<em>runtime</em> docker, maka kubelet harus diatur untuk menggunakan <em>driver</em> cgroup <code>systemd</code>.</p><h3 id=kube-reserved>Kube Reserved</h3><ul><li><strong><em>Flag</em> Kubelet</strong>: <code>--kube-reserved=[cpu=100m][,][memory=100Mi][,][ephemeral-storage=1Gi][,][pid=1000]</code></li><li><strong><em>Flag</em> Kubelet</strong>: <code>--kube-reserved-cgroup=</code></li></ul><p><code>kube-reserved</code> berfungsi untuk mengambil informasi sumber daya reservasi
untuk <em>daemon</em> sistem Kubernetes, seperti kubelet, <em>runtime</em> Container, detektor masalah pada Node, dsb.
<code>kube-reserved</code> tidak berfungsi untuk mereservasi sumber daya untuk <em>daemon</em> sistem yang berjalan
sebagai Pod. <code>kube-reserved</code> merupakan fungsi dari kepadatan Pod pada Node.</p><p>Selain dari <code>cpu</code>, <code>memory</code>, dan <code>ephemeral-storage</code>,<code>pid</code> juga dapat
diatur untuk mereservasi jumlah ID proses untuk <em>daemon</em> sistem Kubernetes.</p><p>Secara opsional, kamu dapat memaksa <em>daemon</em> sistem melalui setelan <code>kube-reserved</code>.
Ini dilakukan dengan menspesifikasikan <em>parent</em> cgroup sebagai nilai dari <em>flag</em> <code>--kube-reserved-cgroup</code> pada kubelet.</p><p>Kami merekomendasikan <em>daemon</em> sistem Kubernetes untuk ditempatkan pada
tingkatan cgroup yang tertinggi (contohnya, <code>runtime.slice</code> pada mesin systemd).
Secara ideal, setiap <em>daemon</em> sistem sebaiknya dijalankan pada <em>child</em> cgroup
di bawah <em>parent</em> ini. Lihat <a href=https://git.k8s.io/design-proposals-archive/node/node-allocatable.md#recommended-cgroups-setup>dokumentasi</a>
untuk mengetahui rekomendasi hierarki cgroup secara detail.</p><p>Catatan: kubelet <strong>tidak membuat</strong> <code>--kube-reserved-cgroup</code> jika cgroup
yang diberikan tidak ada pada sistem. Jika cgroup yang tidak valid diberikan,
maka kubelet akan mengalami kegagalan.</p><h3 id=system-reserved>System Reserved</h3><ul><li><strong><em>Flag</em> Kubelet</strong>: <code>--system-reserved=[cpu=100m][,][memory=100Mi][,][ephemeral-storage=1Gi][,][pid=1000]</code></li><li><strong><em>Flag</em> Kubelet</strong>: <code>--system-reserved-cgroup=</code></li></ul><p><code>system-reserved</code> berfungsi untuk mengetahui reservasi sumber daya untuk
<em>daemon</em> sistem pada OS, seperti <code>sshd</code>, <code>udev</code>, dan lainnya. <code>system-reserved</code> sebaiknya
mereservasi memori untuk kernel juga, karena memori kernel tidak termasuk dalam
hitungan kalkulasi Pod pada Kubernetes. Kami juga merekomendasikan reservasi sumber daya
untuk sesi (<em>session</em>) login pengguna (contohnya, <code>user.slice</code> di dalam dunia systemd).</p><h3 id=melakukan-reservasi-daftar-cpu-secara-eksplisit>Melakukan Reservasi Daftar CPU secara Eksplisit</h3><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.17 [stable]</code></div><ul><li><strong><em>Flag</em> Kubelet</strong>: <code>--reserved-cpus=0-3</code></li></ul><p><code>reserved-cpus</code> berfungsi untuk mendefinisikan <a href=https://www.kernel.org/doc/Documentation/cgroup-v1/cpusets.txt>cpuset</a> secara eksplisit untuk
<em>daemon</em> sistem OS dan <em>daemon</em> sistem Kubernetes. <code>reserved-cpus</code> dimaksudkan untuk
sistem-sistem yang tidak mendefinisikan tingkatan cgroup tertinggi secara terpisah untuk
<em>daemon</em> sistem OS dan <em>daemon</em> sistem Kubernetes yang berkaitan dengan sumber daya cpuset.</p><p>Jika kubelet <strong>tidak memiliki</strong> <code>--system-reserved-cgroup</code> dan <code>--kube-reserved-cgroup</code>,
cpuset akan diberikan secara eksplisit oleh <code>reserved-cpus</code>, yang akan menimpa definisi
yang diberikan oleh opsi <code>--kube-reserved</code> dan <code>--system-reserved</code>.</p><p>Opsi ini dirancang secara spesifik untuk kasus-kasus Telco/NFV, di mana <em>interrupt</em> atau <em>timer</em>
yang tidak terkontrol bisa memengaruhi performa dari beban kerja. Kamu dapat menggunakan
opsi untuk untuk mendefinisikan cpuset secara eksplisit untuk <em>daemon</em> sistem/Kubernetes dan
<em>interrupt</em>/<em>timer</em>, sehingga CPU sisanya dalam sistem akan digunakan untuk beban kerja saja,
dengan dampak yang sedikit terhadap <em>interrupt</em>/<em>timer</em> yang tidak terkontrol. Untuk
memindahkan <em>daemon</em> sistem, <em>daemon</em> Kubernetes serta <em>interrrupt</em>/<em>timer</em> Kubernetes supaya
menggunakan cpuset yang eksplisit didefinisikan oleh opsi ini, sebaiknya digunakan mekanisme lain di luar Kubernetes. Contohnya: pada Centos, kamu dapat melakukan ini dengan menggunakan
toolset yang sudah disetel.</p><h3 id=batas-pengusiran-eviction-threshold>Batas Pengusiran (<em>Eviction Threshold</em>)</h3><ul><li><strong><em>Flag</em> Kubelet</strong>: <code>--eviction-hard=[memory.available&lt;500Mi]</code></li></ul><p>Tekanan memori pada tingkatan Node menyebabkan sistem OOM (<em>Out Of Memory</em>) yang
berdampak pada Node secara keseluruhan dan semua Pod yang dijalankan di dalamnya.
Node dapat berubah menjadi <em>offline</em> sementara sampai memori berhasil diklaim kembali.
Untuk menghindari sistem OOM, atau mengurangi kemungkinan terjadinya OOM, kubelet
menyediakan fungsi untuk pengelolaan saat <a href=/docs/tasks/administer-cluster/out-of-resource/>Kehabisan Sumber Daya (<em>Out of Resource</em>)</a>.
Pengusiran dapat dilakukan hanya untuk kasus kehabisan <code>memory</code> dan <code>ephemeral-storage</code>. Dengan mereservasi
sebagian memori melalui <em>flag</em> <code>--eviction-hard</code>, kubelet akan berusaha untuk "mengusir" (<em>evict</em>)
Pod ketika ketersediaan memori pada Node jatuh di bawah nilai yang telah direservasi.
Dalam bahasa sederhana, jika <em>daemon</em> sistem tidak ada pada Node, maka Pod tidak dapat menggunakan
memori melebihi nilai yang ditentukan oleh <em>flag</em> <code>--eviction-hard</code>. Karena alasan ini,
sumber daya yang direservasi untuk pengusiran tidak tersedia untuk Pod.</p><h3 id=memaksakan-allocatable-pada-node>Memaksakan <em>Allocatable</em> pada Node</h3><ul><li><strong><em>Flag</em> Kubelet</strong>: <code>--enforce-node-allocatable=pods[,][system-reserved][,][kube-reserved]</code></li></ul><p>Penjadwal menganggap <code>Allocatable</code> sebagai kapasitas yang tersedia untuk digunakan oleh Pod.</p><p>Secara bawaan, kubelet memaksakan <code>Allocatable</code> untuk semua Pod. Pemaksaan dilakukan
dengan cara "mengusir" Pod-Pod ketika penggunaan sumber daya Pod secara keseluruhan telah
melewati nilai <code>Allocatable</code>. Lihat <a href=/docs/tasks/administer-cluster/out-of-resource/#eviction-policy>bagian ini</a>
untuk mengetahui kebijakan pengusiran secara detail. Pemaksaan ini dikendalikan dengan
cara memberikan nilai Pod melalui <em>flag</em> <code>--enforce-node-allocatable</code> pada kubelet.</p><p>Secara opsional, kubelet dapat diatur untuk memaksakan <code>kube-reserved</code> dan
<code>system-reserved</code> dengan memberikan nilai melalui <em>flag</em> tersebut. Sebagai catatan,
jika kamu mengatur <code>kube-reserved</code>, maka kamu juga harus mengatur <code>--kube-reserved-cgroup</code>. Begitu pula
jika kamu mengatur <code>system-reserved</code>, maka kamu juga harus mengatur <code>--system-reserved-cgroup</code>.</p><h2 id=panduan-umum>Panduan Umum</h2><p><em>Daemon</em> sistem dilayani mirip seperti Pod <code>Guaranteed</code> yang terjamin sumber dayanya.
<em>Daemon</em> sistem dapat melakukan <em>burst</em> di dalam jangkauan cgroup. Perilaku ini
dikelola sebagai bagian dari penggelaran (<em>deployment</em>) Kubernetes. Sebagai contoh,
kubelet harus memiliki cgroup sendiri dan membagikan sumber daya <code>kube-reserved</code> dengan
<em>runtime</em> Container. Namun begitu, kubelet tidak dapat melakukan <em>burst</em> dan menggunakan
semua sumber daya yang tersedia pada Node jika <code>kube-reserved</code> telah dipaksakan pada sistem.</p><p>Kamu harus berhati-hati ekstra ketika memaksakan reservasi <code>system-reserved</code> karena dapat
menyebabkan layanan sistem yang terpenting mengalami CPU <em>starvation</em>, OOM <em>killed</em>, atau tidak
dapat melakukan <em>fork</em> pada Node. Kami menyarankan untuk memaksakan <code>system-reserved</code> hanya
jika pengguna telah melakukan <em>profiling</em> sebaik mungkin pada Node mereka untuk
mendapatkan estimasi yang akurat dan percaya diri terhadap kemampuan mereka untuk
memulihkan sistem ketika ada grup yang terkena OOM <em>killed</em>.</p><ul><li>Untuk memulai, paksakan <code>Allocatable</code> pada Pod.</li><li>Ketika <em>monitoring</em> dan <em>alerting</em> telah cukup dilakukan untuk memonitor <em>daemon</em>
dari sistem Kubernetes, usahakan untuk memaksakan <code>kube-reserved</code> berdasarkan penggunakan heuristik.</li><li>Jika benar-benar diperlukan, paksakan <code>system-reserved</code> secara bertahap.</li></ul><p>Sumber daya yang diperlukan oleh <em>daemon</em> sistem Kubernetes dapat tumbuh seiring waktu dengan
adanya penambahan fitur-fitur baru. Proyek Kubernetes akan berusaha untuk menurunkan penggunaan sumber daya
dari <em>daemon</em> sistem Node, tetapi belum menjadi prioritas untuk saat ini.
Kamu dapat berekspektasi bahwa fitur kapasitas <code>Allocatable</code> ini akan dihapus pada versi yang akan datang.</p><h2 id=contoh-skenario>Contoh Skenario</h2><p>Berikut ini merupakan contoh yang menggambarkan komputasi <code>Allocatable</code> pada Node:</p><ul><li>Node memiliki 16 CPU, memori sebesar 32Gi, dan penyimpanan sebesar 100Gi.</li><li><code>--kube-reserved</code> diatur menjadi <code>cpu=1,memory=2Gi,ephemeral-storage=1Gi</code></li><li><code>--system-reserved</code> diatur menjadi <code>cpu=500m,memory=1Gi,ephemeral-storage=1Gi</code></li><li><code>--eviction-hard</code> diatur menjadi <code>memory.available&lt;500Mi,nodefs.available&lt;10%</code></li></ul><p>Dalam skenario ini, <code>Allocatable</code> akan menjadi 14.5 CPU, memori 28.5Gi, dan penyimpanan
lokal 88Gi.
Penjadwal memastikan bahwa semua Pod yang berjalan pada Node ini secara total tidak meminta memori melebihi
28.5Gi dan tidak menggunakan penyimpanan lokal melebihi 88Gi.
Pengusiran Pod akan dilakukan kubelet ketika penggunaan memori keseluruhan oleh Pod telah melebihi 28.5Gi,
atau jika penggunaan penyimpanan keseluruhan telah melebihi 88Gi. Jika semua proses pada Node mengonsumsi
CPU sebanyak-banyaknya, Pod-Pod tidak dapat mengonsumsi lebih dari 14.5 CPU.</p><p>Jika <code>kube-reserved</code> dan/atau <code>system-reserved</code> tidak dipaksakan dan <em>daemon</em> sistem
melebihi reservasi mereka, maka kubelet akan mengusir Pod ketika penggunaan memori pada Node
melebihi 31.5Gi atau penggunaan penyimpanan melebihi 90Gi.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-1e966f5d0540bbee0876f9d0d08d54dc>4.6 - Membagi sebuah Klaster dengan Namespace</h1><p>Laman ini menunjukkan bagaimana cara melihat, menggunakan dan menghapus <a class=glossary-tooltip title='Sebuah abstraksi yang digunakan oleh Kubernetes untuk mendukung multipel klaster virtual pada klaster fisik yang sama.' data-toggle=tooltip data-placement=top href=/id/docs/concepts/overview/working-with-objects/namespaces target=_blank aria-label=namespaces>namespaces</a>. Laman ini juga menunjukkan bagaimana cara menggunakan Namespace Kubernetes namespaces untuk membagi klaster kamu.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><ul><li>Memiliki <a href=/id/docs/setup/>Klaster Kubernetes</a>.</li><li>Memiliki pemahaman dasar <a href=/id/docs/concepts/workloads/pods/pod/><em>Pod</em></a>, <a href=/id/docs/concepts/services-networking/service/><em>Service</em></a>, dan <a href=/id/docs/concepts/workloads/controllers/deployment/><em>Deployment</em></a> dalam Kubernetes.</li></ul><h2 id=melihat-namespace>Melihat Namespace</h2><ol><li>Untuk melihat Namespace yang ada saat ini pada sebuah klaster anda bisa menggunakan:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get namespaces
</span></span></code></pre></div><pre tabindex=0><code>NAME          STATUS    AGE
default       Active    11d
kube-system   Active    11d
kube-public   Active    11d
</code></pre><p>Kubernetes mulai dengan tiga Namespace pertama:</p><ul><li><code>default</code> Namespace bawaan untuk objek-objek yang belum terkait dengan Namespace lain</li><li><code>kube-system</code> Namespace untuk objek-objek yang dibuat oleh sistem Kubernetes</li><li><code>kube-public</code> Namespace ini dibuat secara otomatis dan dapat dibaca oleh seluruh pengguna (termasuk yang tidak terotentikasi). Namespace ini sering dicadangkan untuk kepentingan klaster, untuk kasus dimana beberapa sumber daya seharusnya dapat terlihat dan dapat terlihat secara publik di seluruh klaster. Aspek publik pada Namespace ini hanya sebuah konvensi bukan suatu kebutuhan.</li></ul><p>Kamu bisa mendapat ringkasan Namespace tertentu dengan menggunakan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get namespaces &lt;name&gt;
</span></span></code></pre></div><p>Atau kamu bisa mendapatkan informasi detail menggunakan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe namespaces &lt;name&gt;
</span></span></code></pre></div><pre tabindex=0><code>Name:           default
Labels:         &lt;none&gt;
Annotations:    &lt;none&gt;
Status:         Active

No resource quota.

Resource Limits
 Type       Resource    Min Max Default
 ----               --------    --- --- ---
 Container          cpu         -   -   100m
</code></pre><p>Sebagai catatan, detail diatas menunjukkan baik kuota sumber daya (jika ada) dan juga jangkauan batas sumber daya.</p><p>Kuota sumber daya melacak penggunaan total sumber daya didalam Namespace dan mengijinkan operator-operator klaster mendefinisikan batas atas penggunaan sumber daya yang dapat di gunakan sebuah Namespace.</p><p>Jangkauan batas mendefinisikan pertimbangan min/maks jumlah sumber daya yang dapat di gunakan oleh sebuah entitas dalam sebuah Namespace.</p><p>Lihatlah <a href=https://git.k8s.io/community/contributors/design-proposals/resource-management/admission_control_limit_range.md>Kontrol Admisi: Rentang Batas</a></p><p>Sebuah Namespace dapat berada dalam salah satu dari dua buah fase:</p><ul><li><code>Active</code> Namespace sedang digunakan</li><li><code>Terminating</code> Namespace sedang dihapus dan tidak dapat digunakan untuk objek-objek baru</li></ul><p>Lihat <a href=https://git.k8s.io/community/contributors/design-proposals/architecture/namespaces.md#phases>dokumentasi desain</a> untuk detil lebih lanjut.</p><h2 id=membuat-sebuah-namespace-baru>Membuat sebuah Namespace baru</h2><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Hindari membuat Namespace dengan awalan <code>kube-</code>, karena awalan ini dicadangkan untuk Namespace dari sistem Kubernetes.</div><ol><li><p>Buat berkas YAML baru dengan nama <code>my-namespace.yaml</code> dengan isi berikut ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Namespace<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;masukkan-nama-namespace-disini&gt;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Then run:</p><pre tabindex=0><code>kubectl create -f ./my-namespace.yaml
</code></pre></li><li><p>Sebagai alternatif, kamu bisa membuat Namespace menggunakan perintah dibawah ini:</p><pre tabindex=0><code>kubectl create namespace &lt;masukkan-nama-namespace-disini&gt;
</code></pre></li></ol><p>Nama Namespace kamu harus merupakan
<a href=/docs/concepts/overview/working-with-objects/names#dns-label-names>Label DNS</a> yang valid.</p><p>Ada kolom opsional <code>finalizers</code>, yang memungkinkan <em>observables</em> untuk membersihkan sumber daya ketika Namespace dihapus. Ingat bahwa jika kamu memberikan finalizer yang tidak ada, Namespace akan dibuat tapi akan berhenti pada status <code>Terminating</code> jika pengguna mencoba untuk menghapusnya.</p><p>Informasi lebih lanjut mengenai <code>finalizers</code> bisa dibaca pada <a href=https://git.k8s.io/community/contributors/design-proposals/architecture/namespaces.md#finalizers>dokumentasi desain</a> dari Namespace.</p><h2 id=menghapus-namespace>Menghapus Namespace</h2><p>Hapus Namespace dengan</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete namespaces &lt;insert-some-namespace-name&gt;
</span></span></code></pre></div><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Ini akan menghapus semua hal yang ada dalam Namespace!</div><p>Proses penghapusan ini asinkron, jadi untuk beberapa waktu kamu akan melihat Namespace dalam status <code>Terminating</code>.</p><h2 id=membagi-klaster-kamu-menggunakan-namespace-kubernetes>Membagi klaster kamu menggunakan Namespace Kubernetes</h2><ol><li><p>Pahami Namespace bawaan</p><p>Secara bawaan, sebuah klaster Kubernetes akan membuat Namespace bawaan ketika menyediakan klaster untuk menampung Pod, Service, dan Deployment yang digunakan oleh klaster.</p><p>Dengan asumsi kamu memiliki klaster baru, kamu bisa mengecek Namespace yang tersedia dengan melakukan hal berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get namespaces
</span></span></code></pre></div><pre tabindex=0><code>NAME      STATUS    AGE
default   Active    13m
</code></pre></li><li><p>Membuat Namespace baru</p><p>Untuk latihan ini, kita akan membuat dua Namespace Kubernetes tambahan untuk menyimpan konten kita</p><p>Dalam sebuah skenario dimana sebuah organisasi menggunakan klaster Kubernetes yang digunakan bersama untuk penggunaan pengembangan dan produksi:</p><p>Tim pengembang ingin mengelola ruang di dalam klaster dimana mereka bisa melihat daftar Pod, Service, dan Deployment yang digunakan untuk membangun dan menjalankan apliksi mereka. Di ruang ini sumber daya akan datang dan pergi, dan pembatasan yang tidak ketat mengenai siapa yang bisa atau tidak bisa memodifikasi sumber daya untuk mendukung pengembangan secara gesit (<em>agile</em>).</p><p>Tim operasi ingin mengelola ruang didalam klaster dimana mereka bisa memaksakan prosedur ketat mengenai siapa yang bisa atau tidak bisa melakukan manipulasi pada kumpulan Pod, Layanan, dan Deployment yang berjalan pada situs produksi.</p><p>Satu pola yang bisa diikuti organisasi ini adalah dengan membagi klaster Kubernetes menjadi dua Namespace: <code>development</code> dan <code>production</code></p><p>Mari kita buat dua Namespace untuk menyimpan hasil kerja kita.</p><p>Buat Namespace <code>development</code> menggunakan kubectl:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/admin/namespace-dev.json
</span></span></code></pre></div><p>Kemudian mari kita buat Namespace <code>production</code> menggunakan kubectl:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/admin/namespace-prod.json
</span></span></code></pre></div><p>Untuk memastikan apa yang kita lakukan benar, lihat seluruh Namespace dalam klaster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get namespaces --show-labels
</span></span></code></pre></div><pre tabindex=0><code>NAME          STATUS    AGE       LABELS
default       Active    32m       &lt;none&gt;
development   Active    29s       name=development
production    Active    23s       name=production
</code></pre></li><li><p>Buat pod pada setiap Namespace</p><p>Sebuah Namespace Kubernetes memberikan batasan untuk Pod, Service, dan Deployment dalam klaster.</p><p>Pengguna yang berinteraksi dengan salah satu Namespace tidak melihat konten di dalam Namespace lain</p><p>Untuk menunjukkan hal ini, mari kita jalankan Deployment dan Pod sederhana di dalam Namespace <code>development</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create deployment snowflake --image<span style=color:#666>=</span>k8s.gcr.io/serve_hostname -n<span style=color:#666>=</span>development
</span></span><span style=display:flex><span>kubectl scale deployment snowflake --replicas<span style=color:#666>=</span><span style=color:#666>2</span> -n<span style=color:#666>=</span>development
</span></span></code></pre></div><p>Kita baru aja membuat sebuah Deployment yang memiliki ukuran replika dua yang menjalankan Pod dengan nama <code>snowflake</code> dengan sebuah Container dasar yang hanya melayani <em>hostname</em>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get deployment -n<span style=color:#666>=</span>development
</span></span></code></pre></div><pre tabindex=0><code>NAME         READY   UP-TO-DATE   AVAILABLE   AGE
snowflake    2/2     2            2           2m
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods -l <span style=color:#b8860b>app</span><span style=color:#666>=</span>snowflake -n<span style=color:#666>=</span>development
</span></span></code></pre></div><pre tabindex=0><code>NAME                         READY     STATUS    RESTARTS   AGE
snowflake-3968820950-9dgr8   1/1       Running   0          2m
snowflake-3968820950-vgc4n   1/1       Running   0          2m
</code></pre><p>Dan ini merupakan sesuatu yang bagus, dimana pengembang bisa melakukan hal yang ingin mereka lakukan tanpa harus khawatir hal itu akan mempengaruhi konten pada namespace <code>production</code>.</p><p>Mari kita pindah ke Namespace <code>production</code> dan menujukkan bagaimana sumber daya di satu Namespace disembunyikan dari yang lain</p><p>Namespace <code>production</code> seharusnya kosong, dan perintah berikut ini seharusnya tidak menghasilkan apapun.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get deployment -n<span style=color:#666>=</span>production
</span></span><span style=display:flex><span>kubectl get pods -n<span style=color:#666>=</span>production
</span></span></code></pre></div><p><code>Production</code> Namespace ingin menjalankan <code>cattle</code>, mari kita buat beberapa Pod <code>cattle</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create deployment cattle --image<span style=color:#666>=</span>k8s.gcr.io/serve_hostname -n<span style=color:#666>=</span>production
</span></span><span style=display:flex><span>kubectl scale deployment cattle --replicas<span style=color:#666>=</span><span style=color:#666>5</span> -n<span style=color:#666>=</span>production
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get deployment -n<span style=color:#666>=</span>production
</span></span></code></pre></div><pre tabindex=0><code>NAME         READY   UP-TO-DATE   AVAILABLE   AGE
cattle       5/5     5            5           10s
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods -l <span style=color:#b8860b>app</span><span style=color:#666>=</span>cattle -n<span style=color:#666>=</span>production
</span></span></code></pre></div><pre tabindex=0><code>NAME                      READY     STATUS    RESTARTS   AGE
cattle-2263376956-41xy6   1/1       Running   0          34s
cattle-2263376956-kw466   1/1       Running   0          34s
cattle-2263376956-n4v97   1/1       Running   0          34s
cattle-2263376956-p5p3i   1/1       Running   0          34s
cattle-2263376956-sxpth   1/1       Running   0          34s
</code></pre></li></ol><p>Sampai sini, seharusnya sudah jelas bahwa sumber daya yang dibuat pengguna pada sebuah Namespace disembunyikan dari Namespace lainnya.</p><p>Seiring dengan evolusi dukungan kebijakan di Kubernetes, kami akan memperluas skenario ini untuk menunjukkan bagaimana kamu bisa menyediakan aturan otorisasi yang berbeda untuk tiap Namespace.</p><h2 id=memahami-motivasi-penggunaan-namespace>Memahami motivasi penggunaan Namespace</h2><p>Sebuah klaster tunggal umumnya bisa memenuhi kebutuhan pengguna yang berbeda atau kelompok pengguna (itulah sebabnya disebut 'komunitas pengguna').</p><p>Namespace Kubernetes membantu proyek-proyek, tim-tim dan pelanggan yang berbeda untuk berbagi klaster Kubernetes.</p><p>Ini dilakukan dengan menyediakan hal berikut:</p><ol><li>Cakupan untuk <a href=/id/docs/concepts/overview/working-with-objects/names/>Names</a>.</li><li>Sebuah mekanisme untuk memasang otorisasi dan kebijakan untuk bagian dari klaster.</li></ol><p>Penggunaan Namespace berbeda merupakan hal opsional.</p><p>Tiap komunitas pengguna ingin bisa bekerja secara terisolasi dari komunitas lainnya.</p><p>Tiap komunitas pengguna memiliki hal berikut sendiri:</p><ol><li>sumber daya (Pod, Service, ReplicationController, dll.)</li><li>kebijakan (siapa yang bisa atau tidak bisa melakukan hal tertentu dalam komunitasnya)</li><li>batasan (komunitas ini diberi kuota sekian, dll.)</li></ol><p>Seorang operator klaster dapat membuat sebuah Namespace untuk tiap komunitas user yang unik.</p><p>Namespace tersebut memberikan cakupan yang unik untuk:</p><ol><li>penamaan sumber daya (untuk menghindari benturan penamaan dasar)</li><li>pendelegasian otoritas pengelolaan untuk pengguna yang dapat dipercaya</li><li>kemampuan untuk membatasi konsumsi sumber daya komunitas</li></ol><p>Contoh penggunaan mencakup</p><ol><li>Sebagai operator klaster, aku ingin mendukung beberapa komunitas pengguna dalam sebuah klaster.</li><li>Sebagai operator klaster, aku ingin mendelegasikan otoritas untuk mempartisi klaster ke pengguna terpercaya di komunitasnya.</li><li>Sebagai operator klaster, aku ingin membatasi jumlah sumber daya yang bisa dikonsumsi komunitas dalam rangka membatasi dampak ke komunitas lain yang menggunakan klaster yang sama.</li><li>Sebagai pengguna klaster, aku ingin berinteraksi dengan sumber daya yang berkaitan dengan komunitas pengguna saya secara terisolasi dari apa yang dilakukan komunitas lain di klaster yang sama.</li></ol><h2 id=memahami-namespace-dan-dns>Memahami Namespace dan DNS</h2><p>Ketika kamu membuat sebuah <a href=/docs/concepts/services-networking/service/>Service</a>, akan terbentuk <a href=/id/docs/concepts/services-networking/dns-pod-service/>entri DNS</a> untuk Service tersebut.
Entri DNS ini dalam bentuk <code>&lt;service-name>.&lt;namespace-name>.svc.cluster.local</code>, yang berarti jika sebuah Container hanya menggunakan <code>&lt;service-name></code> maka dia akan me-<em>resolve</em> ke layanan yang lokal dalam Namespace yang sama. Ini berguna untuk menggunakan konfigurasi yang sama pada Namespace yang berbeda seperti <em>Development</em>, <em>Staging</em> dan <em>Production</em>. Jika kami ingin menjangkau antar Namespace, kamu harus menggunakan <em>fully qualified domain name</em> (FQDN).</p><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Pelajari lebih lanjut mengenai <a href=/id/docs/concepts/overview/working-with-objects/namespaces/#pengaturan-preferensi-namespace>pengaturan preferensi Namespace</a>.</li><li>Pelajari lebih lanjut mengenai <a href=/id/docs/concepts/overview/working-with-objects/namespaces/#pengaturan-namespace-untuk-sebuah-permintaan>pengaturan namespace untuk sebuah permintaan</a></li><li>Baca <a href=https://github.com/kubernetes/community/blob/main/contributors/design-proposals/architecture/namespaces.md>desain Namespace</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0b17e83b6049e53b8ffa864bdfa07c87>4.7 - Mengatur Control Plane Kubernetes dengan Ketersediaan Tinggi (High-Availability)</h1><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.5 [alpha]</code></div><p>Kamu dapat mereplikasi <em>control plane</em> Kubernetes dalam skrip <code>kube-up</code> atau <code>kube-down</code> untuk Google Compute Engine (GCE).
Dokumen ini menjelaskan cara menggunakan skrip kube-up/down untuk mengelola <em>control plane</em> dengan ketersedian tinggi atau <em>high_availability</em> (HA) dan bagaimana <em>control plane</em> HA diimplementasikan untuk digunakan dalam GCE.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=memulai-klaster-yang-kompatibel-dengan-ha>Memulai klaster yang kompatibel dengan HA</h2><p>Untuk membuat klaster yang kompatibel dengan HA, kamu harus mengatur tanda ini pada skrip <code>kube-up</code>:</p><ul><li><p><code>MULTIZONE=true</code> - untuk mencegah penghapusan replika <em>control plane</em> kubelet dari zona yang berbeda dengan zona bawaan server.
Ini diperlukan jika kamu ingin menjalankan replika <em>control plane</em> pada zona berbeda, dimana hal ini disarankan.</p></li><li><p><code>ENABLE_ETCD_QUORUM_READ=true</code> - untuk memastikan bahwa pembacaan dari semua server API akan mengembalikan data terbaru.
Jika <code>true</code>, bacaan akan diarahkan ke replika pemimpin dari etcd.
Menetapkan nilai ini menjadi <code>true</code> bersifat opsional: pembacaan akan lebih dapat diandalkan tetapi juga akan menjadi lebih lambat.</p></li></ul><p>Sebagai pilihan, kamu dapat menentukan zona GCE tempat dimana replika <em>control plane</em> pertama akan dibuat.
Atur tanda berikut:</p><ul><li><code>KUBE_GCE_ZONE=zone</code> - zona tempat di mana replika <em>control plane</em> pertama akan berjalan.</li></ul><p>Berikut ini contoh perintah untuk mengatur klaster yang kompatibel dengan HA pada zona GCE europe-west1-b:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>MULTIZONE</span><span style=color:#666>=</span><span style=color:#a2f>true</span> <span style=color:#b8860b>KUBE_GCE_ZONE</span><span style=color:#666>=</span>europe-west1-b  <span style=color:#b8860b>ENABLE_ETCD_QUORUM_READS</span><span style=color:#666>=</span><span style=color:#a2f>true</span> ./cluster/kube-up.sh
</span></span></code></pre></div><p>Perhatikan bahwa perintah di atas digunakan untuk membuat klaster dengan sebuah <em>control plane</em>;
Namun, kamu bisa menambahkan replika <em>control plane</em> baru ke klaster dengan perintah berikutnya.</p><h2 id=menambahkan-replika-control-plane-yang-baru>Menambahkan replika <em>control plane</em> yang baru</h2><p>Setelah kamu membuat klaster yang kompatibel dengan HA, kamu bisa menambahkan replika <em>control plane</em> ke sana.
Kamu bisa menambahkan replika <em>control plane</em> dengan menggunakan skrip <code>kube-up</code> dengan tanda berikut ini:</p><ul><li><p><code>KUBE_REPLICATE_EXISTING_MASTER=true</code> - untuk membuat replika dari <em>control plane</em> yang sudah ada.</p></li><li><p><code>KUBE_GCE_ZONE=zone</code> - zona di mana replika <em>control plane</em> itu berjalan.
Region ini harus sama dengan region dari zona replika yang lain.</p></li></ul><p>Kamu tidak perlu mengatur tanda <code>MULTIZONE</code> atau <code>ENABLE_ETCD_QUORUM_READS</code>,
karena tanda itu diturunkan pada saat kamu memulai klaster yang kompatible dengan HA.</p><p>Berikut ini contoh perintah untuk mereplikasi <em>control plane</em> pada klaster sebelumnya yang kompatibel dengan HA:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>KUBE_GCE_ZONE</span><span style=color:#666>=</span>europe-west1-c <span style=color:#b8860b>KUBE_REPLICATE_EXISTING_MASTER</span><span style=color:#666>=</span><span style=color:#a2f>true</span> ./cluster/kube-up.sh
</span></span></code></pre></div><h2 id=menghapus-replika-control-plane>Menghapus replika <em>control plane</em></h2><p>Kamu dapat menghapus replika <em>control plane</em> dari klaster HA dengan menggunakan skrip <code>kube-down</code> dengan tanda berikut:</p><ul><li><p><code>KUBE_DELETE_NODES=false</code> - untuk mencegah penghapusan kubelet.</p></li><li><p><code>KUBE_GCE_ZONE=zone</code> - zona di mana replika <em>control plane</em> akan dihapus.</p></li><li><p><code>KUBE_REPLICA_NAME=replica_name</code> - (opsional) nama replika <em>control plane</em> yang akan dihapus.
Jika kosong: replika mana saja dari zona yang diberikan akan dihapus.</p></li></ul><p>Berikut ini contoh perintah untuk menghapus replika <em>control plane</em> dari klaster HA yang sudah ada sebelumnya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>KUBE_DELETE_NODES</span><span style=color:#666>=</span><span style=color:#a2f>false</span> <span style=color:#b8860b>KUBE_GCE_ZONE</span><span style=color:#666>=</span>europe-west1-c ./cluster/kube-down.sh
</span></span></code></pre></div><h2 id=mengatasi-replika-control-plane-yang-gagal>Mengatasi replika <em>control plane</em> yang gagal</h2><p>Jika salah satu replika <em>control plane</em> di klaster HA kamu gagal,
praktek terbaik adalah menghapus replika dari klaster kamu dan menambahkan replika baru pada zona yang sama.
Berikut ini contoh perintah yang menunjukkan proses tersebut:</p><ol><li>Menghapus replika yang gagal:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>KUBE_DELETE_NODES</span><span style=color:#666>=</span><span style=color:#a2f>false</span> <span style=color:#b8860b>KUBE_GCE_ZONE</span><span style=color:#666>=</span>replica_zone <span style=color:#b8860b>KUBE_REPLICA_NAME</span><span style=color:#666>=</span>replica_name ./cluster/kube-down.sh
</span></span></code></pre></div><ol start=2><li>Menambahkan replika baru untuk menggantikan replika yang lama</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>KUBE_GCE_ZONE</span><span style=color:#666>=</span>replica-zone <span style=color:#b8860b>KUBE_REPLICATE_EXISTING_MASTER</span><span style=color:#666>=</span><span style=color:#a2f>true</span> ./cluster/kube-up.sh
</span></span></code></pre></div><h2 id=praktek-terbaik-untuk-mereplikasi-control-plane-untuk-klaster-ha>Praktek terbaik untuk mereplikasi <em>control plane</em> untuk klaster HA</h2><ul><li><p>Usahakan untuk menempatkan replika <em>control plane</em> pada zona yang berbeda. Pada saat terjadi kegagalan zona, semua <em>control plane</em> yang ditempatkan dalam zona tersebut akan gagal pula.
Untuk bertahan dari kegagalan pada sebuah zona, tempatkan juga Node pada beberapa zona yang lain
(Lihatlah <a href=/id/docs/setup/best-practices/multiple-zones/>multi-zona</a> untuk lebih detail).</p></li><li><p>Jangan gunakan klaster dengan dua replika <em>control plane</em>. Konsensus pada klaster dengan dua replika membutuhkan kedua replika tersebut berjalan pada saat mengubah keadaan yang persisten.
Akibatnya, kedua replika tersebut diperlukan dan kegagalan salah satu replika mana pun mengubah klaster dalam status kegagalan mayoritas.
Dengan demikian klaster dengan dua replika lebih buruk, dalam hal HA, daripada klaster dengan replika tunggal.</p></li><li><p>Ketika kamu menambahkan sebuah replika <em>control plane</em>, status klaster (etcd) disalin ke sebuah <em>instance</em> baru.
Jika klaster itu besar, mungkin butuh waktu yang lama untuk menduplikasi keadaannya.
Operasi ini dapat dipercepat dengan memigrasi direktori data etcd, seperti yang dijelaskan <a href=https://coreos.com/etcd/docs/latest/admin_guide.html#member-migration>di sini</a>
(Kami sedang mempertimbangkan untuk menambahkan dukungan untuk migrasi direktori data etcd di masa mendatang).</p></li></ul><h2 id=catatan-implementasi>Catatan implementasi</h2><p><img src=/images/docs/ha-master-gce.png alt=ha-master-gce></p><h3 id=ikhtisar>Ikhtisar</h3><p>Setiap replika <em>control plane</em> akan menjalankan komponen berikut dalam mode berikut:</p><ul><li><p><em>instance</em> etcd: semua <em>instance</em> akan dikelompokkan bersama menggunakan konsensus;</p></li><li><p>server API : setiap server akan berbicara dengan lokal etcd - semua server API pada cluster akan tersedia;</p></li><li><p>pengontrol (<em>controller</em>), penjadwal (<em>scheduler</em>), dan <em>scaler</em> klaster automatis: akan menggunakan mekanisme sewa - dimana hanya satu <em>instance</em> dari masing-masing mereka yang akan aktif dalam klaster;</p></li><li><p>manajer tambahan (<em>add-on</em>): setiap manajer akan bekerja secara independen untuk mencoba menjaga tambahan dalam sinkronisasi.</p></li></ul><p>Selain itu, akan ada penyeimbang beban (<em>load balancer</em>) di depan server API yang akan mengarahkan lalu lintas eksternal dan internal menuju mereka.</p><h3 id=penyeimbang-beban>Penyeimbang Beban</h3><p>Saat memulai replika <em>control plane</em> kedua, penyeimbang beban yang berisi dua replika akan dibuat
dan alamat IP dari replika pertama akan dipromosikan ke alamat IP penyeimbang beban.
Demikian pula, setelah penghapusan replika <em>control plane</em> kedua yang dimulai dari paling akhir, penyeimbang beban akan dihapus dan alamat IP-nya akan diberikan ke replika terakhir yang ada.
Mohon perhatikan bahwa pembuatan dan penghapusan penyeimbang beban adalah operasi yang rumit dan mungkin perlu beberapa waktu (~20 menit) untuk dipropagasikan.</p><h3 id=service-control-plane-kubelet>Service <em>control plane</em> & kubelet</h3><p>Daripada sistem mencoba untuk menjaga daftar terbaru dari apiserver Kubernetes yang ada dalam Service Kubernetes,
sistem akan mengarahkan semua lalu lintas ke IP eksternal:</p><ul><li><p>dalam klaster dengan satu <em>control plane</em>, IP diarahkan ke <em>control plane</em> tunggal.</p></li><li><p>dalam klaster dengan multiple <em>control plane</em>, IP diarahkan ke penyeimbang beban yang ada di depan <em>control plane</em>.</p></li></ul><p>Demikian pula, IP eksternal akan digunakan oleh kubelet untuk berkomunikasi dengan <em>control plane</em>.</p><h3 id=sertifikat-control-plane>Sertifikat <em>control plane</em></h3><p>Kubernetes menghasilkan sertifikat TLS <em>control plane</em> untuk IP publik eksternal dan IP lokal untuk setiap replika.
Tidak ada sertifikat untuk IP publik sementara (<em>ephemeral</em>) dari replika;
Untuk mengakses replika melalui IP publik sementara, kamu harus melewatkan verifikasi TLS.</p><h3 id=pengklasteran-etcd>Pengklasteran etcd</h3><p>Untuk mengizinkan pengelompokkan etcd, porta yang diperlukan untuk berkomunikasi antara <em>instance</em> etcd akan dibuka (untuk komunikasi dalam klaster).
Untuk membuat penyebaran itu aman, komunikasi antara <em>instance</em> etcd diotorisasi menggunakan SSL.</p><h2 id=bacaan-tambahan>Bacaan tambahan</h2><p><a href=https://git.k8s.io/community/contributors/design-proposals/cluster-lifecycle/ha_master.md>Dokumen desain - Penyebaran master HA automatis</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-fe5ad73163d38596340536ec03a205f0>4.8 - Menggunakan sysctl dalam Sebuah Klaster Kubernetes</h1><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.12 [beta]</code></div><p>Dokumen ini menjelaskan tentang cara mengonfigurasi dan menggunakan parameter kernel dalam sebuah
klaster Kubernetes dengan menggunakan antarmuka <a class=glossary-tooltip title='An interface for getting and setting Unix kernel parameters' data-toggle=tooltip data-placement=top href=/docs/tasks/administer-cluster/sysctl-cluster/ target=_blank aria-label=sysctl>sysctl</a>.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=melihat-daftar-semua-parameter-sysctl>Melihat Daftar Semua Parameter Sysctl</h2><p>Dalam Linux, antarmuka sysctl memungkinkan administrator untuk memodifikasi kernel
parameter pada <em>runtime</em>. Parameter tersedia melalui sistem file virtual dari proses <code>/proc/sys/</code>.
Parameter mencakup berbagai subsistem seperti:</p><ul><li>kernel (dengan prefiks umum: <code>kernel.</code>)</li><li>networking (dengan prefiks umum: <code>net.</code>)</li><li>virtual memory (dengan prefiks umum: <code>vm.</code>)</li><li>MDADM (dengan prefiks umum: <code>dev.</code>)</li><li>subsistem yang lainnya dideskripsikan pada <a href=https://www.kernel.org/doc/Documentation/sysctl/README>dokumentasi Kernel</a>.</li></ul><p>Untuk mendapatkan daftar semua parameter, kamu bisa menjalankan perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo sysctl -a
</span></span></code></pre></div><h2 id=mengaktifkan-sysctl-unsafe>Mengaktifkan Sysctl <em>Unsafe</em></h2><p>Sysctl dikelompokkan menjadi sysctl <em>safe</em> dan sysctl <em>unsafe</em>. Sebagai tambahan untuk
pengaturan <em>Namespace</em> yang benar, sebuah sysctl <em>safe</em> harus diisolasikan dengan benar diantara Pod dalam Node yang sama.
Hal ini berarti mengatur sysctl <em>safe</em> dalam satu Pod:</p><ul><li>tidak boleh mempengaruhi Pod lain dalam Node</li><li>tidak boleh membahayakan kesehatan dari Node</li><li>tidak mengizinkan untuk mendapatkan sumber daya CPU atau memori di luar batas sumber daya dari sebuah Pod.</li></ul><p>Sejauh ini, sebagian besar sysctl yang diatur sebagai Namespace belum tentu dianggap sysctl <em>safe</em>.
Sysctl berikut ini didukung dalam kelompok <em>safe</em>:</p><ul><li><code>kernel.shm_rmid_forced</code>,</li><li><code>net.ipv4.ip_local_port_range</code>,</li><li><code>net.ipv4.tcp_syncookies</code>,</li><li><code>net.ipv4.ping_group_range</code> (sejak Kubernetes 1.18),</li><li><code>net.ipv4.ip_unprivileged_port_start</code> (sejak Kubernetes 1.22).</li></ul><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong><p>Contoh <code>net.ipv4.tcp_syncookies</code> bukan merupakan Namespace pada kernel Linux versi 4.4 atau lebih rendah.</p><p>Daftar ini akan terus dikembangkan dalam versi Kubernetes berikutnya ketika kubelet
mendukung mekanisme isolasi yang lebih baik.</p><p>Semua sysctl <em>safe</em> diaktifkan secara bawaan.</p><p>Semua sysctl <em>unsafe</em> dinon-aktifkan secara bawaan dan harus diizinkan secara manual oleh
administrator klaster untuk setiap Node. Pod dengan sysctl <em>unsafe</em> yang dinon-aktifkan akan dijadwalkan,
tetapi akan gagal untuk dijalankan.</p><p>Dengan mengingat peringatan di atas, administrator klaster dapat mengizinkan sysctl <em>unsafe</em> tertentu
untuk situasi yang sangat spesial seperti pada saat kinerja tinggi atau
penyetelan aplikasi secara <em>real-time</em>. <em>Unsafe</em> syctl diaktifkan Node demi Node melalui
<em>flag</em> pada kubelet; sebagai contoh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubelet --allowed-unsafe-sysctls <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  <span style=color:#b44>&#39;kernel.msg*,net.core.somaxconn&#39;</span> ...
</span></span></code></pre></div><p>Untuk <a class=glossary-tooltip title='A tool for running Kubernetes locally.' data-toggle=tooltip data-placement=top href=/docs/setup/learning-environment/minikube/ target=_blank aria-label=Minikube>Minikube</a>, ini dapat dilakukan melalui <em>flag</em> <code>extra-config</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>minikube start --extra-config<span style=color:#666>=</span><span style=color:#b44>&#34;kubelet.allowed-unsafe-sysctls=kernel.msg*,net.core.somaxconn&#34;</span>...
</span></span></code></pre></div><p>Hanya sysctl yang diatur sebagai Namespace dapat diaktifkan dengan cara ini.</p><h2 id=mnegatur-sysctl-untuk-pod>Mnegatur Sysctl untuk Pod</h2><p>Sejumlah sysctl adalah diatur sebagai Namespace dalam Kernel Linux hari ini. Ini berarti
mereka dapat diatur secara independen untuk setiap Pod dalam sebuah Node. Hanya sysctl dengan Namespace
yang dapat dikonfigurasi melalui Pod securityContext dalam Kubernetes.</p><p>Sysctl berikut dikenal sebagai Namespace. Daftar ini dapat berubah
pada versi kernel Linux yang akan datang.</p><ul><li><code>kernel.shm*</code>,</li><li><code>kernel.msg*</code>,</li><li><code>kernel.sem</code>,</li><li><code>fs.mqueue.*</code>,</li><li>Parameter dibawah <code>net.*</code> dapat diatur sebagai Namespace dari <em>container networking</em>
Namun, ada beberapa perkecualian (seperti
<code>net.netfilter.nf_conntrack_max</code> dan <code>net.netfilter.nf_conntrack_expect_max</code>
yang dapat diatur dalam Namespace <em>container networking</em> padahal bukan merupakan Namespace).</li></ul><p>Sysctl tanpa Namespace disebut dengan sysctl <em>node-level</em>. Jika kamu perlu mengatur
mereka, kamu harus secara manual mengonfigurasi mereka pada sistem operasi setiap Node, atau dengan
menggunakan DaemonSet melalui Container yang berwenang.</p><p>Gunakan securityContext dari Pod untuk mengonfigurasi sysctl Namespace. securityContext
berlaku untuk semua Container dalam Pod yang sama.</p><p>Contoh ini menggunakan securityContext dari Pod untuk mengatur sebuah sysctl <em>safe</em>
<code>kernel.shm_rmid_forced</code>, dan dua buah sysctl <em>unsafe</em> <code>net.core.somaxconn</code> dan
<code>kernel.msgmax</code>. Tidak ada perbedaan antara sysctl <em>safe</em> dan sysctl <em>unsafe</em> dalam
spesifikasi tersebut.</p><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Hanya modifikasi parameter sysctl setelah kamu memahami efeknya, untuk menghindari
gangguan pada kestabilan sistem operasi kamu.</div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>sysctl-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>sysctls</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>kernel.shm_rmid_forced<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;0&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>net.core.somaxconn<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1024&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>kernel.msgmax<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;65536&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>...<span style=color:#bbb>
</span></span></span></code></pre></div><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Karena sifat alami dari sysctl <em>unsafe</em>, penggunaan sysctl <em>unsafe</em>
merupakan resiko kamu sendiri dan dapat menyebabkan masalah parah seperti perilaku yang salah
pada Container, kekurangan sumber daya, atau kerusakan total dari Node.</div><p>Merupakan sebuah praktik yang baik untuk mempertimbangkan Node dengan pengaturan sysctl khusus sebagai
Node yang tercemar (<em>tainted</em>) dalam sebuah cluster, dan hanya menjadwalkan Pod yang membutuhkan pengaturan sysctl.
Sangat disarankan untuk menggunakan Kubernetes <a href=/docs/reference/generated/kubectl/kubectl-commands/#taint>fitur <em>taints and toleration</em></a> untuk mengimplementasikannya.</p><p>Pod dengan sysctl <em>unsafe</em> akan gagal diluncurkan pada sembarang Node yang belum
mengaktifkan kedua sysctl <em>unsafe</em> secara eksplisit. Seperti halnya sysctl <em>node-level</em> sangat
disarankan untuk menggunakan <a href=/docs/reference/generated/kubectl/kubectl-commands/#taint>fitur <em>taints and toleration</em></a> atau
<a href=/id/docs/concepts/scheduling-eviction/taint-and-toleration/>pencemaran dalam Node</a>
untuk Pod dalam Node yang tepat.</p><h2 id=podsecuritypolicy>PodSecurityPolicy</h2><p>Kamu selanjutnya dapat mengontrol sysctl mana saja yang dapat diatur dalam Pod dengan menentukan daftar
sysctl atau pola (<em>pattern</em>) sysctl dalam <code>forbiddenSysctls</code> dan/atau <em>field</em>
<code>allowedUnsafeSysctls</code> dari PodSecurityPolicy. Pola sysctl diakhiri
dengan karakter <code>*</code>, seperti <code>kernel.*</code>. Karakter <code>*</code> saja akan mencakup
semua sysctl.</p><p>Secara bawaan, semua sysctl <em>safe</em> diizinkan.</p><p>Kedua <code>forbiddenSysctls</code> dan <code>allowedUnsafeSysctls</code> merupakan daftar dari nama sysctl
atau pola sysctl yang polos (yang diakhiri dengan karakter <code>*</code>). Karakter <code>*</code> saja berarti sesuai dengan semua sysctl.</p><p><em>Field</em> <code>forbiddenSysctls</code> tidak memasukkan sysctl tertentu. Kamu dapat melarang
kombinasi sysctl <em>safe</em> dan sysctl <em>unsafe</em> dalam daftar tersebut. Untuk melarang pengaturan
sysctl, hanya gunakan <code>*</code> saja.</p><p>Jika kamu menyebutkan sysctl <em>unsafe</em> pada <em>field</em> <code>allowedUnsafeSysctls</code> dan
tidak ada pada <em>field</em> <code>forbiddenSysctls</code>, maka sysctl dapat digunakan pada Pod
dengan menggunakan PodSecurityPolicy ini. Untuk mengizinkan semua sysctl <em>unsafe</em> diatur dalam
PodSecurityPolicy, gunakan karakter <code>*</code> saja.</p><p>Jangan mengonfigurasi kedua <em>field</em> ini sampai tumpang tindih, dimana
sysctl yang diberikan akan diperbolehkan dan dilarang sekaligus.</p><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Jika kamu mengizinkan sysctl <em>unsafe</em> melalui <em>field</em> <code>allowUnsafeSysctls</code>
pada PodSecurityPolicy, Pod apa pun yang menggunakan sysctl seperti itu akan gagal dimulai
jika sysctl <em>unsafe</em> tidak diperbolehkan dalam <em>flag</em> kubelet <code>--allowed-unsafe-sysctls</code>
pada Node tersebut.</div><p>Ini merupakan contoh sysctl <em>unsafe</em> yang diawali dengan <code>kernel.msg</code> yang diperbolehkan dan
sysctl <code>kernel.shm_rmid_forced</code> yang dilarang.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>sysctl-psp<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowedUnsafeSysctls</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- kernel.msg*<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>forbiddenSysctls</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- kernel.shm_rmid_forced<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span>...<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-c4d0832845adc92b7ccd54aed63fc932>4.9 - Mengoperasikan klaster etcd untuk Kubernetes</h1><p><p>etcd adalah penyimpanan <i>key value</i> konsisten yang digunakan sebagai penyimpanan data klaster Kubernetes.</p></p><p>Selalu perhatikan mekanisme untuk mem-<i>backup</i> data etcd pada klaster Kubernetes kamu. Untuk informasi lebih lanjut tentang etcd, lihat <a href=https://etcd.io/docs>dokumentasi etcd</a>.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Jalankan etcd sebagai klaster dimana anggotanya berjumlah ganjil.</p></li><li><p>Etcd adalah sistem terdistribusi berbasis <em>leader</em>. Pastikan <em>leader</em> secara berkala mengirimkan <em>heartbeat</em> dengan tepat waktu ke semua pengikutnya untuk menjaga kestabilan klaster.</p></li><li><p>Pastikan tidak terjadi kekurangan sumber daya.</p><p>Kinerja dan stabilitas dari klaster sensitif terhadap jaringan dan <em>IO disk</em>. Kekurangan sumber daya apa pun dapat menyebabkan <em>timeout</em> dari <em>heartbeat</em>, yang menyebabkan ketidakstabilan klaster. Etcd yang tidak stabil mengindikasikan bahwa tidak ada <em>leader</em> yang terpilih. Dalam keadaan seperti itu, sebuah klaster tidak dapat membuat perubahan apa pun ke kondisi saat ini, yang menyebabkan tidak ada Pod baru yang dapat dijadwalkan.</p></li><li><p>Menjaga kestabilan klaster etcd sangat penting untuk stabilitas klaster Kubernetes. Karenanya, jalankan klaster etcd pada mesin khusus atau lingkungan terisolasi untuk <a href=https://github.com/coreos/etcd/blob/master/Documentation/op-guide/hardware.md#hardware-recommendations>persyaratan sumber daya terjamin</a>.</p></li><li><p>Versi minimum yang disarankan untuk etcd yang dijalankan dalam lingkungan produksi adalah <code>3.2.10+</code>.</p></li></ul><h2 id=persyaratan-sumber-daya>Persyaratan sumber daya</h2><p>Mengoperasikan etcd dengan sumber daya terbatas hanya cocok untuk tujuan pengujian. Untuk peluncuran dalam lingkungan produksi, diperlukan konfigurasi perangkat keras lanjutan. Sebelum meluncurkan etcd dalam produksi, lihat <a href=https://github.com/coreos/etcd/blob/master/Documentation/op-guide/hardware.md#example-hardware-configurations>dokumentasi referensi persyaratan sumber daya</a>.</p><h2 id=memulai-klaster-etcd>Memulai Klaster etcd</h2><p>Bagian ini mencakup bagaimana memulai klaster etcd dalam Node tunggal dan Node multipel.</p><h3 id=klaster-etcd-dalam-node-tunggal>Klaster etcd dalam Node tunggal</h3><p>Gunakan Klaster etcd Node tunggal hanya untuk tujuan pengujian</p><ol><li><p>Jalankan perintah berikut ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./etcd --listen-client-urls<span style=color:#666>=</span>http://<span style=color:#b8860b>$PRIVATE_IP</span>:2379 --advertise-client-urls<span style=color:#666>=</span>http://<span style=color:#b8860b>$PRIVATE_IP</span>:2379
</span></span></code></pre></div></li><li><p>Start server API Kubernetes dengan <em>flag</em> <code>--etcd-servers=$PRIVATE_IP:2379</code>.</p><p>Ganti <code>PRIVATE_IP</code> dengan IP klien etcd kamu.</p></li></ol><h3 id=klaster-etcd-dengan-node-multipel>Klaster etcd dengan Node multipel</h3><p>Untuk daya tahan dan ketersediaan tinggi, jalankan etcd sebagai klaster dengan Node multipel dalam lingkungan produksi dan cadangkan secara berkala. Sebuah klaster dengan lima anggota direkomendasikan dalam lingkungan produksi. Untuk informasi lebih lanjut, lihat <a href=https://github.com/coreos/etcd/blob/master/Documentation/faq.md#what-is-failure-tolerance>Dokumentasi FAQ</a>.</p><p>Mengkonfigurasi klaster etcd baik dengan informasi anggota statis atau dengan penemuan dinamis. Untuk informasi lebih lanjut tentang pengklasteran, lihat <a href=https://github.com/coreos/etcd/blob/master/Documentation/op-guide/clustering.md>Dokumentasi pengklasteran etcd</a>.</p><p>Sebagai contoh, tinjau sebuah klaster etcd dengan lima anggota yang berjalan dengan URL klien berikut: <code>http://$IP1:2379</code>, <code>http://$IP2:2379</code>, <code>http://$IP3:2379</code>, <code>http://$IP4:2379</code>, dan <code>http://$IP5:2379</code>. Untuk memulai server API Kubernetes:</p><ol><li><p>Jalankan perintah berikut ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./etcd --listen-client-urls<span style=color:#666>=</span>http://<span style=color:#b8860b>$IP1</span>:2379, http://<span style=color:#b8860b>$IP2</span>:2379, http://<span style=color:#b8860b>$IP3</span>:2379, http://<span style=color:#b8860b>$IP4</span>:2379, http://<span style=color:#b8860b>$IP5</span>:2379 --advertise-client-urls<span style=color:#666>=</span>http://<span style=color:#b8860b>$IP1</span>:2379, http://<span style=color:#b8860b>$IP2</span>:2379, http://<span style=color:#b8860b>$IP3</span>:2379, http://<span style=color:#b8860b>$IP4</span>:2379, http://<span style=color:#b8860b>$IP5</span>:2379
</span></span></code></pre></div></li><li><p>Start server Kubernetes API dengan flag <code>--etcd-servers=$IP1:2379, $IP2:2379, $IP3:2379, $IP4:2379, $IP5:2379</code>.</p><p>Ganti <code>IP</code> dengan alamat IP klien kamu.</p></li></ol><h3 id=klaster-etcd-dengan-node-multipel-dengan-load-balancer>Klaster etcd dengan Node multipel dengan load balancer</h3><p>Untuk menjalankan penyeimbangan beban (<em>load balancing</em>) untuk klaster etcd:</p><ol><li>Siapkan sebuah klaster etcd.</li><li>Konfigurasikan sebuah <em>load balancer</em> di depan klaster etcd.
Sebagai contoh, anggap saja alamat <em>load balancer</em> adalah <code>$LB</code>.</li><li>Mulai Server API Kubernetes dengan <em>flag</em> <code>--etcd-servers=$LB:2379</code>.</li></ol><h2 id=mengamankan-klaster-etcd>Mengamankan klaster etcd</h2><p>Akses ke etcd setara dengan izin root pada klaster sehingga idealnya hanya server API yang memiliki akses ke etcd. Dengan pertimbangan sensitivitas data, disarankan untuk memberikan izin hanya kepada Node-Node yang membutuhkan akses ke klaster etcd.</p><p>Untuk mengamankan etcd, tetapkan aturan <em>firewall</em> atau gunakan fitur keamanan yang disediakan oleh etcd. Fitur keamanan etcd tergantung pada Infrastruktur Kunci Publik / <em>Public Key Infrastructure</em> (PKI) x509. Untuk memulai, buat saluran komunikasi yang aman dengan menghasilkan pasangan kunci dan sertifikat. Sebagai contoh, gunakan pasangan kunci <code>peer.key</code> dan <code>peer.cert</code> untuk mengamankan komunikasi antara anggota etcd, dan <code>client.key</code> dan <code>client.cert</code> untuk mengamankan komunikasi antara etcd dan kliennya. Lihat <a href=https://github.com/coreos/etcd/tree/master/hack/tls-setup>contoh skrip</a> yang disediakan oleh proyek etcd untuk menghasilkan pasangan kunci dan berkas CA untuk otentikasi klien.</p><h3 id=mengamankan-komunikasi>Mengamankan komunikasi</h3><p>Untuk mengonfigurasi etcd dengan <em>secure peer communication</em>, tentukan <em>flag</em> <code>--peer-key-file=peer.key</code> dan <code>--peer-cert-file=peer.cert</code>, dan gunakan https sebagai skema URL.</p><p>Demikian pula, untuk mengonfigurasi etcd dengan <em>secure client communication</em>, tentukan <em>flag</em> <code>--key-file=k8sclient.key</code> dan <code>--cert-file=k8sclient.cert</code>, dan gunakan https sebagai skema URL.</p><h3 id=membatasi-akses-klaster-etcd>Membatasi akses klaster etcd</h3><p>Setelah konfigurasi komunikasi aman, batasi akses klaster etcd hanya ke server API Kubernetes. Gunakan otentikasi TLS untuk melakukannya.</p><p>Sebagai contoh, anggap pasangan kunci <code>k8sclient.key</code> dan <code>k8sclient.cert</code> dipercaya oleh CA <code>etcd.ca</code>. Ketika etcd dikonfigurasi dengan <code>--client-cert-auth</code> bersama dengan TLS, etcd memverifikasi sertifikat dari klien dengan menggunakan CA dari sistem atau CA yang dilewati oleh <em>flag</em> <code>--trusted-ca-file</code>. Menentukan <em>flag</em> <code>--client-cert-auth=true</code> dan <code>--trusted-ca-file=etcd.ca</code> akan membatasi akses kepada klien yang mempunyai sertifikat <code>k8sclient.cert</code>.</p><p>Setelah etcd dikonfigurasi dengan benar, hanya klien dengan sertifikat yang valid dapat mengaksesnya. Untuk memberikan akses kepada server Kubernetes API, konfigurasikan dengan <em>flag</em> <code>--etcd-certfile=k8sclient.cert</code>,<code>--etcd-keyfile=k8sclient.key</code> dan <code>--etcd-cafile=ca.cert</code>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Otentikasi etcd saat ini tidak didukung oleh Kubernetes. Untuk informasi lebih lanjut, lihat masalah terkait <a href=https://github.com/kubernetes/kubernetes/issues/23398>Mendukung Auth Dasar untuk Etcd v2</a>.</div><h2 id=mengganti-anggota-etcd-yang-gagal>Mengganti anggota etcd yang gagal</h2><p>Etcd klaster mencapai ketersediaan tinggi dengan mentolerir kegagalan dari sebagian kecil anggota. Namun, untuk meningkatkan kesehatan keseluruhan dari klaster, segera ganti anggota yang gagal. Ketika banyak anggota yang gagal, gantilah satu per satu. Mengganti anggota yang gagal melibatkan dua langkah: menghapus anggota yang gagal dan menambahkan anggota baru.</p><p>Meskipun etcd menyimpan ID anggota unik secara internal, disarankan untuk menggunakan nama unik untuk setiap anggota untuk menghindari kesalahan manusia. Sebagai contoh, sebuah klaster etcd dengan tiga anggota. Jadikan URL-nya, member1=http://10.0.0.1, member2=http://10.0.0.2, and member3=http://10.0.0.3. Ketika member1 gagal, ganti dengan member4=http://10.0.0.4.</p><ol><li><p>Dapatkan ID anggota yang gagal dari member1:</p><p><code>etcdctl --endpoints=http://10.0.0.2,http://10.0.0.3 member list</code></p><p>Akan tampil pesan berikut:</p><pre><code> 8211f1d0f64f3269, started, member1, http://10.0.0.1:2380, http://10.0.0.1:2379
 91bc3c398fb3c146, started, member2, http://10.0.0.2:2380, http://10.0.0.2:2379
 fd422379fda50e48, started, member3, http://10.0.0.3:2380, http://10.0.0.3:2379
</code></pre></li><li><p>Hapus anggota yang gagal:</p><p><code>etcdctl member remove 8211f1d0f64f3269</code></p><p>Akan tampil pesan berikut:</p><pre><code>Removed member 8211f1d0f64f3269 from cluster
</code></pre></li><li><p>Tambahkan anggota baru:</p><p><code>./etcdctl member add member4 --peer-urls=http://10.0.0.4:2380</code></p><p>Akan tampil pesan berikut:</p><pre><code>Member 2be1eb8f84b7f63e added to cluster ef37ad9dc622a7c4
</code></pre></li><li><p>Jalankan anggota yang baru ditambahkan pada mesin dengan IP <code>10.0.0.4</code>:</p><pre><code> export ETCD_NAME=&quot;member4&quot;
 export ETCD_INITIAL_CLUSTER=&quot;member2=http://10.0.0.2:2380,member3=http://10.0.0.3:2380,member4=http://10.0.0.4:2380&quot;
 export ETCD_INITIAL_CLUSTER_STATE=existing
 etcd [flags]
</code></pre></li><li><p>Lakukan salah satu dari yang berikut:</p><ol><li>Perbarui <em>flag</em> <code>--etcd-server</code> untuk membuat Kubernetes mengetahui perubahan konfigurasi, lalu start ulang server API Kubernetes.</li><li>Perbarui konfigurasi <em>load balancer</em> jika <em>load balancer</em> digunakan dalam Deployment.</li></ol></li></ol><p>Untuk informasi lebih lanjut tentang konfigurasi ulang klaster, lihat <a href=https://github.com/coreos/etcd/blob/master/Documentation/op-guide/runtime-configuration.md#remove-a-member>Dokumentasi Konfigurasi etcd</a>.</p><h2 id=mencadangkan-klaster-etcd>Mencadangkan klaster etcd</h2><p>Semua objek Kubernetes disimpan dalam etcd. Mencadangkan secara berkala data klaster etcd penting untuk memulihkan klaster Kubernetes di bawah skenario bencana, seperti kehilangan semua Node <em>control plane</em>. Berkas <em>snapshot</em> berisi semua status Kubernetes dan informasi penting. Untuk menjaga data Kubernetes yang sensitif aman, enkripsi berkas <em>snapshot</em>.</p><p>Mencadangkan klaster etcd dapat dilakukan dengan dua cara: <em>snapshot</em> etcd bawaan dan <em>snapshot</em> volume.</p><h3 id=snapshot-bawaan>Snapshot bawaan</h3><p>Fitur <em>snapshot</em> didukung oleh etcd secara bawaan, jadi mencadangkan klaster etcd lebih mudah. <em>Snapshot</em> dapat diambil dari anggota langsung dengan command <code>etcdctl snapshot save</code> atau dengan menyalin <code>member/snap/db</code> berkas dari etcd <a href=https://github.com/coreos/etcd/blob/master/Documentation/op-guide/configuration.md#--data-dir>direktori data</a> yang saat ini tidak digunakan oleh proses etcd. Mengambil <em>snapshot</em> biasanya tidak akan mempengaruhi kinerja anggota.</p><p>Di bawah ini adalah contoh untuk mengambil <em>snapshot</em> dari <em>keyspace</em> yang dilayani oleh <code>$ENDPOINT</code> ke berkas <code>snapshotdb</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#b8860b>ETCDCTL_API</span><span style=color:#666>=</span><span style=color:#666>3</span> etcdctl --endpoints <span style=color:#b8860b>$ENDPOINT</span> snapshot save snapshotdb
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># keluar 0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># memverifikasi hasil snapshot</span>
</span></span><span style=display:flex><span><span style=color:#b8860b>ETCDCTL_API</span><span style=color:#666>=</span><span style=color:#666>3</span> etcdctl --write-out<span style=color:#666>=</span>table snapshot status snapshotdb
</span></span><span style=display:flex><span>+----------+----------+------------+------------+
</span></span><span style=display:flex><span>|   HASH   | REVISION | TOTAL KEYS | TOTAL SIZE |
</span></span><span style=display:flex><span>+----------+----------+------------+------------+
</span></span><span style=display:flex><span>| fe01cf57 |       <span style=color:#666>10</span> |          <span style=color:#666>7</span> | 2.1 MB     |
</span></span><span style=display:flex><span>+----------+----------+------------+------------+
</span></span></code></pre></div><h3 id=snapshot-volume>Snapshot volume</h3><p>Jika etcd berjalan pada volume penyimpanan yang mendukung cadangan, seperti Amazon Elastic Block Store, buat cadangan data etcd dengan mengambil <em>snapshot</em> dari volume penyimpanan.</p><h2 id=memperbesar-skala-dari-klaster-etcd>Memperbesar skala dari klaster etcd</h2><p>Peningkatan skala klaster etcd meningkatkan ketersediaan dengan menukarnya untuk kinerja. Penyekalaan tidak akan meningkatkan kinerja atau kemampuan klaster. Aturan umum adalah untuk tidak melakukan penyekalaan naik atau turun untuk klaster etcd. Jangan mengonfigurasi grup penyekalaan otomatis untuk klaster etcd. Sangat disarankan untuk selalu menjalankan klaster etcd statis dengan lima anggota untuk klaster produksi Kubernetes untuk setiap skala yang didukung secara resmi.</p><p>Penyekalaan yang wajar adalah untuk meningkatkan klaster dengan tiga anggota menjadi dengan lima anggota, ketika dibutuhkan lebih banyak keandalan. Lihat <a href=https://github.com/coreos/etcd/blob/master/Documentation/op-guide/runtime-configuration.md#remove-a-member>Dokumentasi Rekonfigurasi etcd</a> untuk informasi tentang cara menambahkan anggota ke klaster yang ada.</p><h2 id=memulihkan-klaster-etcd>Memulihkan klaster etcd</h2><p>Etcd mendukung pemulihan dari <em>snapshot</em> yang diambil dari proses etcd dari versi <a href=http://semver.org/>major.minor</a>. Memulihkan versi dari versi patch lain dari etcd juga didukung. Operasi pemulihan digunakan untuk memulihkan data klaster yang gagal.</p><p>Sebelum memulai operasi pemulihan, berkas <em>snapshot</em> harus ada. Ini bisa berupa berkas <em>snapshot</em> dari operasi pencadangan sebelumnya, atau dari sisa <a href=https://github.com/coreos/etcd/blob/master/Documentation/op-guide/configuration.md#--data-dir>direktori data</a>. Untuk informasi dan contoh lebih lanjut tentang memulihkan klaster dari berkas <em>snapshot</em>, lihat <a href=https://github.com/coreos/etcd/blob/master/Documentation/op-guide/recovery.md#restoring-a-cluster>dokumentasi pemulihan bencana etcd</a>.</p><p>Jika akses URL dari klaster yang dipulihkan berubah dari klaster sebelumnya, maka server API Kubernetes harus dikonfigurasi ulang sesuai dengan URL tersebut. Pada kasus ini, start kembali server API Kubernetes dengan <em>flag</em> <code>--etcd-servers=$NEW_ETCD_CLUSTER</code> bukan <em>flag</em> <code>--etcd-servers=$OLD_ETCD_CLUSTER</code>. Ganti <code>$NEW_ETCD_CLUSTER</code> dan <code>$OLD_ETCD_CLUSTER</code> dengan alamat IP masing-masing. Jika <em>load balancer</em> digunakan di depan klaster etcd, kamu mungkin hanya perlu memperbarui <em>load balancer</em> sebagai gantinya.</p><p>Jika mayoritas anggota etcd telah gagal secara permanen, klaster etcd dianggap gagal. Dalam skenario ini, Kubernetes tidak dapat membuat perubahan apa pun ke kondisi saat ini. Meskipun Pod terjadwal mungkin terus berjalan, tidak ada Pod baru yang bisa dijadwalkan. Dalam kasus seperti itu, pulihkan klaster etcd dan kemungkinan juga untuk mengonfigurasi ulang server API Kubernetes untuk memperbaiki masalah ini.</p><h2 id=memutakhirkan-dan-memutar-balikan-klaster-etcd>Memutakhirkan dan memutar balikan klaster etcd</h2><p>Pada Kubernetes v1.13.0, etcd2 tidak lagi didukung sebagai <em>backend</em> penyimpanan untuk klaster Kubernetes baru atau yang sudah ada. <em>Timeline</em> untuk dukungan Kubernetes untuk etcd2 dan etcd3 adalah sebagai berikut:</p><ul><li>Kubernetes v1.0: hanya etcd2</li><li>Kubernetes v1.5.1: dukungan etcd3 ditambahkan, standar klaster baru yang dibuat masih ke etcd2</li><li>Kubernetes v1.6.0: standar klaster baru yang dibuat dengan <code>kube-up.sh</code> adalah etcd3,
dan <code>kube-apiserver</code> standarnya ke etcd3</li><li>Kubernetes v1.9.0: pengumuman penghentian <em>backend</em> penyimpanan etcd2 diumumkan</li><li>Kubernetes v1.13.0: <em>backend</em> penyimpanan etcd2 dihapus, <code>kube-apiserver</code> akan
menolak untuk start dengan <code>--storage-backend=etcd2</code>, dengan pesan
<code>etcd2 is no longer a supported storage backend</code></li></ul><p>Sebelum memutakhirkan v1.12.x kube-apiserver menggunakan <code>--storage-backend=etcd2</code> ke
v1.13.x, data etcd v2 harus dimigrasikan ke <em>backend</em> penyimpanan v3 dan
permintaan kube-apiserver harus diubah untuk menggunakan <code>--storage-backend=etcd3</code>.</p><p>Proses untuk bermigrasi dari etcd2 ke etcd3 sangat tergantung pada bagaimana
klaster etcd diluncurkan dan dikonfigurasi, serta bagaimana klaster Kubernetes diluncurkan dan dikonfigurasi. Kami menyarankan kamu berkonsultasi dengan dokumentasi penyedia kluster kamu untuk melihat apakah ada solusi yang telah ditentukan.</p><p>Jika klaster kamu dibuat melalui <code>kube-up.sh</code> dan masih menggunakan etcd2 sebagai penyimpanan <em>backend</em>, silakan baca <a href=https://v1-12.docs.kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#upgrading-and-rolling-back-etcd-clusters>Kubernetes v1.12 etcd cluster upgrade docs</a></p><h2 id=masalah-umum-penyeimbang-klien-etcd-dengan-secure-endpoint>Masalah umum: penyeimbang klien etcd dengan <em>secure endpoint</em></h2><p>Klien etcd v3, dirilis pada etcd v3.3.13 atau sebelumnya, memiliki <a href=https://github.com/kubernetes/kubernetes/issues/72102><em>critical bug</em></a> yang mempengaruhi kube-apiserver dan penyebaran HA. Pemindahan kegagalan (<em>failover</em>) penyeimbang klien etcd tidak bekerja dengan baik dengan <em>secure endpoint</em>. Sebagai hasilnya, server etcd boleh gagal atau terputus sesaat dari kube-apiserver. Hal ini mempengaruhi peluncuran HA dari kube-apiserver.</p><p>Perbaikan dibuat di <a href=https://github.com/etcd-io/etcd/pull/10911>etcd v3.4</a> (dan di-backport ke v3.3.14 atau yang lebih baru): klien baru sekarang membuat bundel kredensial sendiri untuk menetapkan target otoritas dengan benar dalam fungsi dial.</p><p>Karena perbaikan tersebut memerlukan pemutakhiran dependensi dari gRPC (ke v1.23.0), <em>downstream</em> Kubernetes <a href=https://github.com/kubernetes/kubernetes/issues/72102#issuecomment-526645978>tidak mendukung upgrade etcd</a>, yang berarti <a href=https://github.com/etcd-io/etcd/pull/10911/commits/db61ee106ca9363ba3f188ecf27d1a8843da33ab>perbaikan etcd di kube-apiserver</a> hanya tersedia mulai Kubernetes 1.16.</p><p>Untuk segera memperbaiki celah keamanan (<em>bug</em>) ini untuk Kubernetes 1.15 atau sebelumnya, buat kube-apiserver khusus. kamu dapat membuat perubahan lokal ke <a href=https://github.com/kubernetes/kubernetes/blob/7b85be021cd2943167cd3d6b7020f44735d9d90b/vendor/google.golang.org/grpc/credentials/credentials.go#L135><code>vendor/google.golang.org/grpc/credentials/credentials.go</code></a> dengan <a href=https://github.com/etcd-io/etcd/pull/10911/commits/db61ee106ca9363ba3f188ecf27d1a8843da33ab>etcd@db61ee106</a>.</p><p>Lihat <a href=https://github.com/kubernetes/kubernetes/issues/72102>"kube-apiserver 1.13.x menolak untuk bekerja ketika server etcd pertama tidak tersedia"</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-aa0731e8aa8e2f6cc9e3c1a5e9895863>5 - Mengelola Objek Kubernetes</h1><div class=lead>Paradigma deklaratif dan imperatif untuk berinteraksi dengan API Kubernetes.</div></div><div class=td-content><h1 id=pg-df206392be6f4d19bd8da41cee7170fa>5.1 - Pengelolaan Objek Kubernetes secara Deklaratif dengan Menggunakan Berkas Konfigurasi</h1><p>Objek-objek Kubernetes dapat dibuat, diperbarui, dan dihapus dengan menjalankan perintah <code>kubectl apply</code> terhadap file-file konfigurasi objek yang disimpan dalam sebuah direktori secara rekursif sesuai dengan kebutuhan. Perintah <code>kubectl diff</code> bisa digunakan untuk menampilkan pratinjau tentang perubahan apa saja yang akan dibuat oleh perintah <code>kubectil apply</code>.</p><h2 id=kelebihan-dan-kekurangan>Kelebihan dan kekurangan</h2><p>Perintah <code>kubectl</code> memungkinkan tiga cara untuk mengelola objek:</p><ul><li>Perintah imperatif</li><li>Konfigurasi objek imperatif</li><li>Konfigurasi objek deklaratif</li></ul><p>Lihat <a href=/id/docs/concepts/overview/working-with-objects/object-management/>Pengelolaan Objek Kubernetes</a> untuk menyimak diskusi mengenai kelebihan dan kekurangan dari tiap cara pengelolaan objek.</p><h2 id=sebelum-kamu-mulai>Sebelum kamu mulai</h2><p>Konfigurasi objek secara deklaratif membutuhkan pemahaman yang baik
tentang definisi dan konfigurasi objek-objek Kubernetes. Jika belum pernah, kamu disarankan untuk membaca terlebih dulu dokumen-dokumen berikut:</p><ul><li><a href=/id/docs/tasks/manage-kubernetes-objects/imperative-command/>Pengelolaan Objek Kubernetes Menggunakan Perintah Imperatif</a></li><li><a href=/id/docs/tasks/manage-kubernetes-objects/imperative-config/>Pengelolaan Objek Kubernetes Menggunakan Berkas Konfigurasi Imperatif</a></li></ul><p>Berikut adalah beberapa defnisi dari istilah-istilah yang digunakan
dalam dokumen ini:</p><ul><li><em>objek berkas konfigurasi / berkas konfigurasi</em>: Sebuah <em>file</em> yang
mendefinisikan konfigurasi untuk sebuah objek Kubernetes. Dokumen ini akan memperlihatkan cara menggunakan <em>file</em> konfigurasi dengan perintah <code>kubectl apply</code>. <em>File-file</em> konfigurasi biasanya disimpan di sebuah <em>source control</em> seperti Git.</li><li><em>konfigurasi objek live / konfigurasi live</em>: nilai konfigurasi <em>live</em> dari sebuah objek, sebagaimana yang tersimpan di klaster Kubernetes. Nilai-nilai ini disimpan di <em>storage</em> klaster Kubernetes, biasanya etcd.</li><li><em>writer konfigurasi deklaratif / writer deklaratif</em>: Seseorang atau sebuah komponen perangkat lunak yang membuat pembaruan ke objek <em>live</em>. <em>Live writer</em> yang disebut pada dokumen ini adalah <em>writer</em> yang membuat perubahan terhadap <em>file</em> konfigurasi objek dan menjalankan perintah <code>kubectl apply</code> untuk menulis perubahan-perubahan tersebut.</li></ul><h2 id=cara-membuat-objek>Cara membuat objek</h2><p>Gunakan perintah <code>kubectl apply</code> untuk membuat semua objek, kecuali objek-objek yang sudah ada sebelumnya, yang didefinisikan di <em>file-file</em> konfigurasi dalam direktori yang ditentukan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f &lt;directory&gt;/
</span></span></code></pre></div><p>Perintah di atas akan memberi anotasi <code>kubectl.kubernetes.io/last-applied-configuration: '{...}'</code> pada setiap objek yang dibuat. Anotasi ini berisi konten dari <em>file</em> konfigurasi objek yang digunakan untuk membuat objek tersebut.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Tambahkan parameter <code>-R</code> untuk memproses seluruh direktori secara rekursif.</div><p>Berikut sebuah contoh <em>file</em> konfigurasi objek:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/simple_deployment.yaml download=application/simple_deployment.yaml><code>application/simple_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-simple-deployment-yaml")' title="Copy application/simple_deployment.yaml to clipboard"></img></div><div class=includecode id=application-simple-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Jalankan perintah <code>kubectl diff</code> untuk menampilkan objek yang akan dibuat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl diff -f https://k8s.io/examples/application/simple_deployment.yaml
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Perintah <code>diff</code> menggunakan <a href=/docs/reference/using-api/api-concepts/#dry-run><em>server-side dry-run</em></a>, yang perlu diaktifkan di <code>kube-apiserver</code>.</div><p>Buat objek dengan perintah <code>kubectl apply</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/simple_deployment.yaml
</span></span></code></pre></div><p>Tampilkan konfigurasi <em>live</em> dengan perintah <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f https://k8s.io/examples/application/simple_deployment.yaml -o yaml
</span></span></code></pre></div><p>Keluaran perintah di atas akan menunjukkan bahwa anotasi <code>kubectl.kubernetes.io/last-applied-configuration</code> sudah dituliskan ke konfigurasi <em>live</em>, dan anotasi tersebut sesuai dengan <em>file</em> konfigurasi:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Ini merupakan representasi dari simple_deployment.yaml dalam format json</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Ini ditulis oleh perintah `kubectl apply` ketika objek dibuat</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;minReadySeconds&#34;:5,&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.7.9&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=cara-memperbarui-objek>Cara memperbarui objek</h2><p>Kamu juga bisa menggunakan <code>kubectl apply</code> untuk memperbarui semua objek yang didefinisikan dalam sebuah direktori, termasuk objek-objek yang sudah ada sebelumnya. Cara ini akan melakukan hal-hal berikut:</p><ol><li>Menyimpan nilai <em>field-field</em> yang ada di <em>file</em> konfigurasi ke konfigurasi <em>live</em>.</li><li>Menghapus <em>field-field</em> yang dihapus di <em>file</em> konfigurasi dari konfigurasi <em>live</em>.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl diff -f &lt;directory&gt;/
</span></span><span style=display:flex><span>kubectl apply -f &lt;directory&gt;/
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Tambahkan argumen <code>-R</code> untuk memproses seluruh direktori secara rekursif.</div><p>Berikut sebuah contoh <em>file</em> konfigurasi:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/simple_deployment.yaml download=application/simple_deployment.yaml><code>application/simple_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-simple-deployment-yaml")' title="Copy application/simple_deployment.yaml to clipboard"></img></div><div class=includecode id=application-simple-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buat objek dengan perintah <code>kubectl apply</code>::</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/simple_deployment.yaml
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Untuk keperluan ilustrasi, perintah berikut merujuk ke satu <em>file</em> konfigurasi alih-alih ke satu direktori.</div><p>Tampilkan konfigurasi <em>live</em> dengan perintah <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f https://k8s.io/examples/application/simple_deployment.yaml -o yaml
</span></span></code></pre></div><p>Keluaran perintah di atas akan menunjukkan bahwa anotasi <code>kubectl.kubernetes.io/last-applied-configuration</code> sudah dituliskan ke konfigurasi <em>live</em>, dan anotasi tersebut sesuai dengan <em>file</em> konfigurasi:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Berikut merupakan representasi dari simple_deployment.yaml dalam format json</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Representasi berikut ditulis oleh perintah kubectl apply ketika objek dibuat</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;minReadySeconds&#34;:5,&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.7.9&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Perbarui nilai <code>replicas</code> secara langsung di konfigurasi <code>live</code> dengan menggunakan perintah <code>kubectl scale</code>. Pembaruan ini tidak menggunakan perintah <code>kubectl apply</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl scale deployment/nginx-deployment --replicas<span style=color:#666>=</span><span style=color:#666>2</span>
</span></span></code></pre></div><p>Tampilkan konfigurasi <em>live</em> dengan perintah <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f https://k8s.io/examples/application/simple_deployment.yaml -o yaml
</span></span></code></pre></div><p>Keluaran perintah di atas akan menunjukkan bahwa nilai <code>replicas</code> telah diubah menjadi 2, dan anotasi <code>last-applied-configuration</code> tidak memuat nilai <code>replicas</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># perhatikan bahwa anotasi tidak memuat nilai replicas</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># karena nilai tersebut tidak diperbarui melalui perintah kubectl-apply</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;minReadySeconds&#34;:5,&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.7.9&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># ditulis oleh perintah kubectl scale</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Perbarui <em>file</em> konfigurasi <code>simple_deployment.yaml</code>, ubah <em>image</em> dari <code>nginx:1.7.9</code> ke <code>nginx:1.11.9</code>, dan hapus <em>field</em> <code>minReadySeconds</code>:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/update_deployment.yaml download=application/update_deployment.yaml><code>application/update_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-update-deployment-yaml")' title="Copy application/update_deployment.yaml to clipboard"></img></div><div class=includecode id=application-update-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.11.9<span style=color:#bbb> </span><span style=color:#080;font-style:italic># perbarui image</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Terapkan perubahan yang telah dibuat di <em>file</em> konfigurasi:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl diff -f https://k8s.io/examples/application/update_deployment.yaml
</span></span><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/update_deployment.yaml
</span></span></code></pre></div><p>Tampilkan konfigurasi <em>live</em> dengan perintah <code>kubectl get</code>:</p><pre tabindex=0><code>kubectl get -f https://k8s.io/examples/application/simple_deployment.yaml -o yaml
</code></pre><p>Keluaran perintah di atas akan menunjukkan perubahan-perubahan berikut pada konfiguasi <em>live</em>:</p><ul><li><em>Field</em> <code>replicas</code> tetap bernilai 2 sesuai dengan nilai yang diatur oleh perintah <code>kubectl scale</code>. Hal ini karena <em>field</em> <code>replicas</code> dihapuskan dari <em>file</em> konfigurasi.</li><li>Nilai <em>field</em> <code>image</code> telah diperbarui menjadi <code>nginx:1.11.9</code> dari <code>nginx:1.7.9</code>.</li><li>Anotasi <code>last-applied-configuration</code> telah diperbari dengan <em>image</em> terbaru.</li><li><em>Field</em> <code>minReadySeconds</code> telah dihapus.</li><li>Anotasi <code>last-applied-configuration</code> tidak lagi memuat <em>field</em> <code>minReadySeconds</code>.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Anotasi memuat image yang telah diperbarui ke nginx 1.11.9,</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># tetapi tidak memuat nilai replica yang telah diperbarui menjadi 2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.11.9&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Diatur oleh `kubectl scale`, tidak diubah oleh `kubectl apply`.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># minReadySeconds dihapuskan oleh `kubectl apply`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.11.9<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Diatur oleh `kubectl apply`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Mencampur perintah <code>kubectl apply</code> dengan perintah imperatif untuk konfigurasi objek seperti <code>create</code> dan <code>replace</code> tidak dimungkinkan. Hal ini karena <code>create</code> dan <code>replace</code> tidak menyimpan anotasi <code>kubectl.kubernetes.io/last-applied-configuration</code> yang diperlukan oleh <code>kubectl aplly</code> untuk melakukan pembaruan.</div><h2 id=cara-menghapus-objek>Cara menghapus objek</h2><p>Ada dua cara untuk menghapus objek-objek yang dikelola dengan <code>kubectl apply</code>.</p><h3 id=rekomendasi-kubectl-delete-f-filename>Rekomendasi: <code>kubectl delete -f &lt;filename></code></h3><p>Penghapusan objek secara manual dengan menggunakan perintah imperatif merupakan cara yang direkomendasikan karena lebih eksplisit dalam menentukan objek apa yang akan dihapus dan lebih kecil kemungkinannya untuk pengguna menghapus objek lain secara tidak sengaja:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete -f &lt;filename&gt;
</span></span></code></pre></div><h3 id=alternatif-kubectl-apply-f-directory-prune-l-your-label>Alternatif: <code>kubectl apply -f &lt;directory/> --prune -l your=label</code></h3><p>Lakukan ini hanya jika kamu benar-benar mengetahui apa yang kamu lakukan.</p><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Perintah <code>kubectl apply --prune</code> masih dalam versi alpha dan perubahan-perubahan yang tidak memiliki kompatibilitas dengan versi sebelumnya mungkin akan diperkenalkan pada rilis-rilis berikutnya.</div><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Kamu harus berhati-hati ketika menggunakan perintah ini agar kamu tidak menghapus objek-objek lain secara tak sengaja.</div><p>Sebagai alternatif dari <code>kubectl delete</code>, kamu bisa menggunakan <code>kubectl apply</code> untuk mengidentifikasi objek-objek yang hendak dihapus setelah berkas konfigurasi objek-objek tersebut dihapus dari direktori. Ketika dijalankan dengan argumen <code>--prune</code>, perintah <code>kubectl apply</code> akan melakukan <em>query</em> ke <em>API server</em> untuk mencari semua objek yang sesuai dengan himpunan label-label tertentu, dan berusaha untuk mencocokkan kofigurasi objek <em>live</em> yg diperoleh terhadap <em>file</em> konfigurasi objek. Jika sebuah objek cocok dengan <em>query</em> yang dilakukan, dan objek tersebut tidak memiliki <em>file</em> konfigurasi di direktori serta tidak memiliki anotasi <code>last-applied-configuration</code>, objek tersebut akan dihapus.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f &lt;directory/&gt; --prune -l &lt;labels&gt;
</span></span></code></pre></div><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Perintah <code>kubectl apply</code> dengan argumen <code>--prune</code> sebaiknya hanya dijalankan terhadap direktori <em>root</em> yang berisi <em>file-file</em> konfigurasi objek. Menjalankan perintah tadi terhadap sub direktori bisa menyebabkan terhapusnya objek-objek lain secara tidak disengaja jika objek-objek tersebut memenuhi kriteria selektor label yang dispesifikasikan oleh argumen <code>-l &lt;label></code> dan tidak muncul di sub direktori.</div><h2 id=cara-melihat-objek>Cara melihat objek</h2><p>Kamu bisa menggunakan perintah <code>kubectl get</code> dengan parameter <code>-o yaml</code> untuk melihat konfigurasi dari sebuah objek <em>live</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f &lt;filename|url&gt; -o yaml
</span></span></code></pre></div><h2 id=cara-kubectl-apply-menghitung-perbedaan-dan-menggabungkan-perubahan>Cara <code>kubectl apply</code> menghitung perbedaan dan menggabungkan perubahan</h2><div class="alert alert-warning caution callout" role=alert><strong>Perhatian:</strong> <em>Patch</em> adalah operasi pembaruan yang lingkupnya spesifik terhadap sejumlah <em>field</em> dari sebuah objek alih-alih terhadap keseluruhan objek. <em>Patch</em> memungkinkan pembaruan terhadap himpunan <em>field</em> yang spesifik tanpa harus membaca keseluruhan objek terlebih dulu.</div><p>Ketika memperbarui konfigurasi <em>live</em> dari sebuah objek, <code>kubectl apply</code> melakukannya dengan mengirimkan <em>request</em> untuk melakukan <em>patch</em> ke <em>API server</em>. <em>Patch</em> mendefinisikan pembaruan-pembaruan yang likungpnya sepsifik terhadap sejumlah <em>field</em> dari objek konfigurasi <em>live</em>. Perintah <code>kubectl apply</code> menghitung <em>patch request</em> ini menggunakan <em>file</em> konfigurasi, konfigurasi <em>live</em>, dan anotasi <code>last-applied-configuration</code> yang tersimpan di konfigurasi <em>live</em>.</p><h3 id=perhitungan-penggabungan-patch>Perhitungan penggabungan <em>patch</em></h3><p>Perintah <code>kubectl apply</code> menulis konten dari berkas konfigurasi ke anotasi <code>kubectl.kubernetes.io/last-applied-configuration</code>. Ini digunakan untuk mengidentifikasi <em>field</em> apa saja yang telah dihapus dari <em>file</em> konfigurasi dan perlu dihapus dari konfigurasi <em>live</em>. Berikut adalah langkah-langkah yang digunakan untuk menghitung <em>field</em> apa saja yang harus dihapus atau diubah:</p><ol><li>Hitung <em>field-field</em> yang perlu dihapus. Ini mencakup <em>field-field</em> yang ada di <code>last-applied-configuration</code> tapi tidak ada di <em>file</em> konfigurasi.</li><li>Hitung <em>field-field</em> yang perlu ditambah atau diubah. Ini mencakup <em>field-field</em> yang ada di <em>file</em> konfigurasi yang nilainya tidak sama dengan konfigurasi <em>live</em>.</li></ol><p>Agar lebih jelas, simak contoh berikut. Misalkan, berikut adalah <em>file</em> konfigurasi untuk sebuah objek Deployment:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/update_deployment.yaml download=application/update_deployment.yaml><code>application/update_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-update-deployment-yaml")' title="Copy application/update_deployment.yaml to clipboard"></img></div><div class=includecode id=application-update-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.11.9<span style=color:#bbb> </span><span style=color:#080;font-style:italic># perbarui image</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Juga, misalkan, berikut adalah konfigurasi <em>live</em> dari objek Deployment yang sama:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># perhatikan bagaimana anotasi berikut tidak memuat replicas</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># karena replicas tidak diperbarui melalui perintah kubectl apply</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;minReadySeconds&#34;:5,&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.7.9&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># ditulis oleh perintah kubectl scale</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Berikut merupakan perhitungan penggabungan yang akan dilakukan oleh perintah <code>kubectl apply</code>:</p><ol><li>Hitung semua <em>field</em> yang akan dihapus dengan membaca nilai dari <code>last-applied-configuration</code> dan membandingkannya dengan nilai yang ada di <em>file</em> konfigurasi. Hapus semua <em>field</em> yang nilainya secara eksplisit diubah menjadi null pada <em>file</em> konfigurasi objek lokal terlepas dari apakah <em>field-field</em> tersebut ada di anotasi <code>last-applied-configuration</code> atau tidak. Pada contoh di atas, <em>field</em> <code>minReadySeconds</code> muncul pada anotasi <code>last-applied-configuration</code>, tapi tidak ada di <em>file</em> konfigurasi. <strong>Aksi:</strong> Hapus <code>minReadySeconds</code> dari konfigurasi <em>live</em>.</li><li>Hitung semua <em>field</em> yang akan diubah dengan membaca nilai-nilai dari <em>file</em> konfigurasi dan membandingkannya dengan nilai-nilai yang ada di konfigurasi <em>live</em>. Pada contoh ini, nilai dari <em>field</em> <code>image</code> di <em>file</em> konfigurasi tidak sama dengan nilai dari konfigurasi <em>live</em>. <strong>Aksi:</strong> Ubah nilai <code>image</code> pada konfigurasi <em>live</em>.</li><li>Ubah anotasi <code>last-applied-configuration</code> agar sesuai dengan nilai yang ada di <em>file</em> konfigurasi.</li><li>Gabungkan hasil-hasil dari langkah 1, 2, dan 3 ke dalam satu <em>patch request</em> ke <em>API server</em>.</li></ol><p>Berikut konfigurasi <em>live</em> yang dihasilkan oleh proses penggabungan pada contoh di atas:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Anotasi memuat pembaruan image menjadi nginx 1.11.9,</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># tetapi tidak memuat pembaruan replicas menjadi 2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubectl.kubernetes.io/last-applied-configuration</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-deployment&#34;,&#34;namespace&#34;:&#34;default&#34;},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;selector&#34;:{&#34;matchLabels&#34;:{&#34;app&#34;:nginx}},&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;spec&#34;:{&#34;containers&#34;:[{&#34;image&#34;:&#34;nginx:1.11.9&#34;,&#34;name&#34;:&#34;nginx&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      &#34;ports&#34;:[{&#34;containerPort&#34;:80}]}]}}}}</span><span style=color:#bbb>      
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Diubah oleh `kubectl scale`, tidak diubah oleh `kubectl apply`.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># minReadySeconds dihapus oleh `kubectl apply`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.11.9<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Diubah oleh `kubectl apply`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=cara-penggabungan-tipe-tipe-field-yang-berbeda>Cara penggabungan tipe-tipe <em>field</em> yang berbeda</h3><p>Cara sebuah <em>field</em> terentu dalam sebuah <em>file</em> konfigurasi digabungkan dengan konfigurasi <em>live</em> bergantung pada tipe <em>field</em> tersebut. Ada beberapa tipe <em>field</em>:</p><ul><li><p><em>primitif</em>: <em>field</em> yang bertipe string, integer, atau boolean. Sebagai contoh, <code>image</code> dan <code>replicas</code> termasuk sebagai <em>field</em> primitif. <strong>Aksi:</strong> <em>Replace</em>.</p></li><li><p><em>map</em>, atau <em>objek</em>: <em>field</em> yang bertipe <em>map</em> atau tipe kompleks yang mengandung sub <em>field</em>. Sebagai contoh, <code>labels</code>, <code>annotations</code>, <code>spec</code>, dan <code>metadata</code> termasuk sebagai map. <strong>Aksi</strong>: Lakukan penggabungan tiap-tiap elemen atau sub <em>field</em>.</p></li><li><p><em>list</em>: <em>field</em> yang berisi sejumlah item yang tiap itemnya bisa berupa tipe primitif maupun map. Sebagai contoh, <code>containers</code>, <code>ports</code>, dan <code>args</code> termasuk sebagai <em>list</em>. <strong>Aksi:</strong> Bervariasi.</p></li></ul><p>Ketika digunakan untuk memperbarui sebuah <em>field</em> bertipe <em>map</em> atau <em>list</em>, perintah <code>kubectl apply</code> memperbarui nilai tiap-tiap sub elemen ketimbang mengganti nilai semua <em>field</em>. Misalnya, ketika menggabungkan <em>field</em> <code>spec</code> pada sebuah Deployment, bukan keseluruhan <em>field</em> <code>spec</code> yang diubah nilainya. Alih-alih, sub <em>field</em> dari <code>spec</code> seperti <code>replicas</code> yang kemudian dibandingkan nilainya dan digabungkan.</p><h3 id=menggabungkan-perubahan-pada-field-primitif>Menggabungkan perubahan pada <em>field</em> primitif</h3><p><em>Field</em> primitif diganti nilainya atau dihapus sama sekali.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> <code>-</code> digunakan untuk menandai sebuah nilai "<em>not applicable</em>" karena nilai tersebut tidak digunakan.</div><table><thead><tr><th><em>Field</em> pada <em>file</em> konfigurasi objek</th><th><em>Field</em> pada objek konfigurasi <em>live</em></th><th><em>Field</em> pada <em>last-applied-configuration</em></th><th>Aksi</th></tr></thead><tbody><tr><td>Ya</td><td>Ya</td><td>-</td><td>Ubah nilai di konfigurasi <em>live</em> mengikuti nilai pada <em>file</em> konfigurasi.</td></tr><tr><td>Ya</td><td>Tidak</td><td>-</td><td>Ubah nilai di konfigurasi <em>live</em> mengikuti nilai pada konfigurasi lokal.</td></tr><tr><td>Tidak</td><td>-</td><td>Ya</td><td>Hapus dari konfigurasi <em>live</em>.</td></tr><tr><td>Tidak</td><td>-</td><td>Tidak</td><td>Tidak melakukan apa-apa, pertahankan nilai konfigurasi <em>live</em>.</td></tr></tbody></table><h3 id=menggabungkan-perubahan-pada-field-bertipe-map>Menggabungkan perubahan pada <em>field</em> bertipe <em>map</em></h3><p><em>Field</em> yang bertipe <em>map</em> digabungkan dengan membandingkan tiap sub <em>field</em> atau elemen dari map:</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> <code>-</code> digunakan untuk menandai sebuah nilai "<em>not applicable</em>" karena nilai tersebut tidak digunakan.</div><table><thead><tr><th><em>Key</em> pada <em>file</em> konfigurasi objek</th><th><em>Key</em> pada objek konfigurasi <em>live</em></th><th><em>Field</em> pada <em>last-applied-configuration</em></th><th>Aksi</th></tr></thead><tbody><tr><td>Ya</td><td>Ya</td><td>-</td><td>Bandingkan nilai tiap sub <em>field</em>.</td></tr><tr><td>Ya</td><td>Tidak</td><td>-</td><td>Ubah nilai pada konfigurasi <em>live</em> mengikuti nilai pada konfigurasi lokal.</td></tr><tr><td>Tidak</td><td>-</td><td>Ya</td><td>Hapus dari konfigurasi <em>live</em>.</td></tr><tr><td>Tidak</td><td>-</td><td>Tidak</td><td>Tidak melakukan apa-apa, pertahankan nilai konfigurasi <em>live</em>.</td></tr></tbody></table><h3 id=menggabungkan-perubahan-pada-field-yang-bertipe-list>Menggabungkan perubahan pada <em>field</em> yang bertipe <em>list</em></h3><p>Penggabungan perubahan pada sebuah <em>list</em> bisa menggunakan salah satu dari tiga strategi:</p><ul><li>Ganti nilai keseluruhan <em>list</em>.</li><li>Gabungkan nilai tiap-tiap elemen di dalam sebuah list yang elemennya kompleks.</li><li>Gabungkan list yang elemennya primitif.</li></ul><p>Pilihan strategi dibuat berbeda-beda bergantung tipe tiap <em>field</em>.</p><h4 id=ganti-nilai-keseluruhan-list>Ganti nilai keseluruhan <em>list</em></h4><p>Perlakukan <em>list</em> sama dengan <em>field</em> primitif. Ganti atau hapus keseluruhan list. Ini akan menjaga urutan dari list.</p><p><strong>Contoh:</strong> Gunakan <code>kubectl apply</code> untuk memperbarui <em>field</em> <code>args</code> pada sebuah kontainer di dalam sebuah <em>pod</em>. Ini akan mengubah nilai <code>args</code> di konfigurasi <em>live</em> mengikuti nilai di <em>file</em> konfigurasi. Elemen <code>args</code> apapun yang sebelumnya ditambahkan ke konfigurasi <em>live</em> akan hilang. Urutan dari elemen-elemen <code>args</code> yang didefinisikan di <em>file</em> konfigurasi akan dipertahankan ketika ditulis ke konfigurasi <em>live</em>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#080;font-style:italic># nilai last-applied-configuration*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;a&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;b&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># nilai berkas konfigurasi</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;a&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;c&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># nilai konfigurasi live</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;a&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;b&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;d&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># hasil setelah penggabungan</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;a&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;c&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>Penjelasan:</strong> Penggabungan menggunakan nilai pada <em>file</em> konfigurasi sebagai nilai baru untuk <em>list</em> <code>args</code>.</p><h4 id=menggabungkan-tiap-tiap-elemen-dari-sebuah-list-dengan-elemen-kompleks>Menggabungkan tiap-tiap elemen dari sebuah <em>list</em> dengan elemen kompleks:</h4><p>Perlakukan <em>list</em> selayaknya sebuah <em>map</em>, perlakukan <em>field</em> spesifik dari tiap element sebagai sebuah <em>key</em>. Tambah, hapus, atau perbarui tiap-tiap elemen. Operasi ini tidak mempertahankan urutan elemen di dalam <em>list</em>.</p><p>Strategi penggabungan ini menggunakan <em>tag</em> khusus <code>patchMergeKey</code> pada tiap <em>field</em>. <em>Tag</em> <code>patchMergeKey</code> didefinisikan untuk tiap <em>field</em> pada <em>source code</em> Kubernetes: <a href=https://github.com/kubernetes/api/blob/d04500c8c3dda9c980b668c57abc2ca61efcf5c4/core/v1/types.go#L2747>types.go</a>. Ketika menggabungkan sebuah <em>list</em> yang berisi <em>map</em>, <em>field</em> yang dispesifikasikan sebagai <code>patchMergeKey</code> untuk tiap elemen digunakan sebagai <em>map key</em> untuk elemen tersebut.</p><p><strong>Contoh:</strong> Gunakan <code>kubectl apply</code> untuk memperbarui <em>field</em> <code>containers</code> pada sebuah PodSpec. Perintah ini akan menggabungkan <em>list</em> <code>containers</code> seolah-olah <em>list</em> tersebut adalah sebuah <em>map</em> dan tiap elemennya menggunakan <code>name</code> sebagai <em>key</em>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#080;font-style:italic># nilai last-applied-configuration</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.10<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name: nginx-helper-a # key</span>:<span style=color:#bbb> </span>nginx-helper-a; akan dihapus pada hasil akhir<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name: nginx-helper-b # key</span>:<span style=color:#bbb> </span>nginx-helper-b; akan dipertahankan pada hasil akhir<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># nilai berkas konfigurasi</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.10<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name: nginx-helper-c # key</span>:<span style=color:#bbb> </span>nginx-helper-c; akan ditambahkan pada hasil akhir<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># konfigurasi live</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.10<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-a<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;run&#34;</span>]<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Field ini akan dipertahankan pada hasil akhir</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name: nginx-helper-d # key</span>:<span style=color:#bbb> </span>nginx-helper-d; akan dipertahankan pada hasil akhir<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># hasil akhir setelah penggabungan</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.10<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># Elemen nginx-helper-a dihapus</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;run&#34;</span>]<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Field dipertahankan</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-c<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Elemen ditambahkan</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-helper-d<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Elemen tidak diubah</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>helper:1.3<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>Penjelasan:</strong></p><ul><li>Kontainer dengan nama "nginx-helper-a" dihapus karena tidak ada kontainer dengan nama tersebut di <em>file</em> konfigurasi.</li><li>Kontainer dengan nama "nginx-helper-b" tetap mempertahankan nilai <code>args</code> pada konfigurasi <em>live</em>. Perintah <code>kubectl apply</code> bisa mengenali bahwa "nginx-helper-b" di konfigurasi <em>live</em> sama dengan "ngnix-helper-b" di <em>file</em> konfigurasi, meskipun keduanya memiliki <em>field</em> yang berbeda (tidak ada <code>args</code> pada <em>file</em> konfigurasi). Ini karena nilai <code>patchMergeKey</code> di kedua konfigurasi identik.</li><li>Kontainer dengan nama "nginx-helper-c" ditambahkan karena tidak ada kontainer dengan nama tersebut di konfigurasi <em>live</em>, tapi ada di <em>file</em> konfigurasi.</li><li>Kontainer dengan nama "nginx-helper-d" dipertahankan karena tidak ada elemen dengan nama tersebut pada <em>last-applied-configuration</em>.</li></ul><h4 id=menggabungkan-sebuah-list-dengan-elemen-elemen-primitif>Menggabungkan sebuah <em>list</em> dengan elemen-elemen primitif</h4><p>Pada versi Kubernetes 1.5, penggabungan list dengan elemen-elemen primitif tidak lagi didukung.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Strategi mana yang dipilih untuk sembarang <em>field</em> ditentukan oleh <em>tag</em> <code>patchStrategy</code> pada <a href=https://github.com/kubernetes/api/blob/d04500c8c3dda9c980b668c57abc2ca61efcf5c4/core/v1/types.go#L2748>types.go</a>. Jika <code>patchStrategy</code> tidak ditentukan untuk sebuah <em>field</em> yang bertipe <em>list</em>, maka <em>list</em> tersebut akan diubah nilainya secara keseluruhan.</div><h2 id=nilai-default-dari-sebuah-field>Nilai <em>default</em> dari sebuah <em>field</em></h2><p><em>API server</em> mengisi <em>field</em> tertentu dengan nilai <em>default</em> pada konfigurasi <em>live</em> jika nilai <em>field-field</em> tersebut tidak dispesifikasikan ketika objek dibuat.</p><p>Berikut adalah sebuah <em>file</em> konfigurasi untuk sebuah Deployment. Berkas berikut tidak menspesifikasikan <code>strategy</code>:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/simple_deployment.yaml download=application/simple_deployment.yaml><code>application/simple_deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-simple-deployment-yaml")' title="Copy application/simple_deployment.yaml to clipboard"></img></div><div class=includecode id=application-simple-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buat objek dengan perintah <code>kubectl apply</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/simple_deployment.yaml
</span></span></code></pre></div><p>Tampilkan konfigurasi <em>live</em> dengan perintah <code>kubectl get</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -f https://k8s.io/examples/application/simple_deployment.yaml -o yaml
</span></span></code></pre></div><p>Keluaran dari perintah tadi menunjukkan bahwa <em>API server</em> mengisi beberapa <em>field</em> dengan nilai <em>default</em> pada konfigurasi <em>live</em>. <em>Field-field</em> berikut tidak dispesifikan pada <em>file</em> konfigurasi.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReadySeconds</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>strategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rollingUpdate</span>:<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver - diturunkan dari strategy.type</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxSurge</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxUnavailable</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>RollingUpdate<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>IfNotPresent<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>protocol</span>:<span style=color:#bbb> </span>TCP<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>terminationMessagePath</span>:<span style=color:#bbb> </span>/dev/termination-log<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>dnsPolicy</span>:<span style=color:#bbb> </span>ClusterFirst<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Always<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>terminationGracePeriodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>30</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default dari apiserver</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Dalam sebuah <em>patch request</em>, <em>field-field</em> dengan nilai <em>default</em> tidak diisi kembali dengan nilai <em>default</em> kecuali secara eksplisit nilainya dihapuskan sebagai bagian dari <em>patch request</em>. Ini bisa menimbulkan hasil yang tak terduga jika sebagian <em>field</em> diisi dengan nilai <em>default</em> yang diturunkan dari nilai <em>field</em> lainnya. Ketika <em>field</em> lain tersebut nilainya diubah, <em>field-field</em> yang diisi dengan nilai <em>default</em> berdasarkan <em>field</em> yang berubah tadi tidak akan diperbarui kecuali secara eksplisit dihapus.</p><p>Oleh karena itu, beberapa <em>field</em> yang nilainya diisi secara <em>default</em> oleh <em>server</em> perlu didefinisikan secara eksplisit di <em>file</em> konfigurasi, meskipun nilai yang diinginkan sudah sesuai dengan nilai <em>default</em> dari server. Ini untuk mempermudah mengenali nilai-nilai yang berselisih yang tidak akan diisi dengan nilai <em>default</em> oleh <em>server</em>.</p><p><strong>Contoh:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#080;font-style:italic># last-applied-configuration</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># berkas konfigurasi</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>strategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Recreate<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai yang diperbarui</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># konfigurasi live</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>strategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>RollingUpdate<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rollingUpdate</span>:<span style=color:#bbb> </span><span style=color:#080;font-style:italic># nilai default yang diturunkan dari type</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxSurge </span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxUnavailable</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># hasil setelah penggabungan - ERROR!</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>strategy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type: Recreate # nilai yang diperbarui</span>:<span style=color:#bbb> </span>tidak kompatibel dengan field rollingUpdate<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rollingUpdate: # nilai default</span>:<span style=color:#bbb> </span>tidak kompatibel dengan &#34;type: Recreate&#34;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxSurge </span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>maxUnavailable</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>Penjelasan:</strong></p><ol><li>Pengguna sebelumnya sudah membuat sebuah Deployment tanpa mendefinisikan <code>strategy.type</code> (seperti yang bisa dilihat pada <code>last-applied-configuration</code>).</li><li>Server mengisi <code>strategy.type</code> dengan nilai <em>default</em> <code>RollingUpdate</code> dan mengisi <code>strategy.rollingUpdate</code> dengan nilai <em>default</em> pada konfigurasi <em>live</em>.</li><li>Pengguna mengubah nilai <em>field</em> <code>strategy.type</code> menjadi <code>Recreate</code> pada <em>file</em> konfigurasi. Nilai <code>strategy.rollingUpdate</code> tidak berubah dari nilai <em>default</em>, meskipun server sekarang berekspektasi nilai tersebut dihapus. Jika nilai <code>strategy.rollingUpdate</code> didefinisikan di awal pada <em>file</em> konfigurasi, akan jelas bagi <em>server</em> bahwa <em>field</em> tersebut perlu dihapus.</li><li>Perintah <code>kubect apply</code> gagal karena <code>strategy.rollingUpdate</code> tidak dihapus. <em>Field</em> <code>strategy.rollingUpdate</code> tidak bisa didefinisikan jika <em>field</em> <code>strategy.type</code> berisi <code>Recreate</code>.</li></ol><p>Rekomendasi: <em>Field-field</em> ini harus didefinisikan secara eksplisit di <em>file</em> konfigurasi objek:</p><ul><li>Label Selectors dan PodTemplate pada <em>workloads</em>, misalnya Deployment, StatefulSet, Job, DaemonSet, ReplicaSet, dan ReplicationController</li><li>Strategi Deployment <em>rollout</em></li></ul><h3 id=cara-menghilangkan-field-field-yang-diisi-dengan-nilai-default-atau-diisi-oleh-writer-lainnya>Cara menghilangkan <em>field-field</em> yang diisi dengan nilai <em>default</em> atau diisi oleh <em>writer</em> lainnya</h3><p><em>Field-field</em> yang tidak muncul di <em>file</em> konfigurasi bisa dihilangkan dengan mengisi nilainya dengan <code>null</code> dan kemudian jalankan <code>kubectl apply</code> dengan <em>file</em> konfigurasi tersebut. Untuk <em>field-field</em> yang nilainya diisi dengan nilai <em>default</em> oleh <em>server</em>, aksi ini akan mmenyebabkan pengisian ulang <em>field</em> dengan nilai <em>default</em>.</p><h2 id=cara-mengubah-kepemilikan-sebuah-field-antara-file-konfigurasi-dan-writer-imperatif>Cara mengubah kepemilikan sebuah <em>field</em> antara <em>file</em> konfigurasi dan <em>writer</em> imperatif</h2><p>Hanya metode-metode berikut yang bisa kamu gunakan untuk mengubah satu <em>field</em> objek:</p><ul><li>Gunakan <code>kubectl apply</code>.</li><li>Tulis secara langsung ke konfigurasi <em>live</em> tanpa memodifikasi <em>file</em> konfigurasi: misalnya, dengan perintah <code>kubectl scale</code>.</li></ul><h3 id=mengubah-kepemilikan-dari-writer-imperatif-ke-file-konfigurasi>Mengubah kepemilikan dari <em>writer</em> imperatif ke <em>file</em> konfigurasi</h3><p>Tambahkan <em>field</em> ke <em>file</em> konfigurasi. Hentikan pembaruan secara langsung ke konfigurasi <em>live</em> tanpa melalui <code>kubectl apply</code>.</p><h3 id=mengubah-kepemilikan-dari-file-konfigurasi-ke-writer-imperatif>Mengubah kepemilikan dari <em>file</em> konfigurasi ke <em>writer</em> imperatif</h3><p>Pada versi Kubernetes 1.5, mengubah kepemilikan sebuah field dari <em>file</em> konfigurasi memerlukan langkah-langkah manual:</p><ul><li>Hapus <em>field</em> dari <em>file</em> konfigurasi.</li><li>Hapus <em>field</em> dari anotasi <code>kubectl.kubernetes.io/last-applied-configuration</code> pada objek <em>live</em>.</li></ul><h2 id=mengubah-metode-metode-pengelolaan-objek>Mengubah metode-metode pengelolaan objek</h2><p>Objek-objek Kubernetes sebaiknya dikelola dengan satu metode dalam satu waktu. Berpindah dari satu metode ke metode lain dimungkinkan, tetapi memerlukan proses manual.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Boleh menggunakan perintah hapus secara imperatif dalam pengelolaan objek secara deklaratif.</div><h3 id=migrasi-dari-pengelolaan-dengan-perintah-imperatif-ke-konfigurasi-objek-deklaratif>Migrasi dari pengelolaan dengan perintah imperatif ke konfigurasi objek deklaratif</h3><p>Migrasi dari pengelolaan objek dengan perintah imperatif ke pengelolaan objek dengan konfigurasi deklaratif memerlukan beberapa langkah manual:</p><ol><li><p>Ekspor objek <em>live</em> ke <em>file</em> konfigurasi lokal:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get &lt;kind&gt;/&lt;name&gt; -o yaml &gt; &lt;kind&gt;_&lt;name&gt;.yaml
</span></span></code></pre></div></li><li><p>Hapus secara manual <em>field</em> <code>status</code> dari <em>file</em> konfigurasi.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Tahap ini opsional, karena <code>kubectl apply</code> tidak memperbarui <em>field</em> status meskipun <em>field</em> tersebut ada di <em>file</em> konfigurasi.</div></li><li><p>Ubah anotasi <code>kubectl.kubernetes.io/last-applied-configuration</code> pada objek:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl replace --save-config -f &lt;kind&gt;_&lt;name&gt;.yaml
</span></span></code></pre></div></li><li><p>Selanjutnya gunakan <code>kubectl apply</code> secara eksklusif untuk mengelola objek.</p></li></ol><h3 id=migrasi-dari-konfigurasi-objek-imperatif-ke-konfigurasi-objek-deklaratif>Migrasi dari konfigurasi objek imperatif ke konfigurasi objek deklaratif</h3><ol><li><p>Atur anotasi <code>kubectl.kubernetes.io/last-applied-configuration</code> pada objek:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl replace --save-config -f &lt;kind&gt;_&lt;name&gt;.yaml
</span></span></code></pre></div></li><li><p>Gunakan selalu perintah <code>kubectl apply</code> saja untuk mengelola objek.</p></li></ol><h2 id=pendefinisian-selektor-controller-dan-label-podtemplate>Pendefinisian selektor <em>controller</em> dan label PodTemplate</h2><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Pembaruan selektor pada <em>controllers</em> sangat tidak disarankan.</div><p>Cara yang disarankan adalah dengan mendefinisikan sebuah PodTemplate <em>immutable</em> yang hanya digunakan oleh selektor <em>controller</em> tanpa memiliki arti semantik lainnya.</p><p><strong>Contoh:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>controller-selector</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;extensions/v1beta1/deployment/nginx&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>controller-selector</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;extensions/v1beta1/deployment/nginx&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><ul><li><a href=/id/docs/tasks/manage-kubernetes-objects/imperative-command/>Pengelolaan Objek Kubernetes Menggunakan Perintah Imperatif</a></li><li><a href=/id/docs/tasks/manage-kubernetes-objects/imperative-config/>Pengelolaan Objek Kubernetes secara Imperatif Menggunakan Berkas Konfigurasi</a></li><li><a href=/docs/reference/generated/kubectl/kubectl-commands/>Rujukan Perintah Kubectl</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/>Rujukan API Kubernetes</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-11aa6950fcb203094823c8e2cbdd517f>5.2 - Mengelola Objek Kubernetes secara Deklaratif menggunakan Kustomize</h1><p><a href=https://github.com/kubernetes-sigs/kustomize>Kustomize</a> merupakan sebuah alat
untuk melakukan kustomisasi objek Kubernetes melalui sebuah berkas <a href=https://github.com/kubernetes-sigs/kustomize/blob/master/docs/glossary.md#kustomization>berkas kustomization</a>.</p><p>Sejak versi 1.14, kubectl mendukung pengelolaan objek Kubernetes melalui berkas kustomization.
Untuk melihat sumber daya yang ada di dalam direktori yang memiliki berkas kustomization, jalankan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl kustomize &lt;direktori_kustomization&gt;
</span></span></code></pre></div><p>Untuk menerapkan sumber daya tersebut, jalankan perintah <code>kubectl apply</code> dengan <em>flag</em> <code>--kustomize</code> atau <code>-k</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -k &lt;kustomization_directory&gt;
</span></span></code></pre></div><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p>Instal <a href=/id/docs/tasks/tools/install-kubectl/><code>kubectl</code></a> terlebih dahulu.</p><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=gambaran-umum-kustomize>Gambaran Umum Kustomize</h2><p>Kustomize adalah sebuah alat untuk melakukan kustomisasi konfigurasi Kubernetes. Untuk mengelola berkas-berkas konfigurasi, kustomize memiliki fitur -fitur di bawah ini:</p><ul><li>membangkitkan (<em>generate</em>) sumber daya dari sumber lain</li><li>mengatur <em>field</em> dari berbagai sumber daya yang bersinggungan</li><li>mengkomposisikan dan melakukan kustomisasi sekelompok sumber daya</li></ul><h3 id=membangkitkan-sumber-daya>Membangkitkan Sumber Daya</h3><p>ConfigMap dan Secret menyimpan konfigurasi atau data sensitif yang digunakan oleh objek-objek Kubernetes lainnya, seperti Pod.
Biasanya, <em>source of truth</em> dari ConfigMap atau Secret berasal dari luar klaster, seperti berkas <code>.properties</code> atau berkas kunci SSH.
Kustomize memiliki <code>secretGenerator</code> dan <code>configMapGenerator</code>, yang akan membangkitkan (<em>generate</em>) Secret dan ConfigMap dari berkas-berkas atau nilai-nilai literal.</p><h4 id=configmapgenerator>configMapGenerator</h4><p>Untuk membangkitkan sebuah ConfigMap dari berkas, tambahkan entri ke daftar <code>files</code> pada <code>configMapGenerator</code>.
Contoh di bawah ini membangkitkan sebuah ConfigMap dengan data dari berkas <code>.properties</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas application.properties</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;application.properties
</span></span></span><span style=display:flex><span><span style=color:#b44>FOO=Bar
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>configMapGenerator:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: example-configmap-1
</span></span></span><span style=display:flex><span><span style=color:#b44>  files:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - application.properties
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>ConfigMap yang telah dibangkitkan dapat dilihat menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl kustomize ./
</span></span></code></pre></div><p>Isinya seperti di bawah ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>application.properties</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>    </span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>FOO</span>:<span style=color:#bbb> </span>Bar<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example-configmap-1-42cfbf598f<span style=color:#bbb>
</span></span></span></code></pre></div><p>ConfigMap juga dapat dibangkitkan dari pasangan <em>key-value</em> literal. Untuk membangkitkan secara literal, tambahkan entri pada daftar <code>literals</code> di <code>configMapGenerator</code>.
Contoh di bawah ini membangkitkan ConfigMap dengan data dari pasangan <em>key-value</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>configMapGenerator:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: example-configmap-2
</span></span></span><span style=display:flex><span><span style=color:#b44>  literals:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - FOO=Bar
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>ConfigMap yang dibangkitkan dapat dilihat menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl kustomize ./
</span></span></code></pre></div><p>Isinya seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>FOO</span>:<span style=color:#bbb> </span>Bar<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example-configmap-2-g2hdhfc6tk<span style=color:#bbb>
</span></span></span></code></pre></div><h4 id=secretgenerator>secretGenerator</h4><p>Kamu dapat membangkitkan Secret dari berkas atau pasangan <em>key-value</em> literal. Untuk membangkitkan dari berkas, tambahkan entri pada daftar <code>files</code> di <code>secretGenerator</code>.
Contoh di bawah ini membangkitkan Secret dengan data dari berkas:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas password.txt</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./password.txt
</span></span></span><span style=display:flex><span><span style=color:#b44>username=admin
</span></span></span><span style=display:flex><span><span style=color:#b44>password=secret
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>secretGenerator:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: example-secret-1
</span></span></span><span style=display:flex><span><span style=color:#b44>  files:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - password.txt
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Isinya seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>password.txt</span>:<span style=color:#bbb> </span>dXNlcm5hbWU9YWRtaW4KcGFzc3dvcmQ9c2VjcmV0Cg==<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Secret<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example-secret-1-t2kt65hgtb<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Opaque<span style=color:#bbb>
</span></span></span></code></pre></div><p>Untuk membangkitkan secara literal dari pasangan <em>key-value</em>, tambahkan entri pada daftar <code>literals</code> di <code>secretGenerator</code>.
Contoh di bawah ini membangkitkan Secret dengan data dari pasangan <em>key-value</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>secretGenerator:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: example-secret-2
</span></span></span><span style=display:flex><span><span style=color:#b44>  literals:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - username=admin
</span></span></span><span style=display:flex><span><span style=color:#b44>  - password=secret
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Isinya seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span>c2VjcmV0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>YWRtaW4=<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Secret<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example-secret-2-t52t6g96d8<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Opaque<span style=color:#bbb>
</span></span></span></code></pre></div><h4 id=generatoroptions>generatorOptions</h4><p>ConfigMap dan Secret yang dibangkitkan memiliki informasi sufiks <em>hash</em>. Hal ini memastikan bahwa ConfigMap atau Secret yang baru, dibangkitkan saat isinya berubah.
Untuk menonaktifkan penambahan sufiks ini, kamu bisa menggunakan <code>generatorOptions</code>. Selain itu, melalui <em>field</em> ini kamu juga bisa mengatur opsi-opsi yang bersinggungan untuk ConfigMap dan Secret yang dibangkitkan.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>configMapGenerator:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: example-configmap-3
</span></span></span><span style=display:flex><span><span style=color:#b44>  literals:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - FOO=Bar
</span></span></span><span style=display:flex><span><span style=color:#b44>generatorOptions:
</span></span></span><span style=display:flex><span><span style=color:#b44>  disableNameSuffixHash: true
</span></span></span><span style=display:flex><span><span style=color:#b44>  labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>    type: generated
</span></span></span><span style=display:flex><span><span style=color:#b44>  annotations:
</span></span></span><span style=display:flex><span><span style=color:#b44>    note: generated
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Jalankan perintah <code>kubectl kustomize ./</code> untuk melihat ConfigMap yang dibangkitkan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>FOO</span>:<span style=color:#bbb> </span>Bar<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>note</span>:<span style=color:#bbb> </span>generated<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>generated<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example-configmap-3<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=mengatur-field-yang-bersinggungan>Mengatur <em>field</em> yang bersinggungan</h3><p>Mengatur <em>field-field</em> yang bersinggungan untuk semua sumber daya Kubernetes dalam sebuah proyek.
Beberapa contoh kasusnya seperti di bawah ini:</p><ul><li>mengatur Namespace yang sama untuk semua sumber daya</li><li>menambahkan prefiks atau sufiks yang sama</li><li>menambahkan kumpulan label yang sama</li><li>menambahkan kumpulan anotasi yang sama</li></ul><p>Lihat contoh di bawah ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat sebuah deployment.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: nginx-deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>  labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>    app: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>      app: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>      labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>        app: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>namespace: my-namespace
</span></span></span><span style=display:flex><span><span style=color:#b44>namePrefix: dev-
</span></span></span><span style=display:flex><span><span style=color:#b44>nameSuffix: &#34;-001&#34;
</span></span></span><span style=display:flex><span><span style=color:#b44>commonLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>  app: bingo
</span></span></span><span style=display:flex><span><span style=color:#b44>commonAnnotations:
</span></span></span><span style=display:flex><span><span style=color:#b44>  oncallPager: 800-555-1212
</span></span></span><span style=display:flex><span><span style=color:#b44>resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>- deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Jalankan perintah <code>kubectl kustomize ./</code> untuk melihat <em>field-field</em> tersebut telah terisi di dalam sumber daya Deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>oncallPager</span>:<span style=color:#bbb> </span><span style=color:#666>800-555-1212</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>bingo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dev-nginx-deployment-001<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>my-namespace<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>bingo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>oncallPager</span>:<span style=color:#bbb> </span><span style=color:#666>800-555-1212</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>bingo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=mengkomposisi-dan-melakukan-kustomisasi-sumber-daya>Mengkomposisi dan Melakukan Kustomisasi Sumber Daya</h3><p>Mengkomposisi kumpulan sumber daya dalam sebuah proyek dan mengelolanya di dalam berkas atau direktori yang sama merupakan hal yang cukup umum dilakukan.
Kustomize menyediakan cara untuk mengkomposisi sumber daya dari berkas-berkas yang berbeda, lalu menerapkan <em>patch</em> atau kustomisasi lain di atasnya.</p><h4 id=melakukan-komposisi>Melakukan Komposisi</h4><p>Kustomize mendukung komposisi dari berbagai sumber daya yang berbeda. <em>Field</em> <code>resources</code> pada berkas <code>kustomization.yaml</code>, mendefinisikan daftar sumber daya yang diinginkan dalam sebuah konfigurasi. Atur terlebih dahulu jalur (<em>path</em>) ke berkas konfigurasi sumber daya pada daftar <code>resources</code>.
Contoh di bawah ini merupakan sebuah aplikasi NGINX yang terdiri dari sebuah Deployment dan sebuah Service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas deployment.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>      run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  replicas: 2
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>      labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>        run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>        - containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas service.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; service.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>    run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - port: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>    protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas kustomization.yaml yang terdiri dari keduanya</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>- deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>- service.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Sumber daya dari <code>kubectl kustomize ./</code> berisi kedua objek Deployment dan Service.</p><h4 id=melakukan-kustomisasi>Melakukan Kustomisasi</h4><p><em>Patch</em> dapat digunakan untuk menerapkan berbagai macam kustomisasi pada sumber daya. Kustomize mendukung berbagai mekanisme <em>patching</em> yang berbeda melalui <code>patchesStrategicMerge</code> dan <code>patchesJson6902</code>. <code>patchesStrategicMerge</code> adalah daftar dari yang berisi tentang <em>path</em> berkas. Setiap berkas akan dioperasikan dengan cara <a href=https://github.com/kubernetes/community/blob/master/contributors/devel/sig-api-machinery/strategic-merge-patch.md>strategic merge patch</a>. Nama di dalam <em>patch</em> harus sesuai dengan nama sumber daya yang telah dimuat. Kami menyarankan <em>patch-patch</em> kecil yang hanya melakukan satu hal saja.
Contoh membuat sebuah <em>patch</em> di bawah ini akan menambahkan jumlah replika Deployment dan <em>patch</em> lainnya untuk mengatur limit memori.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas deployment.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>      run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  replicas: 2
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>      labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>        run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>        - containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat sebuah patch increase_replicas.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; increase_replicas.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  replicas: 3
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat patch lainnya set_memory.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; set_memory.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>        limits:
</span></span></span><span style=display:flex><span><span style=color:#b44>          memory: 512Mi
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>- deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>patchesStrategicMerge:
</span></span></span><span style=display:flex><span><span style=color:#b44>- increase_replicas.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>- set_memory.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Jalankan perintah <code>kubectl kustomize ./</code> untuk melihat isi dari Deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>512Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Tidak semua sumber daya atau <em>field</em> mendukung <em>strategic merge patch</em>. Untuk mendukung <em>field</em> sembarang pada sumber daya <em>field</em>, Kustomize
menyediakan penerapan <a href=https://tools.ietf.org/html/rfc6902><em>patch</em> JSON</a> melalui <code>patchesJson6902</code>.
Untuk mencari sumber daya yang tepat dengan sebuah <em>patch</em> Json, maka grup, versi, jenis dan nama dari sumber daya harus dispesifikasikan dalam <code>kustomization.yaml</code>.
Contoh di bawah ini menambahkan jumlah replika dari objek Deployment yang bisa juga dilakukan melalui <code>patchesJson6902</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas deployment.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>      run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  replicas: 2
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>      labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>        run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>        - containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat patch json</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; patch.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>- op: replace
</span></span></span><span style=display:flex><span><span style=color:#b44>  path: /spec/replicas
</span></span></span><span style=display:flex><span><span style=color:#b44>  value: 3
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas kustomization.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>- deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>patchesJson6902:
</span></span></span><span style=display:flex><span><span style=color:#b44>- target:
</span></span></span><span style=display:flex><span><span style=color:#b44>    group: apps
</span></span></span><span style=display:flex><span><span style=color:#b44>    version: v1
</span></span></span><span style=display:flex><span><span style=color:#b44>    kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>    name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  path: patch.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Jalankan perintah <code>kubectl kustomize ./</code> untuk melihat <em>field</em> <code>replicas</code> yang telah diperbarui:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Selain <em>patch</em>, Kustomize juga menyediakan cara untuk melakukan kustomisasi <em>image</em> Container atau memasukkan nilai <em>field</em> dari objek lainnya ke dalam Container tanpa membuat <em>patch</em>. Sebagai contoh, kamu dapat melakukan kustomisasi <em>image</em> yang digunakan di dalam Container dengan menyebutkan spesifikasi <em>field</em> <code>images</code> di dalam <code>kustomization.yaml</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>      run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  replicas: 2
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>      labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>        run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>        - containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>- deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>images:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  newName: my.image.registry/nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  newTag: 1.4.0
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Jalankan perintah <code>kubectl kustomize ./</code> untuk melihat <em>image</em> yang sedang digunakan telah diperbarui:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>my.image.registry/nginx:1.4.0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Terkadang, aplikasi yang berjalan di dalam Pod perlu untuk menggunakan nilai konfigurasi dari objek lainnya.
Contohnya, sebuah Pod dari objek Deployment perlu untuk membaca nama Service dari Env atau sebagai argumen perintah.
Ini karena nama Service bisa saja berubah akibat dari penambahan <code>namePrefix</code> atau <code>nameSuffix</code> pada berkas <code>kustomization.yaml</code>.
Kami tidak menyarankan kamu untuk meng-<em>hardcode</em> nama Service di dalam argumen perintah.
Untuk penggunaan ini, Kustomize dapat memasukkan nama Service ke dalam Container melalui <code>vars</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas deployment.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>      run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  replicas: 2
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>      labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>        run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        command: [&#34;start&#34;, &#34;--host&#34;, &#34;\$(MY_SERVICE_NAME)&#34;]
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas service.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; service.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>    run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - port: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>    protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>namePrefix: dev-
</span></span></span><span style=display:flex><span><span style=color:#b44>nameSuffix: &#34;-001&#34;
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>- deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>- service.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>vars:
</span></span></span><span style=display:flex><span><span style=color:#b44>- name: MY_SERVICE_NAME
</span></span></span><span style=display:flex><span><span style=color:#b44>  objref:
</span></span></span><span style=display:flex><span><span style=color:#b44>    kind: Service
</span></span></span><span style=display:flex><span><span style=color:#b44>    name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Jalankan perintah <code>kubectl kustomize ./</code> untuk melihat nama Service yang dimasukkan ke dalam Container menjadi <code>dev-my-nginx-001</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dev-my-nginx-001<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>command</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- start<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- --host<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- dev-my-nginx-001<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>my-nginx<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=base-dan-overlay>Base dan Overlay</h2><p>Kustomize memiliki konsep <strong>base</strong> dan <strong>overlay</strong>. <strong>base</strong> merupakan direktori dengan <code>kustomization.yaml</code>, yang berisi
sekumpulan sumber daya dan kustomisasi yang terkait. <strong>base</strong> dapat berupa direktori lokal maupun direktori dari repo <em>remote</em>,
asalkan berkas <code>kustomization.yaml</code> ada di dalamnya. <strong>overlay</strong> merupakan direktori dengan <code>kustomization.yaml</code> yang merujuk pada
direktori kustomization lainnya sebagai <strong>base</strong>-nya. <strong>base</strong> tidak memiliki informasi tentang <strong>overlay</strong>. dan dapat digunakan pada beberapa <strong>overlay</strong> sekaligus.
<strong>overlay</strong> bisa memiliki beberapa <strong>base</strong> dan terdiri dari semua sumber daya yang berasal dari <strong>base</strong> yang juga dapat memiliki kustomisasi lagi di atasnya.</p><p>Contoh di bawah ini memperlihatkan kegunaan dari <strong>base</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat direktori untuk menyimpan base</span>
</span></span><span style=display:flex><span>mkdir base
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat base/deployment.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; base/deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>      run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  replicas: 2
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>      labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>        run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas base/service.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; base/service.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>    run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - port: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>    protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas base/kustomization.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; base/kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>- deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>- service.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p><strong>base</strong> ini dapat digunakan di dalam beberapa <strong>overlay</strong> sekaligus. Kamu dapat menambahkan <code>namePrefix</code> yang berbeda ataupun
<em>field</em> lainnya yang bersinggungan di dalam <strong>overlay</strong> berbeda. Di bawah ini merupakan dua buah <strong>overlay</strong> yang menggunakan <strong>base</strong> yang sama.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir dev
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; dev/kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>bases:
</span></span></span><span style=display:flex><span><span style=color:#b44>- ../base
</span></span></span><span style=display:flex><span><span style=color:#b44>namePrefix: dev-
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir prod
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; prod/kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>bases:
</span></span></span><span style=display:flex><span><span style=color:#b44>- ../base
</span></span></span><span style=display:flex><span><span style=color:#b44>namePrefix: prod-
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><h2 id=cara-menerapkan-melihat-menghapus-objek-menggunakan-kustomize>Cara menerapkan/melihat/menghapus objek menggunakan Kustomize</h2><p>Gunakan <code>--kustomize</code> atau <code>-k</code> di dalam perintah <code>kubectl</code> untuk mengenali sumber daya yang dikelola oleh <code>kustomization.yaml</code>.
Perhatikan bahwa <code>-k</code> harus merujuk pada direktori kustomization, misalnya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -k &lt;direktori kustomization&gt;/
</span></span></code></pre></div><p>Buatlah <code>kustomization.yaml</code> seperti di bawah ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas deployment.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  selector:
</span></span></span><span style=display:flex><span><span style=color:#b44>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>      run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>  replicas: 2
</span></span></span><span style=display:flex><span><span style=color:#b44>  template:
</span></span></span><span style=display:flex><span><span style=color:#b44>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>      labels:
</span></span></span><span style=display:flex><span><span style=color:#b44>        run: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>    spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>      containers:
</span></span></span><span style=display:flex><span><span style=color:#b44>      - name: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        image: nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>        ports:
</span></span></span><span style=display:flex><span><span style=color:#b44>        - containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Membuat berkas kustomization.yaml</span>
</span></span><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>namePrefix: dev-
</span></span></span><span style=display:flex><span><span style=color:#b44>commonLabels:
</span></span></span><span style=display:flex><span><span style=color:#b44>  app: my-nginx
</span></span></span><span style=display:flex><span><span style=color:#b44>resources:
</span></span></span><span style=display:flex><span><span style=color:#b44>- deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Jalankan perintah di bawah ini untuk menerapkan objek Deployment <code>dev-my-nginx</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>&gt; kubectl apply -k ./
</span></span><span style=display:flex><span>deployment.apps/dev-my-nginx created
</span></span></code></pre></div><p>Jalankan perintah di bawah ini untuk melihat objek Deployment <code>dev-my-nginx</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get -k ./
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe -k ./
</span></span></code></pre></div><p>Jalankan perintah di bawah ini untuk membandingkan objek Deployment <code>dev-my-nginx</code> dengan kondisi yang diinginkan pada klaster jika manifes telah berhasil diterapkan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl diff -k ./
</span></span></code></pre></div><p>Jalankan perintah di bawah ini untuk menghapus objek Deployment <code>dev-my-nginx</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>&gt; kubectl delete -k ./
</span></span><span style=display:flex><span>deployment.apps <span style=color:#b44>&#34;dev-my-nginx&#34;</span> deleted
</span></span></code></pre></div><h2 id=daftar-fitur-kustomize>Daftar Fitur Kustomize</h2><table><thead><tr><th><em>Field</em></th><th>Tipe</th><th>Deskripsi</th></tr></thead><tbody><tr><td>namespace</td><td>string</td><td>menambahkan Namespace untuk semua sumber daya</td></tr><tr><td>namePrefix</td><td>string</td><td>nilai dari <em>field</em> ini ditambahkan di awal pada nama dari semua sumber daya</td></tr><tr><td>nameSuffix</td><td>string</td><td>nilai dari <em>field</em> ini ditambahkan di akhir pada nama dari semua sumber daya</td></tr><tr><td>commonLabels</td><td>map[string]string</td><td>label untuk ditambahkan pada semua sumber daya dan selektor</td></tr><tr><td>commonAnnotations</td><td>map[string]string</td><td>anotasi untuk ditambahkan pada semua sumber daya</td></tr><tr><td>resources</td><td>[]string</td><td>setiap entri di dalam daftar ini harus diselesaikan pada berkas konfigurasi sumber daya yang sudah ada</td></tr><tr><td>configmapGenerator</td><td>[]<a href=https://github.com/kubernetes-sigs/kustomize/blob/release-kustomize-v4.0/api/types/kustomization.go#L99>ConfigMapArgs</a></td><td>setiap entri di dalam daftar ini membangkitkan ConfigMap</td></tr><tr><td>secretGenerator</td><td>[]<a href=https://github.com/kubernetes-sigs/kustomize/blob/release-kustomize-v4.0/api/types/kustomization.go#L106>SecretArgs</a></td><td>setiap entri di dalam daftar ini membangkitkan Secret</td></tr><tr><td>generatorOptions</td><td><a href=https://github.com/kubernetes-sigs/kustomize/blob/release-kustomize-v4.0/api/types/kustomization.go#L109>GeneratorOptions</a></td><td>memodifikasi perilaku dari semua generator ConfigMap dan Secret</td></tr><tr><td>bases</td><td>[]string</td><td>setiap entri di dalam daftar ini harus diselesaikan ke dalam sebuah direktori yang berisi berkas kustomization.yaml</td></tr><tr><td>patchesStrategicMerge</td><td>[]string</td><td>setiap entri di dalam daftar ini harus diselesaikan dengan <em>strategic merge patch</em> dari sebuah objek Kubernetes</td></tr><tr><td>patchesJson6902</td><td>[]<a href=https://github.com/kubernetes-sigs/kustomize/blob/release-kustomize-v4.0/api/types/patchjson6902.go#L8>Json6902</a></td><td>setiap entri di dalam daftar ini harus diselesaikan ke suatu objek Kubernetes atau <em>patch</em> Json</td></tr><tr><td>vars</td><td>[]<a href=https://github.com/kubernetes-sigs/kustomize/blob/master/api/types/var.go#L31>Var</a></td><td>setiap entri digunakan untuk menangkap teks yang berasal dari <em>field</em> sebuah sumber daya</td></tr><tr><td>images</td><td>[]<a href=https://github.com/kubernetes-sigs/kustomize/tree/master/api/types/image.go#L23>Image</a></td><td>setiap entri digunakan untuk memodifikasi nama, tag dan/atau <em>digest</em> untuk sebuah <em>image</em> tanpa membuat <em>patch</em></td></tr><tr><td>configurations</td><td>[]string</td><td>setiap entri di dalam daftar ini harus diselesaikan ke sebuah berkas yang berisi <a href=https://github.com/kubernetes-sigs/kustomize/tree/master/examples/transformerconfigs>konfigurasi transformer Kustomize</a></td></tr><tr><td>crds</td><td>[]string</td><td>setiap entri di dalam daftar ini harus diselesaikan ke sebuah berkas definisi OpenAPI untuk tipe Kubernetes</td></tr></tbody></table><h2 id=selanjutnya>Selanjutnya</h2><ul><li><a href=https://github.com/kubernetes-sigs/kustomize>Kustomize</a></li><li><a href=https://kubectl.docs.kubernetes.io>Buku Kubectl</a></li><li><a href=/docs/reference/generated/kubectl/kubectl-commands/>Rujukan Perintah Kubectl</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/>Rujukan API Kubernetes</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-80c83fe9b80d0fef2681c8d59c0aa197>5.3 - Pengelolaan Objek Kubernetes dengan Perintah Imperatif</h1><p>Objek-objek Kubernetes bisa dibuat, diperbarui, dan dihapus secara langsung dengan menggunakan perintah-perintah imperatif yang ada pada <em>command-line</em> <code>kubectl</code>. Dokumen ini menjelaskan cara perintah-perintah tersebut diorganisir dan cara menggunakan perintah-perintah tersebut untuk mengelola objek <em>live</em>.</p><h2 id=kelebihan-dan-kekurangan>Kelebihan dan kekurangan</h2><p>Perintah <code>kubectl</code> mendukung tiga cara pengelolaan objek:</p><ul><li>Perintah imperatif</li><li>Konfigurasi objek imperatif</li><li>Konfigurasi objek deklaratif</li></ul><p>Lihat <a href=/id/docs/concepts/overview/working-with-objects/object-management/>Pengelolaan Objek Kubernetes</a> untuk mengenali lebih lanjut kelebihan dan kekurangan dari tiap pengelolaan objek.</p><h2 id=cara-membuat-objek>Cara membuat objek</h2><p>Perangkat <code>kubectl</code> mendukung perintah-perintah berbentuk kata kerja untuk membuat beberapa tipe objek yang paling umum. Perintah-perintah tersebut diberi nama yang mudah dikenali oleh pengguna yang belum familiar dengan tipe-tipe objek Kubernetes.</p><ul><li><code>run</code>: Membuat sebuah objek Deployment untuk menjalankan kontainer di satu atau lebih Pod.</li><li><code>expose</code>: Membuat sebuah objek Service untuk mengatur lalu lintas beban antar Pod.</li><li><code>autoscale</code>: Membuat sebuah objek Autoscaler untuk melakukan <em>scaling</em> horizontal secara otomatis terhadap sebuah objek <em>controller</em>, misalnya sebuah objek Deployment.</li></ul><p>Perangkat <code>kubectl</code> juga mendukung perintah-perintah pembuatan objek yang berdasarkan pada tipe objek. Perintah-perintah ini mendukung lebih banyak tipe objek dan lebih eksplisit tentang intensi mereka. Tapi, perintah-perintah ini memerlukan pengguna untuk memahami tipe dari objek-objek yang hendak mereka buat.</p><ul><li><code>create &lt;objecttype> [&lt;subtype>] &lt;instancename></code></li></ul><p>Beberapa tipe objek memiliki sub tipe yang bisa kamu spesifikasikan pada perintah <code>create</code>. Misalnya, objek Service memiliki beberapa sub tipe seperti ClusterIP, LoadBalancer, dan NodePort. Berikut adalah sebuah contoh cara membuat sebuah Service dengan sub tipe NodePort:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create service nodeport &lt;myservicename&gt;
</span></span></code></pre></div><p>Pada contoh di atas, perintah <code>create service nodeport</code> merupakan sub perintah dari <code>create service</code>.</p><p>Kamu bisa menggunakan parameter <code>-h</code> untuk mencari argumen-argumen dan paramenter-parameter yang didukung oleh sebuah sub perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create service nodeport -h
</span></span></code></pre></div><h2 id=cara-memperbarui-objek>Cara memperbarui objek</h2><p>Perintah <code>kubectl</code> mendukung perintah-perintah berbasis kata kerja untuk beberapa operasi pembaruan yang umum. Perintah-perintah ini diberi nama yang memudahkan pengguna yang belum familiar dengan objek-objek Kubernetes untuk melakukan pembaruan tanpa terlebih dulu mengetahui <em>field-field</em> spesifik yang harus diperbarui:</p><ul><li><code>scale</code>: Melakukan <em>scaling</em> horizontal terhadap sebuah <em>controller</em> untuk menambah atau menghapus Pod dengan memperbarui jumlah replika dari <em>controller</em> tersebut.</li><li><code>annotate</code>: Menambah atau menghapus anotasi sebuah objek.</li><li><code>label</code>: Menambah atau menghapus label sebuah objek.</li></ul><p>Perintah <code>kubectl</code> juga mendukung perintah-perintah pembaruan berdasarkan salah satu aspek dari sebuah objek. Untuk tiap tipe objek yang berbeda, memperbarui sebuah aspek tertentu bisa berarti memperbarui sekumpulan <em>field</em> yang berbeda pula:</p><ul><li><code>set</code> <code>&lt;field></code>: Memperbarui salah satu aspek dari sebuah objek.</li></ul><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Pada Kubernetes versi 1.5, tidak semua perintah yang berdasarkan kata kerja berasosiasi dengan perintah yang berdasarkan aspek tertentu.</div><p>Perangkat <code>kubectl</code> juga mendukung beberapa cara lain untuk memperbarui objek <em>live</em> secara langsung, meskipun cara-cara berikut membutuhkan pemahaman yang lebih tentang skema objek Kubernetes.</p><ul><li><code>edit</code>: Secara langsung mengedit konfigurasi mentah dari sebuah objek <em>live</em> dengan membuka konfigurasinya di sebuah editor.</li><li><code>patch</code>: Secara langsung memodifikasi <em>field-field</em> spesifik dari sebuah objek <em>live</em> dengan menggunakan <em>patch string</em>. Untuk detil lebih lanjut mengenai <code>patch string</code>, lihat bagian tentang <em>patch</em> pada <a href=https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#patch-operations>Konvensi API</a>.</li></ul><h2 id=cara-menghapus-objek>Cara menghapus objek</h2><p>Kamu bisa menggunakan perintah <code>delete</code> pada sebuah objek dari sebuah klaster:</p><ul><li><code>delete &lt;type>/&lt;name></code></li></ul><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Kamu bisa menggunakan <code>kubectl delete</code> baik untuk perintah imperatif maupun konfigurasi objek imperatif. Perbedaannya hanya pada argumen yang diberikan ke perintah tersebut. Untuk menggunakan <code>kubectl delete</code> sebagai perintah imperatif, argumen yang diberikan adalah objek yang hendak dihapus. Berikut adalah sebuah contoh perintah <code>kubectl delete</code> dengan sebuah objek Deployment bernama nginx sebagai argumen:</div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete deployment/nginx
</span></span></code></pre></div><h2 id=cara-melihat-objek>Cara melihat objek</h2><p>Ada beberapa perintah untuk menampilkan informasi tentang sebuah objek:</p><ul><li><code>get</code>: Menampilkan informasi dasar dari objek-objek yang sesuai dengan parameter dari perintah ini. Gunakan <code>get -h</code> untuk melihat daftar opsi yang bisa digunakan.</li><li><code>describe</code>: Menampilkan agregat informasi detil dari objek-objek yang sesuai dengan parameter dari perintah ini.</li><li><code>logs</code>: Menampilkan isi stdout dan stderr dari sebuah kontainer yang berjalan di sebuah Pod.</li></ul><h2 id=menggunakan-perintah-set-untuk-memodifikasi-objek-sebelum-dibuat>Menggunakan perintah <code>set</code> untuk memodifikasi objek sebelum dibuat</h2><p>Ada beberapa <em>field</em> objek yang tidak memiliki parameter yang bisa kamu gunakan pada perintah <code>create</code>. Pada kasus-kasus tersebut, kamu bisa menggunakan kombinasi dari perintah <code>set</code> dan <code>create</code> untuk menspesifikasikan nilai untuk <em>field-field</em> tersebut sebelum objek dibuat. Ini dilakukan dengan melakukan <em>piping</em> pada hasil dari perintah <code>create</code> ke perintah <code>set</code>, dan kemudian mengembalikan hasilnya ke perintah <code>create</code>. Simak contoh berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create service clusterip my-svc --clusterip<span style=color:#666>=</span><span style=color:#b44>&#34;None&#34;</span> -o yaml --dry-run | kubectl <span style=color:#a2f>set</span> selector --local -f - <span style=color:#b44>&#39;environment=qa&#39;</span> -o yaml | kubectl create -f -
</span></span></code></pre></div><ol><li>Perintah <code>kubectl create service -o yaml --dry-run</code> membuat konfigurasi untuk sebuah Service, tapi kemudian menuliskan konfigurasi tadi ke stdout dalam format YAML alih-alih mengirimnya ke <em>API Server</em> Kubernetes.</li><li>Perintah <code>kubectl set selector --local -f - -o yaml</code> membaca konfigurasi dari stdin, dan menuliskan pembaruan konfigurasi ke stdout dalam format YAML.</li><li>Perintah <code>kubectl create -f -</code> membuat objek dengan menggunakan konfigurasi yang disediakan pada stdin.</li></ol><h2 id=menggunakan-edit-untuk-memodifikasi-objek-sebelum-dibuat>Menggunakan <code>--edit</code> untuk memodifikasi objek sebelum dibuat</h2><p>Kamu bisa menggunakan perintah <code>kubectl create --edit</code> untuk membuat perubahan terhadap sebuah objek sebelum objek tersebut dibuat. Simak contoh berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create service clusterip my-svc --clusterip<span style=color:#666>=</span><span style=color:#b44>&#34;None&#34;</span> -o yaml --dry-run &gt; /tmp/srv.yaml
</span></span><span style=display:flex><span>kubectl create --edit -f /tmp/srv.yaml
</span></span></code></pre></div><ol><li>Perintah <code>kubectl create service</code> membuat konfigurasi untuk objek Service dan menyimpannya di <code>/tmp/srv.yaml</code>.</li><li>Perintah <code>kubectl create --edit</code> membuka berkas konfigurasi untuk disunting sebelum objek dibuat.</li></ol><h2 id=selanjutnya>Selanjutnya</h2><ul><li><a href=/id/docs/tasks/manage-kubernetes-objects/imperative-config/>Pengelolaan Objek Kubernetes secara Imperatif dengan Menggunakan Konfigurasi Objek</a></li><li><a href=/id//docs/tasks/manage-kubernetes-objects/declarative-config/>Pengelolaan Objek Kubernetes secara Deklaratif dengan Menggunakan Konfigurasi Objek</a></li><li><a href=/docs/reference/generated/kubectl/kubectl-commands/>Rujukan Perintah Kubectl</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/>Kubernetes API Reference</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b18886277c410fc6f32ce068e2160537>5.4 - Pengelolaan Objek Kubernetes Secara Imperatif dengan Menggunakan File Konfigurasi</h1><p>Objek-objek Kubernetes bisa dibuat, diperbarui, dan dihapus dengan menggunakan perangkat <em>command-line</em> <code>kubectl</code> dan file konfigurasi objek yang ditulis dalam format YAML atau JSON. Dokumen ini menjelaskan cara mendefinisikan dan mengelola objek dengan menggunakan file konfigurasi.</p><h2 id=kelebihan-dan-kekurangan>Kelebihan dan kekurangan</h2><p>Perintah <code>kubectl</code> mendukung tiga cara pengelolaan objek:</p><ul><li>Perintah imperatif</li><li>Konfigurasi objek imperatif</li><li>Konfigurasi objek deklaratif</li></ul><p>Lihat <a href=/id/docs/tasks/manage-kubernetes-objects/>Pengelolaan Objek Kubernetes</a> untuk mengenali lebih lanjut kelebihan dan kekurangan dari tiap cara pengelolaan objek.</p><h2 id=cara-membuat-objek>Cara membuat objek</h2><p>Kamu bisa menggunakan perintah <code>kubectl create -f</code> untuk membuat sebuah objek dari sebuah file konfigurasi. Rujuk dokumen <a href=/docs/reference/generated/kubernetes-api/v1.25/>referensi API Kubernetes</a> untuk detil lebih lanjut.</p><ul><li><code>kubectl create -f &lt;nama-file|url></code></li></ul><h2 id=cara-memperbarui-objek>Cara memperbarui objek</h2><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Memperbarui objek dengan perintah <code>replace</code> akan menghilangkan semua bagian dari spesifikasi objek yang tidak dispesifikasikan pada file konfigurasi. Oleh karena itu, perintah ini sebaiknya tidak digunakan terhadap objek-objek yang spesifikasinya sebagian dikelola oleh klaster, misalnya Service dengan tipe <code>LoadBalancer</code>, di mana <em>field</em> <code>externalIPs</code> dikelola secara terpisah dari file konfigurasi. <em>Field-field</em> yang dikelola secara terpisah harus disalin ke file konfigurasi untuk mencegah terhapus oleh perintah <code>replace</code>.</div><p>Kamu bisa menggunakan perintah <code>kubectl replace -f</code> untuk memperbarui sebuah objek <em>live</em> sesuai dengan sebuah file konfigurasi.</p><ul><li><code>kubectl replace -f &lt;nama-file|url></code></li></ul><h2 id=cara-menghapus-objek>Cara menghapus objek</h2><p>Kamu bisa menggunakan perintah <code>kubectl delete -f</code> untuk menghapus sebuah objek yang dideskripsikan pada sebuah file konfigurasi.</p><ul><li><code>kubectl delete -f &lt;nama-file|url></code></li></ul><h2 id=cara-melihat-objek>Cara melihat objek</h2><p>Kamu bisa menggunakan perintah <code>kubectl get -f</code> untuk melihat informasi tentang sebuah objek yang dideskripsikan pada sebuah file konfigurasi.</p><ul><li><code>kubectl get -f &lt;nama-file|url> -o yaml</code></li></ul><p>Parameter <code>-o yaml</code> menetapkan bahwa keseluruhan konfigurasi objek ditulis ke file yaml. Gunakan perintah <code>kubectl get -h</code> untuk melihat daftar pilihan selengkapnya.</p><h2 id=keterbatasan>Keterbatasan</h2><p>Perintah-perintah <code>create</code>, <code>replace</code>, dan <code>delete</code> bekerja dengan baik saat tiap konfigurasi dari sebuah objek didefinisikan dan dicatat dengan lengkap pada file konfigurasi objek tersebut. Akan tetapi, ketika sebuah objek <em>live</em> diperbarui dan pembaruannya tidak dicatat di file konfigurasinya, pembaruan tersebut akan hilang ketika perintah <code>replace</code> dieksekusi di waktu berikutnya. Ini bisa terjadi saat sebuah <em>controller</em>, misalnya sebuah <code>HorizontalPodAutoscaler</code>, membuat pembaruan secara langsung ke sebuah objek <em>live</em>. Berikut sebuah contoh:</p><ol><li>Kamu membuat sebuah objek dari sebuah file konfigurasi.</li><li>Sebuah sumber lain memperbarui objek tersebut dengan mengubah beberapa <em>field</em>.</li><li>Kamu memperbarui objek tersebut dengan <code>kubectl replace</code> dari file konfigurasi. Perubahan yang dibuat dari sumber lain pada langkah nomor 2 di atas akan hilang.</li></ol><p>Jika kamu perlu mendukung beberapa <em>writer</em> untuk objek yang sama, kamu bisa menggunakan <code>kubectl apply</code> untuk mengelola objek tersebut.</p><h2 id=membuat-dan-mengedit-objek-dari-url-tanpa-menyimpan-konfigurasinya>Membuat dan mengedit objek dari URL tanpa menyimpan konfigurasinya</h2><p>Misalkan kamu memiliki URL dari sebuah file konfigurasi objek. Kamu bisa menggunakan <code>kubectl create --edit</code> untuk membuat perubahan pada konfigurasi sebelum objek tersebut dibuat. Langkah ini terutama berguna untuk mengikuti tutorial atau untuk pekerjaan-pekerjaan yang menggunakan sebuah file konfigurasi di URL terentu yang perlu dimodifikasi.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create -f &lt;url&gt; --edit
</span></span></code></pre></div><h2 id=migrasi-dari-perintah-imperatif-ke-konfigurasi-objek-imperatif>Migrasi dari perintah imperatif ke konfigurasi objek imperatif</h2><p>Migrsasi dari perintah imperatif ke konfigurasi objek imperatif melibatkan beberapa langkah manual.</p><ol><li>Ekspor objek <em>live</em> ke sebuah file konfigurasi objek lokal:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get &lt;kind&gt;/&lt;name&gt; -o yaml --export &gt; &lt;kind&gt;_&lt;name&gt;.yaml
</span></span></code></pre></div><ol><li><p>Hapus secara manual <em>field</em> status dari file konfigurasi objek.</p></li><li><p>Untuk pengelolaan objek selanjutnya, gunakan perintah <code>replace</code> secara eksklusif.</p></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl replace -f &lt;kind&gt;_&lt;name&gt;.yaml
</span></span></code></pre></div><h2 id=mendefinisikan-controller-selectors-dan-label-podtemplate>Mendefinisikan <em>controller selectors</em> dan label PodTemplate</h2><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Memperbarui <em>selectors</em> pada <em>controllers</em> sangat tidak disarankan.</div><p>Pendekatan yang direkomendasikan adalah mendefinisikan sebuah label PodTemplate tunggal dan <em>immutable</em> yang hanya digunakan oleh <em>controller selector</em> tersebut, tanpa makna semantik lainnya.</p><p>Contoh label:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>controller-selector</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;extensions/v1beta1/deployment/nginx&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>controller-selector</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;extensions/v1beta1/deployment/nginx&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><ul><li><a href=/id/docs/tasks/manage-kubernetes-objects/imperative-command/>Pengelolaan Objek Kubernetes Menggunakan Perintah Imperatif</a></li><li><a href=/id/docs/tasks/manage-kubernetes-objects/declarative-config/>Pengelolaan Objek Kubernetes secara Deklaratif dengan Menggunakan File Konfigurasi</a></li><li><a href=/docs/reference/generated/kubectl/kubectl-commands/>Rujukan Perintah Kubectl</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/>Rujukan API Kubernetes</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-866924fa095f897ede8dfdcab9e97942>6 - Memasukkan Data ke dalam Aplikasi</h1></div><div class=td-content><h1 id=pg-c9af1e81bb6e109f6c41febe44f0931b>6.1 - Mendefinisikan Perintah dan Argumen untuk sebuah Kontainer</h1><p>Laman ini menunjukkan bagaimana cara mendefinisikan perintah-perintah
dan argumen-argumen saat kamu menjalankan Container
dalam sebuah <a class=glossary-tooltip title='Unit Kubernetes yang paling sederhana dan kecil. Sebuah Pod merepresentasikan sebuah set kontainer yang dijalankan pada kluster kamu.' data-toggle=tooltip data-placement=top href=/docs/concepts/workloads/pods/pod-overview/ target=_blank aria-label=Pod>Pod</a>.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mendefinisikan-sebuah-perintah-dan-argumen-argumen-saat-kamu-membuat-sebuah-pod>Mendefinisikan sebuah perintah dan argumen-argumen saat kamu membuat sebuah Pod</h2><p>Saat kamu membuat sebuah Pod, kamu dapat mendefinisikan sebuah perintah dan argumen-argumen untuk
Container-Container yang berjalan di dalam Pod. Untuk mendefinisikan sebuah perintah, sertakan
bidang <code>command</code> di dalam berkas konfigurasi. Untuk mendefinisikan argumen-argumen untuk perintah, sertakan
bidang <code>args</code> di dalam berkas konfigurasi. Perintah dan argumen-argumen yang telah
kamu definisikan tidak dapat diganti setelah Pod telah terbuat.</p><p>Perintah dan argumen-argumen yang kamu definisikan di dalam berkas konfigurasi
membatalkan perintah dan argumen-argumen bawaan yang disediakan oleh <em>image</em> Container.
Jika kamu mendefinisikan argumen-argumen, tetapi tidak mendefinisikan sebuah perintah, perintah bawaan digunakan
dengan argumen-argumen baru kamu.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Bidang <code>command</code> menyerupai <code>entrypoint</code> di beberapa <em>runtime</em> Container.
Merujuk pada <a href=#catatan>catatan</a> di bawah.</div><p>Pada latihan ini, kamu akan membuat sebuah Pod baru yang menjalankan sebuah Container. Berkas konfigurasi
untuk Pod mendefinisikan sebuah perintah dan dua argumen:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/commands.yaml download=pods/commands.yaml><code>pods/commands.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-commands-yaml")' title="Copy pods/commands.yaml to clipboard"></img></div><div class=includecode id=pods-commands-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>command-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>purpose</span>:<span style=color:#bbb> </span>demonstrate-command<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>command-demo-container<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>debian<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;printenv&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;HOSTNAME&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;KUBERNETES_PORT&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>OnFailure<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Buat sebuah Pod dengan berkas konfigurasi YAML:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/commands.yaml
</span></span></code></pre></div></li><li><p>Daftar Pod yang sedang berjalan</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><p>Keluaran menunjukkan bahwa Container yang berjalan di dalam Pod command-demo
telah selesai.</p></li><li><p>Untuk melihat keluaran dari perintah yang berjalan di dalam Container, lihat log
dari Pod tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl logs command-demo
</span></span></code></pre></div><p>Keluaran menunjukan nilai dari variabel lingkungan HOSTNAME dan KUBERNETES_PORT:</p><pre tabindex=0><code>command-demo
tcp://10.3.240.1:443
</code></pre></li></ol><h2 id=menggunakan-variabel-lingkungan-untuk-mendefinisikan-argumen>Menggunakan variabel lingkungan untuk mendefinisikan argumen</h2><p>Dalam contoh sebelumnya, kamu mendefinisikan langsung argumen-argumen dengan
menyediakan <em>string</em>. Sebagai sebuah alternatif untuk menyediakan <em>string</em> secara langsung,
kamu dapat mendefinisikan argumen-argumen dengan menggunakan variabel lingkungan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MESSAGE<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;hello world&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;/bin/echo&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;$(MESSAGE)&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div><p>Ini berarti kamu dapat mendefinisikan sebuah argumen untuk sebuah Pod menggunakan
salah satu teknik yang tersedia untuk mendefinisikan variabel-variabel lingkungan, termasuk
<a href=/id/docs/tasks/configure-pod-container/configure-pod-configmap/>ConfigMap</a>
dan
<a href=/id/docs/concepts/configuration/secret/>Secret</a>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Variabel lingkugan muncul dalam tanda kurung, <code>"$(VAR)"</code>. Ini
dibutuhkan untuk variabel yang akan diperuluas di bidang <code>command</code> atau <code>args</code>.</div><h2 id=menjalankan-sebuah-perintah-di-dalam-shell>Menjalankan sebuah perintah di dalam shell</h2><p>Di beberapa kasus, kamu butuh perintah untuk menjalankan sebuah <em>shell</em>. Contohnya,
perintah kamu mungkin terdiri dari beberapa perintah yang digabungkan, atau mungkin berupa
skrip <em>shell</em>. Untuk menjalankan perintah kamu di sebuah <em>shell</em>, bungkus seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>command: <span style=color:#666>[</span><span style=color:#b44>&#34;/bin/sh&#34;</span><span style=color:#666>]</span>
</span></span><span style=display:flex><span>args: <span style=color:#666>[</span><span style=color:#b44>&#34;-c&#34;</span>, <span style=color:#b44>&#34;while true; do echo hello; sleep 10;done&#34;</span><span style=color:#666>]</span>
</span></span></code></pre></div><h2 id=catatan>Catatan</h2><p>Tabel ini merangkum nama-nama bidang yang digunakan oleh Docker dan Kubernetes.</p><table><thead><tr><th>Deskripsi</th><th>Nama bidang pada Docker</th><th>Nama bidang pada Kubernetes</th></tr></thead><tbody><tr><td>Perintah yang dijalankan oleh Container</td><td>Entrypoint</td><td>command</td></tr><tr><td>Argumen diteruskan ke perintah</td><td>Cmd</td><td>args</td></tr></tbody></table><p>Saat kamu mengesampingkan Entrypoint dan Cmd standar,
aturan-aturan ini berlaku:</p><ul><li><p>Jika kamu tidak menyediakan <code>command</code> atau <code>args</code> untuk sebuah Container,
maka <code>command</code> dan <code>args</code> yang didefinisikan di dalam <em>image</em> Docker akan digunakan.</p></li><li><p>Jika kamu menyediakan <code>command</code> tetapi tidak menyediakan <code>args</code> untuk sebuah Container, akan digunakan
<code>command</code> yang disediakan. Entrypoint dan Cmd bawaan yang didefinisikan di dalam
<em>image</em> Docker diabaikan.</p></li><li><p>Jika kamu hanya menyediakan <code>args</code> untuk sebuah Container, Entrypoint bawaan yang didefinisikan di dalam
<em>image</em> Docker dijalakan dengan <code>args</code> yang kamu sediakan.</p></li><li><p>Jika kamu menyediakan <code>command</code> dan <code>args</code>, Entrypoint dan Cmd standar yang didefinisikan
di dalam <em>image</em> Docker diabaikan. <code>command</code> kamu akan dijalankan dengan <code>args</code> kamu.</p></li></ul><p>Berikut ini beberapa contoh:</p><table><thead><tr><th>Image Entrypoint</th><th>Image Cmd</th><th>Container command</th><th>Container args</th><th>Command run</th></tr></thead><tbody><tr><td><code>[/ep-1]</code></td><td><code>[foo bar]</code></td><td>&lt;not set></td><td>&lt;not set></td><td><code>[ep-1 foo bar]</code></td></tr><tr><td><code>[/ep-1]</code></td><td><code>[foo bar]</code></td><td><code>[/ep-2]</code></td><td>&lt;not set></td><td><code>[ep-2]</code></td></tr><tr><td><code>[/ep-1]</code></td><td><code>[foo bar]</code></td><td>&lt;not set></td><td><code>[zoo boo]</code></td><td><code>[ep-1 zoo boo]</code></td></tr><tr><td><code>[/ep-1]</code></td><td><code>[foo bar]</code></td><td><code>[/ep-2]</code></td><td><code>[zoo boo]</code></td><td><code>[ep-2 zoo boo]</code></td></tr></tbody></table><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Pelajari lebih lanjut tentang <a href=/id/docs/tasks/>mengatur Pod and Container</a>.</li><li>Pelajari lebih lanjut tentang <a href=/id/docs/tasks/debug-application-cluster/get-shell-running-container/>menjalankan perintah di dalam sebuah Container</a>.</li><li>Lihat <a href=/docs/reference/generated/kubernetes-api/v1.25/#container-v1-core>Container</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-82c93897176489678232542102daea40>6.2 - Mendefinisikan Variabel Lingkungan untuk sebuah Kontainer</h1><p>Laman ini menunjukkan bagaimana cara untuk mendefinisikan variabel lingkungan (<em>environment variable</em>) untuk sebuah Container di dalam sebuah Pod Kubernetes.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mendefinisikan-sebuah-variabel-lingkungan-untuk-sebuah-container>Mendefinisikan sebuah variabel lingkungan untuk sebuah Container</h2><p>Ketika kamu membuat sebuah Pod, kamu dapat mengatur variabel lingkungan untuk Container-Container yang berjalan di dalam sebuah Pod.
Untuk mengatur variabel lingkungan, sertakan bagian <code>env</code> atau <code>envFrom</code> pada berkas konfigurasi.</p><p>Dalam latihan ini, kamu membuat sebuah Pod yang menjalankan satu buah Container.
Berkas konfigurasi untuk Pod tersebut mendefinisikan sebuah variabel lingkungan dengan nama <code>DEMO_GREETING</code> yang bernilai <code>"Hello from the environment"</code>.
Berikut berkas konfigurasi untuk Pod tersebut:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/inject/envars.yaml download=pods/inject/envars.yaml><code>pods/inject/envars.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-inject-envars-yaml")' title="Copy pods/inject/envars.yaml to clipboard"></img></div><div class=includecode id=pods-inject-envars-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envar-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>purpose</span>:<span style=color:#bbb> </span>demonstrate-envars<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envar-demo-container<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>gcr.io/google-samples/node-hello:1.0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>DEMO_GREETING<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Hello from the environment&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>DEMO_FAREWELL<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Such a sweet sorrow&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Buatlah sebuah Pod berdasarkan berkas konfigurasi YAML tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/inject/envars.yaml
</span></span></code></pre></div></li><li><p>Tampilkan Pod-Pod yang sedang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods -l <span style=color:#b8860b>purpose</span><span style=color:#666>=</span>demonstrate-envars
</span></span></code></pre></div><p>Keluarannya mirip seperti ini:</p><pre tabindex=0><code>NAME            READY     STATUS    RESTARTS   AGE
envar-demo      1/1       Running   0          9s
</code></pre></li><li><p>Dapatkan sebuah <em>shell</em> ke Container yang sedang berjalan di Pod kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it envar-demo -- /bin/bash
</span></span></code></pre></div></li><li><p>Di <em>shell</em> kamu, jalankan perintah <code>printenv</code> untuk melihat daftar variabel lingkungannya.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@envar-demo:/# printenv
</span></span></code></pre></div><p>Keluarannya mirip seperti ini:</p><pre tabindex=0><code>NODE_VERSION=4.4.2
EXAMPLE_SERVICE_PORT_8080_TCP_ADDR=10.3.245.237
HOSTNAME=envar-demo
...
DEMO_GREETING=Hello from the environment
DEMO_FAREWELL=Such a sweet sorrow
</code></pre></li><li><p>Untuk keluar dari <em>shell</em> tersebut, masukkan perintah <code>exit</code>.</p></li></ol><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Variabel-variabel lingkungan yang diatur menggunakan bagian <code>env</code> atau <code>envFrom</code> akan mengesampingkan
variabel-variabel lingkungan yang ditentukan di dalam <em>image</em> kontainer.</div><h2 id=menggunakan-variabel-variabel-lingkungan-di-dalam-konfigurasi-kamu>Menggunakan variabel-variabel lingkungan di dalam konfigurasi kamu</h2><p>Variabel-variabel lingkungan yang kamu definisikan di dalam sebuah konfigurasi Pod dapat digunakan di tempat lain dalam konfigurasi, contohnya di dalam perintah-perintah dan argumen-argumen yang kamu atur dalam Container-Container milik Pod.
Pada contoh konfigurasi berikut, variabel-variabel lingkungan <code>GREETING</code>, <code>HONORIFIC</code>, dan <code>NAME</code> disetel masing-masing menjadi <code>Warm greetings to</code>, <code>The Most Honorable</code>, dan <code>Kubernetes</code>.
Variabel-variabel lingkungan tersebut kemudian digunakan dalam argumen CLI yang diteruskan ke Container <code>env-print-demo</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>print-greeting<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>env-print-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>bash<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>GREETING<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Warm greetings to&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>HONORIFIC<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;The Most Honorable&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>NAME<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Kubernetes&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;echo&#34;</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;$(GREETING) $(HONORIFIC) $(NAME)&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div><p>Setelah dibuat, perintah <code>echo Warm greetings to The Most Honorable Kubernetes</code> dijalankan di Container tersebut.</p><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Pelajari lebih lanjut tentang <a href=/docs/tasks/inject-data-application/environment-variable-expose-pod-information/>variabel lingkungan</a>.</li><li>Pelajari tentang <a href=/docs/user-guide/secrets/#using-secrets-as-environment-variables>menggunakan informasi rahasia sebagai variabel lingkungan</a>.</li><li>Lihat <a href=/docs/reference/generated/kubernetes-api/v1.25/#envvarsource-v1-core>EnvVarSource</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-7f9454a1e775548c23ee5b300a9218a3>6.3 - Mendistribusikan Kredensial dengan Aman Menggunakan Secret</h1><p>Laman ini menjelaskan bagaimana cara menginjeksi data sensitif, seperti kata sandi (<em>password</em>) dan kunci enkripsi, ke dalam Pod.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul><h3 id=mengubah-data-rahasia-kamu-ke-dalam-representasi-base64>Mengubah data rahasia kamu ke dalam representasi Base64</h3><p>Misalnya kamu mempunyai dua buah data rahasia: sebuah nama pengguna <code>my-app</code> dan kata sandi
<code>39528$vdg7Jb</code>. Pertama, gunakan alat penyandian Base64 untuk mengubah nama pengguna kamu dan kata sandi ke dalam representasi Base64. Berikut ini contoh menggunakan program Base64 yang umum digunakan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>echo</span> -n <span style=color:#b44>&#39;my-app&#39;</span> | base64
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> -n <span style=color:#b44>&#39;39528$vdg7Jb&#39;</span> | base64
</span></span></code></pre></div><p>Hasil keluaran menampilkan representasi Base64 dari nama pengguna kamu yaitu <code>bXktYXBw</code>,
dan representasi Base64 dari kata sandi kamu yaitu <code>Mzk1MjgkdmRnN0pi</code>.</p><div class="alert alert-warning caution callout" role=alert><strong>Perhatian:</strong> Gunakan alat yang telah dipercayai oleh OS kamu untuk menghindari risiko dari penggunaan alat eksternal.</div><h2 id=membuat-secret>Membuat Secret</h2><p>Berikut ini adalah berkas konfigurasi yang dapat kamu gunakan untuk membuat Secret yang akan menampung nama pengguna dan kata sandi kamu:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/inject/secret.yaml download=pods/inject/secret.yaml><code>pods/inject/secret.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-inject-secret-yaml")' title="Copy pods/inject/secret.yaml to clipboard"></img></div><div class=includecode id=pods-inject-secret-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Secret<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-secret<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>bXktYXBw<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span>Mzk1MjgkdmRnN0pi<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Membuat Secret</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/inject/secret.yaml
</span></span></code></pre></div></li><li><p>Melihat informasi dari Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get secret test-secret
</span></span></code></pre></div><p>Hasil keluaran:</p><pre tabindex=0><code>NAME          TYPE      DATA      AGE
test-secret   Opaque    2         1m
</code></pre></li><li><p>Melihat informasi detil dari Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe secret test-secret
</span></span></code></pre></div><p>Hasil keluaran:</p><pre tabindex=0><code>Name:       test-secret
Namespace:  default
Labels:     &lt;none&gt;
Annotations:    &lt;none&gt;

Type:   Opaque

Data
====
password:   13 bytes
username:   7 bytes
</code></pre></li></ol><h3 id=membuat-secret-langsung-dengan-kubectl>Membuat Secret langsung dengan kubectl</h3><p>Jika kamu ingin melompati langkah penyandian dengan Base64, kamu dapat langsung membuat Secret yang sama dengan menggunakan perintah <code>kubectl create secret</code>. Contohnya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret generic test-secret --from-literal<span style=color:#666>=</span><span style=color:#b44>&#39;username=my-app&#39;</span> --from-literal<span style=color:#666>=</span><span style=color:#b44>&#39;password=39528$vdg7Jb&#39;</span>
</span></span></code></pre></div><p>Tentu saja ini lebih mudah. Pendekatan yang mendetil setiap langkah di atas bertujuan untuk mendemonstrasikan apa yang sebenarnya terjadi pada setiap langkah.</p><h2 id=membuat-pod-yang-memiliki-akses-ke-data-secret-melalui-volume>Membuat Pod yang memiliki akses ke data Secret melalui Volume</h2><p>Berikut ini adalah berkas konfigurasi yang dapat kamu gunakan untuk membuat Pod:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/inject/secret-pod.yaml download=pods/inject/secret-pod.yaml><code>pods/inject/secret-pod.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-inject-secret-pod-yaml")' title="Copy pods/inject/secret-pod.yaml to clipboard"></img></div><div class=includecode id=pods-inject-secret-pod-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>secret-test-pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># nama harus sesuai dengan nama Volume di bawah ini</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>secret-volume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/etc/secret-volume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Data Secret diekspos ke Container di dalam Pod melalui Volume</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>secret-volume<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>secret</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>secretName</span>:<span style=color:#bbb> </span>test-secret<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/pods/inject/secret-pod.yaml
</span></span></code></pre></div></li><li><p>Verifikasikan apakah Pod kamu sudah berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod secret-test-pod
</span></span></code></pre></div><p>Hasil keluaran:</p><pre tabindex=0><code>NAME              READY     STATUS    RESTARTS   AGE
secret-test-pod   1/1       Running   0          42m
</code></pre></li><li><p>Gunakan <em>shell</em> untuk masuk ke dalam Container yang berjalan di dalam Pod kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -i -t secret-test-pod -- /bin/bash
</span></span></code></pre></div></li><li><p>Data Secret terekspos ke Container melalui Volume yang dipasang (<em>mount</em>) pada
<code>/etc/secret-volume</code>.</p><p>Di dalam <em>shell</em> kamu, tampilkan berkas yang ada di dalam direktori <code>/etc/secret-volume</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Jalankan ini di dalam shell dalam Container</span>
</span></span><span style=display:flex><span>ls /etc/secret-volume
</span></span></code></pre></div><p>Hasil keluaran menampilkan dua buah berkas, masing-masing untuk setiap data Secret:</p><pre tabindex=0><code>password username
</code></pre></li><li><p>Di dalam <em>shell</em> kamu, tampilkan konten dari berkas <code>username</code> dan <code>password</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Jalankan ini di dalam shell dalam Container</span>
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;</span><span style=color:#a2f;font-weight:700>$(</span> cat /etc/secret-volume/username <span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a2f>echo</span> <span style=color:#b44>&#34;</span><span style=color:#a2f;font-weight:700>$(</span> cat /etc/secret-volume/password <span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>&#34;</span>
</span></span></code></pre></div><p>Hasil keluarannya adalah nama pengguna dan kata sandi kamu:</p><pre tabindex=0><code>my-app
39528$vdg7Jb
</code></pre></li></ol><h2 id=mendefinisikan-variabel-lingkungan-container-menggunakan-data-secret>Mendefinisikan variabel lingkungan Container menggunakan data Secret</h2><h3 id=mendefinisikan-variabel-lingkungan-container-menggunakan-data-dari-secret-tunggal>Mendefinisikan variabel lingkungan Container menggunakan data dari Secret tunggal</h3><ul><li><p>Definisikan variabel lingkungan sebagai pasangan <em>key-value</em> pada Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret generic backend-user --from-literal<span style=color:#666>=</span>backend-username<span style=color:#666>=</span><span style=color:#b44>&#39;backend-admin&#39;</span>
</span></span></code></pre></div></li><li><p>Tentukan nilai <code>backend-username</code> yang didefinisikan di Secret ke variabel lingkungan <code>SECRET_USERNAME</code> di dalam spesifikasi Pod.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/inject/pod-single-secret-env-variable.yaml download=pods/inject/pod-single-secret-env-variable.yaml><code>pods/inject/pod-single-secret-env-variable.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-inject-pod-single-secret-env-variable-yaml")' title="Copy pods/inject/pod-single-secret-env-variable.yaml to clipboard"></img></div><div class=includecode id=pods-inject-pod-single-secret-env-variable-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>env-single-secret<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envars-test-container<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SECRET_USERNAME<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>secretKeyRef</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>backend-user<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>backend-username<span style=color:#bbb>
   </span></span></span></code></pre></div></div></div></li><li><p>Membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/pods/inject/pod-single-secret-env-variable.yaml
</span></span></code></pre></div></li><li><p>Di dalam <em>shell</em> kamu, tampilkan konten dari variabel lingkungan <code>SECRET_USERNAME</code> dari Container</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -i -t env-single-secret -- /bin/sh -c <span style=color:#b44>&#39;echo $SECRET_USERNAME&#39;</span>
</span></span></code></pre></div><p>Hasil keluarannya</p><pre tabindex=0><code>backend-admin
</code></pre></li></ul><h3 id=mendefinisikan-variabel-lingkungan-container-dengan-data-dari-multipel-secret>Mendefinisikan variabel lingkungan Container dengan data dari multipel Secret</h3><ul><li><p>Seperti contoh sebelumnya, buat Secret terlebih dahulu.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret generic backend-user --from-literal<span style=color:#666>=</span>backend-username<span style=color:#666>=</span><span style=color:#b44>&#39;backend-admin&#39;</span>
</span></span><span style=display:flex><span>kubectl create secret generic db-user --from-literal<span style=color:#666>=</span>db-username<span style=color:#666>=</span><span style=color:#b44>&#39;db-admin&#39;</span>
</span></span></code></pre></div></li><li><p>Definisikan variabel lingkungan di dalam spesifikasi Pod.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/inject/pod-multiple-secret-env-variable.yaml download=pods/inject/pod-multiple-secret-env-variable.yaml><code>pods/inject/pod-multiple-secret-env-variable.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-inject-pod-multiple-secret-env-variable-yaml")' title="Copy pods/inject/pod-multiple-secret-env-variable.yaml to clipboard"></img></div><div class=includecode id=pods-inject-pod-multiple-secret-env-variable-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envvars-multiple-secrets<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envars-test-container<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>BACKEND_USERNAME<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>secretKeyRef</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>backend-user<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>backend-username<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>DB_USERNAME<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>secretKeyRef</span>:<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>db-user<span style=color:#bbb>
   </span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>db-username<span style=color:#bbb>
   </span></span></span></code></pre></div></div></div></li><li><p>Membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/pods/inject/pod-multiple-secret-env-variable.yaml
</span></span></code></pre></div></li><li><p>Di dalam <em>shell</em> kamu, tampilkan konten dari variabel lingkungan Container</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -i -t envvars-multiple-secrets -- /bin/sh -c <span style=color:#b44>&#39;env | grep _USERNAME&#39;</span>
</span></span></code></pre></div><p>Hasil keluarannya</p><pre tabindex=0><code>DB_USERNAME=db-admin
BACKEND_USERNAME=backend-admin
</code></pre></li></ul><h2 id=mengonfigurasi-semua-pasangan-key-value-di-dalam-secret-sebagai-variabel-lingkungan-container>Mengonfigurasi semua pasangan <em>key-value</em> di dalam Secret sebagai variabel lingkungan Container</h2><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Fitur ini tersedia mulai dari Kubernetes v1.6 dan yang lebih baru.</div><ul><li><p>Membuat Secret yang berisi banyak pasangan <em>key-value</em></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret generic test-secret --from-literal<span style=color:#666>=</span><span style=color:#b8860b>username</span><span style=color:#666>=</span><span style=color:#b44>&#39;my-app&#39;</span> --from-literal<span style=color:#666>=</span><span style=color:#b8860b>password</span><span style=color:#666>=</span><span style=color:#b44>&#39;39528$vdg7Jb&#39;</span>
</span></span></code></pre></div></li><li><p>Gunakan envFrom untuk mendefinisikan semua data Secret sebagai variabel lingkungan Container. <em>Key</em> dari Secret akan mennjadi nama variabel lingkungan di dalam Pod.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/pods/inject/pod-secret-envFrom.yaml download=pods/inject/pod-secret-envFrom.yaml><code>pods/inject/pod-secret-envFrom.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("pods-inject-pod-secret-envfrom-yaml")' title="Copy pods/inject/pod-secret-envFrom.yaml to clipboard"></img></div><div class=includecode id=pods-inject-pod-secret-envfrom-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envfrom-secret<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envars-test-container<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>envFrom</span>:<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>secretRef</span>:<span style=color:#bbb>
    </span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-secret<span style=color:#bbb>
    </span></span></span></code></pre></div></div></div></li><li><p>Membuat Pod:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/pods/inject/pod-secret-envFrom.yaml
</span></span></code></pre></div></li><li><p>Di dalam <em>shell</em> kamu, tampilkan variabel lingkungan Container <code>username</code> dan <code>password</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -i -t envfrom-secret -- /bin/sh -c <span style=color:#b44>&#39;echo &#34;username: $username\npassword: $password\n&#34;&#39;</span>
</span></span></code></pre></div><p>Hasil keluarannya</p><pre tabindex=0><code>username: my-app
password: 39528$vdg7Jb
</code></pre></li></ul><h3 id=referensi>Referensi</h3><ul><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#secret-v1-core>Secret</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#volume-v1-core>Volume</a></li><li><a href=/docs/reference/generated/kubernetes-api/v1.25/#pod-v1-core>Pod</a></li></ul><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Pelajari lebih lanjut <a href=/id/docs/concepts/configuration/secret/>Secret</a>.</li><li>Pelajari lebih lanjut <a href=/id/docs/concepts/storage/volumes/>Volume</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a78a5e7e765fd8c49c8f7c0d72499f72>7 - Menjalankan</h1><div class=lead>Menjalankan dan mengatur aplikasi stateless dan stateful.</div></div><div class=td-content><h1 id=pg-790ea02857492b3a822e981e93e3a98b>7.1 - Menjalankan Aplikasi Stateless Menggunakan Deployment</h1><p>Dokumen ini menunjukkan cara bagaimana cara menjalankan sebuah aplikasi menggunakan objek Deployment Kubernetes.</p><h2 id=tujuan>Tujuan</h2><ul><li>Membuat sebuah Deployment Nginx.</li><li>Menggunakan kubectl untuk mendapatkan informasi mengenai Deployment.</li><li>Mengubah Deployment.</li></ul><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Kubernetes servermu harus dalam versi yang sama atau lebih baru dari v1.9.
Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=membuat-dan-menjelajahi-deployment-nginx>Membuat dan Menjelajahi Deployment Nginx</h2><p>Kamu dapat menjalankan aplikasi dengan membuat sebuah objek Deployment Kubernetes, dan kamu
dapat mendeskripsikan sebuah Deployment di dalam berkas YAML. Sebagai contohnya, berkas
YAML berikut mendeskripsikan sebuah Deployment yang menjalankan <em>image</em> Docker nginx:1.14.2:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/deployment.yaml download=application/deployment.yaml><code>application/deployment.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-deployment-yaml")' title="Copy application/deployment.yaml to clipboard"></img></div><div class=includecode id=application-deployment-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># for versions before 1.9.0 use apps/v1beta2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># tells deployment to run 2 pods matching the template</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.7.9<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Buatlah sebuah Deployment berdasarkan berkas YAML:</p><pre><code> kubectl apply -f https://k8s.io/examples/application/deployment.yaml
</code></pre></li><li><p>Tampilkan informasi dari Deployment:</p><pre><code> kubectl describe deployment nginx-deployment
</code></pre><p>Keluaran dari perintah tersebut akan menyerupai:</p><pre><code> Name:     nginx-deployment
 Namespace:    default
 CreationTimestamp:  Tue, 30 Aug 2016 18:11:37 -0700
 Labels:     app=nginx
 Annotations:    deployment.kubernetes.io/revision=1
 Selector:   app=nginx
 Replicas:   2 desired | 2 updated | 2 total | 2 available | 0 unavailable
 StrategyType:   RollingUpdate
 MinReadySeconds:  0
 RollingUpdateStrategy:  1 max unavailable, 1 max surge
 Pod Template:
   Labels:       app=nginx
   Containers:
    nginx:
     Image:              nginx:1.14.2
     Port:               80/TCP
     Environment:        &lt;none&gt;
     Mounts:             &lt;none&gt;
   Volumes:              &lt;none&gt;
 Conditions:
   Type          Status  Reason
   ----          ------  ------
   Available     True    MinimumReplicasAvailable
   Progressing   True    NewReplicaSetAvailable
 OldReplicaSets:   &lt;none&gt;
 NewReplicaSet:    nginx-deployment-1771418926 (2/2 replicas created)
 No events.
</code></pre></li><li><p>Lihatlah daftar Pod-Pod yang dibuat oleh Deployment:</p><pre><code> kubectl get pods -l app=nginx
</code></pre><p>Keluaran dari perintah tersebut akan menyerupai:</p><pre><code> NAME                                READY     STATUS    RESTARTS   AGE
 nginx-deployment-1771418926-7o5ns   1/1       Running   0          16h
 nginx-deployment-1771418926-r18az   1/1       Running   0          16h
</code></pre></li><li><p>Tampilkan informasi mengenai Pod:</p><pre><code> kubectl describe pod &lt;nama-pod&gt;
</code></pre><p>dimana <code>&lt;nama-pod></code> merupakan nama dari Pod kamu.</p></li></ol><h2 id=mengubah-deployment>Mengubah Deployment</h2><p>Kamu dapat mengubah Deployment dengan cara mengaplikasikan berkas YAML yang baru.
Berkas YAML ini memberikan spesifikasi Deployment untuk menggunakan Nginx versi 1.16.1.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/deployment-update.yaml download=application/deployment-update.yaml><code>application/deployment-update.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-deployment-update-yaml")' title="Copy application/deployment-update.yaml to clipboard"></img></div><div class=includecode id=application-deployment-update-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># untuk versi sebelum 1.9.0 gunakan apps/v1beta2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.16.1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># Memperbarui versi nginx dari 1.14.2 ke 1.16.1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Terapkan berkas YAML yang baru:</p><pre><code>  kubectl apply -f https://k8s.io/examples/application/deployment-update.yaml
</code></pre></li><li><p>Perhatikan bahwa Deployment membuat Pod-Pod dengan nama baru dan menghapus Pod-Pod lama:</p><pre><code>  kubectl get pods -l app=nginx
</code></pre></li></ol><h2 id=meningkatkan-jumlah-aplikasi-dengan-meningkatkan-ukuran-replika>Meningkatkan Jumlah Aplikasi dengan Meningkatkan Ukuran Replika</h2><p>Kamu dapat meningkatkan jumlah Pod di dalam Deployment dengan menerapkan
berkas YAML baru. Berkas YAML ini akan meningkatkan jumlah replika menjadi 4,
yang nantinya memberikan spesifikasi agar Deployment memiliki 4 buah Pod.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/deployment-scale.yaml download=application/deployment-scale.yaml><code>application/deployment-scale.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-deployment-scale-yaml")' title="Copy application/deployment-scale.yaml to clipboard"></img></div><div class=includecode id=application-deployment-scale-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb> </span><span style=color:#080;font-style:italic># untuk versi sebelum 1.9.0 gunakan apps/v1beta2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>4</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># Memperbarui replica dari 2 menjadi 4</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx:1.14.2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><ol><li><p>Terapkan berkas YAML:</p><pre><code> kubectl apply -f https://k8s.io/examples/application/deployment-scale.yaml
</code></pre></li><li><p>Verifikasi Deployment kamu saat ini yang memiliki empat Pod:</p><pre><code> kubectl get pods -l app=nginx
</code></pre><p>Keluaran dari perintah tersebut akan menyerupai:</p><pre><code> NAME                               READY     STATUS    RESTARTS   AGE
 nginx-deployment-148880595-4zdqq   1/1       Running   0          25s
 nginx-deployment-148880595-6zgi1   1/1       Running   0          25s
 nginx-deployment-148880595-fxcez   1/1       Running   0          2m
 nginx-deployment-148880595-rwovn   1/1       Running   0          2m
</code></pre></li></ol><h2 id=menghapus-deployment>Menghapus Deployment</h2><p>Menghapus Deployment dengan nama:</p><pre><code>kubectl delete deployment nginx-deployment
</code></pre><h2 id=cara-lama-menggunakan-replicationcontroller>Cara Lama Menggunakan: ReplicationController</h2><p>Cara yang dianjurkan untuk membuat aplikasi dengan replika adalah dengan menggunakan Deployment,
yang nantinya akan menggunakan ReplicaSet. Sebelum Deployment dan ReplicaSet ditambahkan
ke Kubernetes, aplikasi dengan replika dikonfigurasi menggunakan <a href=/id/docs/concepts/workloads/controllers/replicationcontroller/>ReplicationController</a>.</p><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Pelajari lebih lanjut mengenai <a href=/id/docs/concepts/workloads/controllers/deployment/>objek Deployment</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f5f2f7a74377a9d45325c5253353fa8f>7.2 - Menghapus Paksa Pod StatefulSet</h1><p>Laman ini menjelaskan bagaimana cara menghapus Pod yang menjadi bagian dari sebuah <a class=glossary-tooltip title='Melakukan proses manajemen deployment dan scaling dari sebuah set Pod, serta menjamin mekanisme ordering dan keunikan dari Pod ini.' data-toggle=tooltip data-placement=top href=/docs/concepts/workloads/controllers/statefulset/ target=_blank aria-label='stateful set'>stateful set</a>, dan menjelaskan pertimbangan yang harus diperhatikan saat melakukannya.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><ul><li>Ini merupakan tugas yang cukup rumit dan memiliki potensi melanggar beberapa properti yang melekat dari StatefulSet.</li><li>Sebelum melanjutkan, pastikan kamu paham dengan pertimbangan yang disebutkan di bawah ini.</li></ul><h2 id=pertimbangan-statefulset>Pertimbangan StatefulSet</h2><p>Pada operasi normal dari StatefulSet, <strong>tidak pernah</strong> ada kebutuhan untuk menghapus paksa sebuah Pod StatefulSet. <a href=/id/docs/concepts/workloads/controllers/statefulset/><em>Controller</em> StatefulSet</a> bertanggung jawab terhadap pembuatan, penyekalaan dan penghapusan terhadap anggota dari StatefulSet. <em>Controller</em> akan berusaha menjaga agar jumlah Pod yang ditentukan dari 0 hingga N-1 hidup dan siap sedia. StatefulSet memastikan bahwa, pada waktu kapanpun, akan ada minimal satu Pod dengan identitas yang telah ditetapkan berjalan pada klaster. Hal ini direferensikan sebagai semantik <em>at most one</em> yang disediakan StatefulSet.</p><p>Penghapusan paksa secara manual harus dilakukan dengan hati-hati, karena hal tersebut berpotensi melanggar semantik <em>at most one</em> yang melekat pada StatefulSet. StatefulSet dapat digunakan untuk menjalankan aplikasi terklaster dan terdistribusi yang membutuhkan identitas jaringan dan penyimpanan yang stabil dan tetap. Aplikasi-aplikasi ini biasanya memiliki konfigurasi yang tergantung dengan sejumlah anggota dengan identitas yang tetap. Memiliki banyak anggota dengan identitas yang sama berpotensi menimbulkan kerusakan dan kehilangan data (contohnya skenario <em>split brain</em> pada sistem berbasis kuorum).</p><h2 id=menghapus-pod>Menghapus Pod</h2><p>Kamu dapat melakukan penghapusan Pod secara <em>graceful</em> dengan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pods &lt;pod&gt;
</span></span></code></pre></div><p>Agar perintah di atas mengarah ke terminasi secara <em>graceful</em>, Pod <strong>tidak boleh</strong> menspesifikasikan <code>pod.Spec.TerminationGracePeriodSeconds</code> dengan nilai 0. Praktik untuk mengatur nilai <code>pod.Spec.TerminationGracePeriodSeconds</code> menjadi 0 detik merupakan hal yang tidak aman dan sangat tidak disarankan untuk Pod StatefulSet. Penghapusan secara <em>graceful</em> itu aman dan akan memastikan bahwa Pod <a href=/id/docs/concepts/workloads/pods/pod-lifecycle/#pod-termination>akan mati secara <em>gracefully</em></a> sebelum kubelet menghapus nama dari apiserver.</p><p>Kubernetes (versi 1.5 atau lebih baru) tidak akan menghapus Pod hanya karena Node tidak dapat dijangkau. Pod yang berjalan pada Node yang tidak dapat dijangkau akan memasuki keadaan 'Terminating' atau 'Unknown' setelah <a href=/id/docs/admin/node/#node-condition>waktu habis</a>. Pod juga dapat memasuki keadaan ini saat pengguna berusaha melakukan penghapusan secara <em>graceful</em> terhadap Pod pada Node yang tidak dapat dijangkau. Cara yang hanya dapat dilakukan untuk menghapus Pod pada keadaan tersebut dari apiserver adalah:</p><ul><li>Objek Node telah dihapus (baik oleh kamu, atau oleh <a href=/id/docs/admin/node><em>Controller</em> Node</a>).<br></li><li>Kubelet pada Node yang tidak responsif akan menanggapi, lalu mematikan Pod dan menghapusnya dari apiserver.<br></li><li>Penghapusan paksa Pod oleh pengguna.</li></ul><p>Praktik terbaik yang direkomendasikan adalah menggunakan pendekatan pertama atau kedua. Jika sebuah Node telah terkonfirmasi mati (contohnya terputus dari jaringan secara permanen, dimatikan, dll), maka objek Node dihapus. Jika Node mengalami partisi jaringan, maka coba selesaikan masalah ini atau menunggu masalah itu terselesaikan. Saat partisi terselesaikan, kubelet akan menyelesaikan penghapusan Pod serta membebaskan namanya dari apiserver.</p><p>Normalnya, sistem akan menyelesaikan penghapusan saat Pod tidak lagi berjalan pada Node, atau Node telah dihapus oleh administrator. Kamu dapat mengabaikan hal ini dengan menghapus paksa Pod.</p><h3 id=penghapusan-paksa>Penghapusan Paksa</h3><p>Penghapusan paksa <strong>tidak</strong> menunggu konfirmasi dari kubelet bahwa Pod telah diterminasi. Terlepas dari apakah penghapusan paksa sukses mematikan sebuah Pod, namanya akan segera dibebaskan dari apiserver. Hal ini berakibat <em>controller</em> StatefulSet akan membuat Pod pengganti dengan identitas yang sama; ini dapat menimbulkan duplikasi terhadap Pod apabila ternyata Pod tersebut masih berjalan, dan jika Pod tersebut masih dapat berkomunikasi dengan anggota Statefulset lainnya, hal ini berakibat terjadi pelanggaran semantik <em>at most one</em> dari StatefulSet yang telah dijamin.</p><p>Saat kamu menghapus paksa sebuah Pod StatefulSet, berarti kamu menjamin bahwa Pod tersebut tidak akan pernah lagi berkomunikasi dengan Pod lain pada StatefulSet dan namanya dapat dibebaskan secara aman untuk pembuatan penggantinya.</p><p>Jika kamu ingin menghapus paksa Pod dengan menggunakan kubectl versi >= 1.5, lakukan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pods &lt;pod&gt; --grace-period<span style=color:#666>=</span><span style=color:#666>0</span> --force
</span></span></code></pre></div><p>Jika kamu menggunakan kubectl &lt;= 1.4, kamu harus menghilangkan pilihan <code>--force</code> dan gunakan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete pods &lt;pod&gt; --grace-period<span style=color:#666>=</span><span style=color:#666>0</span>
</span></span></code></pre></div><p>Jika setelah perintah ini dijalankan dan Pod tetap berada pada kondisi <code>Unknown</code>, gunakan perintah berikut untuk menghapus Pod dari klaster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl patch pod &lt;pod&gt; -p <span style=color:#b44>&#39;{&#34;metadata&#34;:{&#34;finalizers&#34;:null}}&#39;</span>
</span></span></code></pre></div><p>Selalu jalankan penghapusan paksa Pod StatefulSet dengan hati-hati dan penuh pemahaman terhadap risiko yang dapat timbul.</p><h2 id=selanjutnya>Selanjutnya</h2><p>Pelajari lebih lanjut <a href=/docs/tasks/debug-application-cluster/debug-stateful-set/><em>debugging</em> StatefulSet</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0c0bb1bd76d2a9069e50e2cec6d20c2a>7.3 - HorizontalPodAutoscaler</h1><p>HorizontalPodAutoscaler secara otomatis akan memperbanyak jumlah Pod di dalam ReplicationController, Deployment,
ReplicaSet ataupun StatefulSet berdasarkan hasil observasi penggunaan CPU(atau, dengan
<a href=https://git.k8s.io/community/contributors/design-proposals/instrumentation/custom-metrics-api.md>metrik khusus</a>, pada beberapa aplikasi yang menyediakan metrik).
Perlu dicatat bahwa HorizontalPodAutoscale tidak dapat diterapkan pada objek yang tidak dapat diperbanyak, seperti DeamonSets.</p><p>HorizontalPodAutoscaler diimplementasikan sebagai Kubernetes API <em>resource</em> dan sebuah <em>controller</em>.
<em>Resource</em> tersebut akan menentukan perilaku dari <em>controller</em>-nya.
Kontroler akan mengubah jumlah replika pada ReplicationController atau pada Deployment untuk menyesuaikan dengan hasil observasi rata-rata
penggunaan CPU sesuai dengan yang ditentukan oleh pengguna.</p><h2 id=bagaimana-cara-kerja-horizontalpodautoscaler>Bagaimana cara kerja HorizontalPodAutoscaler?</h2><p><img src=/images/docs/horizontal-pod-autoscaler.svg alt="Diagram HorizontalPodAutoscaler"></p><p>HorizontalPodAutoscaler diimplementasikan sebagai sebuah <em>loop</em> kontrol, yang secara
berkala dikontrol oleh <em>flag</em> <code>--horizontal-pod-autoscaler-sync-period</code> pada <em>controller manager</em>
(dengan nilai bawaan 15 detik).</p><p>Dalam setiap periode, <em>controller manager</em> melakukan kueri penggunaan sumber daya dan membandingkan
dengan metrik yang dispesifikasikan pada HorizontalPodAutoscaler. <em>Controller manager</em> mendapat
metrik dari sumber daya metrik API (untuk metrik per Pod) atau dari API metrik khusus (untuk semua metrik lainnya).</p><ul><li><p>Untuk metrik per Pod (seperti CPU), <em>controller</em> mengambil metrik dari sumber daya metrik API
untuk setiap Pod yang ditargetkan oleh HorizontalPodAutoscaler. Kemudian, jika nilai target penggunaan ditentukan,
maka <em>controller</em> akan menghitung nilai penggunaan sebagai persentasi dari pengguaan sumber daya dari Container
pada masing-masing Pod. Jika target nilai mentah (<em>raw value</em>) ditentukan, maka nilai metrik mentah (<em>raw metric</em>)
akan digunakan secara langsung. <em>Controller</em> kemudian mengambil nilai rata-rata penggunaan atau nilai mentah (tergantung
dengan tipe target yang ditentukan) dari semua Pod yang ditargetkan dan menghasilkan perbandingan yang
digunakan untuk menentukan jumlah replika yang akan diperbanyak.</p><p>Perlu dicatat bahwa jika beberapa Container pada Pod tidak memiliki nilai <em>resource request</em>, penggunaan CPU
pada Pod tersebut tidak akan ditentukan dan <em>autoscaler</em> tidak akan melakukan tindakan apapun untuk metrik tersebut.
Perhatikan pada bagian <a href=#detail-algoritma>detail algoritma</a> di bawah ini untuk informasi lebih lanjut mengenai
cara kerja algoritma <em>autoscale</em>.</p></li><li><p>Untuk metrik khusus per Pod, <em>controller</em> bekerja sama seperti sumber daya metrik per Pod,
kecuali Pod bekerja dengan nilai mentah, bukan dengan nilai utilisasi (<em>utilization values</em>).</p></li><li><p>Untuk objek metrik dan metrik eksternal, sebuah metrik diambil, dimana metrik tersebut menggambarkan
objek tersebut. Metrik ini dibandingkan dengan nilai target untuk menghasilkan perbandingan seperti di atas.
Pada API <code>autoscaling/v2beta2</code>, nilai perbandingan dapat secara opsional dibagi dengan jumlah Pod
sebelum perbandingan dibuat.</p></li></ul><p>Pada normalnya, HorizontalPodAutoscaler mengambil metrik dari serangkaian API yang sudah diagregat
(<code>custom.metric.k8s.io</code>, dan <code>external.metrics.k8s.io</code>). API <code>metrics.k8s.io</code> biasanya disediakan oleh
<em>metric-server</em>, dimana <em>metric-server</em> dijalankan secara terpisah. Perhatikan
<a href=/docs/tasks/debug-application-cluster/resource-metrics-pipeline/#metrics-server><em>metrics-server</em></a> sebagai petunjuk.
HorizontalPodAutoscaler juga mengambil metrik dari Heapster secara langsung.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.11 [deprecated]</code></div><p>Pengambian metrik dari Heapster tidak didukung lagi pada Kubernetes versi 1.11.</div><p>Perhatikan <a href=#dukungan-untuk-api-metrik>Dukungan untuk API metrik</a> untuk lebih detail.</p><p><em>Autoscaler</em> mengkases <em>controller</em> yang dapat diperbanyak (seperti ReplicationController, Deployment, dan ReplicaSet)
dengan menggunakan <em>scale sub-resource</em>. Untuk lebih detail mengenai <em>scale sub-resource</em> dapat ditemukan
<a href=https://git.k8s.io/community/contributors/design-proposals/autoscaling/horizontal-pod-autoscaler.md#scale-subresource>di sini</a>.</p><h3 id=detail-algoritma>Detail Algoritma</h3><p>Dari sudut pandang paling sederhana, <em>controller</em> HorizontalPodAutoscaler mengoperasikan
perbandingan metrik yang diinginkan dengan kedaan metrik sekarang.</p><pre tabindex=0><code>desiredReplicas = ceil[currentReplicas * ( currentMetricValue / desiredMetricValue )]
</code></pre><p>Sebagai contoh, jika nilai metrik sekarang adalah <code>200m</code> dan nilai metrik yang
diinginkan adalah <code>100m</code>, jumlah replika akan ditambah dua kali lipat,
karena <code>200.0 / 100.0 == 2.0</code>. Jika nilai metrik sekarang adalah <code>50m</code>,
maka jumlah replika akan dikurangi setengah, karena <code>50.0 / 100.0 == 0.5</code>.
Kita tetap memperbanyak replika (<em>scale</em>) jika nilai perbandingan mendekati 1.0 (dalam toleransi yang
dapat dikonfigurasi secata global, dari <em>flag</em> <code>--horizontal-pod-autoscaler-tolerance</code>
dengan nilai bawaan 0.1.</p><p>Ketika <code>targetAverageValue</code> (nilai target rata-rata) atau <code>targetAverageUtilization</code>
(target penggunaan rata-rata) ditentukan, <code>currentMetricValue</code> (nilai metrik sekaraang)
dihitung dengan mengambil rata-rata dari metrik dari semua Pod yang ditargetkan oleh
HorizontalPodAutoscaler. Sebelum mengecek toleransi dan menentukan nilai akhir,
kita mengambil kesiapan Pod dan metrik yang hilang sebagai pertimbangan.</p><p>Semua Pod yang memiliki waktu penghapusan (Pod dalam proses penutupan)
dan semua Pod yang mengalami kegagalan akan dibuang.</p><p>Jika ada metrik yang hilang dari Pod, maka Pod akan dievaluasi nanti.
Pod dengan nilai metrik yang hilang akan digunakan untuk menyesuaikan
jumlah akhir Pod yang akan diperbanyak atau dikurangi.</p><p>Ketika <em>scaling</em> dilakukan karena CPU, jika terdapat Pod yang akan siap (dengan kata lain
Pod tersebut sedang dalam tahap inisialisasi) <em>atau</em> metrik terakhir dari Pod
adalah metrik sebelum Pod dalam keadaan siap, maka Pod tersebut juga
akan dievaluasi nantinya.</p><p>Akibat keterbatasan teknis, <em>controller</em> HorizontalPodAutoscaler tidak dapat
menentukan dengan tepat kapan pertama kali Pod akan dalam keadaan siap
ketika menentukan apakah metrik CPU tertentu perlu dibuang. Sebaliknya,
HorizontalPodAutoscaler mempertimbangkan sebuah Pod "tidak dalam keadaan siap"
jika Pod tersebut dalam keadaan tidak siap dan dalam transisi ke status tidak
siap dalam waktu singkat, rentang waktu dapat dikonfigurasi, sejak Pod tersebut dijalankan.
Rentang waktu tersebut dapat dikonfigurasi dengan <em>flag</em> <code>--horizontal-pod-autoscaler-initial-readiness-delay</code>
dan waktu bawaannya adalah 30 detik. Ketika suatu Pod sudah dalam keadaan siap,
Pod tersebut mempertimbangkan untuk siap menjadi yang pertama jika itu terjadi dalam
waktu yang lebih lama, rentang waktu dapat dikonfigurasi, sejak Pod tersebut dijalankan.
Rentang waktu tersebut dapat dikonfigurasi dengan <em>flag</em> <code>--horizontal-pod-autoscaler-cpu-initialization-period</code>
dan nilai bawaannya adalah 5 menit.</p><p>Skala perbandingan dasar <code>currentMetricValue / desiredMetricValue</code>
dihitung menggunakan Pod yang tersisa yang belum disisihkan atau dibuang dari
kondisi di atas.</p><p>Jika terdapat metrik yang hilang, kita menghitung ulang rata-rata dengan lebih
konservatif, dengan asumsi Pod mengkonsumsi 100% dari nilai yang diharapkan
jika jumlahnya dikurangi (<em>scale down</em>) dan 0% jika jumlahnya diperbanyak (<em>scale up</em>).
Ini akan mengurangi besarnya kemungkinan untuk <em>scale</em>.</p><p>Selanjutnya, jika terdapat Pod dalam keadaan tidak siap, dan kita akan
memperbanyak replikas (<em>scale up</em>) tanpa memperhitungkan metrik yang hilang atau Pod yang tidak dalam
keadaan siap, kita secara konservatif mengasumsikan Pod yang tidak dalam keadaan siap
mengkonsumsi 0% dari metrik yang diharapkan, akhirnya meredam jumlah replika yang diperbanyak (<em>scale up</em>).</p><p>Seteleh memperhitungkan Pod yang tidak dalam keadaan siap dan metrik yang hilang,
kita menghitung ulang menggunakan perbandingan. Jika perbandingan yang baru membalikkan
arah <em>scale</em>-nya atau masih di dalam toleransi, kita akan melakukan <em>scale</em> dengan tepat. Jika tidak,
kita menggunakan perbandingan yang baru untuk memperbanyak atau mengurangi jumlah replika.</p><p>Perlu dicatat bahwa nilai asli untuk rata-rata penggunaan dilaporkan kembali melalui
status HorizontalPodAutoscaler, tanpa memperhitungkan Pod yang tidak dalam keadaan siap atau
metrik yang hilang, bahkan ketika perbandingan yang baru digunakan.</p><p>Jika beberapa metrik ditentukan pada sebuah HorizontalPodAutoscaler, perhitungan
dilakukan untuk setiap metrik dan nilai replika terbesar yang diharapkan akan dipilih.
Jika terdapat metrik yang tidak dapat diubah menjadi jumlah replika yang diharapkan
(contohnya terdapat kesalahan ketika mengambil metrik dari API metrik) dan pengurangan replika
disarankan dari metrik yang dapat diambil, maka <em>scaling</em> akan diabaikan. Ini berarti
HorizontalPodAutoscaler masih mampu untuk memperbanyak replika jika satu atau lebih metrik
memberikan sebuah <code>desiredReplicas</code> lebih besar dari nilai yang sekarang.</p><p>Pada akhirnya, sebelum HorizontalPodAutoscaler memperbanyak target, rekomendasi <em>scaling</em> akan
dicatat. <em>Controller</em> mempertimbangkan semua rekomendasi dalam rentang waktu yang dapat
dikonfigurasi untuk memilih rekomendasi tertinggi. Nilai ini dapat dikonfigurasi menggunakan
<em>flag</em> <code>--horizontal-pod-autoscaler-downscale-stabilization</code>, dengan nilai bawaan
5 menit. Ini berarti pengurangan replika akan terjadi secara bertahap, untuk mengurangi dampak dari
perubahan nilai metrik yang cepat.</p><h2 id=objek-api>Objek API</h2><p>HorizontalPodAutoscaler adalah sebuah API dalam grup <code>autoscaling</code> pada Kubernetes.
Versi stabil, yang hanya mendukung untuk <em>autoscale</em> CPU, dapat ditemukan pada versi
API <code>autoscaling/v1</code>.</p><p>Versi <em>beta</em>, yang mendukung untuk <em>scaling</em> berdasarkan memori dan metrik khusus,
dapat ditemukan pada <code>autoscaling/v2beta2</code>. <em>Field</em> yang baru diperkenalkan pada
<code>autoscaling/v2beta2</code> adalah <em>preserved</em> sebagai anotasi ketika menggunakan <code>autoscaling/v1</code>.</p><p>Ketika kamu membuat sebuah HorizontalPodAutoscaler, pastikan nama yang ditentukan adalah valid
<a href=/id/docs/concepts/overview/working-with-objects/names#nama>nama subdomain DNS</a>.
Untuk lebih detail tentang objek API ini dapat ditemukan di
<a href=https://git.k8s.io/community/contributors/design-proposals/autoscaling/horizontal-pod-autoscaler.md#horizontalpodautoscaler-object>Objek HorizontalPodAutoscaler</a>.</p><h2 id=dukungan-untuk-horizontalpodautoscaler-pada-kubectl>Dukungan untuk HorizontalPodAutoscaler pada kubectl</h2><p>Seperti sumber daya API lainnya, HorizontalPodAutoscaler didukung secara bawaan oleh <code>kubectl</code>.
Kita dapat membuat <em>autoscaler</em> yang baru dengan menggunakan perintah <code>kubectl create</code>.
Kita dapat melihat daftar <em>autoscaler</em> dengan perintah <code>kubectl get hpa</code> dan melihat deskripsi
detailnya dengan perintah <code>kubectl describe hpa</code>. Akhirnya, kita dapat menghapus <em>autoscaler</em>
meggunakan perintah <code>kubectl delete hpa</code>.</p><p>Sebagai tambahan, terdapat sebuah perintah khusus <code>kubectl autoscaler</code> untuk mempermudah pembuatan
HorizontalPodAutoscaler. Sebagai contoh, mengeksekusi
<code>kubectl autoscaler rs foo --min=2 --max=5 --cpu-percent=80</code> akan membuat sebuah <em>autoscaler</em> untuk
ReplicaSet <em>foo</em>, dengan target pengguaan CPU <code>80%</code> dan jumlah replika antara 2 sampai dengan 5.
Dokumentasi lebih detail tentang <code>kubectl autoscaler</code> dapat ditemukan di
<a href=/docs/reference/generated/kubectl/kubectl-commands/#autoscale>sini</a>.</p><h2 id=autoscaling-ketika-rolling-update>Autoscaling ketika Rolling Update</h2><p>Saat ini, dimungkinkan untuk melakukan <em>rolling update</em> menggunakan objek Deployment, yang akan
mengatur ReplicaSet untuk kamu. HorizontalPodAutoscaler hanya mendukung pendekatan terakhir:
HorizontalPodAutoscaler terikat dengan objek Deployment, yang mengatur seberapa besar dari objek Deployment tersebut,
dan Deployment bertugas untuk mengatur besar dari ReplicaSet.</p><p>HorizontalPodAutoscaler tidak bekerja dengan <em>rolling update</em> yang menggunakan manipulasi
pada ReplicationContoller secara langsung, dengan kata lain kamu tidak bisa mengikat
HorizontalPodAutoscaler dengan ReplicationController dan melakukan <em>rolling update</em>.
Alasan HorizontalPodAutoscaler tidak bekerja ketika <em>rolling update</em> membuat ReplicationController
yang baru adalah HorizontalPodAutoscaler tidak akan terikat dengan ReplicationController yang baru tersebut.</p><h2 id=dukungan-untuk-cooldown-penundaan>Dukungan untuk <em>Cooldown</em> / Penundaan</h2><p>Ketika mengolah <em>scaleing</em> dari sebuah grup replika menggunakan HorizonalPodAutoscaler,
jumlah replika dimungkinkan tetap berubah secara sering disebabkan oleh perubahan dinamis
dari metrik yang dievaluasi. Hal ini sering disebut dengan <em>thrashing</em>.</p><p>Mulai dari versi 1.6, operator klaster dapat mengatasi masalah ini dengan mengatur
konfigurasi HorizontalPodAutoscaler global sebagai <em>flag</em> <code>kube-controller-manager</code>.</p><p>Mulai dari versi 1.12, sebuah algoritma pembaruan baru menghilangkan kebutuhan terhadap
penundaan memperbanyak replika (<em>upscale</em>).</p><ul><li><code>--horizontal-pod-autoscaler-downscale-stabilization</code>: Nilai untuk opsi ini adalah
sebuah durasi yang menentukan berapa lama <em>autoscaler</em> menunggu sebelum operasi
pengurangan replika (<em>downscale</em>) yang lain dilakukan seteleh operasi sekarang selesai. Nilai bawaannya
adalah 5 menit (<code>5m0s</code>).</li></ul><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Ketika mengubah nilai paramater ini, sebuah operator klaster sadar akan kemungkinan
konsekuensi. Jika waktu penundaan diset terlalu lama, kemungkinan akan membuat
HorizontalPodAutoscaler tidak responsif terharap perubahan beban kerja. Namun, jika
waktu penundaan diset terlalu cepat, kemungkinan replikasi akan <em>trashing</em> seperti
biasanya.</div><h2 id=dukungan-untuk-beberapa-metrik>Dukungan untuk Beberapa Metrik</h2><p>Kubernetes versi 1.6 menambah dukungan untuk <em>scaling</em> berdasarkan beberapa metrik.
Kamu dapat menggunakan API versi <code>autoscaling/v2beta2</code> untuk menentukan beberapa metrik
yang akan digunakan HorizontalPodAutoscaler untuk menambah atau mengurangi jumlah replika.
Kemudian, <em>controller</em> HorizontalPodAutoscaler akan mengevaluasi setiap metrik dan menyarankan jenis
<em>scaling</em> yang baru berdasarkan metrik tersebut. Jumlah replika terbanyak akan digunakan untuk <em>scale</em>
yang baru.</p><h2 id=dukungan-untuk-metrik-khusus>Dukungan untuk Metrik Khusus</h2><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Kubernetes versi 1.2 menambah dukungan <em>alpha</em> untuk melakukan <em>scaling</em> berdasarkan metrik
yang spesifik dengan aplikasi menggunakan anotasi khusus. Dukungan untuk anotasi ini
dihilangkan pada Kubernetes versi 1.6 untuk mendukung API <em>autoscaling</em> yang baru. Selama
cara lama untuk mendapatkan metrik khusus masih tersedia, metrik ini tidak akan tersedia untuk
digunakan oleh HorizontalPodAutoscaler dan anotasi sebelumnya untuk menentukan metrik khusus untuk
<em>scaling</em> tidak lagi digunakan oleh <em>controller</em> HorizontalPodAutscaler.</div><p>Kubernetes versi 1.6 menambah dukungan untuk menggunakan metrik khusus pada HorizontalPodAutoscaler.
Kamu dapat menambahkan metrik khusus untuk HorizontalPodAutoscaler pada API versi <code>autoscaling/v2beta2</code>.
Kubernetes kemudian memanggil API metrik khusus untuk mengambil nilai dari metrik khusus.</p><p>Lihat <a href=#dukungan-untuk-api-metrik>Dukungan untuk API metrik</a> untuk kubutuhannya.</p><h2 id=dukungan-untuk-api-metrik>Dukungan untuk API metrik</h2><p>Secara standar, <em>controller</em> HorizontalPodAutoscaler mengambil metrik dari beberapa API. Untuk dapat
mengakses API ini, administrator klaster harus memastikan bahwa:</p><ul><li><p><a href=/docs/tasks/access-kubernetes-api/configure-aggregation-layer/>API Later Pengumpulan</a> diaktifkan.</p></li><li><p>API berikut ini terdaftar:</p><ul><li><p>Untuk metrik sumber daya, ini adalah API <code>metrics.k8s.io</code>, pada umumnya disediakan oleh
<a href=https://github.com/kubernetes-incubator/metrics-server>metrics-server</a>. API tersebut dapat
diaktifkan sebagai <em>addon</em> atau tambahan pada klaster.</p></li><li><p>Untuk metrik khusus, ini adalah API <code>custom.metrics.k8s.io</code>. API ini disediakan oleh API
adaptor server yang disediakan oleh vendor yang memberi solusi untuk metrik. Cek dengan
<em>pipeline</em> metrikmu atau <a href=https://github.com/kubernetes/metrics/blob/master/IMPLEMENTATIONS.md#custom-metrics-api>daftar solusi yang sudah diketahui</a>. Jika kamu ingin membuat sendiri, perhatikan
<a href=https://github.com/kubernetes-incubator/custom-metrics-apiserver><em>boilerplate</em> berikut</a> untuk memulai.</p></li><li><p>Untuk metrik eksternal, ini adalah API <code>external.metrics.k8s.io</code>. API ini mungkin disediakan oleh penyedia
metrik khusus diatas.</p></li></ul></li><li><p>Nilai dari <code>--horizontal-pod-autoscaler-use-rest-clients</code> adalah <code>true</code> atau tidak ada. Ubah nilai tersebut menjadi
<code>false</code> untuk mengubah ke <em>autoscaling</em> berdasarkan Heapster, dimana ini sudah tidak didukung lagi.</p></li></ul><p>Untuk informasi lebih lanjut mengenai metrik-metrik ini dan bagaimana perbedaan setiap metrik, perhatikan proposal
desain untuk <a href=https://github.com/kubernetes/design-proposals-archive/blob/main/autoscaling/hpa-v2.md>HPA V2</a>,
<a href=https://github.com/kubernetes/design-proposals-archive/blob/main/instrumentation/custom-metrics-api.md>custom.metrics.k8s.io</a>
dan <a href=https://github.com/kubernetes/design-proposals-archive/blob/main/instrumentation/external-metrics-api.md>external.metrics.k8s.io</a>.</p><p>Untuk contoh bagaimana menggunakan metrik-metrik ini, perhatikan <a href=/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/#autoscaling-on-multiple-metrics-and-custom-metrics>panduan penggunaan metrik khusus</a>
dan <a href=/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/#autoscaling-on-metrics-not-related-to-kubernetes-objects>panduan penggunaan metrik eksternal</a>.</p><h2 id=dukungan-untuk-perilaku-scaling-yang-dapat-dikonfigurasi>Dukungan untuk Perilaku <em>Scaling</em> yang dapat Dikonfigurasi</h2><p>Mulai dari versi <a href=https://github.com/kubernetes/enhancements/blob/master/keps/sig-autoscaling/853-configurable-hpa-scale-velocity/README.md>v1.18</a>, API <code>v2beta2</code> mengizinkan perilaku <em>scaling</em> dapat
dikonfigurasi melalui <em>field</em> <code>behavior</code> pada HorizontalPodAutoscaler. Perilaku <em>scaling up</em> dan <em>scaling down</em>
ditentukan terpisah pada <em>field</em> <code>slaceUp</code> dan <em>field</em> <code>scaleDown</code>, dibawah dari <em>field</em> <code>behavior</code>.
Sebuah stabilisator dapat ditentukan untuk kedua arah <em>scale</em> untuk mencegah perubahan replika yang terlalu
berbeda pada target <em>scaling</em>. Menentukan <em>scaling policies</em> akan mengontrol perubahan replika
ketika <em>scaling</em>.</p><h3 id=scaling-policies>Scaling Policies</h3><p>Satu atau lebih <em>scaling policies</em> dapat ditentukan pada <em>field</em> <code>behavior</code>. Ketika beberapa
<em>policies</em> ditentukan, <em>policy</em> yang mengizinkan <em>scale</em> terbesar akan dipilih secara <em>default</em>.
Contoh berikut menunjukkan perilaku ketika mengurangi replika:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>behavior</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleDown</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>policies</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Pods<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#666>4</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>60</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Percent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>60</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Ketika jumlah Pod lebih besar dari 40, <em>policy</em> kedua akan digunakan untuk <em>scaling down</em>.
Misalnya, jika terdapat 80 replika dan target sudah di <em>scale down</em> ke 10 replika, 8 replika
akan dikurangi pada tahapan pertama. Pada iterasi berikutnya, ketika jumlah replika adalah 72,
10% dari Pod adalah 7.2 tetapi akan dibulatkan menjadi 8. Dalam setiap iterasi pada <em>controller</em>
<em>autoscaler</em> jumlah Pod yang akan diubah akan dihitung ulang berdarkan jumlah replika sekarang.
Ketika jumlah replika dibawah 40, <em>policy</em> pertama (Pods) akan digunakan dan 4 replika akan dikurangi
dalam satu waktu.</p><p><code>periodSeconds</code> menunjukkan berapa lama waktu pada iterasi terkhir untuk menunjukkan <em>policy</em>
mana yang akan digunakan. <em>Policy</em> pertama mengizinkan maksimal 4 replika di <em>scale down</em>
dalam satu menit. <em>Policy</em> kedua mengixinkan maksimal 10% dari total replika sekarang di
<em>scale down</em> dalam satu menit.</p><p>Pemilihan <em>policy</em> dapat diubah dengan menentukannya pada <em>field</em> <code>selectPolicy</code> untuk sebuah
arah <em>scale</em> (baik <em>scale up</em> ataupun <em>scale down</em>). Dengan menentukan nilai <code>Min</code>,
HorizontalPodAutoscaler akan memilih <em>policy</em> yang mengizinkan pergantian replika paling sedikit.
Dengan menuntukan nilai <code>Disable</code>, akan menghentikan <em>scaling</em> pada arah <em>scale</em> tersebut.</p><h3 id=jendela-stabilisasi>Jendela Stabilisasi</h3><p>Jendela stabilisasi digunakan untuk membatasi perubahan replika yang terlalu drastis ketika
metrik yang digunakan untuk <em>scaling</em> tetap berubah-ubah. Jendela stabilisasi digunakan oleh
algoritma <em>autoscaling</em> untuk memperhitungkan jumlah replika yang diharapkan dari <em>scaling</em>
sebelumnya untuk mencengah *scaling. Berikut adalah contoh penggunaan jendela stabilisasi
pada <code>scaleDown</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>scaleDown</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>stabilizationWindowSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>300</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Ketika metrik menandakan bahwa replika pada target akan dikurangi, algoritma akan memperhatikan
jumlah replika yang diharapkan sebelumnya dan menggunakan nilai terbesar dari interval
yang ditentukan. Pada contoh diatas, semua jumlah replika yang diharapkan pada 5 menit
yang lalu akan dipertimbangkan.</p><h3 id=perilaku-standar>Perilaku Standar</h3><p>Untuk menggunakan <em>scaling</em> khusus, tidak semua <em>field</em> perlu ditentukan. Hanta nilai yang
perlu diubah saja yang ditentukan. Nilai khusus ini akan digabungkan dengan nilai standar.
Berikut adalah nilai standar perilaku pada algoritma yang digunakan HorizontalPodAutoscaler.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>behavior</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleDown</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>stabilizationWindowSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>300</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>policies</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Percent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#666>100</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>15</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleUp</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>stabilizationWindowSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>policies</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Percent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#666>100</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>15</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Pods<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#666>4</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>15</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>selectPolicy</span>:<span style=color:#bbb> </span>Max<span style=color:#bbb>
</span></span></span></code></pre></div><p>Untuk <code>scaleDown</code>, nilai dari jendela stabilisasi adalah 300 detik (atau nilai dari
<em>flag</em> <code>--horizontal-pod-autoscaler-downscale-stabilization</code> jika ditentukan). Hanya terdapat
satu <em>policy</em>, yaitu mengizinkan menghapus 100% dari replika yang berjalan,
artinya target replikasi di <em>scale</em> ke jumlah replika minimum. Untuk <code>scaleUp</code>, tidak terdapat
jendela stabilisasi. Jika metrik menunjukkan bahwa replika pada target perlu diperbanyak, maka replika akan
diperbanyak di secara langsung. Untuk <code>scaleUp</code> terdapat dua <em>policy</em>, yaitu empat Pod atau 100% dari
replika yang berjalan akan ditambahkan setiap 15 detik sampai HorizontalPodAutoscaler
dalam keadaan stabil.</p><h3 id=contoh-mengubah-jendela-stabiliasi-pada-field-scaledown>Contoh: Mengubah Jendela Stabiliasi pada <em>field</em> scaleDown</h3><p>Untuk membuat jendela stabilisai untuk pengurangan replika selama satu menit, perilaku
berikut ditambahkan pada HorizontalPodAutoscaler.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>behavior</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleDown</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>stabilizationWindowSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>60</span><span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=contoh-membatasi-nilai-scale-down>Contoh: Membatasi nilai <em>scale down</em></h3><p>Untuk membatasi total berapa Pod yang akan dihapus, 10% setiap menut, perilaku
berikut ditambahkan pada HorizontalPodAutoscaler.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>behavior</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleDown</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>policies</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Percent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>60</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Untuk mengizinkan penghapusan 5 Pod terakhir, <em>policy</em> lain dapat ditambahkan.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>behavior</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleDown</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>policies</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Percent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>60</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Pods<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>periodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>60</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>selectPolicy</span>:<span style=color:#bbb> </span>Max<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=contoh-menonakfitkan-scale-down>Contoh: menonakfitkan <em>scale down</em></h3><p>Nilai <code>Disable</code> pada <code>selectPolicy</code> akan menonaktifkan <em>scaling</em> pada arah yang
ditentukan. Untuk mencegah pengurangan replika dapat menggunakan <em>policy</em> berikut.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>behavior</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleDown</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>selectPolicy</span>:<span style=color:#bbb> </span>Disabled<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><ul><li>Dokumentasi desain <a href=https://git.k8s.io/community/contributors/design-proposals/autoscaling/horizontal-pod-autoscaler.md>Horizontal Pod Autoscaling</a>.</li><li>Perintah kubectl autoscale <a href=/docs/reference/generated/kubectl/kubectl-commands/#autoscale>kubectl autoscale</a>.</li><li>Contoh penggunaan <a href=/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/>HorizontalPodAutoscaler</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8138226ce9660ac8e3e82ff86fff8ad2>7.4 - Panduan HorizontalPodAutoscaler</h1><p>HorizontalPodAutoscaler secara otomatis akan memperbanyak jumlah Pod di dalam ReplicationController, Deployment,
ReplicaSet ataupun StatefulSet berdasarkan hasil observasi penggunaan CPU (atau, dengan
<a href=https://git.k8s.io/community/contributors/design-proposals/instrumentation/custom-metrics-api.md>metrik khusus</a>, pada beberapa aplikasi yang menyediakan metrik).</p><p>Laman ini memandu kamu dengan contoh pengaktifan HorizontalPodAutoscaler untuk server php-apache. Untuk informasi lebih lanjut tentang perilaku HorizontalPodAutoscaler, lihat <a href=/id/docs/tasks/run-application/horizontal-pod-autoscaler/>Petunjuk pengguna HorizontalPodAutoscaler</a>.</p><h2 id=heading></h2><p>Contoh dibawah ini membutuhkan klaster Kubernetes dan kubectl di versi 1.2 atau yang lebih baru yang sedang berjalan.
<a href=https://github.com/kubernetes-incubator/metrics-server/>Server metrik</a> sebagai pemantauan perlu diluncurkan di dalam sebuah klaster
untuk menyediakan metrik melalui metrik API sumber daya, karena HorizontalPodAutoscaler menggunakan API ini untuk mengumpulkan metrik. Petunjuk untuk menerapkan server metrik ada di repositori GitHub dari <a href=https://github.com/kubernetes-incubator/metrics-server/>server metrik</a>, jika kamu mengikuti petunjuk <a href=/docs/setup/production-environment/turnkey/gce/>memulai panduan GCE</a>,
metrik-pemantauan server akan diaktifkan secara default</p><p>Untuk menentukan beberapa metrik sumber daya untuk HorizontalPodAutoscaler, kamu harus memiliki klaster Kubernetes
dan kubectl di versi 1.6 atau yang lebih baru. Selanjutnya, untuk menggunakan metrik khusus, klaster kamu
harus dapat berkomunikasi dengan server API yang menyediakan API metrik khusus. Terakhir, untuk menggunakan metrik yang tidak terkait dengan objek Kubernetes apa pun, kamu harus memiliki klaster Kubernetes pada versi 1.10 atau yang lebih baru, dan kamu harus dapat berkomunikasi dengan server API yang menyediakan API metrik eksternal.
Lihat <a href=/docs/tasks/run-application/horizontal-pod-autoscale/#support-for-custom-metrics>Panduan pengguna HorizontalPodAutoscaler</a> untuk detail lebih lanjut.</p><h2 id=menjalankan-mengekspos-server-php-apache>Menjalankan & mengekspos server php-apache</h2><p>Untuk mendemonstrasikan HorizontalPodAutoscaler kita akan menggunakan <em>image</em> Docker khusus berdasarkan <em>image</em> php-apache.
Dockerfile memiliki konten berikut:</p><pre tabindex=0><code>FROM php:5-apache
ADD index.php /var/www/html/index.php
RUN chmod a+rx index.php
</code></pre><p>Bagian ini mendefinisikan laman index.php yang melakukan beberapa komputasi intensif CPU:</p><pre tabindex=0><code>&lt;?php
  $x = 0.0001;
  for ($i = 0; $i &lt;= 1000000; $i++) {
    $x += sqrt($x);
  }
  echo &#34;OK!&#34;;
?&gt;
</code></pre><p>Pertama, kita akan memulai Deployment yang menjalankan <em>image</em> dan mengeksposnya sebagai Service
menggunakan konfigurasi berikut:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/php-apache.yaml download=application/php-apache.yaml><code>application/php-apache.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-php-apache-yaml")' title="Copy application/php-apache.yaml to clipboard"></img></div><div class=includecode id=application-php-apache-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/hpa-example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span>500m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span>200m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#00f;font-weight:700>---</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Jalankan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/php-apache.yaml
</span></span></code></pre></div><pre tabindex=0><code>deployment.apps/php-apache created
service/php-apache created
</code></pre><h2 id=membuat-horizontalpodautoscaler>Membuat HorizontalPodAutoscaler</h2><p>Sekarang server sudah berjalan, selanjutnya kita akan membuat <em>autoscaler</em> menggunakan
<a href=/docs/reference/generated/kubectl/kubectl-commands#autoscale>kubectl autoscale</a>.
Perintah berikut akan membuat HorizontalPodAutoscaler yang mengelola antara 1 dan 10 replika Pod yang dikontrol oleh Deployment php-apache yang kita buat pada langkah pertama instruksi ini.
Secara kasar, HPA akan menambah dan mengurangi jumlah replika
(melalui Deployment) untuk mempertahankan pemakaian CPU rata-rata di semua Pod sebesar 50%
(karena setiap Pod meminta 200 mili-core menurut <code>kubectl run</code>), ini berarti penggunaan CPU rata-rata adalah 100 mili-core).
Lihat <a href=/id/docs/tasks/run-application/horizontal-pod-autoscaler/#detail-algoritma>ini</a> untuk detail lebih lanjut tentang algoritmanya.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl autoscale deployment php-apache --cpu-percent<span style=color:#666>=</span><span style=color:#666>50</span> --min<span style=color:#666>=</span><span style=color:#666>1</span> --max<span style=color:#666>=</span><span style=color:#666>10</span>
</span></span></code></pre></div><pre tabindex=0><code>horizontalpodautoscaler.autoscaling/php-apache autoscaled
</code></pre><p>Kita dapat memeriksa status <em>autoscaler</em> saat ini dengan menjalankan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get hpa
</span></span></code></pre></div><pre tabindex=0><code>NAME         REFERENCE                     TARGET    MINPODS   MAXPODS   REPLICAS   AGE
php-apache   Deployment/php-apache/scale   0% / 50%  1         10        1          18s
</code></pre><p>Harap dicatat bahwa konsumsi CPU saat ini adalah 0% karena kita tidak mengirimkan permintaan apa pun ke server
(kolom <code>TARGET</code> menunjukkan nilai rata-rata di semua Pod yang dikontrol oleh Deployment yang sesuai).</p><h2 id=menambahkan-beban>Menambahkan beban</h2><p>Sekarang, kita akan melihat bagaimana <em>autoscaler</em> bereaksi terhadap peningkatan beban.
Kita akan memulai sebuah Container, dan mengirimkan perulangan kueri tak terbatas ke Service php-apache (jalankan di terminal yang berbeda):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl run -it --rm load-generator --image<span style=color:#666>=</span>busybox /bin/sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hit enter <span style=color:#a2f;font-weight:700>for</span> <span style=color:#a2f>command</span> prompt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>while</span> true; <span style=color:#a2f;font-weight:700>do</span> wget -q -O- http://php-apache; <span style=color:#a2f;font-weight:700>done</span>
</span></span></code></pre></div><p>Dalam satu menit atau lebih, kita akan melihat beban CPU yang lebih tinggi dengan menjalankan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get hpa
</span></span></code></pre></div><pre tabindex=0><code>NAME         REFERENCE                     TARGET      MINPODS   MAXPODS   REPLICAS   AGE
php-apache   Deployment/php-apache/scale   305% / 50%  1         10        1          3m
</code></pre><p>Di sini, konsumsi CPU meningkat hingga 305% dari permintaan.
Hasilnya, Deployment mengubah ukurannya menjadi 7 replika:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get deployment php-apache
</span></span></code></pre></div><pre tabindex=0><code>NAME         READY   UP-TO-DATE   AVAILABLE   AGE
php-apache   7/7      7           7           19m
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Mungkin perlu beberapa menit untuk menstabilkan jumlah replika. Karena jumlah
bebannya tidak dikendalikan dengan cara apa pun, yang mungkin terjadi adalah jumlah replika akhir
akan berbeda dari contoh.</div><h2 id=menghentikan-beban>Menghentikan beban</h2><p>Kita akan menyudahi contoh dengan menghentikan beban pengguna.</p><p>Di terminal tempat kita membuat Container dengan <em>image</em> <code>busybox</code>, hentikan
pembangkitan beban dengan mengetik <code>&lt;Ctrl> + C</code>.</p><p>Kemudian kita akan memverifikasi status hasil (setelah satu menit atau lebih):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get hpa
</span></span></code></pre></div><pre tabindex=0><code>NAME         REFERENCE                     TARGET       MINPODS   MAXPODS   REPLICAS   AGE
php-apache   Deployment/php-apache/scale   0% / 50%     1         10        1          11m
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get deployment php-apache
</span></span></code></pre></div><pre tabindex=0><code>NAME         READY   UP-TO-DATE   AVAILABLE   AGE
php-apache   1/1     1            1           27m
</code></pre><p>Di sini penggunaan CPU turun menjadi 0, sehingga HPA secara otomatis melakukan penyekalaan jumlah replika kembali menjadi 1.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Penyekalaan otomatis replika mungkin memerlukan waktu beberapa menit.</div><h2 id=penyekalaan-otomatis-pada-metrik-multipel-dan-metrik-kustom>Penyekalaan otomatis pada metrik multipel dan metrik kustom</h2><p>Kamu dapat memperkenalkan metrik tambahan untuk digunakan saat melakukan penyekalaan otomatis pada Deployment <code>php-apache</code> dengan menggunakan versi API <code>autoscaling / v2beta2</code>.</p><p>Pertama, dapatkan YAML HorizontalPodAutoscaler kamu dalam bentuk <code>autoscaling / v2beta2</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get hpa.v2beta2.autoscaling -o yaml &gt; /tmp/hpa-v2.yaml
</span></span></code></pre></div><p>Buka berkas <code>/tmp/hpa-v2.yaml</code> di editor, dan kamu akan melihat YAML yang terlihat seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>autoscaling/v2beta2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>HorizontalPodAutoscaler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleTargetRef</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>maxReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metrics</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Resource<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>cpu<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>target</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Utilization<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>averageUtilization</span>:<span style=color:#bbb> </span><span style=color:#666>50</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>observedGeneration</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>lastScaleTime</span>:<span style=color:#bbb> </span>&lt;some-time&gt;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>currentReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>desiredReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>currentMetrics</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Resource<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>cpu<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>current</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>averageUtilization</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>averageValue</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Perhatikan bahwa kolom <code>targetCPUUtilizationPercentage</code> telah diganti dengan himpunan yang disebut <code>metrics</code>.
Metrik penggunaan CPU adalah <em>resource metric</em>, merepresentasikan sebagai persentase sumber daya
ditentukan pada Container Pod. Perhatikan bahwa kamu dapat menentukan metrik sumber daya selain CPU. Secara bawaan,
satu-satunya metrik sumber daya lain yang didukung adalah memori. Sumber daya ini tidak mengubah nama dari klaster
ke klaster, dan harus selalu tersedia, selama API <code>metrics.k8s.io</code> tersedia.</p><p>Kamu juga dapat menentukan metrik sumber daya dalam nilai secara langsung, bukan sebagai persentase dari
nilai yang diminta, dengan menggunakan <code>target.type</code> dari <code>AverageValue</code> sebagai ganti <code>Utilization</code>, dan
menyetel <em>field</em> <code>target.averageValue</code> yang sesuai, bukan <code>target.averageUtilization</code>.</p><p>Ada dua jenis metrik lainnya, keduanya dianggap sebagai <em>metrik khusus</em>: metrik Pod dan
metrik objek. Metrik ini memungkinkan untuk memiliki nama yang spesifik untuk klaster, dan membutuhkan lebih banyak
pengaturan pemantauan klaster lanjutan.</p><p>Jenis metrik alternatif yang pertama adalah <em>metrik Pod</em>. Metrik ini mendeskripsikan Pod, dan
dirata-ratakan bersama di seluruh Pod dan dibandingkan dengan nilai target untuk menentukan jumlah replika.
Mereka bekerja seperti metrik sumber daya, kecuali bahwa mereka <em>hanya</em> mendukung jenis <code>target</code> dari <code>AverageValue</code>.</p><p>Metrik Pod ditentukan menggunakan blok metrik seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Pods<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>pods</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metric</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>packets-per-second<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>target</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>AverageValue<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>averageValue</span>:<span style=color:#bbb> </span>1k<span style=color:#bbb>
</span></span></span></code></pre></div><p>Jenis metrik alternatif kedua adalah <em>metrik objek</em>. Metrik ini mendeskripsikan perbedaan
objek di Namespace yang sama, bukan mendeskripsikan Pod. Metriknya belum tentu
diambil dari objek; mereka hanya mendeskripsikannya. Metrik objek mendukung jenis <code>target</code>
baik <code>Value</code> dan <code>AverageValue</code>. Dengan <code>Value</code>, target dibandingkan langsung dengan yang dikembalikan
metrik dari API. Dengan <code>AverageValue</code>, nilai yang dikembalikan dari API metrik khusus dibagi
dengan jumlah Pod sebelum dibandingkan dengan target. Contoh berikut adalah YAML
representasi dari metrik <code>requests-per-second</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Object<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>object</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metric</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>requests-per-second<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>describedObject</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>networking.k8s.io/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Ingress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>main-route<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>target</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Value<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span>2k<span style=color:#bbb>
</span></span></span></code></pre></div><p>Jika kamu memberikan beberapa blok metrik seperti itu, HorizontalPodAutoscaler akan mempertimbangkan setiap metrik secara bergantian.
HorizontalPodAutoscaler akan menghitung jumlah replika yang diusulkan untuk setiap metrik, lalu memilih
satu dengan jumlah replika tertinggi.</p><p>Misalnya, jika sistem pemantauan kamu mengumpulkan metrik tentang lalu lintas jaringan,
kamu dapat memperbarui definisi di atas menggunakan <code>kubectl edit</code> agar terlihat seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>autoscaling/v2beta2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>HorizontalPodAutoscaler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleTargetRef</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>maxReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metrics</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Resource<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>cpu<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>target</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Utilization<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>averageUtilization</span>:<span style=color:#bbb> </span><span style=color:#666>50</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Pods<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>pods</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>metric</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>packets-per-second<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>target</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>AverageValue<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>averageValue</span>:<span style=color:#bbb> </span>1k<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Object<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>object</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>metric</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>requests-per-second<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>describedObject</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>networking.k8s.io/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Ingress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>main-route<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>target</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Value<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span>10k<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>observedGeneration</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>lastScaleTime</span>:<span style=color:#bbb> </span>&lt;some-time&gt;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>currentReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>desiredReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>currentMetrics</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Resource<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>cpu<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>current</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>averageUtilization</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>averageValue</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Object<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>object</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>metric</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>requests-per-second<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>describedObject</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>networking.k8s.io/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Ingress<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>main-route<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>current</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span>10k<span style=color:#bbb>
</span></span></span></code></pre></div><p>Kemudian, HorizontalPodAutoscaler kamu akan mencoba memastikan bahwa setiap Pod mengonsumsi kira-kira
50% dari CPU yang diminta, melayani 1000 paket per detik, dan semua Pod berada di belakang Ingress
rute utama melayani total 10.000 permintaan per detik.</p><h3 id=penyekalaan-otomatis-pada-metrik-yang-lebih-spesifik>Penyekalaan otomatis pada metrik yang lebih spesifik</h3><p>Banyak <em>pipeline</em> metrik memungkinkan kamu mendeskripsikan metrik baik berdasarkan nama atau kumpulan tambahan
deskriptor yang disebut <em>labels</em>. Untuk semua jenis metrik non-sumber daya (Pod, objek, dan eksternal,
dijelaskan seperti dibawah), kamu dapat menentukan pemilih label tambahan yang diteruskan ke pipa metrik kamu. Misalnya, jika kamu mengumpulkan metrik <code>http_requests</code> dengan label <code>verb</code>
, kamu dapat menentukan blok metrik berikut untuk diskalakan hanya pada permintaan GET:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Object<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>object</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metric</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>http_requests<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb> </span>{<span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb> </span>{<span style=color:green;font-weight:700>verb</span>:<span style=color:#bbb> </span>GET}}<span style=color:#bbb>
</span></span></span></code></pre></div><p><em>Selector</em> ini menggunakan sintaksis yang sama dengan <em>selector</em> lengkap label Kubernetes. Pipa pemantauan
menentukan cara mengecilkan beberapa seri menjadi satu nilai, jika nama dan pemilih cocok dengan
beberapa seri. Selektor bersifat aditif, dan tidak dapat memilih metrik yang mendeskripsikan objek
yang <strong>bukan</strong> objek target (target pod dalam kasus tipe <code>Pod</code>, dan objek yang dijelaskan dalam kasus tipe <code>Objek</code>).</p><h3 id=penyekalaan-otomatis-pada-metrik-yang-tidak-terkait-dengan-objek-kubernetes>Penyekalaan otomatis pada metrik yang tidak terkait dengan objek Kubernetes</h3><p>Aplikasi yang berjalan di Kubernetes mungkin perlu melakukan penyekalaan otomatis berdasarkan metrik yang tidak
memiliki hubungan yang jelas dengan objek apa pun di klaster Kubernetes, seperti metrik yang mendeskripsikan
layanan yang dihosting tanpa korelasi langsung dengan namespace Kubernetes. Di Kubernetes 1.10 dan yang lebih baru, kamu dapat menangani kasus penggunaan ini dengan <em>metrik eksternal</em>.</p><p>Menggunakan metrik eksternal membutuhkan pengetahuan tentang sistem pemantauanmu; penyiapannya mirip dengan yang diperlukan saat menggunakan metrik khusus. Metrik eksternal memungkinkan kamu menskalakan klaster kamu secara otomatis berdasarkan metrik apa pun yang tersedia di sistem pemantauanmu. Cukup berikan blok <code>metric</code> dengan <code>name</code> dan <code>selector</code> (pemilih), seperti di atas, dan gunakan jenis metrik <code>External</code>, bukan <code>Object</code>.
Jika beberapa <em>series</em> cocok dengan <code>metricSelector</code>, jumlah dari nilai mereka akan digunakan oleh HorizontalPodAutoscaler.
Metrik eksternal mendukung jenis target <code>Value</code> dan <code>AverageValue</code>, yang berfungsi persis sama seperti saat kamu menggunakan tipe <code>Object</code>.</p><p>Misalnya, jika aplikasi kamu memproses tugas dari layanan antrian yang dihosting, kamu dapat menambahkan bagian berikut ke manifes HorizontalPodAutoscaler untuk menentukan bahwa kamu memerlukan satu pekerja per 30 tugas yang belum diselesaikan.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>External<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>external</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metric</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>queue_messages_ready<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;queue=worker_tasks&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>target</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>AverageValue<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>averageValue</span>:<span style=color:#bbb> </span><span style=color:#666>30</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Jika memungkinkan, lebih baik menggunakan target metrik khusus daripada metrik eksternal, karena lebih mudah bagi administrator klaster untuk mengamankan API metrik khusus. API metrik eksternal berpotensi memungkinkan akses ke metrik apa pun, jadi administrator klaster harus berhati-hati saat mengeksposnya.</p><h2 id=lampiran-kondisi-status-horizontal-pod-autoscaler>Lampiran: Kondisi Status Horizontal Pod Autoscaler</h2><p>Saat menggunakan bentuk <code>autoscaling/v2beta2</code> dari HorizontalPodAutoscaler, kamu akan dapat melihat
<em>status condition</em> yang ditetapkan oleh Kubernetes pada HorizontalPodAutoscaler. <em>Status condition</em> ini menunjukkan apakah HorizontalPodAutoscaler dapat melakukan penyekalaan atau tidak, dan apakah saat ini dibatasi atau tidak.</p><p>Kondisi muncul pada <em>field</em> <code>status.conditions</code>. Untuk melihat kondisi yang memengaruhi HorizontalPodAutoscaler, kita bisa menggunakan <code>kubectl description hpa</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe hpa cm-test
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Name:                           cm-test
</span></span><span style=display:flex><span>Namespace:                      prom
</span></span><span style=display:flex><span>Labels:                         &lt;none&gt;
</span></span><span style=display:flex><span>Annotations:                    &lt;none&gt;
</span></span><span style=display:flex><span>CreationTimestamp:              Fri, <span style=color:#666>16</span> Jun <span style=color:#666>2017</span> 18:09:22 +0000
</span></span><span style=display:flex><span>Reference:                      ReplicationController/cm-test
</span></span><span style=display:flex><span>Metrics:                        <span style=color:#666>(</span> current / target <span style=color:#666>)</span>
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;http_requests&#34;</span> on pods:      66m / 500m
</span></span><span style=display:flex><span>Min replicas:                   <span style=color:#666>1</span>
</span></span><span style=display:flex><span>Max replicas:                   <span style=color:#666>4</span>
</span></span><span style=display:flex><span>ReplicationController pods:     <span style=color:#666>1</span> current / <span style=color:#666>1</span> desired
</span></span><span style=display:flex><span>Conditions:
</span></span><span style=display:flex><span>  Type                  Status  Reason                  Message
</span></span><span style=display:flex><span>  ----                  ------  ------                  -------
</span></span><span style=display:flex><span>  AbleToScale           True    ReadyForNewScale        the last scale <span style=color:#a2f>time</span> was sufficiently old as to warrant a new scale
</span></span><span style=display:flex><span>  ScalingActive         True    ValidMetricFound        the HPA was able to successfully calculate a replica count from pods metric http_requests
</span></span><span style=display:flex><span>  ScalingLimited        False   DesiredWithinRange      the desired replica count is within the acceptable range
</span></span><span style=display:flex><span>Events:
</span></span></code></pre></div><p>Untuk HorizontalPodAutoscaler ini, kita dapat melihat beberapa kondisi yang menandakan dalam keadaan sehat. Yang pertama, <code>AbleToScale</code>, menunjukkan apakah HPA dapat mengambil dan memperbarui skala atau tidak, serta apakah kondisi terkait <em>backoff</em> akan mencegah penyekalaan atau tidak. Yang kedua, <code>ScalingActive</code>, menunjukkan apakah HPA diaktifkan atau tidak (yaitu jumlah replika target bukan nol) dan mampu menghitung skala yang diinginkan. Jika <code>False</code>, biasanya menunjukkan masalah dengan
pengambilan metrik. Terakhir, kondisi terakhir, <code>ScalingLimited</code>, menunjukkan bahwa skala yang diinginkan telah dibatasi oleh maksimum atau minimum HorizontalPodAutoscaler. Ini adalah indikasi bahwa kamu mungkin ingin menaikkan atau menurunkan batasan jumlah replika minimum atau maksimum pada HorizontalPodAutoscaler kamu.</p><h2 id=lampiran-kuantitas>Lampiran: Kuantitas</h2><p>Semua metrik di HorizontalPodAutoscaler dan metrik API ditentukan menggunakan notasi bilangan bulat khusus yang dikenal di Kubernetes sebagai <a class=glossary-tooltip title='Representasi bilangan bulat dari bilangan kecil atau besar menggunakan sufiks SI.' data-toggle=tooltip data-placement=top href='/id/docs/reference/glossary/?all=true#term-quantity' target=_blank aria-label=kuantitas>kuantitas</a>. Misalnya, kuantitas <code>10500m</code> akan ditulis sebagai <code>10.5</code> dalam notasi desimal. Metrik API akan menampilkan bilangan bulat tanpa sufiks jika memungkinkan, dan secara umum akan mengembalikan kuantitas dalam satuan mili. Ini berarti kamu mungkin melihat nilai metrik berfluktuasi antara <code>1</code> dan <code>1500m</code>, atau <code>1</code> dan <code>1,5</code> ketika ditulis dalam notasi desimal.</p><h2 id=lampiran-skenario-lain-yang-memungkinkan>Lampiran: Skenario lain yang memungkinkan</h2><h3 id=membuat-autoscaler-secara-deklaratif>Membuat autoscaler secara deklaratif</h3><p>Daripada menggunakan perintah <code>kubectl autoscale</code> untuk membuat HorizontalPodAutoscaler secara imperatif, kita dapat menggunakan berkas berikut untuk membuatnya secara deklaratif:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/hpa/php-apache.yaml download=application/hpa/php-apache.yaml><code>application/hpa/php-apache.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-hpa-php-apache-yaml")' title="Copy application/hpa/php-apache.yaml to clipboard"></img></div><div class=includecode id=application-hpa-php-apache-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>autoscaling/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>HorizontalPodAutoscaler<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scaleTargetRef</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>php-apache<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>minReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>maxReplicas</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>targetCPUUtilizationPercentage</span>:<span style=color:#bbb> </span><span style=color:#666>50</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Kita akan membuat <em>autoscaler</em> dengan menjalankan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create -f https://k8s.io/examples/application/hpa/php-apache.yaml
</span></span></code></pre></div><pre tabindex=0><code>horizontalpodautoscaler.autoscaling/php-apache created
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b74b959f5a531003dd0653dfbfc2e88b>8 - Mengakes Aplikasi-aplikasi di sebuah Klaster</h1></div><div class=td-content><h1 id=pg-777447042cd4e81df3fa5beb3357a485>8.1 - Antarmuka Pengguna Berbasis Web (Dashboard)</h1><p>Dashboard adalah antarmuka pengguna Kubernetes. Kamu dapat menggunakan Dashboard untuk men-<em>deploy</em> aplikasi yang sudah dikontainerisasi ke klaster Kubernetes, memecahkan masalah pada aplikasi kamu, dan mengatur sumber daya klaster. Kamu dapat menggunakan Dashboard untuk melihat ringkasan dari aplikasi yang sedang berjalan di klaster kamu, dan juga membuat atau mengedit objek individu sumber daya Kubernetes (seperti Deployment, Job, DaemonSet, dll.). Sebagai contoh, kamu dapat mengembangkan sebuah Deployment, menginisiasi sebuah pembaruan bertahap (<em>rolling update</em>), memulai kembali sebuah Pod atau men-<em>deploy</em> aplikasi baru menggunakan sebuah <em>deploy wizard</em>.</p><p>Dashboard juga menyediakan informasi tentang status dari sumber daya Kubernetes di klaster kamu dan kesalahan apapun yang mungkin telah terjadi..</p><p><img src=/images/docs/ui-dashboard.png alt="Antarmuka Pengguna Dashboard Kubernetes"></p><h2 id=men-deploy-antarmuka-pengguna-dashboard>Men-<em>deploy</em> Antarmuka Pengguna Dashboard</h2><p>Antarmuka Dashboard tidak ter-<em>deploy</em> secara bawaan. Untuk men-<em>deploy</em>-nya, kamu dapat menjalankan perintah berikut:</p><pre tabindex=0><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml
</code></pre><h2 id=mengakses-antarmuka-dashboard>Mengakses Antarmuka Dashboard</h2><p>Untuk melindungi data klaster kamu, pen-<em>deploy</em>-an Dashboard menggunakan sebuah konfigurasi <em>RBAC</em> yang minimal secara bawaan. Saat ini, Dashboard hanya mendukung otentikasi dengan <em>Bearer Token</em>. Untuk membuat token untuk demo, kamu dapat mengikuti petunjuk kita untuk <a href=https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md>membuat sebuah contoh pengguna</a>.</p><div class="alert alert-danger warning callout" role=alert><strong>Peringatan:</strong> Contoh pengguna yang telah dibuat di tutorial tersebut akan memiliki hak istimewa sebagai administrator dan hanyalah untuk tujuan pembelajaran.</div><h3 id=proksi-antarmuka-baris-perintah-cli>Proksi antarmuka baris perintah (CLI)</h3><p>Kamu dapat mengakses Dashboard menggunakan perkakas CLI kubectl dengan menjalankan perintah berikut:</p><pre tabindex=0><code>kubectl proxy
</code></pre><p>Kubectl akan membuat Dashboard tersedia di http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/.</p><p>Antarmuka pengguna berbasis web tersebut hanya dapat di akses dari mesin dimana perintah tersebut dijalankan. Lihat <code>kubectl proxy --help</code> untuk lebih lanjut.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Metode otentikasi Kubeconfig tidak mendukung penyedia identitas eksternal atau otentikasi berbasis sertifikat elektronik x509.</div><h2 id=tampilan-selamat-datang>Tampilan selamat datang</h2><p>Ketika kamu mengakses Dashboard di klaster yang kosong, kamu akan melihat laman selamat datang. Laman ini berisi tautan ke dokumen ini serta tombol untuk men-<em>deploy</em> aplikasi pertama kamu. Selain itu, kamu dapat melihat aplikasi-aplikasi sistem mana saja yang berjalan secara bawaan di <a href=/docs/tasks/administer-cluster/namespaces/>Namespace</a> <code>kube-system</code> dari klaster kamu, misalnya Dashboard itu sendiri.</p><p><img src=/images/docs/ui-dashboard-zerostate.png alt="Kubernetes Dashboard welcome page"></p><h2 id=men-deploy-aplikasi-yang-sudah-dikontainerisasi>Men-<em>deploy</em> aplikasi yang sudah dikontainerisasi</h2><p>Dashboard memungkinkan kamu untuk membuat dan men-<em>deploy</em> aplikasi yang sudah dikontainerisasi sebagai Deployment dan Service opsional dengan sebuah <em>wizard</em> sederhana. Kamu secara manual dapat menentukan detail aplikasi, atau mengunggah sebuah berkas YAML atau JSON yang berisi konfigurasi aplikasi.</p><p>Tekan tombol <strong>CREATE</strong> di pojok kanan atas di laman apapun untuk memulai.</p><h3 id=menentukan-detail-aplikasi>Menentukan detail aplikasi</h3><p><em>Deploy wizard</em> meminta kamu untuk menyediakan informasi sebagai berikut:</p><ul><li><p><strong>App name</strong> (wajib): Nama dari aplikasi kamu. Sebuah <a href=/id/docs/concepts/overview/working-with-objects/labels/>label</a> dengan nama tersebut akan ditambahkan ke Deployment dan Service, jika ada, akan di-<em>deploy</em>.</p><p>Nama aplikasi harus unik di dalam <a href=/docs/tasks/administer-cluster/namespaces/>Namespace</a> Kubernetes yang kamu pilih. Nama tersebut harus dimulai dengan huruf kecil, dan diakhiri dengan huruf kecil atau angka, dan hanya berisi huruf kecil, angka dan tanda hubung (-). Nama tersebut juga dibatasi hanya 24 karakter. Spasi di depan dan belakang nama tersebut diabaikan.</p></li><li><p><strong>Container image</strong> (wajib): Tautan publik dari sebuah <a href=/id/docs/concepts/containers/images/><em>image</em></a> kontainer Docker pada <em>registry</em> apapun, atau sebuah <em>image</em> privat (biasanya di-<em>hosting</em> di Google Container Registry atau Docker Hub). Spesifikasi <em>image</em> kontainer tersebut harus diakhiri dengan titik dua.</p></li><li><p><strong>Number of pods</strong> (wajib): Berapa banyak Pod yang kamu inginkan untuk men-<em>deploy</em> aplikasimu. Nilainya haruslah sebuah bilangan bulat positif.</p><p>Sebuah <a href=/id/docs/concepts/workloads/controllers/deployment/>Deployment</a> akan terbuat untuk mempertahankan jumlah Pod di klaster kamu.</p></li><li><p><strong>Service</strong> (opsional): Untuk beberapa aplikasi (misalnya aplikasi <em>frontend</em>) kamu mungkin akan mengekspos sebuah <a href=/id/docs/concepts/services-networking/service/>Service</a> ke alamat IP publik yang mungkin berada diluar klaster kamu(Service eksternal). Untuk Service eksternal, kamu mungkin perlu membuka lebih dari satu porta jaringan untuk mengeksposnya. Lihat lebih lanjut <a href=/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/>di sini</a>.</p><p>Service lainnya yang hanya dapat diakses dari dalam klaster disebut Service internal.</p><p>Terlepas dari jenis Service, jika kamu memilih untuk membuat sebuah Service dan Container kamu berjalan di sebuah porta(arah masuk), kamu perlu menentukan dua porta. Service akan memetakan porta(arah masuk) ke porta target yang ada di sisi Container. Service akan mengarahkan ke Pod-Pod kamu yang sudah di-<em>deploy</em>. Protokol yang didukung adalah TCP dan UDP. Nama DNS internal untuk Service ini akan sesuai dengan nama aplikasi yang telah kamu tentukan diatas.</p></li></ul><p>Jika membutuhkan, kamu dapat membuka bagian <strong>Advanced options</strong> di mana kamu dapat menyetel lebih banyak pengaturan:</p><ul><li><p><strong>Description</strong>: Tels yang kamu masukkan ke sini akan ditambahkan sebagai sebuah <a href=/id/docs/concepts/overview/working-with-objects/annotations/>anotasi</a> ke Deployment dan akan ditampilkan di detail aplikasi.</p></li><li><p><strong>Labels</strong>: <a href=/id/docs/concepts/overview/working-with-objects/labels/>Label-label</a> bawaan yang akan digunakan untuk aplikasi kamu adalah <code>name</code> dan <code>version</code> aplikasi. Kamu dapat menentukan label lain untuk diterapkan ke Deployment, Service (jika ada), dan Pod, seperti <code>release</code>, <code>environment</code>, <code>tier</code>, <code>partition</code>, dan <code>track</code> rilis.</p><p>Contoh:</p><pre tabindex=0><code class=language-conf data-lang=conf>release=1.0
tier=frontend
environment=pod
track=stable
</code></pre></li><li><p><strong><em>Namespace</em></strong>: Kubernetes mendukung beberapa klaster virtual yang berjalan di atas klaster fisik yang sama. Klaster virtual ini disebut <a href=/docs/tasks/administer-cluster/namespaces/>Namespace</a>. Mereka mengizinkan kamu untuk mempartisi sumber daya ke beberapa grup yang diberi nama secara logis.</p><p>Dashboard menampilkan semua Namespace yang tersedia dalam sebuah daftar <em>dropdown</em>, dan mengizinkan kamu untuk membuat Namespace baru. Nama yang diizinkan untuk Namespace terdiri dari maksimal 63 karakter alfanumerik dan tanda hubung (-), dan tidak boleh ada huruf kapital.
Nama dari Namespace tidak boleh terdiri dari angka saja. Jika nama Namespace disetel menjadi sebuah angka, misalnya 10, maka Pod tersebut akan ditaruh di Namespace <code>default</code>.</p><p>Jika pembuatan Namespace berhasil, Namespace tersebut akan dipilih secara bawaan. Jika pembuatannya gagal, maka Namespace yang pertama akan terpilih.</p></li><li><p><strong><em>Image Pull Secret</em></strong>: Jika kamu menggunakan <em>image</em> kontainer Docker yang privat, mungkin diperlukan kredensial <a href=/id/docs/concepts/configuration/secret/><em>pull secret</em></a>.</p><p>Dashboard menampilkan semua <em>secret</em> yang tersedia dengan daftar <em>dropdown</em>, dan mengizinkan kamu untuk membuat <em>secret</em> baru. Nama <em>secret</em> tersebut harus mengikuti aturan Nama DNS, misalnya <code>new.image-pull.secret</code>. Isi dari sebuah <em>secret</em> harus dienkode dalam bentuk <em>base64</em> dan ditentukan dalam sebuah berkas <a href=/id/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod><code>.dockercfg</code></a>. Nama kredensial dapat berisi maksimal 253 karakter.</p><p>Jika pembuatan <em>image pull secret</em> berhasil, <em>image pull secret</em> tersebut akan terpilih secara bawaan. Jika gagal, maka tidak ada <em>secret</em> yang dipilih.</p></li><li><p><strong><em>CPU requirement (cores)</em></strong> dan <strong><em>Memory requirement (MiB)</em></strong>: Kamu dapat menentukan <a href=/docs/tasks/configure-pod-container/limit-range/>batasan sumber daya</a> minimal untuk Container. Secara bawaan, Pod-Pod berjalan dengan CPU dan memori yang tak dibatasi.</p></li><li><p><strong><em>Run command</em></strong> dan <strong><em>Run command arguments</em></strong>: Secara bawaan, Container-Container kamu akan menjalankan perintah <a href=/docs/user-guide/containers/#containers-and-commands><em>entrypoint</em></a> bawaan dari <em>image</em> Docker yang ditentukan. Kamu dapat menggunakan opsi <em>Run command</em> dan <em>Run command arguments</em> untuk mengganti bawaannya.</p></li><li><p><strong><em>Run as priveleged</em></strong>: Pengaturan ini untuk menentukan sebuah proses yang berjalan dalam <a href=/docs/user-guide/pods/#privileged-mode-for-pod-containers><em>privileged container</em></a> sepadan dengan proses yang berjalan sebagai <em>root</em> pada <em>host</em>-nya. <em>Priveleged container</em> dapat menggunakan kemampuan seperti memanipulasi <em>stack</em> jaringan dan mengakses perangkat-perangkat.</p></li><li><p><strong><em>Environment variables</em></strong>: Kubernetes mengekspos Service melalui <a href=/docs/tasks/inject-data-application/environment-variable-expose-pod-information/><em>environment variable</em></a>. Kamu dapat membuat <em>environment variable</em> atau meneruskan argumen ke perintah-perintah untuk menjalankan Container dengan nilai dari <em>environment variable</em>. <em>Environment Variable</em> dapat digunakan pada aplikasi-aplikasi untuk menemukan sebuah Service. Nilai <em>environment variable</em> dapat merujuk ke variabel lain menggunakan sintaksis <code>$(VAR_NAME)</code>.</p></li></ul><h3 id=menggungah-berkas-yaml-atau-json>Menggungah berkas YAML atau JSON</h3><p>Kubernetes mendukung pengaturan deklaratif. Dengan cara ini, semua pengaturan disimpan dalam bentuk berkas YAML atau JSON menggunakan skema sumber daya [<a href=/id/docs/concepts/overview/kubernetes-api/>API</a>.</p><p>Sebagai alternatif untuk menentukan detail aplikasi di <em>deploy wizard</em>, kamu dapat menentukan sendiri detail aplikasi kamu dalam berkas YAML atau JSON, dan mengunggah berkas tersebut menggunakan Dashboard.</p><h2 id=menggunakan-dashboard>Menggunakan Dashboard</h2><p>Bagian ini akan menjelaskan bagian-bagian yang ada pada Antarmuka Dashboard Kubernetes; apa saja yang mereka sediakan dan bagaimana cara menggunakanya.</p><h3 id=navigation>Navigation</h3><p>Ketika ada objek Kubernetes yang sudah didefinisikan di dalam klaster, Dashboard akan menampilkanya di tampilan awalnya. Secara bawaan hanya objek-objek dalam Namespace <em>default</em> saja yang ditampilkan di sini dan kamu dapat menggantinya dengan selektor Namespace yang berada di menu navigasi.</p><p>Dashboard menampilkan jenis objek Kubernetes dan mengelompokanya dalam beberapa kategori menu.</p><h4 id=admin-overview>Admin Overview</h4><p>Untuk administrasi klaster dan Namespace, Dashboard menampilkan Node, Namespace dan PresistentVolume dan memiliki tampilan yang detail untuk objek-objek tersebut. Daftar Node berisi metrik penggunaan CPU dan memori yang dikumpulkan dari semua Node. Tampilan detail menampilkan metrik-metrik untuk sebuah Node, spesifikasinya, status, sumber daya yang dialokasikan, <em>event-event</em>, dan Pod-Pod yang sedang berjalan di Node tersebut.</p><h4 id=workloads>Workloads</h4><p>Menampilkan semua aplikasi yang sedang berjalan di Namespace yang dipilih. Tampilan ini menampilkan aplikasi berdasarkan jenis beban kerja (misalnya, Deployment, Replica Set, Stateful Set, dll.) dan setiap jenis beban kerja memiliki tampilanya sendiri. Daftar ini merangkum informasi yang dapat ditindaklanjuti, seperti berapa banyak Pod yang siap untuk setiap Replica Set atau penggunaan memori pada sebuah Pod.</p><p>Tampilan detail dari beban kerja menampilkan status dan informasi spesifik serta hubungan antara objek. Misalnya, Pod-Pod yang diatur oleh ReplicaSet atau, ReplicaSet-ReplicaSet baru, dan HorizontalPodAutoscaler untuk Deployment.</p><h4 id=services>Services</h4><p>Menampilkan sumber daya Kubernetes yang mengizinkan untuk mengekspos Service-Service ke jaringan luar dan menemukannya (<em>service discovery</em>) di dalam klaster. Untuk itu, tampilan dari Service dan Ingress menunjukan Pod-Pod yang ditarget oleh mereka, <em>endpoint-endpoint</em> internal untuk koneksi klaster, dan <em>endpoint-endpoint</em> eksternal untuk pengguna eksternal.</p><h4 id=storage>Storage</h4><p>Tampilan Storage menampilkan sumber-sumber daya PersistentVolumeClaim yang digunakan oleh aplikasi untuk menyimpan data.</p><h4 id=config-maps-dan-secrets>Config Maps dan Secrets</h4><p>Menampilkan semua sumber daya Kubernetes yang digunakan untuk pengaturan aplikasi yang sedang berjalan di klaster. Pada tampilan ini kamu dapat mengedit dan mengelola objek-objek konfigurasi dan menampilkan kredensial yang tersembunyi secara bawaan.</p><h4 id=logs-viewer>Logs Viewer</h4><p>Laman daftar dan detail Pod tertaut dengan laman penampil log (<em>log viewer</em>). Kamu dapat menelusuri log yang berasal dari Container-Container pada sebuah Pod.</p><p><img src=/images/docs/ui-dashboard-logs-view.png alt="Logs viewer"></p><h2 id=selanjutnya>Selanjutnya</h2><p>Untuk informasi lebih lanjut, lihat
<a href=https://github.com/kubernetes/dashboard>Laman proyek Kubernetes Dashboard</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6a8d9e9e05f2b6825afbb8889c957370>8.2 - Mengakses Klaster</h1><p>Topik ini membahas tentang berbagai cara untuk berinteraksi dengan klaster.</p><h2 id=mengakses-untuk-pertama-kalinya-dengan-kubectl>Mengakses untuk pertama kalinya dengan kubectl</h2><p>Saat mengakses API Kubernetes untuk pertama kalinya, kami sarankan untuk menggunakan
CLI Kubernetes, <code>kubectl</code>.</p><p>Untuk mengakses sebuah klaster, kamu perlu mengetahui lokasi klaster dan mempunyai kredensial untuk mengaksesnya.
Biasanya, ini secara otomatis diatur saat kamu mengikuti <a href=/docs/setup/>Panduan persiapan</a>,
atau orang lain yang mengatur klaster dan memberikan kredensial dan lokasi kepadamu.</p><p>Periksa lokasi dan kredensial yang ada pada konfigurasi kubectl-mu melalui perintah ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config view
</span></span></code></pre></div><p>Beragam <a href=/docs/user-guide/kubectl-cheatsheet>contoh</a> menyediakan pengantar penggunaan kubectl, dan dokumentasi lengkap dapat ditemukan di <a href=/docs/user-guide/kubectl-overview>kubectl manual</a>.</p><h2 id=mengakses-rest-api-secara-langsung>Mengakses REST API secara langsung</h2><p>Kubectl menangani pencarian dan autentikasi ke apiserver.
Jika kamu ingin secara langsung mengakses REST API dengan klien HTTP seperti curl atau wget, atau peramban, ada beberapa cara untuk pencarian dan autentikasi:</p><ul><li>Jalankan kubectl dalam mode proksi.<ul><li>Pendekatan yang disarankan.</li><li>Menggunakan lokasi apiserver yang tersimpan.</li><li>Melakukan verifikasi identitas apiserver menggunakan sertifikat elektronik yang ditandatangani sendiri. Tidak memungkinkan adanya MITM.</li><li>Melakukan autentikasi ke apiserver.</li><li>Di masa depan, dimungkinkan dapat melakukan <em>load-balancing</em> dan <em>failover</em> yang cerdas dari sisi klien.</li></ul></li><li>Penyediaan lokasi dan kredensial langsung ke klien http.<ul><li>Pendekatan alternatif.</li><li>Bekerja dengan beberapa jenis kode klien dengan menggunakan proksi.</li><li>Perlu mengimpor sertifikat elektronik <em>root</em> ke peramban kamu untuk melindungi dari MITM.</li></ul></li></ul><h3 id=menggunakan-kubectl-proxy>Menggunakan kubectl proxy</h3><p>Perintah berikut akan menjalankan kubectl dalam mode di mana ia bertindak sebagai proksi terbalik (<em>reverse proxy</em>).
Hal ini menangani pencarian dan autentikasi apiserver.
Jalankan seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl proxy --port<span style=color:#666>=</span><span style=color:#666>8080</span>
</span></span></code></pre></div><p>Lihat <a href=/docs/reference/generated/kubectl/kubectl-commands/#proxy>kubectl proxy</a> untuk lebih jelasnya.</p><p>Kemudian kamu dapat menjelajahi API-nya dengan curl, wget, atau peramban, ganti localhost dengan [::1] untuk IPv6, seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl http://localhost:8080/api/
</span></span></code></pre></div><p>Hasil keluarannya seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;kind&#34;</span>: <span style=color:#b44>&#34;APIVersions&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;versions&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;v1&#34;</span>
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;serverAddressByClientCIDRs&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>&#34;clientCIDR&#34;</span>: <span style=color:#b44>&#34;0.0.0.0/0&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>&#34;serverAddress&#34;</span>: <span style=color:#b44>&#34;10.0.1.149:443&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=tanpa-menggunakan-kubectl-proxy>Tanpa menggunakan kubectl proxy</h3><p>Gunakan <code>kubectl describe secret...</code> untuk mendapatkan token untuk akun servis (<em>service account</em>) <code>default</code> dengan grep/cut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>APISERVER</span><span style=color:#666>=</span><span style=color:#a2f;font-weight:700>$(</span>kubectl config view --minify | grep server | cut -f 2- -d <span style=color:#b44>&#34;:&#34;</span> | tr -d <span style=color:#b44>&#34; &#34;</span><span style=color:#a2f;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#b8860b>SECRET_NAME</span><span style=color:#666>=</span><span style=color:#a2f;font-weight:700>$(</span>kubectl get secrets | grep ^default | cut -f1 -d <span style=color:#b44>&#39; &#39;</span><span style=color:#a2f;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#b8860b>TOKEN</span><span style=color:#666>=</span><span style=color:#a2f;font-weight:700>$(</span>kubectl describe secret <span style=color:#b8860b>$SECRET_NAME</span> | grep -E <span style=color:#b44>&#39;^token&#39;</span> | cut -f2 -d<span style=color:#b44>&#39;:&#39;</span> | tr -d <span style=color:#b44>&#34; &#34;</span><span style=color:#a2f;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl <span style=color:#b8860b>$APISERVER</span>/api --header <span style=color:#b44>&#34;Authorization: Bearer </span><span style=color:#b8860b>$TOKEN</span><span style=color:#b44>&#34;</span> --insecure
</span></span></code></pre></div><p>Hasil keluarannya seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;kind&#34;</span>: <span style=color:#b44>&#34;APIVersions&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;versions&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;v1&#34;</span>
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;serverAddressByClientCIDRs&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>&#34;clientCIDR&#34;</span>: <span style=color:#b44>&#34;0.0.0.0/0&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>&#34;serverAddress&#34;</span>: <span style=color:#b44>&#34;10.0.1.149:443&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Menggunakan <code>jsonpath</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>APISERVER</span><span style=color:#666>=</span><span style=color:#a2f;font-weight:700>$(</span>kubectl config view --minify -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#39;{.clusters[0].cluster.server}&#39;</span><span style=color:#a2f;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#b8860b>SECRET_NAME</span><span style=color:#666>=</span><span style=color:#a2f;font-weight:700>$(</span>kubectl get serviceaccount default -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#39;{.secrets[0].name}&#39;</span><span style=color:#a2f;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#b8860b>TOKEN</span><span style=color:#666>=</span><span style=color:#a2f;font-weight:700>$(</span>kubectl get secret <span style=color:#b8860b>$SECRET_NAME</span> -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#39;{.data.token}&#39;</span> | base64 --decode<span style=color:#a2f;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl <span style=color:#b8860b>$APISERVER</span>/api --header <span style=color:#b44>&#34;Authorization: Bearer </span><span style=color:#b8860b>$TOKEN</span><span style=color:#b44>&#34;</span> --insecure
</span></span></code></pre></div><p>Hasil keluarannya seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;kind&#34;</span>: <span style=color:#b44>&#34;APIVersions&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;versions&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;v1&#34;</span>
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;serverAddressByClientCIDRs&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>&#34;clientCIDR&#34;</span>: <span style=color:#b44>&#34;0.0.0.0/0&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>&#34;serverAddress&#34;</span>: <span style=color:#b44>&#34;10.0.1.149:443&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Contoh di atas menggunakan <em>flag</em> <code>--insecure</code>. Hal ini membuatnya rentan terhadap serangan MITM.
Ketika kubectl mengakses klaster, kubectl menggunakan sertifikat elektronik <em>root</em> yang tersimpan dan sertifikat elektronik klien untuk mengakses server.
(Sertifikat-sertifikat elektronik tersebut diinstal di direktori <code>~/.kube</code>). Karena sertifikat elektronik klaster biasanya ditandatangani sendiri,
mungkin diperlukan konfigurasi khusus untuk membuat klien HTTP kamu menggunakan sertifikat elektronik root.</p><p>Pada beberapa klaster, apiserver tidak memerlukan autentikasi; mungkin apiserver tersebut meladen (<em>serve</em>) di localhost, atau dilindungi oleh sebuah dinding api (<em>firewall</em>).
Tidak ada standar untuk ini. <a href=/docs/reference/access-authn-authz/controlling-access/>Mengonfigurasi Akses ke API</a> menjelaskan bagaimana admin klaster dapat mengonfigurasi hal ini.
Pendekatan semacam itu dapat bertentangan dengan dukungan ketersediaan tinggi (<em>high-availability</em>) pada masa depan.</p><h2 id=akses-terprogram-ke-api>Akses terprogram ke API</h2><p>Kubernetes secara resmi mendukung pustaka (<em>library</em>) klien <a href=#klien-go>Go</a> dan <a href=#klien-python>Python</a>.</p><h3 id=klien-go>Klien Go</h3><ul><li>Untuk mendapatkan pustakanya, jalankan perintah berikut: <code>go get k8s.io/client-go@kubernetes-&lt;kubernetes-version-number></code>, lihat <a href=https://github.com/kubernetes/client-go/blob/master/INSTALL.md#for-the-casual-user>INSTALL.md</a> untuk instruksi instalasi yang lebih detail. Lihat <a href=https://github.com/kubernetes/client-go#compatibility-matrix>https://github.com/kubernetes/client-go</a> untuk melihat versi yang didukung.</li><li>Tulis aplikasi dengan menggunakan klien client-go. Perhatikan bahwa client-go mendefinisikan objek APInya sendiri, jadi jika perlu, silakan impor definisi API dari client-go daripada dari repositori utama, misalnya, <code>import "k8s.io/client-go/kubernetes"</code>.</li></ul><p>Klien Go dapat menggunakan <a href=/docs/concepts/cluster-administration/authenticate-across-clusters-kubeconfig/>berkas kubeconfig</a> yang sama dengan yang digunakan oleh CLI kubectl untuk mencari dan mengautentikasi ke apiserver. Lihat <a href=https://git.k8s.io/client-go/examples/out-of-cluster-client-configuration/main.go>contoh ini</a>.</p><p>Jika aplikasi ini digunakan sebagai Pod di klaster, silakan lihat <a href=#mengakses-api-dari-pod>bagian selanjutnya</a>.</p><h3 id=klien-python>Klien Python</h3><p>Untuk menggunakan <a href=https://github.com/kubernetes-client/python>klien Python</a>, jalankan perintah berikut: <code>pip install kubernetes</code>. Lihat <a href=https://github.com/kubernetes-client/python>halaman Pustaka Klien Python</a> untuk opsi instalasi lainnya.</p><p>Klien Python dapat menggunakan <a href=/docs/concepts/cluster-administration/authenticate-across-clusters-kubeconfig/>berkas kubeconfig</a> yang sama dengan yang digunakan oleh CLI kubectl untuk mencari dan mengautentikasi ke apiserver. Lihat <a href=https://github.com/kubernetes-client/python/tree/master/examples>contoh</a>.</p><h3 id=bahasa-lainnya>Bahasa lainnya</h3><p>Ada <a href=/docs/reference/using-api/client-libraries/>pustaka klien</a> untuk mengakses API dari bahasa lain.
Lihat dokumentasi pustaka lain untuk melihat bagaimana mereka melakukan autentikasi.</p><h2 id=mengakses-api-dari-pod>Mengakses API dari Pod</h2><p>Saat mengakses API dari Pod, pencarian dan autentikasi ke apiserver agak berbeda.</p><p>Cara yang disarankan untuk menemukan apiserver di dalam Pod adalah dengan nama DNS <code>kubernetes.default.svc</code>,
yang akan mengubah kedalam bentuk Service IP yang pada gilirannya akan dialihkan ke apiserver.</p><p>Cara yang disarankan untuk mengautentikasi ke apiserver adalah dengan kredensial <a href=/id/docs/tasks/configure-pod-container/configure-service-account/>akun servis</a>.
Oleh kube-system, Pod dikaitkan dengan sebuah akun servis (<em>service account</em>), dan sebuah kredensial (token) untuk akun servis (<em>service account</em>) tersebut ditempatkan ke pohon sistem berkas (<em>file system tree</em>) dari setiap Container di dalam Pod tersebut,
di <code>/var/run/secrets/kubernetes.io/serviceaccount/token</code>.</p><p>Jika tersedia, bundel sertifikat elektronik ditempatkan ke pohon sistem berkas dari setiap Container di <code>/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code>,
dan itu akan digunakan untuk memverifikasi sertifikat elektronik yang digunakan apiserver untuk meladen.</p><p>Terakhir, Namespace <code>default</code> yang akan digunakan untuk operasi API <em>namespaced</em> ditempatkan di dalam berkas <code>/var/run/secrets/kubernetes.io/serviceaccount/namespace</code> di dalam setiap Container.</p><p>Dari dalam Pod, cara yang disarankan untuk menghubungi API adalah:</p><ul><li>Jalankan <code>kubectl proxy</code> pada Container <em>sidecar</em> di dalam Pod, atau sebagai proses <em>background</em> di dalam Container.
Perintah tersebut memproksi API Kubernetes pada antarmuka localhost Pod tersebut, sehingga proses lain dalam Container apa pun milik Pod dapat mengaksesnya.</li><li>Gunakan pustaka klien Go, dan buatlah sebuah klien menggunakan fungsi <code>rest.InClusterConfig()</code> dan <code>kubernetes.NewForConfig()</code>.
Mereka menangani pencarian dan autentikasi ke apiserver. <a href=https://git.k8s.io/client-go/examples/in-cluster-client-configuration/main.go>contoh</a></li></ul><p>Pada setiap kasus, kredensial Pod digunakan untuk berkomunikasi secara aman dengan apiserver.</p><h2 id=mengakses-servis-yang-berjalan-di-klaster>Mengakses servis yang berjalan di klaster</h2><p>Bagian sebelumnya menjelaskan tentang menghubungi server API Kubernetes. Bagian ini menjelaskan tentang menghubungi servis lain yang berjalan di klaster Kubernetes.
Di Kubernetes, semua <a href=/docs/admin/node>Node</a>, <a href=/docs/user-guide/pods>Pod</a>, dan <a href=/docs/user-guide/services>Service</a> memiliki IP sendiri.
Dalam banyak kasus, IP Node, IP Pod, dan beberapa IP Service pada sebuah klaster tidak dapat dirutekan, sehingga mereka tidak terjangkau dari mesin di luar klaster, seperti mesin desktop kamu.</p><h3 id=cara-untuk-terhubung>Cara untuk terhubung</h3><p>Kamu memiliki beberapa opsi untuk menghubungi Node, Pod, dan Service dari luar klaster:</p><ul><li>Mengakses Service melalui IP publik.<ul><li>Gunakan Service dengan tipe <code>NodePort</code> atau <code>LoadBalancer</code> untuk membuat Service dapat dijangkau di luar klaster. Lihat dokumentasi <a href=/docs/user-guide/services>Service</a> dan perintah <a href=/docs/reference/generated/kubectl/kubectl-commands/#expose>kubectl expose</a>.</li><li>Bergantung pada lingkungan klaster kamu, hal ini mungkin hanya mengekspos Service ke jaringan perusahaan kamu, atau mungkin mengeksposnya ke internet. Pikirkan apakah Service yang diekspos aman atau tidak. Apakah layanan di balik Service tersebut melakukan autentikasinya sendiri?</li><li>Tempatkan Pod di belakang Service. Untuk mengakses satu Pod tertentu dari sekumpulan replika, misalnya untuk pengawakutuan (<em>debugging</em>), letakkan label unik di Pod dan buat Service baru yang memilih label ini.</li><li>Pada kebanyakan kasus, pengembang aplikasi tidak perlu langsung mengakses Node melalui IP Node mereka.</li></ul></li><li>Akses Service, Node, atau Pod menggunakan <em>Verb</em> Proxy.<ul><li>Apakah autentikasi dan otorisasi apiserver dilakukan sebelum mengakses Service jarak jauh. Gunakan ini jika Service tersebut tidak cukup aman untuk diekspos ke internet, atau untuk mendapatkan akses ke porta (<em>port</em>) pada IP Node, atau untuk pengawakutuan.</li><li>Proksi dapat menyebabkan masalah untuk beberapa aplikasi web.</li><li>Hanya bekerja pada HTTP/HTTPS.</li><li>Dijelaskan <a href=#url-proxy-apiserver-secara-manual>di sini</a>.</li></ul></li><li>Akses dari Node atau Pod di klaster.<ul><li>Jalankan Pod, kemudian hubungkan ke sebuah <em>shell</em> di dalamnya menggunakan <a href=/docs/reference/generated/kubectl/kubectl-commands/#exec>kubectl exec</a>. Hubungi Node, Pod, dan Service lain dari <em>shell</em> itu.</li><li>Beberapa klaster memungkinkan kamu untuk melakukan SSH ke sebuah Node di dalam klaster. Dari sana, kamu mungkin dapat mengakses Service-Service klaster. Hal ini merupakan metode yang tidak standar, dan akan bekerja pada beberapa klaster tetapi tidak pada yang lain. Peramban dan perkakas lain mungkin diinstal atau tidak. DNS Klaster mungkin tidak berfungsi.</li></ul></li></ul><h3 id=menemukan-service-bawaan-builtin>Menemukan Service bawaan (<em>builtin</em>)</h3><p>Biasanya, ada beberapa Service yang dimulai pada sebuah klaster oleh kube-system. Dapatkan daftarnya dengan perintah <code>kubectl cluster-info</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl cluster-info
</span></span></code></pre></div><p>Keluarannya mirip seperti ini:</p><pre tabindex=0><code>Kubernetes master is running at https://104.197.5.247
elasticsearch-logging is running at https://104.197.5.247/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy
kibana-logging is running at https://104.197.5.247/api/v1/namespaces/kube-system/services/kibana-logging/proxy
kube-dns is running at https://104.197.5.247/api/v1/namespaces/kube-system/services/kube-dns/proxy
grafana is running at https://104.197.5.247/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy
heapster is running at https://104.197.5.247/api/v1/namespaces/kube-system/services/monitoring-heapster/proxy
</code></pre><p>Ini menunjukkan URL <em>proxy-verb</em> untuk mengakses setiap Service.
Misalnya, klaster ini mempunyai pencatatan log pada level klaster (<em>cluster-level logging</em>) yang aktif (menggunakan Elasticsearch), yang dapat dicapai di <code>https://104.197.5.247/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/</code> jika kredensial yang sesuai diberikan.
Pencatatan log dapat pula dicapai dengan sebuah proksi <em>kubectl</em>, misalnya di:
<code>http://localhost:8080/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/</code>.
(Lihat <a href=#mengakses-rest-api-secara-langsung>di atas</a> untuk panduan bagaimana cara meneruskan kredensial atau menggunakan <code>kubectl proxy</code>.)</p><h4 id=membuat-url-proksi-apiserver-secara-manual>Membuat URL proksi apiserver secara manual</h4><p>Seperti disebutkan di atas, kamu menggunakan perintah <code>kubectl cluster-info</code> untuk mendapatkan URL proksi suatu Service.
Untuk membuat URL proksi yang memuat <em>endpoint-endpoint</em> Service, sufiks, dan parameter, kamu cukup menambahkan ke URL proksi Service:
<code>http://</code><em><code>alamat_kubernetes_master</code></em><code>/api/v1/namespaces/</code><em><code>nama_namespace</code></em><code>/services/</code><em><code>nama_servis[:nama_porta]</code></em><code>/proxy</code></p><p>Jika kamu belum menentukan nama untuk porta kamu, kamu tidak perlu memasukan <em>nama_porta</em> di URL.</p><p>Secara bawaan, server API memproksi ke Service kamu menggunakan HTTP. Untuk menggunakan HTTPS, awali nama Service dengan <code>https:</code>:
<code>http://</code><em><code>alamat_kubernetes_master</code></em><code>/api/v1/namespaces/</code><em><code>nama_namespace</code></em><code>/services/</code><em><code>https:nama_servis:[nama_porta]</code></em><code>/proxy</code></p><p>Format yang didukung untuk segmen nama URL adalah:</p><ul><li><code>&lt;nama_servis></code> - Memproksi ke porta bawaan atau porta tanpa nama menggunakan HTTP</li><li><code>&lt;nama_servis>:&lt;nama_porta></code> - Memproksi ke porta yang telah ditentukan menggunakan HTTP</li><li><code>https:&lt;nama_servis>:</code> - Memproksi ke porta bawaan atau porta tanpa nama menggunakan HTTPS (perhatikan tanda adanya titik dua)</li><li><code>https:&lt;nama_servis>:&lt;nama_porta></code> - proksi ke porta yang telah ditentukan menggunakan https</li></ul><h5 id=contoh>Contoh</h5><ul><li>Untuk mengakses <em>endpoint</em> Service Elasticsearch <code>_search?q=user:kimchy</code>, kamu dapat menggunakan: <code>http://104.197.5.247/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/_search?q=user:kimchy</code></li><li>Untuk mengakses informasi kesehatan klaster Elasticsearch <code>_cluster/health?pretty=true</code>, kamu dapat menggunakan: <code>https://104.197.5.247/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/_cluster/health?pretty=true</code></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;cluster_name&#34;</span> : <span style=color:#b44>&#34;kubernetes_logging&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;status&#34;</span> : <span style=color:#b44>&#34;yellow&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;timed_out&#34;</span> : <span style=color:#a2f;font-weight:700>false</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;number_of_nodes&#34;</span> : <span style=color:#666>1</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;number_of_data_nodes&#34;</span> : <span style=color:#666>1</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;active_primary_shards&#34;</span> : <span style=color:#666>5</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;active_shards&#34;</span> : <span style=color:#666>5</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;relocating_shards&#34;</span> : <span style=color:#666>0</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;initializing_shards&#34;</span> : <span style=color:#666>0</span>,
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>&#34;unassigned_shards&#34;</span> : <span style=color:#666>5</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=menggunakan-peramban-web-untuk-mengakses-service-yang-berjalan-di-klaster>Menggunakan peramban web untuk mengakses Service yang berjalan di klaster</h3><p>Kamu mungkin dapat memasukkan URL proksi apiserver ke bilah alamat peramban. Namun:</p><ul><li>Peramban web biasanya tidak dapat menerima token, jadi kamu mungkin perlu menggunakan autentikasi dasar/<em>basic auth</em> (kata sandi). Apiserver dapat dikonfigurasi untuk menerima autentikasi dasar, tetapi klaster kamu mungkin belum dikonfigurasi untuk menerima autentikasi dasar.</li><li>Beberapa aplikasi web mungkin tidak berfungsi, terutama yang memiliki javascript pada sisi klien yang digunakan untuk membuat URL sedemikian sehingga ia tidak mengetahui adanya prefiks jalur (<em>path</em>) proksi (<code>/proxy</code>).</li></ul><h2 id=meminta-pengalihan>Meminta pengalihan</h2><p>Kemampuan pengalihan telah usang (<em>deprecated</em>) dan dihapus. Silakan gunakan proksi (lihat di bawah) sebagai gantinya.</p><h2 id=begitu-banyaknya-proksi>Begitu Banyaknya Proksi</h2><p>Ada beberapa proksi berbeda yang mungkin kamu temui saat menggunakan Kubernetes:</p><ol><li><p><a href=#mengakses-rest-api-secara-langsung>Proksi kubectl</a>:</p><ul><li>berjalan di desktop pengguna atau di Pod</li><li>memproksi dari sebuah alamat localhost ke apiserver Kubernetes</li><li>dari klien ke proksi menggunakan HTTP</li><li>dari proksi ke apiserver menggunakan HTTPS</li><li>menemukan apiserver-nya</li><li>menambahkan <em>header-header</em> autentikasi</li></ul></li><li><p><a href=#menemukan-service-bawaan-builtin>Proksi apiserver</a>:</p><ul><li>merupakan sebuah <em>bastion</em> yang dibangun ke dalam apiserver</li><li>menghubungkan pengguna di luar klaster ke IP klaster yang mungkin tidak dapat dijangkau</li><li>berjalan dalam proses apiserver</li><li>dari klien ke proksi menggunakan HTTPS (atau HTTP jika apiserver dikonfigurasi)</li><li>dari proksi ke target dapat menggunakan HTTP atau HTTPS seperti yang dipilih oleh proksi menggunakan informasi yang tersedia</li><li>dapat digunakan untuk menjangkau Node, Pod, atau Service</li><li>melakukan <em>load balancing</em> saat digunakan untuk menjangkau sebuah Service</li></ul></li><li><p><a href=/id/docs/concepts/services-networking/service/#ips-and-vips>kube-proxy</a>:</p><ul><li>berjalan di setiap Node</li><li>memproksi UDP dan TCP</li><li>tidak mengerti HTTP</li><li>menyediakan <em>load balancing</em></li><li>hanya digunakan untuk menjangkau Service</li></ul></li><li><p>Sebuah Proksi/<em>Load-balancer</em> di depan apiserver:</p><ul><li>keberadaan dan implementasi bervariasi dari satu klaster ke klaster lainnya (mis. nginx)</li><li>terletak di antara semua klien dan satu atau lebih apiserver</li><li>bertindak sebagai <em>load balancer</em> jika terdapat beberapa apiserver.</li></ul></li><li><p><em>Cloud Load Balancer</em> pada Service eksternal:</p><ul><li>disediakan oleh beberapa penyedia layanan <em>cloud</em> (mis. AWS ELB, Google Cloud Load Balancer)</li><li>dibuat secara otomatis ketika Service Kubernetes memiliki tipe <code>LoadBalancer</code></li><li>hanya menggunakan UDP/TCP</li><li>implementasi bervariasi berdasarkan penyedia layanan <em>cloud</em>.</li></ul></li></ol><p>Pengguna Kubernetes biasanya tidak perlu khawatir tentang apa pun selain dua jenis pertama. Admin klaster biasanya akan memastikan bahwa tipe yang terakhir telah diatur dengan benar.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5a233e14205d77fe1294917d2da6f876>8.3 - Mengkonfigurasi Akses ke Banyak Klaster</h1><p>Halaman ini menunjukkan bagaimana mengkonfigurasi akses ke banyak klaster dengan menggunakan
berkas (<em>file</em>) konfigurasi. Setelah semua klaster, pengguna, dan konteks didefinisikan di
satu atau lebih berkas konfigurasi, kamu akan dengan cepat berpindah antar klaster dengan menggunakan
perintah <code>kubectl config use-context</code>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Berkas yang digunakan untuk mengkonfigurasi akses ke sebuah klaster terkadang disebut
berkas <em>kubeconfig</em>. Ini adalah cara umum untuk merujuk ke berkas konfigurasi.
Itu tidak berarti bahwa selalu ada berkas bernama <code>kubeconfig</code>.</div><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mendefinisikan-klaster-pengguna-dan-konteks>Mendefinisikan klaster, pengguna, dan konteks</h2><p>Misalkan kamu memiliki dua klaster, satu untuk pekerjaan pengembangan dan satu untuk pekerjaan eksperimen (<em>scratch</em>).
Di klaster <code>pengembangan</code>, pengembang <em>frontend</em> kamu bekerja di sebuah Namespace bernama <code>frontend</code>,
dan pengembang penyimpanan kamu bekerja di sebuah Namespace bernama <code>storage</code>. Di klaster <code>scratch</code> kamu,
pengembang bekerja di Namespace <code>default</code>, atau mereka membuat Namespace tambahan sesuai keinginan mereka.
Akses ke klaster <code>development</code> membutuhkan autentikasi dengan sertifikat.
Akses ke klaster <code>scratch</code> membutuhkan autentikasi dengan nama pengguna dan kata sandi.</p><p>Buat sebuah direktori bernama <code>config-exercise</code>. Di direktori <code>config-exercise</code> kamu,
buat sebuah berkas bernama <code>config-demo</code> dengan konten ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>preferences: <span style=color:#666>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>  name: development
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>  name: scratch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: developer
</span></span><span style=display:flex><span>- name: experimenter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>  name: dev-frontend
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>  name: dev-storage
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>  name: exp-scratch
</span></span></code></pre></div><p>Berkas konfigurasi di atas mendeskripsikan semua klaster, pengguna, dan konteks.
Berkas <code>config-demo</code> kamu memiliki kerangka kerja untuk mendeskripsikan dua klaster, dua pengguna, dan tiga konteks.</p><p>Buka direktori <code>config-exercise</code> kamu. Masukkan perintah-perintah berikut untuk menambahkan detail ke
berkas konfigurasi kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo set-cluster development --server<span style=color:#666>=</span>https://1.2.3.4 --certificate-authority<span style=color:#666>=</span>fake-ca-file
</span></span><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo set-cluster scratch --server<span style=color:#666>=</span>https://5.6.7.8 --insecure-skip-tls-verify
</span></span></code></pre></div><p>Tambahkan detail pengguna ke berkas konfigurasi kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo set-credentials developer --client-certificate<span style=color:#666>=</span>fake-cert-file --client-key<span style=color:#666>=</span>fake-key-seefile
</span></span><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo set-credentials experimenter --username<span style=color:#666>=</span>exp --password<span style=color:#666>=</span>some-password
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong><ul><li>Untuk menghapus sebuah pengguna, kamu dapat menjalankan perintah <code>kubectl --kubeconfig=config-demo config unset users.&lt;name></code></li><li>Untuk menghapus sebuah klaster, kamu dapat menjalankan perintah <code>kubectl --kubeconfig=config-demo config unset clusters.&lt;name></code></li><li>Untuk menghapus sebuah konteks, kamu dapat menjalankan perintah <code>kubectl --kubeconfig=config-demo config unset contexts.&lt;name></code></li></ul></div><p>Tambahkan detail konteks ke berkas konfigurasi kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo set-context dev-frontend --cluster<span style=color:#666>=</span>development --namespace<span style=color:#666>=</span>frontend --user<span style=color:#666>=</span>developer
</span></span><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo set-context dev-storage --cluster<span style=color:#666>=</span>development --namespace<span style=color:#666>=</span>storage --user<span style=color:#666>=</span>developer
</span></span><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo set-context exp-scratch --cluster<span style=color:#666>=</span>scratch --namespace<span style=color:#666>=</span>default --user<span style=color:#666>=</span>experimenter
</span></span></code></pre></div><p>Buka berkas <code>config-demo</code> kamu untuk melihat detail-detail yang telah ditambah. Sebagai alternatif dari membuka
berkas <code>config-demo</code>, kamu bisa menggunakan perintah <code>config view</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo view
</span></span></code></pre></div><p>Keluaran akan menampilkan dua klaster, dua pengguna, dan tiga konteks:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>    certificate-authority: fake-ca-file
</span></span><span style=display:flex><span>    server: https://1.2.3.4
</span></span><span style=display:flex><span>  name: development
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>    insecure-skip-tls-verify: <span style=color:#a2f>true</span>
</span></span><span style=display:flex><span>    server: https://5.6.7.8
</span></span><span style=display:flex><span>  name: scratch
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: development
</span></span><span style=display:flex><span>    namespace: frontend
</span></span><span style=display:flex><span>    user: developer
</span></span><span style=display:flex><span>  name: dev-frontend
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: development
</span></span><span style=display:flex><span>    namespace: storage
</span></span><span style=display:flex><span>    user: developer
</span></span><span style=display:flex><span>  name: dev-storage
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: scratch
</span></span><span style=display:flex><span>    namespace: default
</span></span><span style=display:flex><span>    user: experimenter
</span></span><span style=display:flex><span>  name: exp-scratch
</span></span><span style=display:flex><span>current-context: <span style=color:#b44>&#34;&#34;</span>
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>preferences: <span style=color:#666>{}</span>
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: developer
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    client-certificate: fake-cert-file
</span></span><span style=display:flex><span>    client-key: fake-key-file
</span></span><span style=display:flex><span>- name: experimenter
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    password: some-password
</span></span><span style=display:flex><span>    username: exp
</span></span></code></pre></div><p><code>fake-ca-file</code>, <code>fake-cert-file</code>, dan <code>fake-key-file</code> di atas adalah <em>placeholder</em>
untuk nama jalur (<em>pathname</em>) dari berkas-berkas sertifikat. Kamu harus menggantinya menjadi nama jalur
sebenarnya dari berkas-berkas sertifikat di dalam lingkungan (<em>environment</em>) kamu.</p><p>Terkadang kamu mungkin ingin menggunakan data yang disandikan Base64 yang langsung dimasukkan di berkas konfigurasi
daripada menggunakan berkas sertifikat yang terpisah. Dalam kasus ini, kamu perlu menambahkan akhiran <code>-data</code> ke kunci. Contoh, <code>certificate-authority-data</code>, <code>client-certificate-data</code>, dan <code>client-key-data</code>.</p><p>Setiap konteks memiliki tiga bagian: klaster, pengguna, dan Namespace.
Sebagai contoh, konteks <code>dev-frontend</code> menyatakan, "Gunakan kredensial dari pengguna <code>developer</code>
untuk mengakses Namespace <code>frontend</code> di klaster <code>development</code>.</p><p>Mengatur konteks yang digunakan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo use-context dev-frontend
</span></span></code></pre></div><p>Sekarang kapanpun kamu memasukkan perintah <code>kubectl</code>, aksi tersebut akan diterapkan untuk klaster,
dan Namespace yang terdaftar pada konteks <code>dev-frontend</code>. Dan perintah tersebut akan menggunakan
kredensial dari pengguna yang terdaftar pada konteks <code>dev-frontend</code>.</p><p>Untuk melihat hanya informasi konfigurasi yang berkaitan dengan konteks saat ini,
gunakan <code>--minify</code> flag.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo view --minify
</span></span></code></pre></div><p>Output menunjukkan informasi konfigurasi yang berkaitan dengan konteks <code>dev-frontend</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>    certificate-authority: fake-ca-file
</span></span><span style=display:flex><span>    server: https://1.2.3.4
</span></span><span style=display:flex><span>  name: development
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: development
</span></span><span style=display:flex><span>    namespace: frontend
</span></span><span style=display:flex><span>    user: developer
</span></span><span style=display:flex><span>  name: dev-frontend
</span></span><span style=display:flex><span>current-context: dev-frontend
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>preferences: <span style=color:#666>{}</span>
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: developer
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    client-certificate: fake-cert-file
</span></span><span style=display:flex><span>    client-key: fake-key-file
</span></span></code></pre></div><p>Sekarang apabila kamu ingin bekerja sebentar di klaster eksperimen.</p><p>Ubah konteks saat ini menjadi <code>exp-scratch</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo use-context exp-scratch
</span></span></code></pre></div><p>Sekarang, setiap perintah <code>kubectl</code> yang diberikan akan berlaku untuk Namespace <code>default</code>
dari klaster <code>scratch</code>. Dan perintah akan menggunakan kredensial dari pengguna yang
terdaftar di konteks <code>exp-scratch</code>.</p><p>Untuk melihat konfigurasi yang berkaitan dengan konteks saat ini, <code>exp-scratch</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo view --minify
</span></span></code></pre></div><p>Akhirnya, misalkan kamu ingin bekerja sebentar di Namespace <code>storage</code> pada
klaster <code>development</code>.</p><p>Ubah konteks saat ini menjadi <code>dev-storage</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo use-context dev-storage
</span></span></code></pre></div><p>Untuk melihat konfigurasi yang berkaitan dengan konteks baru saat ini, <code>dev-storage</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config --kubeconfig<span style=color:#666>=</span>config-demo view --minify
</span></span></code></pre></div><h2 id=membuat-sebuah-berkas-konfigurasi-kedua>Membuat sebuah berkas konfigurasi kedua</h2><p>Di direktori <code>config-exercise</code> kamu, buat sebuah berkas bernama <code>config-demo-2</code> dengan konten ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>preferences: <span style=color:#666>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: development
</span></span><span style=display:flex><span>    namespace: ramp
</span></span><span style=display:flex><span>    user: developer
</span></span><span style=display:flex><span>  name: dev-ramp-up
</span></span></code></pre></div><p>Berkas konfigurasi di atas mendefinisikan sebuah konteks baru bernama <code>dev-ramp-up</code>.</p><h2 id=mengatur-variabel-lingkungan-kubeconfig>Mengatur variabel lingkungan KUBECONFIG</h2><p>Lihat apakah kamu sudah memiliki sebuah variabel lingkungan bernama <code>KUBECONFIG</code>.
Jika iya, simpan nilai saat ini dari variabel lingkungan <code>KUBECONFIG</code> kamu, sehingga kamu dapat mengembalikannya nanti.
Sebagai contohL</p><h3 id=linux>Linux</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>KUBECONFIG_SAVED</span><span style=color:#666>=</span><span style=color:#b8860b>$KUBECONFIG</span>
</span></span></code></pre></div><h3 id=windows-powershell>Windows PowerShell</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>$Env</span>:KUBECONFIG_SAVED<span style=color:#666>=</span><span style=color:#b8860b>$ENV</span>:KUBECONFIG
</span></span></code></pre></div><p>Variabel lingkungan <code>KUBECONFIG</code> adalah sebuah daftar dari jalur-jalur (beragam <em>path</em>) menuju berkas konfigurasi.
Daftar ini dibatasi oleh tanda titik dua untuk Linux dan Mac, dan tanda titik koma untuk Windows. Jika kamu
memiliki sebuah variabel lingkungan <code>KUBECONFIG</code>, biasakan diri kamu dengan berkas-berkas konfigurasi
yang ada pada daftar.</p><p>Tambahkan sementara dua jalur ke variabel lingkungan <code>KUBECONFIG</code> kamu. Sebagai contoh:</p><h3 id=linux-1>Linux</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>KUBECONFIG</span><span style=color:#666>=</span><span style=color:#b8860b>$KUBECONFIG</span>:config-demo:config-demo-2
</span></span></code></pre></div><h3 id=windows-powershell-1>Windows PowerShell</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>$Env</span>:KUBECONFIG<span style=color:#666>=(</span><span style=color:#b44>&#34;config-demo;config-demo-2&#34;</span><span style=color:#666>)</span>
</span></span></code></pre></div><p>Di direktori <code>config-exercise</code> kamu, masukan perintah ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config view
</span></span></code></pre></div><p>Keluaran menunjukkan informasi gabungan dari semua berkas yang terdaftar dalam variabel lingkungan <code>KUBECONFIG</code> kamu.
Secara khusus, perhatikan bahwa informasi gabungan tersebut memiliki konteks <code>dev-ramp-up</code>, konteks dari berkas
<code>config-demo-2</code>, dan tiga konteks dari berkas <code>config-demo</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: development
</span></span><span style=display:flex><span>    namespace: frontend
</span></span><span style=display:flex><span>    user: developer
</span></span><span style=display:flex><span>  name: dev-frontend
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: development
</span></span><span style=display:flex><span>    namespace: ramp
</span></span><span style=display:flex><span>    user: developer
</span></span><span style=display:flex><span>  name: dev-ramp-up
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: development
</span></span><span style=display:flex><span>    namespace: storage
</span></span><span style=display:flex><span>    user: developer
</span></span><span style=display:flex><span>  name: dev-storage
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: scratch
</span></span><span style=display:flex><span>    namespace: default
</span></span><span style=display:flex><span>    user: experimenter
</span></span><span style=display:flex><span>  name: exp-scratch
</span></span></code></pre></div><p>Untuk informasi lebih tentang bagaimana berkas Kubeconfig tergabung, lihat
<a href=/id/docs/concepts/configuration/organize-cluster-access-kubeconfig/>Mengatur Akses Cluster Menggunakan Berkas Kubeconfig</a></p><h2 id=jelajahi-direktori-home-kube>Jelajahi direktori $HOME/.kube</h2><p>Jika kamu sudah memiliki sebuah klaster, dan kamu bisa menggunakan <code>kubectl</code> untuk berinteraksi dengan
klaster kamu, kemudian kamu mungkin memiliki sebuah berkas bernama <code>config</code> di
direktori <code>$HOME/.kube</code>.</p><p>Buka <code>$HOME/.kube</code>, dan lihat berkas-berkas apa saja yang ada. Biasanya ada berkas bernama
<code>config</code>. Mungkin juga ada berkas-berkas konfigurasi lain di direktori ini.
Biasakan diri anda dengan konten-konten yang ada di berkas-berkas tersebut.</p><h2 id=tambahkan-home-kube-config-ke-variabel-lingkungan-kubeconfig-kamu>Tambahkan $HOME/.kube/config ke variabel lingkungan KUBECONFIG kamu</h2><p>Jika kamu memiliki sebuah berkas <code>$HOME/.kube/config</code>, dan belum terdaftar dalam variabel lingungan
<code>KUBECONFIG</code> kamu, tambahkan berkas tersebut ke variabel lingkungan <code>KUBECONFIG</code> kamu sekarang.
Sebagai contoh:</p><h3 id=linux-2>Linux</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>KUBECONFIG</span><span style=color:#666>=</span><span style=color:#b8860b>$KUBECONFIG</span>:<span style=color:#b8860b>$HOME</span>/.kube/config
</span></span></code></pre></div><h3 id=windows-powershell-2>Windows Powershell</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>$Env</span>:KUBECONFIG<span style=color:#666>=(</span><span style=color:#b8860b>$Env</span>:KUBECONFIG;<span style=color:#b8860b>$HOME</span>/.kube/config<span style=color:#666>)</span>
</span></span></code></pre></div><p>Lihat gabungan informasi konfigurasi dari semua berkas yang sekarang tergabung
dalam variabel lingkungan <code>KUBECONFIG</code> kamu. Di direktori <code>config-exercise</code> kamu, masukkan perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl config view
</span></span></code></pre></div><h2 id=membersihkan>Membersihkan</h2><p>Kembalikan variabel lingkungan <code>KUBECONFIG</code> kamu ke nilai asilnya. Sebagai contoh:<br></p><h3 id=linux-3>Linux</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>KUBECONFIG</span><span style=color:#666>=</span><span style=color:#b8860b>$KUBECONFIG_SAVED</span>
</span></span></code></pre></div><h3 id=windows-powershell-3>Windows PowerShell</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#b8860b>$Env</span>:KUBECONFIG<span style=color:#666>=</span><span style=color:#b8860b>$ENV</span>:KUBECONFIG_SAVED
</span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><ul><li><a href=/id/docs/concepts/configuration/organize-cluster-access-kubeconfig/>Mengatur Akses Cluster Menggunakan Berkas Kubeconfig</a></li><li><a href=/docs/reference/generated/kubectl/kubectl-commands#config>kubectl config</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-72d3dddbc0c166c9a364e753d2b31ff0>8.4 - Menggunakan Port Forwarding untuk Mengakses Aplikasi di sebuah Klaster</h1><p>Halaman ini menunjukkan bagaimana menggunakan <code>kubectl port-forward</code> untuk menghubungkan sebuah server Redis yang sedang berjalan di sebuah klaster Kubernetes. Tipe dari koneksi ini dapat berguna untuk melakukan <em>debugging</em> basis data.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Kubernetes servermu harus dalam versi yang sama atau lebih baru dari v1.10.
Untuk melihat versi, tekan <code>kubectl version</code>.</p><ul><li>Install <a href=http://redis.io/topics/rediscli>redis-cli</a>.</li></ul><h2 id=membuat-deployment-dan-service-redis>Membuat Deployment dan Service Redis</h2><ol><li><p>Buat sebuah Deployment yang menjalankan Redis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/guestbook/redis-master-deployment.yaml
</span></span></code></pre></div><p>Keluaran dari sebuah perintah yang sukses akan memverifikasi bahwa Deployment telah terbuat:</p><pre tabindex=0><code>deployment.apps/redis-master created
</code></pre><p>Lihat status Pod untuk memeriksa apakah sudah siap:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><p>Keluaran menampilkan Pod yang telah terbuat:</p><pre tabindex=0><code>NAME                            READY     STATUS    RESTARTS   AGE
redis-master-765d459796-258hz   1/1       Running   0          50s
</code></pre><p>Lihat status Deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get deployment
</span></span></code></pre></div><p>Keluaran menampilkan bahwa Deployment telah terbuat:</p><pre tabindex=0><code>NAME         READY   UP-TO-DATE   AVAILABLE   AGE
redis-master 1/1     1            1           55s
</code></pre><p>Deployment secara otomatis mengatur sebuah ReplicaSet.
Lihat status ReplicaSet menggunakan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get replicaset
</span></span></code></pre></div><p>Keluaran menampilkan bahwa ReplicaSet telah terbuat:</p><pre tabindex=0><code>NAME                      DESIRED   CURRENT   READY     AGE
redis-master-765d459796   1         1         1         1m
</code></pre></li><li><p>Buat sebuah Service untuk mengekspos Redis di jaringan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/guestbook/redis-master-service.yaml
</span></span></code></pre></div><p>Keluaran dari perintah yang sukses akan memverifikasi bahwa Service telah terbuat:</p><pre tabindex=0><code>service/redis-master created
</code></pre><p>Lihat Service yang telah terbuat menggunakan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get service redis-master
</span></span></code></pre></div><p>Keluaran menampilkan service yang telah terbuat:</p><pre tabindex=0><code>NAME           TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE
redis-master   ClusterIP   10.0.0.213   &lt;none&gt;        6379/TCP   27s
</code></pre></li><li><p>Periksa apakah server Redis berjalan di Pod, dan mendengarkan porta 6379:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Ubah redis-master-765d459796-258hz menjadi nama Pod</span>
</span></span><span style=display:flex><span>kubectl get pod redis-master-765d459796-258hz --template<span style=color:#666>=</span><span style=color:#b44>&#39;{{(index (index .spec.containers 0).ports 0).containerPort}}{{&#34;\n&#34;}}&#39;</span>
</span></span></code></pre></div><p>Keluaran akan menampilkan porta dari Redis di Pod tersebut:</p><pre tabindex=0><code>6379
</code></pre><p>(ini adalah porta TCP yang dialokasi untuk Redis di internet)</p></li></ol><h2 id=meneruskan-sebuah-porta-lokal-ke-sebuah-porta-pada-pod>Meneruskan sebuah porta lokal ke sebuah porta pada Pod</h2><ol><li><p><code>kubectl port-forward</code> memungkinkan penggunaan nama sumber daya, seperti sebuah nama Pod, untuk memilih Pod yang sesuai untuk melakukan penerusan porta.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Ubah redis-master-765d459796-258hz menjadi nama Pod</span>
</span></span><span style=display:flex><span>kubectl port-forward redis-master-765d459796-258hz 7000:6379
</span></span></code></pre></div><p>yang sama seperti</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl port-forward pods/redis-master-765d459796-258hz 7000:6379
</span></span></code></pre></div><p>atau</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl port-forward deployment/redis-master 7000:6379
</span></span></code></pre></div><p>atau</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl port-forward replicaset/redis-master 7000:6379
</span></span></code></pre></div><p>atau</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl port-forward service/redis-master 7000:6379
</span></span></code></pre></div><p>Semua perintah di atas berfungsi. Keluarannya mirip dengan ini:</p><pre tabindex=0><code>I0710 14:43:38.274550    3655 portforward.go:225] Forwarding from 127.0.0.1:7000 -&gt; 6379
I0710 14:43:38.274797    3655 portforward.go:225] Forwarding from [::1]:7000 -&gt; 6379
</code></pre></li><li><p>Memulai antarmuka baris perintah (<em>command line</em>) Redis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>redis-cli -p <span style=color:#666>7000</span>
</span></span></code></pre></div></li><li><p>Pada baris perintah di Redis, masukkan perintah <code>ping</code>:</p><pre tabindex=0><code>ping
</code></pre><p>Sebuah permintaan <em>ping</em> yang sukses akan mengembalikan:</p><pre tabindex=0><code>PONG
</code></pre></li></ol><h2 id=diskusi>Diskusi</h2><p>Koneksi-koneksi yang dibuat ke porta lokal 7000 diteruskan ke porta 6379 dari Pod yang menjalankan server Redis.
Dengan koneksi ini, kamu dapat menggunakan <em>workstation</em> lokal untuk melakukan <em>debug</em> basis data yang berjalan di Pod.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> <code>kubectl port-forward</code> hanya bisa diimplementasikan untuk porta TCP saja.
Dukungan untuk protokol UDP bisa dilihat di
<a href=https://github.com/kubernetes/kubernetes/issues/47862>issue 47862</a>.</div><h2 id=selanjutnya>Selanjutnya</h2><p>Belajar lebih tentang <a href=/docs/reference/generated/kubectl/kubectl-commands/#port-forward>kubectl port-forward</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-21cd8f87563675fb0278d3694ba9ecb0>8.5 - Membuat Load Balancer Eksternal</h1><p>Laman ini menjelaskan bagaimana membuat <em>Load Balancer</em> Eksternal.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Fitur ini hanya tersedia untuk penyedia cloud atau lingkungan yang mendukung <em>load balancer</em> eksternal.</div><p>Ketika membuat Service, kamu mempunyai opsi untuk tersambung dengan jaringan cloud <em>load balancer</em> secara otomatis.
Hal ini menyediakan akses eksternal alamat IP yang dapat mengirim lalu lintas melalui porta yang tepat pada klaster Node kamu
<em>asalkan klaster kamu beroperasi pada lingkungan yang mendukung dan terkonfigurasi dengan paket penyedia cloud load balancer yang benar</em>.</p><p>Untuk informasi mengenai penyediaan dan penggunaan sumber daya Ingress yang dapat memberikan
servis URL yang dapat dijangkau secara eksternal, penyeimbang beban lalu lintas, terminasi SSL, dll.,
silahkan cek dokumentasi <a href=/id/docs/concepts/services-networking/ingress/>Ingress</a></p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><ul><li><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</li></ul><h2 id=berkas-konfigurasi>Berkas konfigurasi</h2><p>Untuk membuat <em>load balancer</em> eksternal, tambahkan baris di bawah ini ke
<a href=/id/docs/concepts/services-networking/service/#loadbalancer>berkas konfigurasi Service</a> kamu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>LoadBalancer<span style=color:#bbb>
</span></span></span></code></pre></div><p>Berkas konfigurasi kamu mungkin terlihat seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example-service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>8765</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>targetPort</span>:<span style=color:#bbb> </span><span style=color:#666>9376</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>LoadBalancer<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=menggunakan-kubectl>Menggunakan kubectl</h2><p>Kamu dapat membuat Service dengan perintah <code>kubectl expose</code> dan
<em>flag</em> <code>--type=LoadBalancer</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl expose rc example --port<span style=color:#666>=</span><span style=color:#666>8765</span> --target-port<span style=color:#666>=</span><span style=color:#666>9376</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>        --name<span style=color:#666>=</span>example-service --type<span style=color:#666>=</span>LoadBalancer
</span></span></code></pre></div><p>Perintah ini membuat Service baru dengan menggunakan pemilih yang sama dengan
sumber daya yang dirujuk (dalam hal contoh di atas, ReplicationController bernama <code>example</code>).</p><p>Untuk informasi lebih lanjut, termasuk opsi <em>flag</em>, mengacu kepada
<a href=/docs/reference/generated/kubectl/kubectl-commands/#expose>referensi <code>kubectl expose</code></a>.</p><h2 id=menemukan-alamat-ip-kamu>Menemukan alamat IP kamu</h2><p>Kamu dapat menemukan alamat IP yang telah dibuat untuk Service kamu dengan mendapatkan
informasi Service melalui <code>kubectl</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe services example-service
</span></span></code></pre></div><p>yang seharusnya menghasilkan keluaran seperti ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    Name:                   example-service
</span></span><span style=display:flex><span>    Namespace:              default
</span></span><span style=display:flex><span>    Labels:                 &lt;none&gt;
</span></span><span style=display:flex><span>    Annotations:            &lt;none&gt;
</span></span><span style=display:flex><span>    Selector:               <span style=color:#b8860b>app</span><span style=color:#666>=</span>example
</span></span><span style=display:flex><span>    Type:                   LoadBalancer
</span></span><span style=display:flex><span>    IP:                     10.67.252.103
</span></span><span style=display:flex><span>    LoadBalancer Ingress:   192.0.2.89
</span></span><span style=display:flex><span>    Port:                   &lt;unnamed&gt; 80/TCP
</span></span><span style=display:flex><span>    NodePort:               &lt;unnamed&gt; 32445/TCP
</span></span><span style=display:flex><span>    Endpoints:              10.64.0.4:80,10.64.1.5:80,10.64.2.4:80
</span></span><span style=display:flex><span>    Session Affinity:       None
</span></span><span style=display:flex><span>    Events:                 &lt;none&gt;
</span></span></code></pre></div><p>Alamat IP tercantum di sebelah <code>LoadBalancer Ingress</code>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Jika kamu menjalankan Service dari Minikube, kamu dapat menemukan alamat IP dan porta yang ditetapkan dengan:</div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>minikube service example-service --url
</span></span></code></pre></div><h2 id=preservasi-ip-sumber-klien>Preservasi IP sumber klien</h2><p>Implementasi dari fitur ini menyebabkan sumber IP yang terlihat pada Container
target <em>bukan sebagai sumber IP asli</em> dari klien. Untuk mengaktifkan
preservasi IP klien, bidang berikut dapat dikonfigurasikan di dalam
spek Service (mendukung lingkungan GCE/Google Kubernetes Engine):</p><ul><li><code>service.spec.externalTrafficPolicy</code> - menunjukkan jika Service menginginkan rute lalu lintas
eksternal ke titik akhir <em>node-local</em> atau <em>cluster-wide</em>. Terdapat dua opsi yang tersedia:
<code>Cluster</code> (bawaan) dan <code>Local</code>. <code>Cluster</code> mengaburkan sumber IP klien dan mungkin menyebabkan
hop kedua ke Node berbeda, namun harus mempunyai penyebaran beban (<em>load-spreading</em>) yang baik secara keseluruhan.
<code>Local</code> mempreservasi sumber IP client dan menghindari hop kedua <code>LoadBalancer</code> dan Service dengan tipe <code>NodePort</code>, namun
resiko berpotensi penyebaran lalu lintas yang tidak merata.</li><li><code>service.spec.healthCheckNodePort</code> - menentukan pemeriksaan kesehatan porta dari sebuah Node (angka porta numerik) untuk Service.
Jika <code>healthCheckNodePort</code> tidak ditentukan, pengendali Service mengalokasi
porta dari rentang <code>NodePort</code> dari klaster kamu. Kamu dapat mengonfigurasi
rentangan tersebut dari pengaturan opsi barisan perintah API server,
<code>--service-node-port-range</code>. Hal itu menggunakan nilai <code>healthCheckNodePort</code> pengguna spesifik
jika ditentukan oleh klien. Hal itu dapat berefek hanya ketika <code>type</code> diset ke <code>LoadBalancer</code> dan
<code>externalTrafficPolicy</code> diset ke <code>Local</code>.</li></ul><p>Pengaturan <code>externalTrafficPolicy</code> ke <code>Local</code> pada berkas konfigurasi Service mengaktifkan
fitur ini.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example-service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>example<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>8765</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>targetPort</span>:<span style=color:#bbb> </span><span style=color:#666>9376</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>externalTrafficPolicy</span>:<span style=color:#bbb> </span>Local<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>LoadBalancer<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=pengumpul-sampah-garbage-collector-load-balancer>Pengumpul Sampah (Garbage Collector) Load Balancer</h2><div style=margin-top:10px;margin-bottom:10px><b>FEATURE STATE:</b> <code>Kubernetes v1.17 [stable]</code></div><p>Pada kasus biasa, sumber daya <em>load balancer</em> yang berkorelasi pada penyedia cloud perlu
dibersihkan segera setelah Service bertipe <em>LoadBalancer</em> dihapus. Namun perlu diketahui
bahwa terdapat kasus tepi dimana sumber daya cloud yatim piatu (<em>orphaned</em>) setelah
Service yang berkaitan dihapus. <em>Finalizer Protection</em> untuk Service <em>LoadBalancer</em>
diperkenalkan untuk mencegah hal ini terjadi. Dengan menggunakan <em>finalizers</em>, sebuah sumber daya Service
tidak akan pernah dihapus hingga sumber daya <em>load balancer</em> yang berkorelasi juga dihapus.</p><p>Secara khusus, jika Service mempunyai <code>type LoadBalancer</code>, pengendali Service akan melekatkan
<em>finalizer</em> bernama <code>service.kubernetes.io/load-balancer-cleanup</code>.
<em>Finalizer</em> hanya akan dihapus setelah sumber daya <em>load balancer</em> dibersihkan.
Hal ini mencegah sumber daya <em>load balancer</em> yang teruntai bahkan setelah kasus tepi seperti
pengendali Service berhenti.</p><h2 id=penyedia-load-balancer-eksternal>Penyedia Load Balancer Eksternal</h2><p>Penting untuk dicatat bahwa jalur data untuk fungsionalitas ini disediakan oleh <em>load balancer</em> eksternal ke klaster Kubernetes.</p><p>Ketika Service <code>type</code> diset <code>LoadBalancer</code>, Kubernetes menyediakan fungsionalitas yang ekuivalen dengan <code>type</code> sebanding <code>ClusterIP</code>
ke berbagai Pod di dalam klaster dan mengekstensinya dengan pemrograman (eksternal dari Kubernetes) <em>load balancer</em> dengan entri pada Pod
Kubernetes. Pengendali Service Kubernetes mengotomasi pembuatan <em>load balancer</em> eksternal, cek kesehatan (jika dibutuhkan),
dinding api (<em>firewall</em>) (jika dibutuhkan), dan mengambil IP eksternal yang dialokasikan oleh penyedia cloud dan mengisinya pada objek Service.</p><h2 id=peringatan-dan-and-limitasi-ketika-preservasi-sumber-ip>Peringatan dan and Limitasi ketika preservasi sumber IP</h2><p><em>Load balancers</em> GCE/AWS tidak menyediakan bobot pada kolam targetnya (target pools). Hal ini bukan merupakan isu dengan aturan kube-proxy
<em>Load balancer</em> lama yang akan menyeimbangkan semua titik akhir dengan benar.</p><p>Dengan fungsionalitas yang baru, lalu lintas eksternal tidak menyeimbangkan beban secara merata pada seluruh Pod, namun
sebaliknya menyeimbangkan secara merata pada level Node (karena GCE/AWS dan implementasi <em>load balancer</em> eksternal lainnya tidak mempunyai
kemampuan untuk menentukan bobot setiap Node, mereka menyeimbangkan secara merata pada semua Node target, mengabaikan jumlah
Pod pada tiap Node).</p><p>Namun demikian, kita dapat menyatakan bahwa NumServicePods &lt;&lt; NumNodes atau NumServicePods >> NumNodes, distribusi yang cukup mendekati
sama akan terlihat, meski tanpa bobot.</p><p>Sekali <em>load balancer</em> eksternal menyediakan bobot, fungsionalitas ini dapat ditambahkan pada jalur pemrograman <em>load balancer</em>.
<em>Pekerjaan Masa Depan: Tidak adanya dukungan untuk bobot yang disediakan untuk rilis 1.4, namun dapat ditambahkan di masa mendatang</em></p><p>Pod internal ke lalu lintas Pod harus berperilaku sama seperti Service ClusterIP, dengan probabilitas yang sama pada seluruh Pod.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-48e8f306f919c5b81265e265a2b76ab4>8.6 - Membuat Daftar Semua Image Container yang Berjalan dalam Klaster</h1><p>Laman ini menunjukkan cara menggunakan kubectl untuk membuat daftar semua <em>image</em> Container
untuk Pod yang berjalan dalam sebuah klaster.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><p>Dalam latihan ini kamu akan menggunakan kubectl untuk mengambil semua Pod yang
berjalan dalam sebuah klaster, dan mengubah format keluarannya untuk melihat daftar
Container untuk masing-masing Pod.</p><h2 id=membuat-daftar-semua-image-container-pada-semua-namespace>Membuat daftar semua <em>image</em> Container pada semua Namespace</h2><ul><li>Silakan ambil semua Pod dalam Namespace dengan menggunakan perintah <code>kubectl get pods --all-namespaces</code></li><li>Silakan format keluarannya agar hanya menyertakan daftar nama <em>image</em> dari Container
dengan menggunakan perintah <code>-o jsonpath={.items[*].spec.containers[*].image}</code>. Perintah ini akan mem-<em>parsing field</em>
<code>image</code> dari keluaran json yang dihasilkan.<ul><li>Silakan lihat <a href=/docs/user-guide/jsonpath/>referensi jsonpath</a>
untuk informasi lebih lanjut tentang cara menggunakan <code>jsonpath</code>.</li></ul></li><li>Silakan format keluaran dengan menggunakan peralatan standar: <code>tr</code>, <code>sort</code>, <code>uniq</code><ul><li>Gunakan <code>tr</code> untuk mengganti spasi dengan garis baru</li><li>Gunakan <code>sort</code> untuk menyortir hasil</li><li>Gunakan <code>uniq</code> untuk mengumpulkan jumlah <em>image</em></li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods --all-namespaces -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#34;{.items[*].spec.containers[*].image}&#34;</span> |<span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>tr -s <span style=color:#b44>&#39;[[:space:]]&#39;</span> <span style=color:#b44>&#39;\n&#39;</span> |<span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>sort |<span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>uniq -c
</span></span></code></pre></div><p>Perintah di atas secara berulang akan mengembalikan semua <em>field</em> bernama <code>image</code>
dari semua poin yang dikembalikan.</p><p>Sebagai pilihan, dimungkinkan juga untuk menggunakan jalur (<em>path</em>) absolut ke <em>field image</em>
di dalam Pod. Hal ini memastikan <em>field</em> yang diambil benar
bahkan ketika nama <em>field</em> tersebut diulangi,
misalnya banyak <em>field</em> disebut dengan <code>name</code> dalam sebuah poin yang diberikan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods --all-namespaces -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#34;{.items[*].spec.containers[*].image}&#34;</span>
</span></span></code></pre></div><p><code>Jsonpath</code> dapat diartikan sebagai berikut:</p><ul><li><code>.items[*]</code>: untuk setiap nilai yang dihasilkan</li><li><code>.spec</code>: untuk mendapatkan spesifikasi</li><li><code>.containers[*]</code>: untuk setiap Container</li><li><code>.image</code>: untuk mendapatkan <em>image</em></li></ul><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Pada saat mengambil sebuah Pod berdasarkan namanya, misalnya <code>kubectl get pod nginx</code>,
bagian <code>.items[*]</code> dari jalur harus dihilangkan karena hanya akan menghasilkan sebuah Pod
sebagai keluarannya, bukan daftar dari semua Pod.</div><h2 id=membuat-daftar-image-container-berdasarkan-pod>Membuat daftar <em>image</em> Container berdasarkan Pod</h2><p>Format dapat dikontrol lebih lanjut dengan menggunakan operasi <code>range</code> untuk
melakukan iterasi untuk setiap elemen secara individual.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods --all-namespaces -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#39;{range .items[*]}{&#34;\n&#34;}{.metadata.name}{&#34;:\t&#34;}{range .spec.containers[*]}{.image}{&#34;, &#34;}{end}{end}&#39;</span> |<span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>sort
</span></span></code></pre></div><h2 id=membuat-daftar-image-yang-difilter-berdasarkan-label-dari-pod>Membuat daftar <em>image</em> yang difilter berdasarkan label dari Pod</h2><p>Untuk menargetkan hanya Pod yang cocok dengan label tertentu saja, gunakan tanda -l. Filter
dibawah ini akan menghasilkan Pod dengan label yang cocok dengan <code>app=nginx</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods --all-namespaces -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#34;{.items[*].spec.containers[*].image}&#34;</span> -l <span style=color:#b8860b>app</span><span style=color:#666>=</span>nginx
</span></span></code></pre></div><h2 id=membuat-daftar-image-container-yang-difilter-berdasarkan-namespace-pod>Membuat daftar <em>image</em> Container yang difilter berdasarkan Namespace Pod</h2><p>Untuk hanya menargetkan Pod pada Namespace tertentu, gunakankan tanda Namespace. Filter
dibawah ini hanya menyaring Pod pada Namespace <code>kube-system</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods --namespace kube-system -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#34;{.items[*].spec.containers[*].image}&#34;</span>
</span></span></code></pre></div><h2 id=membuat-daftar-image-container-dengan-menggunakan-go-template-sebagai-alternatif-dari-jsonpath>Membuat daftar <em>image</em> Container dengan menggunakan go-template sebagai alternatif dari jsonpath</h2><p>Sebagai alternatif untuk <code>jsonpath</code>, kubectl mendukung penggunaan <a href=https://golang.org/pkg/text/template/>go-template</a>
untuk memformat keluaran seperti berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods --all-namespaces -o go-template --template<span style=color:#666>=</span><span style=color:#b44>&#34;{{range .items}}{{range .spec.containers}}{{.image}} {{end}}{{end}}&#34;</span>
</span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><h3 id=referensi>Referensi</h3><ul><li>Referensi panduan <a href=/docs/user-guide/jsonpath/>Jsonpath</a>.</li><li>Referensi panduan <a href=https://golang.org/pkg/text/template/>Go template</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f6a755efe831d24956501e4bcd49ff96>9 - Pemantauan, Pencatatan, and Debugging</h1><div class=lead>Mengatur pemantauan dan pencatatan untuk memecahkan masalah klaster, atau men-<em>debug</em> aplikasi yang terkontainerisasi.</div></div><div class=td-content><h1 id=pg-731bb8b338c16aebfb9590ba2bd3fdd1>9.1 - Introspeksi dan _Debugging_ Aplikasi</h1><p>Setelah aplikasi kamu berjalan, kamu pasti perlu untuk men-<em>debug</em> masalah yang ada di dalamnya.
Sebelumnya telah dijelaskan bagaimana kamu dapat menggunakan <code>kubectl get pods</code> untuk mengambil informasi status sederhana tentang
Pod kamu. Namun ada sejumlah cara untuk mendapatkan lebih banyak informasi tentang aplikasi kamu.</p><h2 id=menggunakan-kubectl-describe-pod-untuk-mengambil-detil-informasi-pod>Menggunakan <code>kubectl describe pod</code> untuk mengambil detil informasi Pod</h2><p>Dalam contoh ini, kamu menggunakan Deployment untuk membuat dua buah Pod, yang hampir sama dengan contoh sebelumnya.</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/nginx-with-request.yaml download=application/nginx-with-request.yaml><code>application/nginx-with-request.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-nginx-with-request-yaml")' title="Copy application/nginx-with-request.yaml to clipboard"></img></div><div class=includecode id=application-nginx-with-request-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;128Mi&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;500m&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buat Deployment dengan menjalankan perintah ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/nginx-with-request.yaml
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>deployment.apps/nginx-deployment created
</code></pre><p>Cek status dari Pod dengan menggunakan perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>NAME                                READY     STATUS    RESTARTS   AGE
nginx-deployment-1006230814-6winp   1/1       Running   0          11s
nginx-deployment-1006230814-fmgu3   1/1       Running   0          11s
</code></pre><p>Kamu dapat memperoleh lebih banyak informasi tentang masing-masing Pod ini dengan menggunakan perintah <code>kubectl describe pod</code>. Sebagai contoh:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe pod nginx-deployment-1006230814-6winp
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>Name:		nginx-deployment-1006230814-6winp
Namespace:	default
Node:		kubernetes-node-wul5/10.240.0.9
Start Time:	Thu, 24 Mar 2016 01:39:49 +0000
Labels:		app=nginx,pod-template-hash=1006230814
Annotations:    kubernetes.io/created-by={&#34;kind&#34;:&#34;SerializedReference&#34;,&#34;apiVersion&#34;:&#34;v1&#34;,&#34;reference&#34;:{&#34;kind&#34;:&#34;ReplicaSet&#34;,&#34;namespace&#34;:&#34;default&#34;,&#34;name&#34;:&#34;nginx-deployment-1956810328&#34;,&#34;uid&#34;:&#34;14e607e7-8ba1-11e7-b5cb-fa16&#34; ...
Status:		Running
IP:		10.244.0.6
Controllers:	ReplicaSet/nginx-deployment-1006230814
Containers:
  nginx:
    Container ID:	docker://90315cc9f513c724e9957a4788d3e625a078de84750f244a40f97ae355eb1149
    Image:		nginx
    Image ID:		docker://6f62f48c4e55d700cf3eb1b5e33fa051802986b77b874cc351cce539e5163707
    Port:		80/TCP
    QoS Tier:
      cpu:	Guaranteed
      memory:	Guaranteed
    Limits:
      cpu:	500m
      memory:	128Mi
    Requests:
      memory:		128Mi
      cpu:		500m
    State:		Running
      Started:		Thu, 24 Mar 2016 01:39:51 +0000
    Ready:		True
    Restart Count:	0
    Environment:        &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-5kdvl (ro)
Conditions:
  Type          Status
  Initialized   True
  Ready         True
  PodScheduled  True
Volumes:
  default-token-4bcbi:
    Type:	Secret (a volume populated by a Secret)
    SecretName:	default-token-4bcbi
    Optional:   false
QoS Class:      Guaranteed
Node-Selectors: &lt;none&gt;
Tolerations:    &lt;none&gt;
Events:
  FirstSeen	LastSeen	Count	From					SubobjectPath		Type		Reason		Message
  ---------	--------	-----	----					-------------		--------	------		-------
  54s		54s		1	{default-scheduler }						Normal		Scheduled	Successfully assigned nginx-deployment-1006230814-6winp to kubernetes-node-wul5
  54s		54s		1	{kubelet kubernetes-node-wul5}	spec.containers{nginx}	Normal		Pulling		pulling image &#34;nginx&#34;
  53s		53s		1	{kubelet kubernetes-node-wul5}	spec.containers{nginx}	Normal		Pulled		Successfully pulled image &#34;nginx&#34;
  53s		53s		1	{kubelet kubernetes-node-wul5}	spec.containers{nginx}	Normal		Created		Created container with docker id 90315cc9f513
  53s		53s		1	{kubelet kubernetes-node-wul5}	spec.containers{nginx}	Normal		Started		Started container with docker id 90315cc9f513
</code></pre><p>Di sini kamu dapat melihat informasi konfigurasi tentang Container dan Pod (label, kebutuhan resource, dll.), serta informasi status tentang Container dan Pod (status, kesiapan, berapa kali <em>restart</em>, <em>event</em>, dll.) .</p><p>Keadaan (<em>state</em>) Container merupakan salah satu dari keadaan <em>Waiting, Running,</em> atau <em>Terminated</em>. Tergantung dari keadaannya, informasi tambahan akan diberikan - di sini kamu dapat melihat bahwa untuk Container dalam keadaan <em>running</em>, sistem memberi tahu kamu kapan Container tersebut mulai dijalankan.</p><p><em>Ready</em> memberi tahu kepada kamu apakah Container berhasil melewati pemeriksaan kesiapan terakhir. (Dalam kasus ini, Container tidak memiliki pemeriksaan kesiapan yang dikonfigurasi; Container dianggap selalu siap jika tidak ada pemeriksaan kesiapan yang dikonfigurasi.)</p><p>Jumlah <em>restart</em> memberi tahu kamu berapa kali Container telah dimulai ulang; informasi ini dapat berguna untuk mendeteksi kemacetan tertutup (<em>crash loop</em>) dalam Container yang dikonfigurasi dengan nilai <em>restart policy</em> 'always.'.</p><p>Saat ini, satu-satunya kondisi yang terkait dengan Pod adalah kondisi <em>Binary Ready</em>, yang menunjukkan bahwa Pod tersebut dapat melayani permintaan dan harus ditambahkan ke kumpulan penyeimbang beban (<em>load balancing</em>) dari semua Service yang sesuai.</p><p>Terakhir, kamu melihat catatan (<em>log</em>) peristiwa terbaru yang terkait dengan Pod kamu. Sistem mengompresi beberapa peristiwa yang identik dengan menunjukkan kapan pertama dan terakhir kali peristiwa itu dilihat dan berapa kali peristiwa itu dilihat. "From" menunjukkan komponen yang mencatat peristiwa, "SubobjectPath" memberi tahu kamu objek mana (mis. Container dalam pod) yang dimaksud, dan "Reason" dan "Message" memberi tahu kamu apa yang sudah terjadi.</p><h2 id=contoh-men-debug-pod-yang-pending>Contoh: Men-<em>debug</em> Pod yang <em>Pending</em></h2><p>Skenario umum yang bisa kamu deteksi menggunakan peristiwa (<em>event</em>) adalah saat kamu telah membuat Pod yang tidak muat di Node mana pun. Misalnya, karena Pod mungkin meminta lebih banyak sumber daya yang tersedia dalam Node mana pun, atau mungkin Pod menentukan <em>label selector</em> yang tidak sesuai dengan Node mana pun. Katakanlah kamu sebelumnya membuat Deployment dengan 5 replika (bukan 2) dan meminta 600 millicore, bukan 500, pada klaster dengan empat Node di mana setiap mesin (virtual) memiliki 1 CPU. Sehingga salah satu Pod tidak akan bisa dijadwalkan. (Perhatikan bahwa Pod <em>addon</em> seperti fluentd, skydns, dll., yang berjalan di setiap Node pada klaster, tidak bisa dijadwalkan jika kamu meminta sebanyak 1000 millicore.)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>NAME                                READY     STATUS    RESTARTS   AGE
nginx-deployment-1006230814-6winp   1/1       Running   0          7m
nginx-deployment-1006230814-fmgu3   1/1       Running   0          7m
nginx-deployment-1370807587-6ekbw   1/1       Running   0          1m
nginx-deployment-1370807587-fg172   0/1       Pending   0          1m
nginx-deployment-1370807587-fz9sd   0/1       Pending   0          1m
</code></pre><p>Untuk mencari sebab kenapa Pod nginx-deployment-1370807587-fz9sd tidak berjalan, kamu dapat menggunakan <code>kubectl describe pod</code> pada Pod yang <em>pending</em> dan melihat setiap peristiwa yang terjadi di dalamnya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe pod nginx-deployment-1370807587-fz9sd
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>  Name:		nginx-deployment-1370807587-fz9sd
  Namespace:	default
  Node:		/
  Labels:		app=nginx,pod-template-hash=1370807587
  Status:		Pending
  IP:
  Controllers:	ReplicaSet/nginx-deployment-1370807587
  Containers:
    nginx:
      Image:	nginx
      Port:	80/TCP
      QoS Tier:
        memory:	Guaranteed
        cpu:	Guaranteed
      Limits:
        cpu:	1
        memory:	128Mi
      Requests:
        cpu:	1
        memory:	128Mi
      Environment Variables:
  Volumes:
    default-token-4bcbi:
      Type:	Secret (a volume populated by a Secret)
      SecretName:	default-token-4bcbi
  Events:
    FirstSeen	LastSeen	Count	From			        SubobjectPath	Type		Reason			    Message
    ---------	--------	-----	----			        -------------	--------	------			    -------
    1m		    48s		    7	    {default-scheduler }			        Warning		FailedScheduling	pod (nginx-deployment-1370807587-fz9sd) failed to fit in any node
  fit failure on node (kubernetes-node-6ta5): Node didn&#39;t have enough resource: CPU, requested: 1000, used: 1420, capacity: 2000
  fit failure on node (kubernetes-node-wul5): Node didn&#39;t have enough resource: CPU, requested: 1000, used: 1100, capacity: 2000
</code></pre><p>Di sini kamu dapat melihat peristiwa yang dibuat oleh penjadwal yang mengatakan bahwa Pod gagal dijadwalkan karena alasan <code>FailedScheduling</code> (dan mungkin karena sebab yang lainnya). Pesan tersebut memberi tahu kamu bahwa tidak ada cukup sumber daya untuk Pod pada salah satu Node.</p><p>Untuk memperbaiki situasi ini, kamu dapat menggunakan <code>kubectl scale</code> untuk memperbarui Deployment kamu untuk menentukan empat replika atau yang lebih kecil. (Atau kamu bisa membiarkan satu Pod tertunda, dimana hal ini tidak berbahaya.)</p><p>Peristiwa seperti yang kamu lihat di bagian akhir keluaran dari perintah <code>kubectl description pod</code> akan tetap ada dalam etcd dan memberikan informasi tingkat tinggi tentang apa yang terjadi pada klaster. Untuk melihat daftar semua peristiwa kamu dapat menggunakan perintah</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get events
</span></span></code></pre></div><p>tetapi kamu harus ingat bahwa peristiwa bersifat Namespace. Artinya, jika kamu tertarik dengan peristiwa untuk beberapa objek dalam Namespace (misalnya, apa yang terjadi dengan Pod pada Namespace <code>my-namespace</code>), kamu perlu secara eksplisit menyebutkan Namespace tersebut pada perintah:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get events --namespace<span style=color:#666>=</span>my-namespace
</span></span></code></pre></div><p>Untuk melihat peristiwa dari semua Namespace, kamu dapat menggunakan argumen <code>--all-namespaces</code>.</p><p>Sebagai tambahan dari perintah <code>kubectl describe pod</code>, cara lain untuk mendapatkan informasi tambahan tentang sebuah Pod (selain yang disediakan oleh <code>kubectl get pod</code>) adalah dengan meneruskan <em>flag</em> format keluaran <code>-o yaml</code> ke perintah <code>kubectl get pod</code>. Ini akan memberikan kamu lebih banyak informasi dalam format YAML daripada <code>kubectl describe pod</code>--semua informasi dasar yang dimiliki sistem tentang Pod. Di sini kamu akan melihat hal-hal seperti anotasi (yang merupakan metadata nilai kunci tanpa batasan label, yang digunakan secara internal oleh komponen sistem Kubernetes), kebijakan mulai ulang, porta, dan volume.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod nginx-deployment-1006230814-6winp -o yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubernetes.io/created-by</span>:<span style=color:#bbb> </span>|<span style=color:#b44;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#b44;font-style:italic>      </span><span style=color:#bbb>      </span>{<span style=color:#b44>&#34;kind&#34;</span>:<span style=color:#b44>&#34;SerializedReference&#34;</span>,<span style=color:#b44>&#34;apiVersion&#34;</span>:<span style=color:#b44>&#34;v1&#34;</span>,<span style=color:#b44>&#34;reference&#34;</span>:{<span style=color:#b44>&#34;kind&#34;</span>:<span style=color:#b44>&#34;ReplicaSet&#34;</span>,<span style=color:#b44>&#34;namespace&#34;</span>:<span style=color:#b44>&#34;default&#34;</span>,<span style=color:#b44>&#34;name&#34;</span>:<span style=color:#b44>&#34;nginx-deployment-1006230814&#34;</span>,<span style=color:#b44>&#34;uid&#34;</span>:<span style=color:#b44>&#34;4c84c175-f161-11e5-9a78-42010af00005&#34;</span>,<span style=color:#b44>&#34;apiVersion&#34;</span>:<span style=color:#b44>&#34;extensions&#34;</span>,<span style=color:#b44>&#34;resourceVersion&#34;</span>:<span style=color:#b44>&#34;133434&#34;</span>}}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2016-03-24T01:39:50Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>generateName</span>:<span style=color:#bbb> </span>nginx-deployment-1006230814-<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>pod-template-hash</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1006230814&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx-deployment-1006230814-6winp<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceVersion</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;133447&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>uid</span>:<span style=color:#bbb> </span>4c879808-f161-11e5-9a78-42010af00005<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>Always<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#666>80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>protocol</span>:<span style=color:#bbb> </span>TCP<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span>500m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>128Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span>500m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>128Mi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>terminationMessagePath</span>:<span style=color:#bbb> </span>/dev/termination-log<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/var/run/secrets/kubernetes.io/serviceaccount<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>default-token-4bcbi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>readOnly</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>dnsPolicy</span>:<span style=color:#bbb> </span>ClusterFirst<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>nodeName</span>:<span style=color:#bbb> </span>kubernetes-node-wul5<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Always<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>serviceAccount</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>serviceAccountName</span>:<span style=color:#bbb> </span>default<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>terminationGracePeriodSeconds</span>:<span style=color:#bbb> </span><span style=color:#666>30</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>default-token-4bcbi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>secret</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>secretName</span>:<span style=color:#bbb> </span>default-token-4bcbi<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>conditions</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>lastProbeTime</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>lastTransitionTime</span>:<span style=color:#bbb> </span>2016-03-24T01:39:51Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;True&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Ready<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containerStatuses</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>containerID</span>:<span style=color:#bbb> </span>docker://90315cc9f513c724e9957a4788d3e625a078de84750f244a40f97ae355eb1149<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>imageID</span>:<span style=color:#bbb> </span>docker://6f62f48c4e55d700cf3eb1b5e33fa051802986b77b874cc351cce539e5163707<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>lastState</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ready</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>restartCount</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>state</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>running</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>startedAt</span>:<span style=color:#bbb> </span>2016-03-24T01:39:51Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostIP</span>:<span style=color:#bbb> </span><span style=color:#666>10.240.0.9</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>phase</span>:<span style=color:#bbb> </span>Running<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>podIP</span>:<span style=color:#bbb> </span><span style=color:#666>10.244.0.6</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>startTime</span>:<span style=color:#bbb> </span>2016-03-24T01:39:49Z<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=contoh-men-debug-node-yang-mati-tidak-terjangkau-down-unreachable>Contoh: Men-<em>debug</em> Node yang mati/tidak terjangkau (<em>down/unreachable</em>)</h2><p>Terkadang saat men-<em>debug</em> melihat status sebuah Node akan sangat berguna - misalnya, karena kamu telah melihat perilaku aneh dari sebuah Pod yang sedang berjalan pada Node tersebut, atau untuk mencari tahu mengapa sebuah Pod tidak dapat dijadwalkan ke dalam Node tersebut. Seperti pada Pod, kamu dapat menggunakan perintah <code>kubectl description node</code> dan <code>kubectl get node -o yaml</code> untuk mengambil informasi mendetil tentang Node. Misalnya, disini kamu akan melihat jika sebuah Node sedang mati (terputus dari jaringan, atau kubelet mati dan tidak mau restart, dll.). Perhatikan peristiwa yang menunjukkan Node tersebut NotReady, dan juga perhatikan bahwa Pod tidak lagi berjalan (mereka akan dikeluarkan setelah lima menit berstatus NotReady).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>NAME                     STATUS       ROLES     AGE     VERSION
kubernetes-node-861h     NotReady     &lt;none&gt;    1h      v1.13.0
kubernetes-node-bols     Ready        &lt;none&gt;    1h      v1.13.0
kubernetes-node-st6x     Ready        &lt;none&gt;    1h      v1.13.0
kubernetes-node-unaj     Ready        &lt;none&gt;    1h      v1.13.0
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe node kubernetes-node-861h
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>Name:			kubernetes-node-861h
Role
Labels:		 kubernetes.io/arch=amd64
           kubernetes.io/os=linux
           kubernetes.io/hostname=kubernetes-node-861h
Annotations:        node.alpha.kubernetes.io/ttl=0
                    volumes.kubernetes.io/controller-managed-attach-detach=true
Taints:             &lt;none&gt;
CreationTimestamp:	Mon, 04 Sep 2017 17:13:23 +0800
Phase:
Conditions:
  Type		Status		LastHeartbeatTime			LastTransitionTime			Reason					Message
  ----    ------    -----------------     ------------------      ------          -------
  OutOfDisk             Unknown         Fri, 08 Sep 2017 16:04:28 +0800         Fri, 08 Sep 2017 16:20:58 +0800         NodeStatusUnknown       Kubelet stopped posting node status.
  MemoryPressure        Unknown         Fri, 08 Sep 2017 16:04:28 +0800         Fri, 08 Sep 2017 16:20:58 +0800         NodeStatusUnknown       Kubelet stopped posting node status.
  DiskPressure          Unknown         Fri, 08 Sep 2017 16:04:28 +0800         Fri, 08 Sep 2017 16:20:58 +0800         NodeStatusUnknown       Kubelet stopped posting node status.
  Ready                 Unknown         Fri, 08 Sep 2017 16:04:28 +0800         Fri, 08 Sep 2017 16:20:58 +0800         NodeStatusUnknown       Kubelet stopped posting node status.
Addresses:	10.240.115.55,104.197.0.26
Capacity:
 cpu:           2
 hugePages:     0
 memory:        4046788Ki
 pods:          110
Allocatable:
 cpu:           1500m
 hugePages:     0
 memory:        1479263Ki
 pods:          110
System Info:
 Machine ID:                    8e025a21a4254e11b028584d9d8b12c4
 System UUID:                   349075D1-D169-4F25-9F2A-E886850C47E3
 Boot ID:                       5cd18b37-c5bd-4658-94e0-e436d3f110e0
 Kernel Version:                4.4.0-31-generic
 OS Image:                      Debian GNU/Linux 8 (jessie)
 Operating System:              linux
 Architecture:                  amd64
 Container Runtime Version:     docker://1.12.5
 Kubelet Version:               v1.6.9+a3d1dfa6f4335
 Kube-Proxy Version:            v1.6.9+a3d1dfa6f4335
ExternalID:                     15233045891481496305
Non-terminated Pods:            (9 in total)
  Namespace                     Name                                            CPU Requests    CPU Limits      Memory Requests Memory Limits
  ---------                     ----                                            ------------    ----------      --------------- -------------
......
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  CPU Requests  CPU Limits      Memory Requests         Memory Limits
  ------------  ----------      ---------------         -------------
  900m (60%)    2200m (146%)    1009286400 (66%)        5681286400 (375%)
Events:         &lt;none&gt;
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get node kubernetes-node-861h -o yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Node<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>creationTimestamp</span>:<span style=color:#bbb> </span>2015-07-10T21:32:29Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubernetes.io/hostname</span>:<span style=color:#bbb> </span>kubernetes-node-861h<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>kubernetes-node-861h<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceVersion</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;757&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>uid</span>:<span style=color:#bbb> </span>2a69374e-274b-11e5-a234-42010af0d969<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>externalID</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;15233045891481496305&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>podCIDR</span>:<span style=color:#bbb> </span><span style=color:#666>10.244.0.0</span>/24<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>providerID</span>:<span style=color:#bbb> </span>gce://striped-torus-760/us-central1-b/kubernetes-node-861h<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>addresses</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>address</span>:<span style=color:#bbb> </span><span style=color:#666>10.240.115.55</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>InternalIP<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>address</span>:<span style=color:#bbb> </span><span style=color:#666>104.197.0.26</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>ExternalIP<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>capacity</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>3800808Ki<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>pods</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;100&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>conditions</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>lastHeartbeatTime</span>:<span style=color:#bbb> </span>2015-07-10T21:34:32Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>lastTransitionTime</span>:<span style=color:#bbb> </span>2015-07-10T21:35:15Z<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>reason</span>:<span style=color:#bbb> </span>Kubelet stopped posting node status.<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>status</span>:<span style=color:#bbb> </span>Unknown<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Ready<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>nodeInfo</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>bootID</span>:<span style=color:#bbb> </span><span style=color:#666>4e316776</span>-b40d-4f78-a4ea-ab0d73390897<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containerRuntimeVersion</span>:<span style=color:#bbb> </span>docker://Unknown<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kernelVersion</span>:<span style=color:#bbb> </span><span style=color:#666>3.16.0-0.</span>bpo.4-amd64<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubeProxyVersion</span>:<span style=color:#bbb> </span>v0.21.1-185-gffc5a86098dc01<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kubeletVersion</span>:<span style=color:#bbb> </span>v0.21.1-185-gffc5a86098dc01<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>machineID</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>osImage</span>:<span style=color:#bbb> </span>Debian GNU/Linux 7 (wheezy)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>systemUUID</span>:<span style=color:#bbb> </span>ABE5F6B4-D44B-108B-C46A-24CCE16C8B6E<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><p>Pelajari tentang alat <em>debugging</em> tambahan, termasuk:</p><ul><li><a href=/id/docs/concepts/cluster-administration/logging/>Pencatatan (<em>logging</em>)</a></li><li><a href=/docs/tasks/debug-application-cluster/resource-usage-monitoring/>Monitoring</a></li><li><a href=/docs/tasks/debug-application-cluster/get-shell-running-container/>Masuk ke Container melalui <code>exec</code></a></li><li><a href=/docs/tasks/extend-kubernetes/http-proxy-access-api/>Masuk ke Container melalui <em>proxy</em></a></li><li><a href=/docs/tasks/access-application-cluster/port-forward-access-application-cluster/>Masuk ke Container melalui <em>port forwarding</em></a></li><li><a href=/docs/tasks/debug-application-cluster/crictl/>Inspeksi Node Kubernetes dengan menggunakan crictl</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-9713ac27b6d9e3034033200d968221f2>9.2 - Mendapatkan Shell Untuk Masuk ke Container yang Sedang Berjalan</h1><p>Laman ini menunjukkan bagaimana cara menggunakan <code>kubectl exec</code> untuk
mendapatkan <em>shell</em> untuk masuk ke dalam Container yang sedang berjalan.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mendapatkan-sebuah-shell-untuk-masuk-ke-sebuah-container>Mendapatkan sebuah <em>shell</em> untuk masuk ke sebuah Container</h2><p>Dalam latihan ini, kamu perlu membuat Pod yang hanya memiliki satu Container saja. Container
tersebut menjalankan <em>image</em> nginx. Berikut ini adalah berkas konfigurasi untuk Pod tersebut:</p><div class=highlight><div class=copy-code-icon style=text-align:right><a href=https://raw.githubusercontent.com/kubernetes/website/main/content/id/examples/application/shell-demo.yaml download=application/shell-demo.yaml><code>application/shell-demo.yaml</code></a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick='copyCode("application-shell-demo-yaml")' title="Copy application/shell-demo.yaml to clipboard"></img></div><div class=includecode id=application-shell-demo-yaml><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>shell-demo<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>shared-data<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>emptyDir</span>:<span style=color:#bbb> </span>{}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>shared-data<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/usr/share/nginx/html<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostNetwork</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>dnsPolicy</span>:<span style=color:#bbb> </span>Default<span style=color:#bbb>
</span></span></span></code></pre></div></div></div><p>Buatlah Pod tersebut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://k8s.io/examples/application/shell-demo.yaml
</span></span></code></pre></div><p>Pastikan bahwa Container dalam Pod berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod shell-demo
</span></span></code></pre></div><p>Dapatkan <em>shell</em> untuk masuk ke dalam Container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it shell-demo -- /bin/bash
</span></span></code></pre></div><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Simbol tanda hubung ganda "--" digunakan untuk memisahkan antara argumen perintah yang ingin kamu eksekusi pada Container dan argumen dari kubectl itu sendiri.</div><p>Di dalam <em>shell</em> kamu, perlihatkan isi dari direktori <em>root</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@shell-demo:/# ls /
</span></span></code></pre></div><p>Di dalam <em>shell</em> kamu, cobalah perintah-perintah yang lainnya. Berikut beberapa contohnya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@shell-demo:/# ls /
</span></span><span style=display:flex><span>root@shell-demo:/# cat /proc/mounts
</span></span><span style=display:flex><span>root@shell-demo:/# cat /proc/1/maps
</span></span><span style=display:flex><span>root@shell-demo:/# apt-get update
</span></span><span style=display:flex><span>root@shell-demo:/# apt-get install -y tcpdump
</span></span><span style=display:flex><span>root@shell-demo:/# tcpdump
</span></span><span style=display:flex><span>root@shell-demo:/# apt-get install -y lsof
</span></span><span style=display:flex><span>root@shell-demo:/# lsof
</span></span><span style=display:flex><span>root@shell-demo:/# apt-get install -y procps
</span></span><span style=display:flex><span>root@shell-demo:/# ps aux
</span></span><span style=display:flex><span>root@shell-demo:/# ps aux | grep nginx
</span></span></code></pre></div><h2 id=menulis-halaman-utama-root-untuk-nginx>Menulis halaman utama (<em>root</em>) untuk nginx</h2><p>Lihat kembali berkas konfigurasi untuk Pod kamu. Pod
memiliki volume <code>emptyDir</code>, dan Container melakukan pemasangan (<em>mounting</em>) untuk volume tersebut
pada <code>/usr/share/nginx/html</code>.</p><p>Pada <em>shell</em> kamu, buatlah berkas <code>index.html</code> dalam direktori <code>/usr/share/nginx/html</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@shell-demo:/# <span style=color:#a2f>echo</span> Hello shell demo &gt; /usr/share/nginx/html/index.html
</span></span></code></pre></div><p>Pada <em>shell</em> kamu, kirimkan sebuah permintaan (<em>request</em>) GET ke server nginx.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@shell-demo:/# apt-get update
</span></span><span style=display:flex><span>root@shell-demo:/# apt-get install curl
</span></span><span style=display:flex><span>root@shell-demo:/# curl localhost
</span></span></code></pre></div><p>Keluarannya akan menunjukkan teks yang kamu tulis pada berkas <code>index.html</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Hello shell demo
</span></span></code></pre></div><p>Setelah kamu selesai dengan <em>shell</em> kamu, ketiklah <code>exit</code>.</p><h2 id=menjalankan-perintah-individu-di-dalam-sebuah-container>Menjalankan perintah individu di dalam sebuah Container</h2><p>Pada jendela (<em>window</em>) perintah biasa, bukan pada <em>shell</em> kamu di dalam Container,
lihatlah daftar variabel lingkungan (<em>environment variable</em>) pada Container yang sedang berjalan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> shell-demo env
</span></span></code></pre></div><p>Cobalah dengan menjalankan perintah lainnya. Berikut beberapa contohnya:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> shell-demo ps aux
</span></span><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> shell-demo ls /
</span></span><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> shell-demo cat /proc/1/mounts
</span></span></code></pre></div><h2 id=membuka-sebuah-shell-ketika-sebuah-pod-memiliki-lebih-dari-satu-container>Membuka sebuah <em>shell</em> ketika sebuah Pod memiliki lebih dari satu Container</h2><p>Jika sebuah Pod memiliki lebih dari satu Container, gunakanlah <code>--container</code> atau <code>-c</code> untuk
menentukan Container yang dimaksud pada perintah <code>kubectl exec</code>. Sebagai contoh,
misalkan kamu memiliki Pod yang bernama my-pod, dan Pod tersebut memiliki dua Container
yang bernama main-app dan helper-app. Perintah berikut ini akan membuka sebuah
<em>shell</em> ke Container dengan nama main-app.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#a2f>exec</span> -it my-pod --container main-app -- /bin/bash
</span></span></code></pre></div><h2 id=selanjutnya>Selanjutnya</h2><ul><li><a href=/docs/reference/generated/kubectl/kubectl-commands/#exec>kubectl exec</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-9e6e1b706f11386fe2c4b4ffda1409e4>9.3 - Perangkat untuk Memantau Sumber Daya</h1><p>Untuk melukan penyekalaan aplikasi dan memberikan Service yang handal, kamu perlu
memahami bagaimana aplikasi berperilaku ketika aplikasi tersebut digelar (<em>deploy</em>). Kamu bisa memeriksa
kinerja aplikasi dalam klaster Kubernetes dengan memeriksa Container,
<a href=/docs/user-guide/pods>Pod</a>, <a href=/docs/user-guide/services>Service</a>, dan
karakteristik klaster secara keseluruhan. Kubernetes memberikan detail
informasi tentang penggunaan sumber daya dari aplikasi pada setiap level ini.
Informasi ini memungkinkan kamu untuk mengevaluasi kinerja aplikasi kamu dan
mengevaluasi di mana kemacetan dapat dihilangkan untuk meningkatkan kinerja secara keseluruhan.</p><p>Di Kubernetes, pemantauan aplikasi tidak bergantung pada satu solusi pemantauan saja. Pada klaster baru, kamu bisa menggunakan <em>pipeline</em> <a href=#pipeline-metrik-sumber-daya>metrik sumber daya</a> atau <em>pipeline</em> <a href=#pipeline-metrik-penuh>metrik penuh</a> untuk mengumpulkan statistik pemantauan.</p><h2 id=pipeline-metrik-sumber-daya><em>Pipeline</em> Metrik Sumber Daya</h2><p><em>Pipeline</em> metrik sumber daya menyediakan sekumpulan metrik terbatas yang terkait dengan
komponen-komponen klaster seperti <em>controller</em> <a href=/id/docs/tasks/run-application/horizontal-pod-autoscaler>HorizontalPodAutoscaler</a>, begitu juga dengan utilitas <code>kubectl top</code>.
Metrik ini dikumpulkan oleh memori yang ringan, jangka pendek, dalam
<a href=https://github.com/kubernetes-incubator/metrics-server><em>metrics-server</em></a> dan
diekspos ke API <code>metrics.k8s.io</code>.</p><p><em>Metrics-server</em> menemukan semua Node dalam klaster dan
bertanya ke setiap
<a href=/docs/reference/command-line-tools-reference/kubelet>kubelet</a> dari Node tentang penggunaan CPU dan
memori. Kubelet bertindak sebagai jembatan antara <em>control plane</em> Kubernetes dan
Node, mengelola Pod dan Container yang berjalan pada sebuah mesin. Kubelet
menerjemahkan setiap Pod ke Container yang menyusunnya dan mengambil masing-masing
statistik penggunaan untuk setiap Container dari <em>runtime</em> Container melalui
antarmuka <em>runtime</em> Container. Kubelet mengambil informasi ini dari cAdvisor yang terintegrasi
untuk pengintegrasian Docker yang lama. Hal ini yang kemudian memperlihatkan
statistik penggunaan sumber daya dari kumpulan Pod melalui API sumber daya <em>metrics-server</em>.
API ini disediakan pada <code>/metrics/resource/v1beta1</code> pada kubelet yang terautentikasi dan
porta <em>read-only</em>.</p><h2 id=pipeline-metrik-penuh><em>Pipeline</em> Metrik Penuh</h2><p><em>Pipeline</em> metrik penuh memberi kamu akses ke metrik yang lebih banyak. Kubernetes bisa
menanggapi metrik ini secara otomatis dengan mengubah skala atau mengadaptasi klaster
berdasarkan kondisi saat ini, dengan menggunakan mekanisme seperti HorizontalPodAutoscaler.
<em>Pipeline</em> pemantauan mengambil metrik dari kubelet dan
kemudian memgekspos ke Kubernetes melalui adaptor dengan mengimplementasikan salah satu dari API
<code>custom.metrics.k8s.io</code> atau API <code>external.metrics.k8s.io</code>.</p><p><a href=https://prometheus.io>Prometheus</a>, sebuah proyek CNCF, yang dapat secara alami memonitor Kubernetes, Node, dan Prometheus itu sendiri.
Proyek <em>pipeline</em> metrik penuh yang bukan merupakan bagian dari CNCF berada di luar ruang lingkup dari dokumentasi Kubernetes.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d3c88a8663f58e9ec0bed73faff5b670>10 - TLS</h1></div><div class=td-content><h1 id=pg-9a87de8ee8332cb487f34a05debb1125>10.1 - Kelola Sertifikat TLS Pada Klaster</h1><p>Kubernetes menyediakan API <code>certificates.k8s.io</code> yang memungkinkan kamu membuat sertifikat
TLS yang ditandatangani oleh Otoritas Sertifikat (CA) yang kamu kendalikan. CA dan sertifikat ini
bisa digunakan oleh <em>workload</em> untuk membangun kepercayaan.</p><p>API <code>certificates.k8s.io</code> menggunakan protokol yang mirip dengan <a href=https://github.com/ietf-wg-acme/acme/>konsep ACME</a>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Sertifikat yang dibuat menggunakan API <code>certificates.k8s.io</code> ditandatangani oleh CA
khusus. Ini memungkinkan untuk mengkonfigurasi klaster kamu agar menggunakan CA <em>root</em> klaster untuk tujuan ini,
namun jangan pernah mengandalkan ini. Jangan berasumsi bahwa sertifikat ini akan melakukan validasi
dengan CA <em>root</em> klaster</div><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Untuk melihat versi, tekan <code>kubectl version</code>.</p><h2 id=mempercayai-tls-dalam-klaster>Mempercayai TLS dalam Klaster</h2><p>Mempercayai CA khusus dari aplikasi yang berjalan sebagai Pod biasanya memerlukan
beberapa tambahan konfigurasi aplikasi. Kamu harus menambahkan bundel sertifikat CA
ke daftar sertifikat CA yang dipercaya klien atau server TLS.
Misalnya, kamu akan melakukan ini dengan konfigurasi TLS golang dengan mengurai rantai sertifikat
dan menambahkan sertifikat yang diurai ke <code>RootCAs</code> di <em>struct</em>
<a href=https://godoc.org/crypto/tls#Config><code>tls.Config</code></a>.</p><p>Kamu bisa mendistribusikan sertifikat CA sebagai sebuah
<a href=/id/docs/tasks/configure-pod-container/configure-pod-configmap>ConfigMap</a> yang bisa diakses oleh Pod kamu.</p><h2 id=meminta-sertifikat>Meminta Sertifikat</h2><p>Bagian berikut mendemonstrasikan cara membuat sertifikat TLS untuk sebuah
Service kubernetes yang diakses melalui DNS.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Tutorial ini menggunakan CFSSL: PKI dan peralatan TLS dari Cloudflare <a href=https://blog.cloudflare.com/introducing-cfssl/>klik disini</a> untuk mengetahui lebih jauh.</div><h2 id=unduh-dan-pasang-cfssl>Unduh dan Pasang CFSSL</h2><p>Contoh ini menggunakan cfssl yang dapat diunduh pada
<a href=https://github.com/cloudflare/cfssl/releases>https://github.com/cloudflare/cfssl/releases</a>.</p><h2 id=membuat-certificatesigningrequest>Membuat CertificateSigningRequest</h2><p>Buat kunci pribadi dan CertificateSigningRequest (CSR) dengan menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF | cfssl genkey - | cfssljson -bare server
</span></span></span><span style=display:flex><span><span style=color:#b44>{
</span></span></span><span style=display:flex><span><span style=color:#b44>  &#34;hosts&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#34;my-svc.my-namespace.svc.cluster.local&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#34;my-pod.my-namespace.pod.cluster.local&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#34;192.0.2.24&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#34;10.0.34.2&#34;
</span></span></span><span style=display:flex><span><span style=color:#b44>  ],
</span></span></span><span style=display:flex><span><span style=color:#b44>  &#34;CN&#34;: &#34;my-pod.my-namespace.pod.cluster.local&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44>  &#34;key&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#34;algo&#34;: &#34;ecdsa&#34;,
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#34;size&#34;: 256
</span></span></span><span style=display:flex><span><span style=color:#b44>  }
</span></span></span><span style=display:flex><span><span style=color:#b44>}
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p><code>192.0.2.24</code> adalah klaster IP Service,
<code>my-svc.my-namespace.svc.cluster.local</code> adalah nama DNS Service,
<code>10.0.34.2</code> adalah IP Pod dan <code>my-pod.my-namespace.pod.cluster.local</code>
adalah nama DNS Pod. Kamu akan melihat keluaran berikut:</p><pre tabindex=0><code>2017/03/21 06:48:17 [INFO] generate received request
2017/03/21 06:48:17 [INFO] received CSR
2017/03/21 06:48:17 [INFO] generating key: ecdsa-256
2017/03/21 06:48:17 [INFO] encoded CSR
</code></pre><p>Perintah ini menghasilkan dua berkas; Ini menghasilkan <code>server.csr</code> yang berisi permintaan sertifikasi PEM
tersandi <a href=https://tools.ietf.org/html/rfc2986>pkcs#10</a>,
dan <code>server-key.pem</code> yang berisi PEM kunci yang tersandi untuk sertifikat yang
masih harus dibuat.</p><h2 id=membuat-objek-certificatesigningrequest-untuk-dikirim-ke-api-kubernetes>Membuat objek CertificateSigningRequest untuk dikirim ke API Kubernetes</h2><p>Buat sebuah yaml CSR dan kirim ke API Server dengan menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#b44>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#b44>apiVersion: certificates.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#b44>kind: CertificateSigningRequest
</span></span></span><span style=display:flex><span><span style=color:#b44>metadata:
</span></span></span><span style=display:flex><span><span style=color:#b44>  name: my-svc.my-namespace
</span></span></span><span style=display:flex><span><span style=color:#b44>spec:
</span></span></span><span style=display:flex><span><span style=color:#b44>  request: $(cat server.csr | base64 | tr -d &#39;\n&#39;)
</span></span></span><span style=display:flex><span><span style=color:#b44>  usages:
</span></span></span><span style=display:flex><span><span style=color:#b44>  - digital signature
</span></span></span><span style=display:flex><span><span style=color:#b44>  - key encipherment
</span></span></span><span style=display:flex><span><span style=color:#b44>  - server auth
</span></span></span><span style=display:flex><span><span style=color:#b44>EOF</span>
</span></span></code></pre></div><p>Perhatikan bahwa berkas <code>server.csr</code> yang dibuat pada langkah 1 merupakan base64 tersandi
dan disimpan di <em>field</em> <code>.spec.request</code>. Kami juga meminta
sertifikat dengan penggunaan kunci "<em>digital signature</em>", "<em>key enchiperment</em>", dan "<em>server
auth</em>". Kami mendukung semua penggunaan kunci dan penggunaan kunci yang diperpanjang yang terdaftar
<a href=https://godoc.org/k8s.io/api/certificates/v1beta1#KeyUsage>di sini</a>
sehingga kamu dapat meminta sertifikat klien dan sertifikat lain menggunakan
API yang sama.</p><p>CSR semestinya bisa dilihat dari API pada status <em>Pending</em>. Kamu bisa melihatnya dengan menjalankan:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl describe csr my-svc.my-namespace
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>Name:                   my-svc.my-namespace
Labels:                 &lt;none&gt;
Annotations:            &lt;none&gt;
CreationTimestamp:      Tue, 21 Mar 2017 07:03:51 -0700
Requesting User:        yourname@example.com
Status:                 Pending
Subject:
        Common Name:    my-svc.my-namespace.svc.cluster.local
        Serial Number:
Subject Alternative Names:
        DNS Names:      my-svc.my-namespace.svc.cluster.local
        IP Addresses:   192.0.2.24
                        10.0.34.2
Events: &lt;none&gt;
</code></pre><h2 id=mendapatkan-persetujuan-certificatesigningrequest>Mendapatkan Persetujuan CertificateSigningRequest</h2><p>Penyetujuan CertificateSigningRequest dapat dilakukan dengan otomatis
atau dilakukan sekali oleh administrator klaster. Informasi lebih lanjut tentang
apa yang terjadi dibahas dibawah ini.</p><h2 id=unduh-dan-gunakan-sertifikat>Unduh dan Gunakan Sertifikat</h2><p>Setelah CSR ditandatangani dan disetujui, kamu akan melihat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get csr
</span></span></code></pre></div><pre tabindex=0><code class=language-none data-lang=none>NAME                  AGE       REQUESTOR               CONDITION
my-svc.my-namespace   10m       yourname@example.com    Approved,Issued
</code></pre><p>Kamu bisa mengundur sertifikat yang telah diterbitkan dan menyimpannya ke berkas
<code>server.crt</code> dengan menggunakan perintah berikut:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get csr my-svc.my-namespace -o <span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#39;{.status.certificate}&#39;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>    | base64 --decode &gt; server.crt
</span></span></code></pre></div><p>Sekarang kamu bisa menggunakan <code>server.crt</code> dan <code>server-key.pem</code> sebagai pasangan
kunci untuk memulai server HTTPS kamu.</p><h2 id=penyetujuan-certificatesigningrequest>Penyetujuan CertificateSigningRequest</h2><p>Administrator Kubernetes (dengan izin yang cukup) dapat menyetujui secara manual
(atau menolak) Certificate Signing Requests dengan menggunakan perintah <code>kubectl certificate approve</code> dan <code>kubectl certificate deny</code>. Namun jika kamu bermaksud
untuk menggunakan API ini secara sering, kamu dapat mempertimbangkan untuk menulis
Certificate <em>controller</em> otomatis.</p><p>Baik itu mesin atau manusia yang menggunakan kubectl seperti di atas, peran pemberi persetujuan adalah
untuk memverifikasi bahwa CSR memenuhi dua persyaratan:</p><ol><li>Subjek CSR mengontrol kunci pribadi yang digunakan untuk menandatangani CSR. Ini
mengatasi ancaman pihak ketiga yang menyamar sebagai subjek resmi.
Pada contoh di atas, langkah ini adalah untuk memverifikasi bahwa Pod mengontrol
kunci pribadi yang digunakan untuk menghasilkan CSR.</li><li>Subjek CSR berwenang untuk bertindak dalam konteks yang diminta. Ini
mengatasi ancaman subjek yang tidak diinginkan bergabung dengan klaster. Dalam
contoh di atas, langkah ini untuk memverifikasi bahwa Pod diizinkan
berpartisipasi dalam Service yang diminta.</li></ol><p>Jika dan hanya jika kedua persyaratan ini dipenuhi, pemberi persetujuan harus menyetujui
CSR dan sebaliknya harus menolak CSR.</p><h2 id=peringatan-tentang-izin-persetujuan>Peringatan tentang Izin Persetujuan</h2><p>Kemampuan untuk menyetujui CSR menentukan siapa yang mempercayai siapa di dalam lingkungan kamu.
Kemampuan untuk menyetujui CSR tersebut seharusnya tidak diberikan secara luas.
Persyaratan tantangan yang disebutkan di bagian sebelumnya dan
dampak dari mengeluarkan sertifikat khusus, harus sepenuhnya dipahami
sebelum memberikan izin ini.</p><h2 id=catatan-untuk-administrator-klaster>Catatan Untuk Administrator Klaster</h2><p>Tutorial ini mengasumsikan bahwa penanda tangan diatur untuk melayani API sertifikat.
Kubernetes <em>controller manager</em> menyediakan implementasi bawaan dari penanda tangan. Untuk
mengaktifkan, berikan parameter <code>--cluster-signed-cert-file</code> dan
<code>--cluster-signed-key-file</code> ke <em>controller manager</em> dengan <em>path</em> ke
pasangan kunci CA kamu.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ba58efa15c6d46f10e34d799be220965>11 - Mengelola Daemon Klaster</h1><div class=lead>Melakukan tugas-tugas umum untuk mengelola sebuah DaemonSet, misalnya <em>rolling update</em>.</div></div><div class=td-content><h1 id=pg-f1bf7e426f482a85e1a417d1fd9ea7b7>11.1 - Melakukan Rollback pada DaemonSet</h1><p>Laman ini memperlihatkan bagaimana caranya untuk melakukan <em>rollback</em> pada sebuah <a class=glossary-tooltip title='Memastikan salinan Pod dijalankan pada sekumpulan Node dalam satu klaster.' data-toggle=tooltip data-placement=top href=/id/docs/concepts/workloads/controllers/daemonset target=_blank aria-label=DaemonSet>DaemonSet</a>.</p><h2 id=sebelum-kamu-memulai>Sebelum kamu memulai</h2><p><p>Kamu harus memiliki klaster Kubernetes, dan perangkat baris perintah kubectl
juga harus dikonfigurasikan untuk berkomunikasi dengan klastermu. Jika kamu
belum memiliki klaster, kamu dapat membuatnya dengan menggunakan
<a href=/id/docs/tasks/tools/#minikube>minikube</a>,
atau kamu juga dapat menggunakan salah satu dari tempat mencoba Kubernetes berikut ini:</p><ul><li><a href=https://killercoda.com/playgrounds/scenario/kubernetes>Killercoda</a></li><li><a href=http://labs.play-with-k8s.com/>Bermain dengan Kubernetes</a></li></ul>Kubernetes servermu harus dalam versi yang sama atau lebih baru dari 1.7.
Untuk melihat versi, tekan <code>kubectl version</code>.</p><p>Sebelum lanjut, alangkah baiknya jika kamu telah mengetahui cara
untuk <a href=/docs/tasks/manage-daemon/update-daemon-set/>melakukan <em>rolling update</em> pada sebuah DaemonSet</a>.</p><h2 id=melakukan-rollback-pada-daemonset>Melakukan <em>rollback</em> pada DaemonSet</h2><h3 id=langkah-1-dapatkan-nomor-revisi-daemonset-yang-ingin-dikembalikan>Langkah 1: Dapatkan nomor revisi DaemonSet yang ingin dikembalikan</h3><p>Lompati langkah ini jika kamu hanya ingin kembali (<em>rollback</em>) ke revisi terakhir.</p><p>Perintah di bawah ini akan memperlihatkan daftar semua revisi dari DaemonSet:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl rollout <span style=color:#a2f>history</span> daemonset &lt;nama-daemonset&gt;
</span></span></code></pre></div><p>Perintah tersebut akan menampilkan daftar revisi seperti di bawah:</p><pre tabindex=0><code>daemonsets &#34;&lt;nama-daemonset&gt;&#34;
REVISION        CHANGE-CAUSE
1               ...
2               ...
...
</code></pre><ul><li>Alasan perubahan (<em>change cause</em>) kolom di atas merupakan salinan dari anotasi <code>kubernetes.io/change-cause</code> yang berkaitan dengan revisi pada DaemonSet. Kamu boleh menyetel <em>flag</em> <code>--record=true</code> melalui <code>kubectl</code> untuk merekam perintah yang dijalankan akibat dari anotasi alasan perubahan.</li></ul><p>Untuk melihat detail dari revisi tertentu, jalankan perintah di bawah ini:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl rollout <span style=color:#a2f>history</span> daemonset &lt;daemonset-name&gt; --revision<span style=color:#666>=</span><span style=color:#666>1</span>
</span></span></code></pre></div><p>Perintah tersebut memberikan detail soal nomor revisi tertentu:</p><pre tabindex=0><code>daemonsets &#34;&lt;nama-daemonset&gt;&#34; with revision #1
Pod Template:
Labels:       foo=bar
Containers:
app:
 Image:        ...
 Port:         ...
 Environment:  ...
 Mounts:       ...
Volumes:      ...
</code></pre><h3 id=langkah-2-rollback-ke-revisi-tertentu>Langkah 2: <em>Rollback</em> ke revisi tertentu</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># Tentukan nomor revisi yang kamu dapatkan dari Langkah 1 melalui --to-revision</span>
</span></span><span style=display:flex><span>kubectl rollout undo daemonset &lt;nama-daemonset&gt; --to-revision<span style=color:#666>=</span>&lt;nomor-revisi&gt;
</span></span></code></pre></div><p>Jika telah berhasil, perintah tersebut akan memberikan keluaran berikut:</p><pre tabindex=0><code>daemonset &#34;&lt;nama-daemonset&gt;&#34; rolled back
</code></pre><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Jika <em>flag</em> <code>--to-revision</code> tidak diberikan, maka kubectl akan memilihkan revisi yang terakhir.</div><h3 id=langkah-3-lihat-progres-pada-saat-rollback-daemonset>Langkah 3: Lihat progres pada saat <em>rollback</em> DaemonSet</h3><p>Perintah <code>kubectl rollout undo daemonset</code> memberitahu server untuk memulai <em>rollback</em> DaemonSet.
<em>Rollback</em> sebenarnya terjadi secara <em>asynchronous</em> di dalam klaster <a class=glossary-tooltip title='Merupakan lapisan orkestrasi Container yang mengekspos API dan antarmuka untuk mendefinisikan, menggelar, dan mengelola siklus hidup suatu Container.' data-toggle=tooltip data-placement=top href='/id/docs/reference/glossary/?all=true#term-control-plane' target=_blank aria-label='_control plane_'>_control plane_</a>.</p><p>Perintah di bawah ini dilakukan untuk melihat progres dari <em>rollback</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl rollout status ds/&lt;nama-daemonset&gt;
</span></span></code></pre></div><p>Ketika <em>rollback</em> telah selesai dilakukan, keluaran di bawah akan ditampilkan:</p><pre tabindex=0><code>daemonset &#34;&lt;nama-daemonset&gt;&#34; successfully rolled out
</code></pre><h2 id=memahami-revisi-daemonset>Memahami revisi DaemonSet</h2><p>Pada langkah <code>kubectl rollout history</code> sebelumnya, kamu telah mendapatkan
daftar revisi DaemonSet. Setiap revisi disimpan di dalam sumber daya bernama ControllerRevision.</p><p>Untuk melihat apa yang disimpan pada setiap revisi, dapatkan sumber daya mentah (<em>raw</em>) dari
revisi DaemonSet:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get controllerrevision -l &lt;kunci-selektor-daemonset&gt;<span style=color:#666>=</span>&lt;nilai-selektor-daemonset&gt;
</span></span></code></pre></div><p>Perintah di atas akan mengembalikan daftar ControllerRevision:</p><pre tabindex=0><code>NAME                               CONTROLLER                     REVISION   AGE
&lt;nama-daemonset&gt;-&lt;hash-revisi&gt;   DaemonSet/&lt;nama-daemonset&gt;     1          1h
&lt;nama-daemonset&gt;-&lt;hash-revisi&gt;   DaemonSet/&lt;nama-daemonset&gt;     2          1h
</code></pre><p>Setiap ControllerRevision menyimpan anotasi dan templat dari sebuah revisi DaemonSet.</p><p>Perintah <code>kubectl rollout undo</code> mengambil ControllerRevision yang spesifik dan mengganti templat
DaemonSet dengan templat yang tersimpan pada ControllerRevision.
Perintah <code>kubectl rollout undo</code> sama seperti untuk memperbarui templat
DaemonSet ke revisi sebelumnya dengan menggunakan perintah lainnya, seperti <code>kubectl edit</code> atau <code>kubectl apply</code>.</p><div class="alert alert-info note callout" role=alert><strong>Catatan:</strong> Revisi DaemonSet hanya bisa <em>roll</em> ke depan. Artinya, setelah <em>rollback</em> selesai dilakukan,
nomor revisi dari ControllerRevision (<em>field</em> <code>.revision</code>) yang sedang di-<em>rollback</em> akan maju ke depan.
Misalnya, jika kamu memiliki revisi 1 dan 2 pada sistem, lalu <em>rollback</em> dari revisi 2 ke revisi 1,
ControllerRevision dengan <code>.revision: 1</code> akan menjadi <code>.revision: 3</code>.</div><h2 id=troubleshoot><em>Troubleshoot</em></h2><ul><li>Lihat cara untuk melakukan <a href=/docs/tasks/manage-daemon/update-daemon-set/#troubleshooting><em>troubleshoot rolling update</em> pada DaemonSet</a>.</li></ul></div></main></div></div><footer class=d-print-none><div class=footer__links><nav><a class=text-white href=/id/docs/home/>Home</a>
<a class=text-white href=/id/community/>Komunitas</a>
<a class=text-white href=/id/case-studies/>Studi kasus</a></nav></div><div class=container-fluid><div class=row><div class="col-6 col-sm-2 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank href=https://discuss.kubernetes.io><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank href=https://twitter.com/kubernetesio><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar><a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io"><i class="fas fa-calendar-alt"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank href=https://youtube.com/kubernetescommunity><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-2 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank href=https://slack.k8s.io><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute><a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide><i class="fas fa-edit"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-12 col-sm-8 text-center order-sm-2"><small class=text-white>&copy; 2023 Para Pencipta Kubernetes | Dokumentasi didistribusikan di bawah <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small><br><small class=text-white>Copyright &copy; 2023 Linux Foundation &reg;. Hak cipta dilindungi. Linux Foundation telah mendaftarkan merek dagang dan pengunaannya. Perinciannya bisa dilihat pada <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>halaman penggunaan merek dagang</a></small><br><small class=text-white>ICP license: 京ICP备17074266号-3</small></div></div></div></footer></div><script src=/js/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=/js/popper-1.16.1.min.js intregrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=/js/bootstrap-4.6.1.min.js integrity=sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2 crossorigin=anonymous></script>
<script src=/js/script.js></script>
<script async src=/js/mermaid-8.13.4.min.js integrity=sha384-5hHNvPeMrNH14oM3IcQofDoBhiclNK3g2+hnEinKzQ07C4AliMeVpnvxuiwEGpaO crossorigin=anonymous></script>
<script src=/js/main.min.5c0bf7f21dc4f66485f74efbbeeff28a7e4f8cddaac1bae47043159c922ff3a3.js integrity="sha256-XAv38h3E9mSF9077vu/yin5PjN2qwbrkcEMVnJIv86M=" crossorigin=anonymous></script></body></html>